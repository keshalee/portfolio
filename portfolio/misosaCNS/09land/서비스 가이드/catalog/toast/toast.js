!function(a,b){"function"==typeof define&&define.amd?define("toast/core",["exports","strings"],function(c,d){b(a,c,d,Backbone,_,$)}):b(a,{},{},a.Backbone,a._,a.jQuery||a.$)}(this,function(a,b,c,d,e,f){if(b.version="5.8.422",window.__app__=window.Toast=window.TOAST=window.TT=window.tt=window._tt=window._t=b,b.Strings=c,b.extensions={},b.metadata={},b.debug=e.isUndefined(window.debug)?!1:window.debug,"MacIntel"===window.navigator.platform||"MacPPC"===window.navigator.platform?b.platform="mac":window.navigator.platform.indexOf("Linux")>=0?b.platform="linux":b.platform="win",e.isUndefined(window.isMobileDevice)&&e.isUndefined(window.isMobile)?b.isMobile=b.isMobileDevice=window.navigator.userAgent.match(/mobile|ip(ad|hone|od)|android/i):b.isMobile=b.isMobileDevice=window.isMobileDevice,b.isMobileDevice&&(e.isUndefined(window.isTablet)?b.isTablet=window.navigator.userAgent.match(/tablet|ipad/i):b.isTablet=window.isTablet),b.isMobileDevice&&(b.isMobileDevice=!0),e.isUndefined(window.isAndroid)?b.isAndroid=window.navigator.userAgent.match(/android/i):b.isAndroid=window.isAndroid,b.isAndroid&&(b.isAndroid=!0),/msie|trident/i.test(navigator.userAgent)){var g=navigator.userAgent.toString().toLowerCase(),h=/(msie) ([\w.]+)/.exec(g)||/(trident)(?:.*rv:([\w.]+))?/.exec(g)||["",null,-1];b._msieVersion=h[2],e.isEmpty(b._msieVersion)||(b._msieVersion=Number(b._msieVersion))}b.UUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.UUID16=function(){return"xxxxxxxx-xxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.UUID8=function(){return"xxxx-xxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.UUID6=function(){return"xxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.UUID4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},b.dateUUID=function(){var a=new Date,c=a.getFullYear();return c=c.toString().substr(2,2),c+(a.getMonth()+1)+a.getDate()+a.getHours()+a.getMinutes()+"-"+b.UUID4()},e.extend(b,d.Events,{}),b.dispatch=b.send=b.trigger.bind(b);b.extend=function(a,b){var c,d=this;c=a&&e.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},e.extend(c,d,b);var f=function(){this.constructor=c};return f.prototype=d.prototype,c.prototype=new f,a&&e.extend(c.prototype,a),c.__super__=d.prototype,c};b.debug===!0&&window.console&&window.console.log?b._msieVersion&&b._msieVersion<10?b.log=Function.prototype.bind.call(console.log,console):b.log=void 0:b.log=function(){},ttlog=b.log}),define("toast/core/Init",["../core"],function(a){"use strict";function b(a){try{a()}catch(b){}}function c(a,c){m[a]?b(c):n[a].push(c)}function d(a,c){var d,e=n[a];for(c||(c={once:!0}),m[a]=!0,d=0;d<e.length;d++)b(e[d]);c.once&&(n[a]=[])}function e(a){c(k,a)}function f(a){c(i,a)}function g(a){c(j,a)}function h(a){c(l,a)}var i="projectLoaded",j="htmlReady",k="appReady",l="extensionsLoaded",m={PROJECT_LOADED:!1,HTML_READY:!1,APP_READY:!1,EXTENSIONS_LOADED:!1},n={};n[i]=[],n[j]=[],n[k]=[],n[l]=[],a.appReady=e,a.projectLoaded=f,a.htmlReady=g,a.extensionsLoaded=h,a.dispatchReady=d,a.addListener=c,a.PROJECT_LOADED=i,a.HTML_READY=j,a.APP_READY=k,a.EXTENSIONS_LOADED=l}),define("toast/core/Model",["../core"],function(a){"use strict";var b=Backbone.Model.extend({initialize:function(a){for(var b in this.attributes)b!=this.idAttribute&&this.defineProperty(b)},moveUp:function(a){var b=this.__children__.indexOf(a);return-1!=b?(this.__children__.splice(b-1,0,this.__children__.splice(b,1)[0]),b-1):-1},moveFirst:function(a){return this.moveAtIndex(a,0)},moveDown:function(a){var b=this.__children__.indexOf(a);return-1!=b?(this.__children__.splice(b+1,0,this.__children__.splice(b,1)[0]),b+1):-1},moveLast:function(a){return this.moveAtIndex(a,this.__children__.length-1)},moveAtIndex:function(a,b){var c=this.__children__.indexOf(a);return-1!=c?(this.__children__.splice(b,0,this.__children__.splice(c,1)[0]),b):-1},remove:function(a){var b=this.__children__.indexOf(a);-1!=b&&(a.__children__=[],this.__children__.splice(this.__children__.indexOf(a),1))},childIndexOf:function(a){return this.__children__.indexOf(a)},hasChildren:function(){return this.__children__&&this.__children__.length>0},topParent:function(){for(var a=this;;){if(!a.__parent__)break;a=a.__parent__}return a},rect:function(){return{left:this.get("left"),top:this.get("top"),width:this.get("width"),height:this.get("height")}},isDraggable:function(){return!this.get("locked")&&!this.get("hidden")&&this.get("draggable")},output:function(a){var b=_.clone(this.attributes);return b.children=[],delete b.__parent__,delete b.__children__,delete b.draggable,delete b.selected,delete b.isModified,b.thumbUrl&&delete b.thumbUrl,this.__children__.length>0&&this._outputChildren(this,b),b},_outputChildren:function(a,b){_.each(a.__children__,function(a){var c=_.clone(a.attributes);c.children=[],delete c.__parent__,delete c.__children__,delete c.draggable,delete c.selected,delete c.isModified,c.thumbUrl&&delete c.thumbUrl,b.children.push(c),a.__children__.length>0&&this._outputChildren(a,c)},this)}});return a.Model=b}),define("toast/core/Collection",["../core","./Model"],function(a,b){"use strict";var c=Backbone.Collection.extend({attributes:{},initialize:function(a){a||(a={}),arguments.length>1&&(a=arguments[1]),this.attributes=_.extend({},a.attributes);for(var b in this.attributes)this.defineProperty(b)},attr:function(a){return 2!=arguments.length?this.attributes[a]:void(this.attributes[a]=arguments[1])},moveUp:function(a){var b=this.indexOf(a);return b>1?(this.remove(a,{silent:!0}),this.add(a,{at:b-1,silent:!0}),b-1):-1},moveFirst:function(a){return this.moveAtIndex(a,0)},moveDown:function(a){var b=this.indexOf(a);return b<this.models.length?(this.remove(a,{silent:!0}),this.add(a,{at:b+1,silent:!0}),b+1):-1},moveLast:function(a){return this.moveAtIndex(a,this.length-1)},moveAtIndex:function(a,b){return b<this.models.length?(this.remove(a,{silent:!0}),this.add(a,{at:b,silent:!0}),b):-1},remove:function(a,b){if(_.isArray(a))for(var c=0,d=a.length;d>c;c++){var e=a[c],f=this.indexOf(e);e.modelIndex=f}else{var f=this.indexOf(a);a.modelIndex=f}Backbone.Collection.prototype.remove.call(this,a,b)},load:function(a,b){},createWithAttrs:function(a,b){b||(b={}),a=$.extend(!0,{},a);var c=new this.model(a);return this.createChildren(c,a),c.unset("children",{silent:!0}),this.add(c,b),c},createChildren:function(a,b){var c=b.children;_.each(c,function(b){b=$.extend(!0,{},b);var c=new this.model(b);c.__parent__=a,a.__children__||(a.__children__=[]),a.__children__.push(c),b.children&&this.createChildren(c,b)},this)},output:function(a){return this.map(function(b){return b.output(a)})}});return a.Collection=c}),define("toast/core/Contents",["../core","./Collection","./Model"],function(a,b,c){"use strict";var d=(b.prototype,b.extend());return _.extend(d.prototype,{load:function(a,b){this.reset(),"string"==typeof a&&(a=JSON.parse(a));var c=$.extend(!0,{},a.contents);a.contents&&delete a.contents;var d=this.attributes;this.attributes=_.extend(d,a);for(var e in this.attributes)this.defineProperty(e);_.each(c,function(a){var c=new this.model(a);this.createChildren(c,a),c.unset("children",{silent:!0}),this.add(c,b)},this)},moveAtIndex:function(a,b){return b<this.models.length?(b=Math.max(1,b),this.remove(a,{silent:!0}),this.add(a,{at:b,silent:!0}),b):-1}}),a.Contents=d}),define("toast/actions/Action",["../core"],function(Toast){"use strict";var Action=Toast.Action=function(a,b,c){b||(b={}),c||(c={}),this.id=Toast.UUID4().prefix("a"),this.view=a,this.properties=b,this.options=c,this.initialize.apply(this,arguments)};return _.extend(Action.prototype,Backbone.Events,{initialize:function(a,b,c){},execute:function(){}}),_.extend(Action,{create:function(view,action,options){var Action=eval("Toast.Action."+action.name);if(!Action)return null;var instance=new Action(view,action.properties,options);return instance}}),Action.extend=Toast.extend,Toast.Action=Action}),define("toast/actions/LinkUrl",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){var a=this.properties.url;if(!_.isEmpty(a)){if(a.length>4&&"tel:"===a.substr(0,4).toLowerCase())return void(window.location.href=a);-1===a.indexOf("../")&&-1===a.indexOf("./")&&"http:"!==a.protocol()&&"https"!==a.protocol()&&(a="http://"+this.properties.url),this.properties.openWindow?window.open(a):window.location.href=a}}}),a.Action.LinkUrl=d}),define("toast/actions/GotoPage",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){_.isEmpty(this.properties.selectPage)?_.isUndefined(this.properties.pageNumber)||(a.BookZoom._off(),a.Book.move(this.properties.pageNumber,{isLogical:!0}),a.lazy(function(){a.BookZoom._on()},300)):(a.BookZoom._off(),"firstPage"===this.properties.selectPage?a.Book.moveToFirst():"previousPage"===this.properties.selectPage?a.Book.previous():"nextPage"===this.properties.selectPage?a.Book.next():"lastPage"===this.properties.selectPage&&a.Book.moveToLast(),a.lazy(function(){a.BookZoom._on()},300))}}),a.Action.GotoPage=d}),define("toast/actions/Visible",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d),_.isUndefined(this.properties.visible)&&(this.properties.visible="toggle"),_.isEmpty(this.properties.targets)&&(this.properties.targets=[a.model.id])},execute:function(){_.each(this.properties.targets,function(a){var b=this.view.viewController.find("id",a);b&&("toggle"===this.properties.visible?(b.view.$parent.toggle(),this._execute(b,b.view.$parent)):"visible"===this.properties.visible?b.view.$parent.is(":visible")||(b.view.$parent.show(),this._execute(b,b.view.$parent)):b.view.$parent.is(":visible")&&(b.view.$parent.hide(),this._execute(b,b.view.$parent)))},this)},_execute:function(a,b){b.is(":visible")?a.view.onShow():a.view.onHide(),_.each(a.__children__,function(a){this._execute(a,b)},this)}}),a.Action.Visible=d}),define("toast/actions/StopAllSound",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d),this.options.excludes||(this.options.excludes=[])},execute:function(){var b=$("audio");_.each(b,function(b){var c=$(b),d=c.parents(".toast-object");0!==d.length?this._skip(d)||a.send(a.Events.STOP_ALL_SOUND,this.options.reset):0!==b.readyState&&(this._skip(c)||(b.pause(),this.options.reset!==!0||_.isUndefined(b.currentTime)||(b.currentTime=0)))},this)},_skip:function(a){var b;return _.any(this.options.excludes,function(c){return c===a.attr("id")?(b=!0,!0):void 0}),b}}),a.Action.StopAllSound=d}),define("toast/actions/ToggleSound",["../core","./Action","./StopAllSound"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{initialize:function(b,c,e){d.initialize.call(this,b,c,e),this._asset=a.AudioAssets.get(this.properties.asset),_.isEmpty(this._asset)||(_.isEmpty(this._asset.id)?_.isEmpty(this.properties.url)||(this._assetid=this.properties.url.getBaseName().getFilenameWithoutExtension()):this._assetid=this._asset.id,this._assetid&&(this._$audio=this.view.viewController.$el.children("#"+this._assetid),_.isUndefined(this._$audio[0])&&(this._$audio=$("<audio />"),this._$audio.attr({id:this._assetid,src:this._getUrl()}),this._$audio.hide(),this.view.viewController.$el.append(this._$audio),this.view.__on__(a.Events.PAGE_DID_CHANGE,this._onPageDidChange,this),this.view.__on__(a.Events.PAGE_DID_UNLOAD,this._onPageDidUnLoad,this))))},execute:function(){_.isEmpty(this._assetid)||(this._stopAllSoundOnce(),0!==this._$audio[0].readyState&&this._playAndPause())},_getUrl:function(){var b;return this._asset.url?b=this._asset.url:this.properties.url&&(b=this.properties.url,-1===b.indexOf("../")&&-1===b.indexOf("./")&&"http:"!==b.protocol()&&"https"!==b.protocol()&&(b="http://"+this.properties.url)),b&&(b=a.StringUtils.replaceTemplate(b).encodeFilePath()),b},_stopAllSoundOnce:function(){this._doStopAllSoundOnce!==!0&&new c(this.view,this.properties,{excludes:[this._asset.id],reset:!0}).execute(),this._doStopAllSoundOnce=!0},_playAndPause:function(){this._$audio[0].paused?this._$audio[0].play():this._$audio[0].pause()},_onPageDidChange:function(b,c){_.isUndefined(this._$audio[0])||0===this._$audio[0].readyState||a.Book.availableCurrentPage(this.view.viewController.index+1)||(this._$audio[0].pause(),_.isUndefined(this._$audio[0].currentTime)||(this._$audio[0].currentTime=0))},_onPageDidUnLoad:function(a){this.view.viewController.index+1===a&&(_.isUndefined(this._$audio[0])||(this._$audio.remove(),delete this._$audio[0]))}}),a.Action.ToggleSound=e}),define("toast/actions/PlaySound",["../core","./Action","./StopAllSound"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{initialize:function(b,c,e){d.initialize.call(this,b,c,e),this._asset=a.AudioAssets.get(this.properties.asset),_.isEmpty(this._asset)||(_.isEmpty(this._asset.id)?_.isEmpty(this.properties.url)||(this._assetid=this.properties.url.getBaseName().getFilenameWithoutExtension()):this._assetid=this._asset.id,this._assetid&&(this._$audio=this.view.viewController.$el.children("#"+this._assetid),_.isUndefined(this._$audio[0])&&(this._$audio=$("<audio />"),this._$audio.attr({id:this._assetid,src:this._getUrl()}),this._$audio.hide(),this.view.viewController.$el.append(this._$audio),this.view.__on__(a.Events.PAGE_DID_CHANGE,this._onPageDidChange,this),this.view.__on__(a.Events.PAGE_DID_UNLOAD,this._onPageDidUnLoad,this))))},execute:function(){_.isEmpty(this._assetid)||(this._stopAllSoundOnce(),0!==this._$audio[0].readyState&&this._play())},_getUrl:function(){var b;return this._asset.url?b=this._asset.url:this.properties.url&&(b=this.properties.url,-1===b.indexOf("../")&&-1===b.indexOf("./")&&"http:"!==b.protocol()&&"https"!==b.protocol()&&(b="http://"+this.properties.url)),b&&(b=a.StringUtils.replaceTemplate(b).encodeFilePath()),b},_stopAllSoundOnce:function(){this._doStopAllSoundOnce!==!0&&new c(this.view,this.properties,{excludes:[this._asset.id],reset:!0}).execute(),this._doStopAllSoundOnce=!0},_play:function(){0!==this._$audio[0].readyState&&(this._$audio[0].pause(),this.properties.replay&&!_.isUndefined(this._$audio[0].currentTime)&&(this._$audio[0].currentTime=0),this._$audio[0].play())},_stop:function(){_.isUndefined(this._$audio[0])||0===this._$audio[0].readyState||(this._$audio[0].pause(),_.isUndefined(this._$audio[0].currentTime)||(this._$audio[0].currentTime=0))},_onPageDidChange:function(b,c){a.Book.availableCurrentPage(this.view.viewController.index+1)||this._stop()},_onPageDidUnLoad:function(a){this.view.viewController.index+1===a&&(_.isUndefined(this._$audio[0])||(this._$audio.remove(),delete this._$audio[0]))}}),a.Action.PlaySound=e}),define("toast/actions/ToggleAudioPlayer",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){_.each(this.properties.targets,function(a){var b=this.view.viewController.$el.find("#"+a);b.toggle(),this.properties.autoplay===!0&&_.each(this.view.viewController.collection.models,function(c){_.isUndefined(c.view)||c.id!==a||(b.is(":visible")?c.view.play():c.view.pause())},this)},this)}}),a.Action.ToggleAudioPlayer=d}),define("toast/actions/StopSound",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){var a=$("audio");_.each(a,function(a){var b=$(a);_.any(this.properties.assets,function(c){if(c===b.attr("id"))return 0!==a.readyState&&(a.pause(),this.properties.reset!==!0||_.isUndefined(a.currentTime)||(a.currentTime=0)),!0;if(c===b.attr("data-audio-id")){0!==a.readyState&&a.pause();var d=b.parents(".audioplayer");return d.removeClass("audioplayer-playing"),this.properties.reset!==!0||_.isUndefined(a.currentTime)||(a.currentTime=0),b.trigger("timeupdate"),!0}},this)},this)}}),a.Action.StopSound=d}),define("toast/utils/StringUtils",["../core"],function(a){"use strict";_.extend(String.prototype,{trim:function(){return this.replace(/^\s+|\s+$/g,"")},repeat:function(){return new Array(1+n).join(this)},isNumeric:function(){return!jQuery.isArray(this)&&this-parseFloat(this)+1>=0},encodeFilePath:function(){if("file:"!==window.document.location.href.substr(0,5))return this;var b=this.split("/");b=b.map(function(a){return encodeURIComponent(a)});var c=b.join("/");return"win"===a.platform&&(c="file:///"+c),c},protocol:function(){return this.substr(0,5)},camelCase:function(){return this.replace(/(?:^|\s)\w/g,function(a){return a.toUpperCase()})},removeTags:function(a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var b=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,c=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return this.replace(c,"").replace(b,function(b,c){return a.indexOf("<"+c.toLowerCase()+">")>-1?b:""})},getBaseName:function(){var a=this,b=a.lastIndexOf("/");if(b===a.length-1)return a.slice(a.lastIndexOf("/",a.length-2)+1,-1);if(-1!==b)return a.slice(b+1);var c=a.lastIndexOf("}");return-1!==c?a.slice(c+1):a},getDirectoryPath:function(){return this.substr(0,this.lastIndexOf("/")+1)},getParentPath:function(){var a=this;return"/"===a?"":a.substring(0,a.lastIndexOf("/",a.length-2)+1)},getFileExtension:function(){var a=this.lastIndexOf(".");return-1===a?"":this.substr(a+1)},getFilenameWithoutExtension:function(){var a=this.lastIndexOf(".");return-1===a?this:this.slice(0,a)},prefix:function(a){return a+this},suffix:function(a){return this+a},namespace:function(a,b){for(var c=this.split(b||"."),d=window,e="",f=0,g=c.length;g>f;f++)e=c[f],d[e]=d[e]||{},d=d[e];return a&&(d[e]=a),d}});var b=a.StringUtils={templateStrings:{}};return _.extend(b,{trim:function(a){return a.replace(/^\s+|\s+$/g,"")},repeat:function(a){return new Array(1+n).join(a)},isNumeric:function(a){return!jQuery.isArray(a)&&a-parseFloat(a)+1>=0},encodeFilePath:function(b){if("file:"!==window.document.location.href.substr(0,5))return b;var c=b.split("/");c=c.map(function(a){return encodeURIComponent(a)});var d=c.join("/");return"file:"===window.document.location.href.substr(0,5)&&"win"===a.platform&&(d="file:///"+d),d},format:function(a){var b=[].slice.call(arguments,1);return a.replace(/\{(\d+)\}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})},replaceTemplate:function(a,b,c){if(1==arguments.length){var d=a;return _.any(this.templateStrings,function(a,b){return-1!==d.indexOf("{"+b+"}")?(d=d.replace(new RegExp("{"+b+"}","g"),a),!0):void 0}),d}return a.replace(new RegExp("{"+b+"}","g"),c)},regexEscape:function(a){return a.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1")},jQueryIdEscape:function(a){return a.replace(/\./g,"\\.")},getLines:function(a){return a.split("\n")},offsetToLineNum:function(a,b){if(Array.isArray(a)){var c,d=a,e=0;for(c=0;c<d.length;c++){if(!(b>e))return e===b?c:c-1;e+=d[c].length+1}return e>=b?c-1:void 0}return a.substr(0,b).split("\n").length-1},endsWith:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},urlSort:function(a,b){function c(a){return a.lastIndexOf("/")+1<a.length}var d,e;return"win"===Sunshine.platform?(d=(c(a)?"1":"0")+a.toLowerCase(),e=(c(b)?"1":"0")+b.toLowerCase()):(d=a.toLowerCase(),e=b.toLowerCase()),d===e?0:d>e?1:-1},breakableUrl:function(a){var b=_.escape(a);return b.replace(new RegExp(this.regexEscape("/"),"g"),"/&#8203;")},prettyPrintBytes:function(a,b){var c=1024,d=1024*c,e=1024*d,f=1024*e,g=a;if(a>=0&&c>a)g=a+" B";else if(d>a)g=(a/c).toFixed(b)+" KB";else if(e>a)g=(a/d).toFixed(b)+" MB";else if(f>a)g=(a/e).toFixed(b)+" GB";else if(a>=f)return(a/f).toFixed(b)+" TB";return g},truncate:function(a,b){if(a.length>b){a=a.substr(0,b);var c=a.lastIndexOf(" ");return b>c&&c>-1&&(a=a.substr(0,c)),a}},prettyXml:function(a){var b="",c=/(>)(<)(\/*)/g;a=a.replace(c,"$1\r\n$2$3");var d=0;return jQuery.each(a.split("\r\n"),function(a,c){var e=0;c.match(/.+<\/\w[^>]*>$/)?e=0:c.match(/^<\/\w/)?0!=d&&(d-=1):e=c.match(/^<\w[^>]*[^\/]>.*$/)?1:0;for(var f="",g=0;d>g;g++)f+="  ";b+=f+c+"\r\n",d+=e}),b}}),b}),define("toast/actions/PopupActionBase",["../core","../utils/StringUtils","./Action"],function(a,b,c){"use strict";var d,e=c.prototype,f=c.extend();return _.extend(f.prototype,e,{initialize:function(b,c,f){d=a.ThemeLoader.getHTMLTemplates().PopupModal,e.initialize.call(this,b,c,f)},execute:function(){var a={modalDialogMaxWidth:this.properties.width},b=Mustache.render(d,a);this.$el=$(b),$(document.body).append(this.$el),this.$el.find(".modal-body").children(".preloader").show(),this.$container=$("<div />",{"class":"popup-container"}),_.isEmpty(this.properties.width)||this.$container.css("width",this.properties.width+"px"),_.isEmpty(this.properties.height)||this.$container.css("height",this.properties.height+"px"),this.$container.append(this._$render=this._render()),this.properties.scrollbarHidden===!0?(this.$container.css("overflow","hidden"),"IFRAME"===this._$render[0].tagName&&this._$render.attr("scrolling","no")):TT.isMobileDevice&&(this.$container.css({"overflow-y":"auto","-webkit-overflow-scrolling":"touch"}),this.$container.css("width","auto")),this._$render.hide(),this.$el.find(".modal-body").append(this.$container),this.$modalContent=this.$el.find(".modal-content"),this.$modalContent.css({left:"50%"}),this.$el.find(".close").on("click",$.proxy(this._dismiss,this)),this.$el.on("click",$.proxy(this._dismiss,this)),$(window).on("resize",$.proxy(this._didResize,this)),this._updateSize(),"IFRAME"===this._$render[0].tagName?TT.lazy(function(){this._$render.on("load",$.proxy(this._didLoadContent,this)),this._didPopupMount()},0,this):this._didPopupMount()},_render:function(){return $("<div />")},_didPopupMount:function(){},_didLoadContent:function(){this._$render.show(),this.$el.find(".modal-body").children(".preloader").hide(),this.$modalContent.css({left:"50%"}),this._updateSize()},_didResize:function(a){this._updateSize()},_updateSize:function(){var a=window.innerWidth,b=window.innerHeight;if(0!==this.$el.find(".modal-body").children(".close").length&&(a-=50),!_.isUndefined(this._$render)){var c,d,e=Math.max(this.properties.width/a,this.properties.height/b);this.properties.extractFit?(c=this.properties.width/e,d=this.properties.height/e):this.properties.width>a||this.properties.height>b?(c=this.properties.width/e,d=this.properties.height/e):(c=this.properties.width,d=this.properties.height),this.$container.css({width:c+"px",height:d+"px"}),this.$modalContent.css({width:this.$container.width()+"px",marginLeft:-(this.$container.width()/2)+"px"})}},_dismiss:function(a){$(window).off("resize",$.proxy(this._didResize,this)),"IFRAME"===this._$render[0].tagName&&this._$render.off("load",$.proxy(this._didLoadContent,this)),this.$el.remove(),this.$el=null}}),f}),define("toast/actions/PopupMovie",["../core","../utils/StringUtils","./PopupActionBase"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{initialize:function(a,b,c){d.initialize.call(this,a,b,c),_.isUndefined(this.properties.scrollbarHidden)&&(this.properties.scrollbarHidden=!0)},execute:function(){d.execute.call(this)},_render:function(){return"youtube"==this.properties.playerType?this._renderYoutube():this._renderDefaltVideo()},_renderDefaltVideo:function(){var a=$('<video controls preload="auto" />').css({margin:0,padding:0});return this.properties.autoplay&&a.attr("autoplay","autoplay"),a},_renderYoutube:function(){var a=$("<iframe />",{frameborder:0,allowfullscreen:""});return a},_didPopupMount:function(){var b;b=1===a.project.parsedVersion.VERSION_MAJOR&&a.project.parsedVersion.VERSION_MINOR<9?this.properties.openWindow:this.properties.playerType;var c;if("youtube"==b?c=this.properties.url:this.properties.asset?c=a.MovieAssets.url(this.properties.asset):this.properties.url&&(c=a.StringUtils.replaceTemplate(this.properties.url).encodeFilePath()),"youtube"==this.properties.playerType){var d;-1!=c.substring(1,7).indexOf("iframe")&&(d=$(c).attr("src")),-1==c.indexOf("/embed/")&&(d=c.replace("youtu.be/","www.youtube.com/embed/")),this.properties.autoplay&&(d+="?autoplay=1"),this._$render.attr("src",d)}else{var e=$("<source >");e.attr("type","video/mp4"),e.attr("src",c),this._$render.append(e),this._$render.on("loadeddata",$.proxy(this._didLoadContent,this)),this._$render.load()}this._$render.on("click",$.proxy(this._videoClicked,this))},_didLoadContent:function(){d._didLoadContent.call(this)},_updateSize:function(){d._updateSize.call(this);var a=50;this._$render.css({width:parseFloat(this.$container.css("width"))+"px",height:parseFloat(this.$container.css("height"))-a+"px"})},_dismiss:function(a){"default"===this.properties.playerType&&this._$render[0].removeEventListener("loadeddata",$.proxy(this._videoDidLoaded,this),!1),d._dismiss.call(this,a)},_videoClicked:function(a){a.stopPropagation()}}),a.Action.PopupMovie=e}),define("toast/actions/PopupImage",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){d||(d={start:0}),c.initialize.call(this,a,b,d),_.isUndefined(this.options.start)&&(this.options.start=0)},execute:function(){var b=this.properties.assets;if(!_.isUndefined(b)&&0!=b.length){var c=$("<ul />",{"class":"iviewer-ul"});c.hide(),_.each(b,function(b){var d=a.ImageAssets.url(b);c.append('<li><img data-original-url="'+d+'" data-title="'+this.properties.title+'"></li>')},this),$(document.body).append(c);var d,e=!1,f=!0,g=1,h=!1;_.isUndefined(a.config.iviewer)||_.isUndefined(a.config.iviewer.zoomable)?_.isUndefined(this.properties.zoomable)||(e=this.properties.zoomable):e=a.config.iviewer.zoomable,d=e,_.isUndefined(a.config.iviewer)||_.isUndefined(a.config.iviewer.thumbnail)?_.isUndefined(this.properties.thumbnail)||(f=this.properties.thumbnail):f=a.config.iviewer.thumbnail,_.isUndefined(a.config.iviewer)||_.isUndefined(a.config.iviewer.defaultMaxZoomRatio)?_.isNumber(this.properties.maxZoomRatio)&&(g=Number(this.properties.maxZoomRatio)/100):g=a.config.iviewer.defaultMaxZoomRatio/100,_.isUndefined(a.config.iviewer)||_.isUndefined(a.config.iviewer.extractFit)||(h=a.config.iviewer.extractFit);var i={url:"data-original",zoomable:e,movable:d,title:this.properties.title,description:this.properties.description,backgroundColor:this.properties.backgroundColor,toolbarColor:this.properties.toolbarColor,number:_.isUndefined(this.properties.number)?!0:this.properties.number,maxZoomRatio:g,extractFit:h,navbar:f,zIndex:99991,hidden:function(b){c.remove(),a.Book.enableAction(!0)}};a.Book.enableAction(!1),this.__iviewer__=new a.ImageViewer(c[0],i),this.__iviewer__.show()}}}),a.Action.PopupImage=d}),define("toast/actions/PopupWindow",["../core","../utils/StringUtils","./Action"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{initialize:function(a,b,c){d.initialize.call(this,a,b,c)},execute:function(){var a;if(_.isEmpty(this.properties.url)){if(!_.isUndefined(this.properties.relativePath)&&!_.isEmpty(this.properties.relativePath)){var c=this.properties.relativePath;a=b.replaceTemplate("{ASSETS_DIR}"+c).encodeFilePath()}}else a=this.properties.url,-1===a.indexOf("../")&&-1===a.indexOf("./")&&"http:"!==a.protocol()&&"https"!==a.protocol()&&(a="http://"+this.properties.url);var d=screen.width/2-this.properties.width/2,e=screen.height/2-this.properties.height/2;if(_.isEmpty(window.__nw__))window.open(a,this.properties.title,"toolbar=no, location=no, top="+e+", left="+d+", width="+this.properties.width+", height="+this.properties.height);else{var f=window.__nw__.require("nw.gui"),g=f.Window.open(a,{title:this.properties.title,focus:!0,toolbar:!1});g.moveTo(d,e),g.resizeTo(this.properties.width,this.properties.height)}}}),a.Action.PopupWindow=e}),define("toast/actions/PopupLayper",["../core","../utils/StringUtils","./PopupActionBase"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{initialize:function(a,b,c){d.initialize.call(this,a,b,c),_.isUndefined(this.properties.extractFit)&&(this.properties.extractFit=!1)},_render:function(){var a=$("<iframe />").css({margin:0,padding:0,width:"100%",height:"100%",border:0,display:"none"});return a},_didPopupMount:function(){var a;if(_.isUndefined(this.properties.url)||_.isEmpty(this.properties.url)){if(!_.isUndefined(this.properties.relativePath)&&!_.isEmpty(this.properties.relativePath)){var c=this.properties.relativePath;a=b.replaceTemplate("{ASSETS_DIR}"+c).encodeFilePath()}}else a=this.properties.url,-1===a.indexOf("../")&&-1===a.indexOf("./")&&"http:"!==a.protocol()&&"https"!==a.protocol()&&(a="http://"+this.properties.url);this._$render.attr("src",a)}}),a.Action.PopupLayper=e}),define("toast/actions/PopupFlash",["../core","../utils/StringUtils","./PopupActionBase"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{initialize:function(a,b,c){d.initialize.call(this,a,b,c),_.isUndefined(this.properties.scrollbarHidden)&&(this.properties.scrollbarHidden=!0)},execute:function(){a.isMobileDevice||d.execute.call(this)},_render:function(){var a=$("<div />",{id:this.id+"-flash"}).css({margin:0,padding:0,width:this.properties.width+"px",height:this.properties.height+"px"});return a},_didPopupMount:function(){var b;_.isUndefined(this.properties.asset)||_.isEmpty(this.properties.asset)?_.isUndefined(this.properties.url)||_.isEmpty(this.properties.url)||(b=this.properties.url,-1===b.indexOf("../")&&-1===b.indexOf("./")&&"http:"!==b.protocol()&&"https"!==b.protocol()&&(b="http://"+this.properties.url)):b=a.FlashAssets.url(this.properties.asset);var c={},d={scale:"exactFit",allowScriptAccess:"always"},e={};_.isEmpty(this.properties.bgcolor)?d.wmode="transparent":d.bgcolor=this._rgb2hex(this.properties.bgcolor),swfobject.embedSWF(b,this.id+"-flash","100%","100%","10",!1,c,d,e,$.proxy(this._swfLoadEvent,this))},_didLoadContent:function(){this._$render=this.$el.find("#"+this.id+"-flash"),d._didLoadContent.call(this)},_swfLoadEvent:function(a){if(!a.success||!a.ref)return!1;var b=this,c=setInterval(function(){if("undefined"!=typeof a.ref.PercentLoaded&&a.ref.PercentLoaded()){clearInterval(c);var d=setInterval(function(){100===a.ref.PercentLoaded()&&(b._didLoadContent(),clearInterval(d))},5)}},5)},_rgb2hex:function(a){return a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),a&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""}}),a.Action.PopupFlash=e}),define("toast/actions/OpenPartialZoom",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){if(!_.isUndefined(this.properties.targets)&&!_.isEmpty(this.properties.targets)){var a=this.properties.targets[0],b=this.view.viewController.find("id",a);_.isNull(b)||_.isUndefined(b.view)||_.isUndefined(this.properties.targets)||_.isUndefined(b.view.$el.closest("#partial-zoom-modal")[0])&&b.view.open()}}}),a.Action.OpenPartialZoom=d}),define("toast/utils/PopupSubpage",["exports","../core"],function(a,b){"use strict";function c(a){var b;return _.each(k,function(c){return(c.model.id=a)?(b=c,!1):void 0}),b}function d(a){return 0!==$(document.body).children("#"+a+"-dialog").length}function e(a){var c=k.indexOf(a);k.splice(c,1),0===k.length&&($(window).off("resize",f),
a.options.modal&&b.Book.enableAction(!0))}function f(a){j||b.lazyOnce(function(){_.each(k,function(a){a._layout()})},5,m,this)}function g(a,b){if(!d(b.subpage)){var c=new l(a,b);c.open(),k.push(c),1===k.length&&$(window).on("resize",f)}}function h(a){var b=c(a);b&&b.close()}function i(){_.each(k,function(a){a.close()}),k=[]}var j,k=[],l=function(a,b){this.initialize.apply(this,arguments)};_.extend(l.prototype,{initialize:function(a,b){this.model=a,this.view=b.view,this.options=b},open:function(){if(!_.isEmpty(this.model)&&!this._isOpen()){this.options.autoClose&&(this._pageDidChangeHandlerProxy=$.proxy(this._pageDidChangeHandler,this),b.on(b.Events.PAGE_DID_CHANGE,this._pageDidChangeHandlerProxy)),this.options.modal&&b.Book.enableAction(!1),this._createHTMLDocument();var a=$(document.body).children("#"+this._getDialogId()),c=this;this.dialogInstance=a.dialog({title:this.options.title,autoOpen:!0,uiLibrary:"bootstrap",draggable:this.options.draggable,resizable:this.options.resizable,modal:this.options.modal,dragStart:function(a){c._isDrag=!0,c._bringToMostTop()},dragStop:function(a){c._isDrag||c._bringToMostTop(),c._setInitTargetSize(),c._setPageOffset(),c._isDrag&&c._setCenterOffset(),c._isDrag=!1},resizeStart:function(a){j=!0},resize:function(a){c._setDialogBody(),tt.Book.fitPage(c.viewController)},resizeStop:function(a){j=!1,c._setInitTargetSize(),c._setInitDialogSize(),c._setCenterOffset(),c._setPageOffset(),c._setNaturalSize()},closed:function(a){c.close()}}),this.dialogInstance.parent().hasClass("modal")?(this.dialogInstance.parent().addClass("subpage-modal white-background"),this.dialogInstance.parent().css("zIndex",99991)):this.dialogInstance.css("zIndex",99991),this.dialogInstance.addClass("subpage-modal-content"),this._setModalConfig(),this.dialogInstance.open(),this.dialogInstance.data({minWidth:this._getMinSize().width,minHeight:this._getMinSize().height}),this._setInitTargetSize(),this._setDialogBestSize(),this._setInitDialogSize(),this._setDialogBody(this.dialogInstance.find(".modal-body")),this._render(),this._setPosition(),this._setPageOffset(),this._setCenterOffset(),this.dialogInstance.off("draginit drag dragstart dragend")}},_setModalConfig:function(){var a=this.dialogInstance.find(".modal-header");if(0!==a.length){this.options.headerBackgroundColor&&a.css("backgroundColor",this.options.headerBackgroundColor),this.options.titleTextColor&&(a.css("color",this.options.titleTextColor),a.find(".close").css("color",this.options.titleTextColor));var b=this.dialogInstance.find(".modal-body");this.options.bodyBackgroundColor&&b.css("backgroundColor",this.options.bodyBackgroundColor)}},_setInitTargetSize:function(){var a=this._getTargetInfo();this._initTargetSize={width:a.width,height:a.height}},_setInitDialogSize:function(){this._initDialogSize={width:this.dialogInstance.outerWidth(),height:this.dialogInstance.outerHeight()}},_setDialogSize:function(a){this.dialogInstance.css({width:a.width+"px",height:a.height+"px"})},_setDialogBestSize:function(){this._setDialogSize(this._getBestSize())},_setMagneticDialogSize:function(){if(!this.options.resizable)return this._setDialogSize({width:this.viewController.$el.width(),height:this.viewController.$el.height()+this._getHeaderFooterHeight()}),void this._setDialogBody();var a={width:this.dialogInstance.outerWidth(),height:this.dialogInstance.outerHeight()},b=Math.min(a.width/this._initDialogSize.width,a.height/this._initDialogSize.height),c={left:this._pageOffset.left*b,top:this._pageOffset.top*b};Math.floor(c.left)<=4?a.width=this.viewController.$el.width():a.width=this.viewController.$el.width()+2*c.left,Math.floor(c.top)<=4?a.height=this.viewController.$el.height()+this._getHeaderFooterHeight():a.height=this.viewController.$el.height()+this._getHeaderFooterHeight()+2*c.top,this._setDialogSize(a),this._setDialogBody(),tt.Book.fitPage(this.viewController)},_setDialogBody:function(a){a&&(this.$modalBody=a);var b=this.dialogInstance.height();b-=this._getHeaderFooterHeight(),this.$modalBody.css({width:"100%",margin:0,padding:0,height:b+"px"})},_getTargetInfo:function(){var a;a="window"===this.options.positionTarget?$(window):b.Book.$getBook();var c={width:a.width(),height:a.height(),offset:"window"===this.options.positionTarget?{left:0,top:0}:a.offset()};return c.center={x:c.offset.left+a.width()/2,y:c.offset.top+a.height()/2},c},_setPosition:function(){var a,b;this.dialogInstance.css("position","absolute");var c=this._getTargetInfo(),d={width:this.dialogInstance.outerWidth(),height:this.dialogInstance.outerHeight()};"auto"===this.options.position?(a=this.view.$el.parent().offset().left+this.view.$el.parent().width()/2-this.dialogInstance.width()/2,b=this.view.$el.parent().offset().top+this.view.$el.parent().height()/2-this.dialogInstance.height()/2):"center"===this.options.position?(a=c.center.x-d.width/2,b=c.center.y-d.height/2):"leftTop"===this.options.position?(a=c.offset.left+10,b=c.offset.top+10):"leftCenter"===this.options.position?(a=c.offset.left+10,b=c.center.y-d.height/2):"leftBottom"===this.options.position?(a=c.offset.left+10,b=c.offset.top+c.height-(d.height+10)):"rightTop"===this.options.position?(a=c.offset.left+c.width-(d.width+10),b=c.offset.top):"rightCenter"===this.options.position?(a=c.offset.left+c.width-(d.width+10),b=c.center.y-this.dialogInstance.height()/2):"rightBottom"===this.options.position?(a=c.offset.left+c.width-(d.width+10),b=c.offset.top+c.height-(d.height+10)):"centerTop"===this.options.position?(a=c.center.x-d.width/2,b=c.offset.top+10):"centerBottom"===this.options.position?(a=c.center.x-d.width/2,b=c.offset.top+c.height-(d.height+10)):(a=c.center.x-d.width/2,b=c.center.y-d.height/2);var e=this._getShowAllAvalidOffset({left:a,top:b});this.dialogInstance.css("left",e.left+"px"),this.dialogInstance.css("top",e.top+"px")},_getDialogId:function(){return this.options.subpage+"-dialog"},_getHeaderHeight:function(){var a=0,b=this.dialogInstance.find(".modal-header");return 0!==b.length&&(a=b.outerHeight()),a},_getHeaderFooterHeight:function(){var a=0,b=this.dialogInstance.find(".modal-header");0!==b.length&&(a=b.outerHeight());var c=this.dialogInstance.find(".modal-footer");return 0!==c.length&&(a+=c.outerHeight()),a},_setNaturalSize:function(){var a=(Math.max(this.model.width,this.dialogInstance.outerWidth()),this.dialogInstance.outerWidth()/this.dialogInstance.outerHeight());this.__naturalSize__.width=this.dialogInstance.outerWidth(),this.__naturalSize__.height=Math.floor(this.dialogInstance.outerWidth()/a)},_getBestSize:function(){var a={};this.__naturalSize__?a={width:this.dialogInstance.outerWidth(),height:this.dialogInstance.outerHeight()}:(this.__naturalSize__={width:Number(this.model.width),height:Number(this.model.height)+this._getHeaderFooterHeight()},a=this.__naturalSize__);var b=Math.min(($(window).width()-20)/a.width,($(window).height()-20)/a.height);return{width:Math.min(this.__naturalSize__.width,a.width*b),height:Math.min(this.__naturalSize__.height,a.height*b)}},_getTargetScale:function(){var a=this._getTargetInfo();return Math.min(a.width/this._initTargetSize.width,a.height/this._initTargetSize.height)},_createHTMLDocument:function(){var a=$("<div />",{id:this._getDialogId()});a.hide(),$(document.body).append(a)},_isOpen:function(){return 0!==$(document.body).children("#"+this._getDialogId()).length},_render:function(){var a=$("<div />",{id:this.model.id,"class":"toast-ctrl"});this.$modalBody.append(a);var b=new tt.ViewController({el:a});b.index=this.view.viewController.index,b.modal=!0,b.load(this.model.toJSON(),{showLoader:!0,readyonly:!0}),b.isLoaded=!0,tt.Book.fitPage(b),this.$modalBody.css({height:b.$el.height()+"px"}),this.dialogInstance.css("width",b.$el.width()+"px"),this.dialogInstance.css("height",b.$el.height()+this._getHeaderFooterHeight()+"px"),this.viewController=b},_bringToMostTop:function(){var a=this.dialogInstance.parent().children(".subpage-modal-content").last();a.attr("id")!==this.dialogInstance.attr("id")&&a.after(this.dialogInstance)},_setPageOffset:function(){this._pageOffset={left:Math.abs(this.viewController.$el.offset().left-this.$modalBody.offset().left),top:Math.abs(this.viewController.$el.offset().top-this.$modalBody.offset().top)}},_setCenterOffset:function(){var a=this._getTargetInfo();this._centerOffset={x:a.center.x-(this.dialogInstance.offset().left+this.dialogInstance.outerWidth()/2),y:a.center.y-(this.dialogInstance.offset().top+this.dialogInstance.outerHeight()/2)}},_getAvalidOffset:function(a){return a.left=Math.max(-(this.dialogInstance.outerWidth()-50),a.left),a.top=Math.max(10,a.top),a.top=Math.min($(window).height()-(this._getHeaderHeight()+30),a.top),a},_getShowAllAvalidOffset:function(a){return a||(a=this.dialogInstance.offset()),a.left=Math.min($(window).width()-(this.dialogInstance.outerWidth()+10),a.left),a.left=Math.max(10,a.left),a.top=Math.min($(window).height()-(this.dialogInstance.outerHeight()+10),a.top),a.top=Math.max(10,a.top),a},_getMaxSize:function(){return{width:Number(this.model.width),height:Number(this.model.height)+this._getHeaderFooterHeight()}},_getMinSize:function(){return{width:100,height:this.model.height*(100/this.model.width)+this._getHeaderFooterHeight()}},_layout:function(){this._getMaxSize(),this._getMinSize();this._setDialogBestSize(),this._setDialogBody(),tt.Book.fitPage(this.viewController),this._setMagneticDialogSize();var a={width:this.dialogInstance.outerWidth(),height:this.dialogInstance.outerHeight()},b=this._getTargetInfo(),c=this._getTargetScale(),d={x:b.center.x-this._centerOffset.x*c,y:b.center.y-this._centerOffset.y*c},e={left:d.x-a.width/2,top:d.y-a.height/2};e=this._getShowAllAvalidOffset(e),this.dialogInstance.css("left",e.left+"px"),this.dialogInstance.css("top",e.top+"px")},_pageDidChangeHandler:function(){this.options.autoClose&&this.close()},close:function(){var a;this.dialogInstance.parent().hasClass("modal")&&(a=this.dialogInstance.parent()),this.viewController&&(this.viewController.reset(),delete this.viewController);var c=this.dialogInstance.draggable();c.destroy(),this.dialogInstance.remove(),this.$modalBody=null,a&&a.remove(),this.__naturalSize__=null,this._pageDidChangeHandlerProxy&&b.off(b.Events.PAGE_DID_CHANGE,this._pageDidChangeHandlerProxy),e(this)}});var m={};a.open=g,a.close=h,a.closeAll=i,b.PopupSubpage=a}),define("toast/actions/OpenPopupSubpage",["../core","../utils/StringUtils","../utils/PopupSubpage","./Action"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{initialize:function(a,b,c){e.initialize.call(this,a,b,c)},execute:function(){var b=this.view.viewController.findSubpage(this.properties.subpage);if(b||(b=_.find(a.project.subpages.models,{id:this.properties.subpage})),b){var d=_.extend({view:this.view},this.properties);c.open(b,d)}}}),a.Action.OpenPopupSubpage=f}),define("toast/actions/ClosePopupSubpage",["../core","../utils/StringUtils","../utils/PopupSubpage","./Action"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{initialize:function(a,b,c){e.initialize.call(this,a,b,c)},execute:function(){c.close(this.properties.subpage)}}),a.Action.ClosePopupSubpage=f}),define("toast/actions/WidgetAction",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(b,d,e){c.initialize.call(this,b,d,e),a.lazy(function(){this._lazyInitialize()},5,this)},_lazyInitialize:function(){var a,b=this.view.viewController.topParentViewController();a=b?b:this.view.viewController,this._widget=a.find("id",this.properties.widgetId,!0),this._widget&&this._widget.view&&(this._widget.view.on("changeState",$.proxy(this.widgetChangeState,this)),this.widgetChangeState(this.properties.widgetActionName,this._widget.properties[this.properties.widgetActionName]))},widgetChangeState:function(a,b){this.properties.widgetActionName===a&&this.view instanceof TT.UIButton&&(b&&b!==this.properties.widgetActionParameter?this.view.setState("normal"):this.view.setState("selected"))},execute:function(){_.isEmpty(this.properties.widgetId)||_.isEmpty(this.properties.widgetActionName)||this._widget&&this._widget.view&&TT.executeFunctionByName(this.properties.widgetActionName,this._widget.view,this.properties.widgetActionParameter,this._widget.view)}}),a.Action.WidgetAction=d}),define("toast/actions/SendDropResult",["../core","./Action"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,d){c.initialize.call(this,a,b,d)},execute:function(){}}),a.Action.SendDropResult=d}),define("toast/actions/ChangeOrder",["../core","../utils/StringUtils","../utils/PopupSubpage","./Action"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{initialize:function(a,b,c){e.initialize.call(this,a,b,c),_.isEmpty(this.properties.targets)&&(this.properties.targets=[a.model.id])},getIndex:function(a){a||(a={q:"top"});var b="top"===a.q?1:-1,c=this.view.viewController.$contents.children();return _.each(c,function(c){var d=$(c),e=Number(d.css("zIndex"));isNaN(e)||("top"===a.q?e>=b&&(b=e+1):b>=e&&(b=e-1))},this),b},execute:function(){var a;"top"===this.properties.order?a=this.getIndex({q:"top"}):"bottom"===this.properties.order&&(a=this.getIndex({q:"bottom"})),_.each(this.properties.targets,function(b){var c=this.view.viewController.find("id",b);if(c){var d=c.view.$parent.css("zIndex"),e=c.view.$parent.attr("data-zindex");d&&!e&&c.view.$parent.attr("data-zindex",d),"top"===this.properties.order?c.view.$parent.css("zIndex",a++):"bottom"===this.properties.order?c.view.$parent.css("zIndex",a--):"restore"===this.properties.order&&(e?c.view.$parent.css("zIndex",e):c.view.$parent.css("zIndex",""))}},this)}}),a.Action.ChangeOrder=f}),define("toast/actions/ChangeState",["../core","../utils/StringUtils","../utils/PopupSubpage","./Action"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{initialize:function(a,b,c){e.initialize.call(this,a,b,c),_.isEmpty(this.properties.targets)&&(this._target=a.model)},execute:function(){this._target||(this._target=this.view.viewController.find("id",this.properties.targets[0])),this._target&&(_.isEmpty(this.properties.state)||this._target.view.state(this.properties.state))}}),a.Action.ChangeState=f}),define("toast/actions/Reset",["../core","../utils/StringUtils","../utils/PopupSubpage","./Action"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{initialize:function(a,b,c){e.initialize.call(this,a,b,c)},execute:function(){_.each(this.properties.targets,function(a){var b=this.view.viewController.find("id",a);b&&b.view.reset()},this)}}),a.Action.Reset=f}),define("toast/actions",["exports","./core","./actions/LinkUrl","./actions/GotoPage","./actions/Visible","./actions/ToggleSound","./actions/PlaySound","./actions/ToggleAudioPlayer","./actions/StopAllSound","./actions/StopSound","./actions/PopupMovie","./actions/PopupImage","./actions/PopupWindow","./actions/PopupLayper","./actions/PopupFlash","./actions/OpenPartialZoom","./actions/OpenPopupSubpage","./actions/ClosePopupSubpage","./actions/WidgetAction","./actions/SendDropResult","./actions/ChangeOrder","./actions/ChangeState","./actions/Reset"],function(a,b){}),function(a){"use strict";function b(a){var b=a.length,d=c.type(a);return"function"===d||c.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===d||0===b||"number"==typeof b&&b>0&&b-1 in a}if(!a.jQuery){var c=function(a,b){return new c.fn.init(a,b)};c.isWindow=function(a){return a&&a===a.window},c.type=function(a){return a?"object"==typeof a||"function"==typeof a?e[g.call(a)]||"object":typeof a:a+""},c.isArray=Array.isArray||function(a){return"array"===c.type(a)},c.isPlainObject=function(a){var b;if(!a||"object"!==c.type(a)||a.nodeType||c.isWindow(a))return!1;try{if(a.constructor&&!f.call(a,"constructor")&&!f.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}for(b in a);return void 0===b||f.call(a,b)},c.each=function(a,c,d){var e,f=0,g=a.length,h=b(a);if(d){if(h)for(;g>f&&(e=c.apply(a[f],d),e!==!1);f++);else for(f in a)if(a.hasOwnProperty(f)&&(e=c.apply(a[f],d),e===!1))break}else if(h)for(;g>f&&(e=c.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(a.hasOwnProperty(f)&&(e=c.call(a[f],f,a[f]),e===!1))break;return a},c.data=function(a,b,e){if(void 0===e){var f=a[c.expando],g=f&&d[f];if(void 0===b)return g;if(g&&b in g)return g[b]}else if(void 0!==b){var h=a[c.expando]||(a[c.expando]=++c.uuid);return d[h]=d[h]||{},d[h][b]=e,e}},c.removeData=function(a,b){var e=a[c.expando],f=e&&d[e];f&&(b?c.each(b,function(a,b){delete f[b]}):delete d[e])},c.extend=function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[i]||{},i++),"object"!=typeof h&&"function"!==c.type(h)&&(h={}),i===j&&(h=this,i--);j>i;i++)if(f=arguments[i])for(e in f)f.hasOwnProperty(e)&&(a=h[e],d=f[e],h!==d&&(k&&d&&(c.isPlainObject(d)||(b=c.isArray(d)))?(b?(b=!1,g=a&&c.isArray(a)?a:[]):g=a&&c.isPlainObject(a)?a:{},h[e]=c.extend(k,g,d)):void 0!==d&&(h[e]=d)));return h},c.queue=function(a,d,e){function f(a,c){var d=c||[];return a&&(b(Object(a))?!function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a}(d,"string"==typeof a?[a]:a):[].push.call(d,a)),d}if(a){d=(d||"fx")+"queue";var g=c.data(a,d);return e?(!g||c.isArray(e)?g=c.data(a,d,f(e)):g.push(e),g):g||[]}},c.dequeue=function(a,b){c.each(a.nodeType?[a]:a,function(a,d){b=b||"fx";var e=c.queue(d,b),f=e.shift();"inprogress"===f&&(f=e.shift()),f&&("fx"===b&&e.unshift("inprogress"),f.call(d,function(){c.dequeue(d,b)}))})},c.fn=c.prototype={init:function(a){if(a.nodeType)return this[0]=a,this;throw new Error("Not a DOM node.")},offset:function(){var b=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:b.top+(a.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:b.left+(a.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function a(a){for(var b=a.offsetParent;b&&"html"!==b.nodeName.toLowerCase()&&b.style&&"static"===b.style.position;)b=b.offsetParent;return b||document}var b=this[0],d=a(b),e=this.offset(),f=/^(?:body|html)$/i.test(d.nodeName)?{top:0,left:0}:c(d).offset();return e.top-=parseFloat(b.style.marginTop)||0,e.left-=parseFloat(b.style.marginLeft)||0,d.style&&(f.top+=parseFloat(d.style.borderTopWidth)||0,f.left+=parseFloat(d.style.borderLeftWidth)||0),{top:e.top-f.top,left:e.left-f.left}}};var d={};c.expando="velocity"+(new Date).getTime(),c.uuid=0;for(var e={},f=e.hasOwnProperty,g=e.toString,h="Boolean Number String Function Array Date RegExp Object Error".split(" "),i=0;i<h.length;i++)e["[object "+h[i]+"]"]=h[i].toLowerCase();c.fn.init.prototype=c.fn,a.Velocity={Utilities:c}}}(window),function(a){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a():"function"==typeof define&&define.amd?define("toast/animations/_velocity",a):a()}(function(){"use strict";return function(a,b,c,d){function e(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function f(a){return u.isWrapped(a)?a=s.call(a):u.isNode(a)&&(a=[a]),a}function g(a){var b=o.data(a,"velocity");return null===b?d:b}function h(a,b){var c=g(a);c&&c.delayTimer&&!c.delayPaused&&(c.delayRemaining=c.delay-b+c.delayBegin,c.delayPaused=!0,clearTimeout(c.delayTimer.setTimeout))}function i(a,b){var c=g(a);c&&c.delayTimer&&c.delayPaused&&(c.delayPaused=!1,c.delayTimer.setTimeout=setTimeout(c.delayTimer.next,c.delayRemaining))}function j(a){return function(b){return Math.round(b*a)*(1/a)}}function k(a,c,d,e){function f(a,b){return 1-3*b+3*a}function g(a,b){return 3*b-6*a}function h(a){return 3*a}function i(a,b,c){return((f(b,c)*a+g(b,c))*a+h(b))*a}function j(a,b,c){return 3*f(b,c)*a*a+2*g(b,c)*a+h(b)}function k(b,c){for(var e=0;p>e;++e){var f=j(c,a,d);if(0===f)return c;var g=i(c,a,d)-b;c-=g/f}return c}function l(){for(var b=0;t>b;++b)x[b]=i(b*u,a,d)}function m(b,c,e){var f,g,h=0;do g=c+(e-c)/2,f=i(g,a,d)-b,f>0?e=g:c=g;while(Math.abs(f)>r&&++h<s);return g}function n(b){for(var c=0,e=1,f=t-1;e!==f&&x[e]<=b;++e)c+=u;--e;var g=(b-x[e])/(x[e+1]-x[e]),h=c+g*u,i=j(h,a,d);return i>=q?k(b,h):0===i?h:m(b,c,c+u)}function o(){y=!0,(a!==c||d!==e)&&l()}var p=4,q=.001,r=1e-7,s=10,t=11,u=1/(t-1),v="Float32Array"in b;if(4!==arguments.length)return!1;for(var w=0;4>w;++w)if("number"!=typeof arguments[w]||isNaN(arguments[w])||!isFinite(arguments[w]))return!1;a=Math.min(a,1),d=Math.min(d,1),a=Math.max(a,0),d=Math.max(d,0);var x=v?new Float32Array(t):new Array(t),y=!1,z=function(b){return y||o(),a===c&&d===e?b:0===b?0:1===b?1:i(n(b),c,e)};z.getControlPoints=function(){return[{x:a,y:c},{x:d,y:e}]};var A="generateBezier("+[a,c,d,e]+")";return z.toString=function(){return A},z}function l(a,b){var c=a;return u.isString(a)?y.Easings[a]||(c=!1):c=u.isArray(a)&&1===a.length?j.apply(null,a):u.isArray(a)&&2===a.length?z.apply(null,a.concat([b])):u.isArray(a)&&4===a.length?k.apply(null,a):!1,c===!1&&(c=y.Easings[y.defaults.easing]?y.defaults.easing:x),c}function m(a){if(a){var b=y.timestamp&&a!==!0?a:r.now(),c=y.State.calls.length;c>1e4&&(y.State.calls=e(y.State.calls),c=y.State.calls.length);for(var f=0;c>f;f++)if(y.State.calls[f]){var h=y.State.calls[f],i=h[0],j=h[2],k=h[3],l=!!k,q=null,s=h[5],t=h[6];if(k||(k=y.State.calls[f][3]=b-16),s){if(s.resume!==!0)continue;k=h[3]=Math.round(b-t-16),h[5]=null}t=h[6]=b-k;for(var v=Math.min(t/j.duration,1),w=0,x=i.length;x>w;w++){var z=i[w],B=z.element;if(g(B)){var D=!1;if(j.display!==d&&null!==j.display&&"none"!==j.display){if("flex"===j.display){var E=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];o.each(E,function(a,b){A.setPropertyValue(B,"display",b)})}A.setPropertyValue(B,"display",j.display)}j.visibility!==d&&"hidden"!==j.visibility&&A.setPropertyValue(B,"visibility",j.visibility);for(var F in z)if(z.hasOwnProperty(F)&&"element"!==F){var G,H=z[F],I=u.isString(H.easing)?y.Easings[H.easing]:H.easing;if(u.isString(H.pattern)){var J=1===v?function(a,b,c){var d=H.endValue[b];return c?Math.round(d):d}:function(a,b,c){var d=H.startValue[b],e=H.endValue[b]-d,f=d+e*I(v,j,e);return c?Math.round(f):f};G=H.pattern.replace(/{(\d+)(!)?}/g,J)}else if(1===v)G=H.endValue;else{var K=H.endValue-H.startValue;G=H.startValue+K*I(v,j,K)}if(!l&&G===H.currentValue)continue;if(H.currentValue=G,"tween"===F)q=G;else{var L;if(A.Hooks.registered[F]){L=A.Hooks.getRoot(F);var M=g(B).rootPropertyValueCache[L];M&&(H.rootPropertyValue=M)}var N=A.setPropertyValue(B,F,H.currentValue+(9>p&&0===parseFloat(G)?"":H.unitType),H.rootPropertyValue,H.scrollData);A.Hooks.registered[F]&&(A.Normalizations.registered[L]?g(B).rootPropertyValueCache[L]=A.Normalizations.registered[L]("extract",null,N[1]):g(B).rootPropertyValueCache[L]=N[1]),"transform"===N[0]&&(D=!0)}}j.mobileHA&&g(B).transformCache.translate3d===d&&(g(B).transformCache.translate3d="(0px, 0px, 0px)",D=!0),D&&A.flushTransformCache(B)}}j.display!==d&&"none"!==j.display&&(y.State.calls[f][2].display=!1),j.visibility!==d&&"hidden"!==j.visibility&&(y.State.calls[f][2].visibility=!1),j.progress&&j.progress.call(h[1],h[1],v,Math.max(0,k+j.duration-b),k,q),1===v&&n(f)}}y.State.isTicking&&C(m)}function n(a,b){if(!y.State.calls[a])return!1;for(var c=y.State.calls[a][0],e=y.State.calls[a][1],f=y.State.calls[a][2],h=y.State.calls[a][4],i=!1,j=0,k=c.length;k>j;j++){var l=c[j].element;b||f.loop||("none"===f.display&&A.setPropertyValue(l,"display",f.display),"hidden"===f.visibility&&A.setPropertyValue(l,"visibility",f.visibility));var m=g(l);if(f.loop!==!0&&(o.queue(l)[1]===d||!/\.velocityQueueEntryFlag/i.test(o.queue(l)[1]))&&m){m.isAnimating=!1,m.rootPropertyValueCache={};var n=!1;o.each(A.Lists.transforms3D,function(a,b){var c=/^scale/.test(b)?1:0,e=m.transformCache[b];m.transformCache[b]!==d&&new RegExp("^\\("+c+"[^.]").test(e)&&(n=!0,delete m.transformCache[b])}),f.mobileHA&&(n=!0,delete m.transformCache.translate3d),n&&A.flushTransformCache(l),A.Values.removeClass(l,"velocity-animating")}if(!b&&f.complete&&!f.loop&&j===k-1)try{f.complete.call(e,e)}catch(p){setTimeout(function(){throw p},1)}h&&f.loop!==!0&&h(e),m&&f.loop===!0&&!b&&(o.each(m.tweensContainer,function(a,b){if(/^rotate/.test(a)&&(parseFloat(b.startValue)-parseFloat(b.endValue))%360===0){var c=b.startValue;b.startValue=b.endValue,b.endValue=c}/^backgroundPosition/.test(a)&&100===parseFloat(b.endValue)&&"%"===b.unitType&&(b.endValue=0,b.startValue=100)}),y(l,"reverse",{loop:!0,delay:f.delay})),f.queue!==!1&&o.dequeue(l,f.queue)}y.State.calls[a]=!1;for(var q=0,r=y.State.calls.length;r>q;q++)if(y.State.calls[q]!==!1){i=!0;break}i===!1&&(y.State.isTicking=!1,delete y.State.calls,y.State.calls=[])}var o,p=function(){if(c.documentMode)return c.documentMode;for(var a=7;a>4;a--){var b=c.createElement("div");if(b.innerHTML="<!--[if IE "+a+"]><span></span><![endif]-->",b.getElementsByTagName("span").length)return b=null,a}return d}(),q=function(){var a=0;return b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||function(b){var c,d=(new Date).getTime();return c=Math.max(0,16-(d-a)),a=d+c,setTimeout(function(){b(d+c)},c)}}(),r=function(){var a=b.performance||{};if("function"!=typeof a.now){var c=a.timing&&a.timing.navigationStart?a.timing.navigationStart:(new Date).getTime();a.now=function(){return(new Date).getTime()-c}}return a}(),s=function(){var a=Array.prototype.slice;try{return a.call(c.documentElement),a}catch(b){return function(b,c){var d=this.length;if("number"!=typeof b&&(b=0),"number"!=typeof c&&(c=d),this.slice)return a.call(this,b,c);var e,f=[],g=b>=0?b:Math.max(0,d+b),h=0>c?d+c:Math.min(c,d),i=h-g;if(i>0)if(f=new Array(i),this.charAt)for(e=0;i>e;e++)f[e]=this.charAt(g+e);else for(e=0;i>e;e++)f[e]=this[g+e];return f}}}(),t=function(){return Array.prototype.includes?function(a,b){return a.includes(b)}:Array.prototype.indexOf?function(a,b){return a.indexOf(b)>=0}:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}},u={isNumber:function(a){return"number"==typeof a},isString:function(a){return"string"==typeof a},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},isNode:function(a){return a&&a.nodeType},isWrapped:function(a){return a&&a!==b&&u.isNumber(a.length)&&!u.isString(a)&&!u.isFunction(a)&&!u.isNode(a)&&(0===a.length||u.isNode(a[0]))},isSVG:function(a){return b.SVGElement&&a instanceof b.SVGElement},isEmptyObject:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}},v=!1;if(a.fn&&a.fn.jquery?(o=a,v=!0):o=b.Velocity.Utilities,8>=p&&!v)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=p)return void(jQuery.fn.velocity=jQuery.fn.animate);var w=400,x="swing",y={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:b.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:c.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[],delayedElements:{count:0}},CSS:{},Utilities:o,Redirects:{},Easings:{},Promise:b.Promise,defaults:{queue:"",duration:w,easing:x,begin:d,complete:d,progress:d,display:d,visibility:d,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0,promiseRejectEmpty:!0},init:function(a){o.data(a,"velocity",{isSVG:u.isSVG(a),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:5,patch:0},debug:!1,timestamp:!0,pauseAll:function(a){var b=(new Date).getTime();o.each(y.State.calls,function(b,c){if(c){if(a!==d&&(c[2].queue!==a||c[2].queue===!1))return!0;c[5]={resume:!1}}}),o.each(y.State.delayedElements,function(a,c){c&&h(c,b)})},resumeAll:function(a){var b=(new Date).getTime();o.each(y.State.calls,function(b,c){if(c){if(a!==d&&(c[2].queue!==a||c[2].queue===!1))return!0;c[5]&&(c[5].resume=!0)}}),o.each(y.State.delayedElements,function(a,c){c&&i(c,b)})}};b.pageYOffset!==d?(y.State.scrollAnchor=b,y.State.scrollPropertyLeft="pageXOffset",y.State.scrollPropertyTop="pageYOffset"):(y.State.scrollAnchor=c.documentElement||c.body.parentNode||c.body,y.State.scrollPropertyLeft="scrollLeft",y.State.scrollPropertyTop="scrollTop");var z=function(){function a(a){return-a.tension*a.x-a.friction*a.v}function b(b,c,d){var e={x:b.x+d.dx*c,v:b.v+d.dv*c,tension:b.tension,friction:b.friction};return{dx:e.v,dv:a(e)}}function c(c,d){var e={dx:c.v,dv:a(c)},f=b(c,.5*d,e),g=b(c,.5*d,f),h=b(c,d,g),i=1/6*(e.dx+2*(f.dx+g.dx)+h.dx),j=1/6*(e.dv+2*(f.dv+g.dv)+h.dv);return c.x=c.x+i*d,c.v=c.v+j*d,c}return function d(a,b,e){var f,g,h,i={x:-1,v:0,tension:null,friction:null},j=[0],k=0,l=1e-4,m=.016;for(a=parseFloat(a)||500,b=parseFloat(b)||20,e=e||null,i.tension=a,i.friction=b,f=null!==e,f?(k=d(a,b),g=k/e*m):g=m;;)if(h=c(h||i,g),j.push(1+h.x),k+=16,!(Math.abs(h.x)>l&&Math.abs(h.v)>l))break;return f?function(a){return j[a*(j.length-1)|0]}:k}}();y.Easings={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},spring:function(a){return 1-Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)}},o.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["ease-out-in",[.465,.183,.153,.946]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(a,b){y.Easings[b[0]]=k.apply(null,b[1])});var A=y.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"],units:["%","em","ex","ch","rem","vw","vh","vmin","vmax","cm","mm","Q","in","pc","pt","px","deg","grad","rad","turn","s","ms"],colorNames:{aliceblue:"240,248,255",antiquewhite:"250,235,215",aquamarine:"127,255,212",aqua:"0,255,255",azure:"240,255,255",beige:"245,245,220",bisque:"255,228,196",black:"0,0,0",blanchedalmond:"255,235,205",blueviolet:"138,43,226",blue:"0,0,255",brown:"165,42,42",burlywood:"222,184,135",cadetblue:"95,158,160",chartreuse:"127,255,0",chocolate:"210,105,30",coral:"255,127,80",cornflowerblue:"100,149,237",cornsilk:"255,248,220",crimson:"220,20,60",cyan:"0,255,255",darkblue:"0,0,139",darkcyan:"0,139,139",darkgoldenrod:"184,134,11",darkgray:"169,169,169",darkgrey:"169,169,169",darkgreen:"0,100,0",darkkhaki:"189,183,107",darkmagenta:"139,0,139",darkolivegreen:"85,107,47",darkorange:"255,140,0",darkorchid:"153,50,204",darkred:"139,0,0",darksalmon:"233,150,122",darkseagreen:"143,188,143",darkslateblue:"72,61,139",darkslategray:"47,79,79",darkturquoise:"0,206,209",darkviolet:"148,0,211",deeppink:"255,20,147",deepskyblue:"0,191,255",dimgray:"105,105,105",dimgrey:"105,105,105",dodgerblue:"30,144,255",
firebrick:"178,34,34",floralwhite:"255,250,240",forestgreen:"34,139,34",fuchsia:"255,0,255",gainsboro:"220,220,220",ghostwhite:"248,248,255",gold:"255,215,0",goldenrod:"218,165,32",gray:"128,128,128",grey:"128,128,128",greenyellow:"173,255,47",green:"0,128,0",honeydew:"240,255,240",hotpink:"255,105,180",indianred:"205,92,92",indigo:"75,0,130",ivory:"255,255,240",khaki:"240,230,140",lavenderblush:"255,240,245",lavender:"230,230,250",lawngreen:"124,252,0",lemonchiffon:"255,250,205",lightblue:"173,216,230",lightcoral:"240,128,128",lightcyan:"224,255,255",lightgoldenrodyellow:"250,250,210",lightgray:"211,211,211",lightgrey:"211,211,211",lightgreen:"144,238,144",lightpink:"255,182,193",lightsalmon:"255,160,122",lightseagreen:"32,178,170",lightskyblue:"135,206,250",lightslategray:"119,136,153",lightsteelblue:"176,196,222",lightyellow:"255,255,224",limegreen:"50,205,50",lime:"0,255,0",linen:"250,240,230",magenta:"255,0,255",maroon:"128,0,0",mediumaquamarine:"102,205,170",mediumblue:"0,0,205",mediumorchid:"186,85,211",mediumpurple:"147,112,219",mediumseagreen:"60,179,113",mediumslateblue:"123,104,238",mediumspringgreen:"0,250,154",mediumturquoise:"72,209,204",mediumvioletred:"199,21,133",midnightblue:"25,25,112",mintcream:"245,255,250",mistyrose:"255,228,225",moccasin:"255,228,181",navajowhite:"255,222,173",navy:"0,0,128",oldlace:"253,245,230",olivedrab:"107,142,35",olive:"128,128,0",orangered:"255,69,0",orange:"255,165,0",orchid:"218,112,214",palegoldenrod:"238,232,170",palegreen:"152,251,152",paleturquoise:"175,238,238",palevioletred:"219,112,147",papayawhip:"255,239,213",peachpuff:"255,218,185",peru:"205,133,63",pink:"255,192,203",plum:"221,160,221",powderblue:"176,224,230",purple:"128,0,128",red:"255,0,0",rosybrown:"188,143,143",royalblue:"65,105,225",saddlebrown:"139,69,19",salmon:"250,128,114",sandybrown:"244,164,96",seagreen:"46,139,87",seashell:"255,245,238",sienna:"160,82,45",silver:"192,192,192",skyblue:"135,206,235",slateblue:"106,90,205",slategray:"112,128,144",snow:"255,250,250",springgreen:"0,255,127",steelblue:"70,130,180",tan:"210,180,140",teal:"0,128,128",thistle:"216,191,216",tomato:"255,99,71",turquoise:"64,224,208",violet:"238,130,238",wheat:"245,222,179",whitesmoke:"245,245,245",white:"255,255,255",yellowgreen:"154,205,50",yellow:"255,255,0"}},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var a=0;a<A.Lists.colors.length;a++){var b="color"===A.Lists.colors[a]?"0 0 0 1":"255 255 255 1";A.Hooks.templates[A.Lists.colors[a]]=["Red Green Blue Alpha",b]}var c,d,e;if(p)for(c in A.Hooks.templates)if(A.Hooks.templates.hasOwnProperty(c)){d=A.Hooks.templates[c],e=d[0].split(" ");var f=d[1].match(A.RegEx.valueSplit);"Color"===e[0]&&(e.push(e.shift()),f.push(f.shift()),A.Hooks.templates[c]=[e.join(" "),f.join(" ")])}for(c in A.Hooks.templates)if(A.Hooks.templates.hasOwnProperty(c)){d=A.Hooks.templates[c],e=d[0].split(" ");for(var g in e)if(e.hasOwnProperty(g)){var h=c+e[g],i=g;A.Hooks.registered[h]=[c,i]}}},getRoot:function(a){var b=A.Hooks.registered[a];return b?b[0]:a},getUnit:function(a,b){var c=(a.substr(b||0,5).match(/^[a-z%]+/)||[])[0]||"";return c&&t(A.Lists.units,c)?c:""},fixColors:function(a){return a.replace(/(rgba?\(\s*)?(\b[a-z]+\b)/g,function(a,b,c){return A.Lists.colorNames.hasOwnProperty(c)?(b?b:"rgba(")+A.Lists.colorNames[c]+(b?"":",1)"):b+c})},cleanRootPropertyValue:function(a,b){return A.RegEx.valueUnwrap.test(b)&&(b=b.match(A.RegEx.valueUnwrap)[1]),A.Values.isCSSNullValue(b)&&(b=A.Hooks.templates[a][1]),b},extractValue:function(a,b){var c=A.Hooks.registered[a];if(c){var d=c[0],e=c[1];return b=A.Hooks.cleanRootPropertyValue(d,b),b.toString().match(A.RegEx.valueSplit)[e]}return b},injectValue:function(a,b,c){var d=A.Hooks.registered[a];if(d){var e,f,g=d[0],h=d[1];return c=A.Hooks.cleanRootPropertyValue(g,c),e=c.toString().match(A.RegEx.valueSplit),e[h]=b,f=e.join(" ")}return c}},Normalizations:{registered:{clip:function(a,b,c){switch(a){case"name":return"clip";case"extract":var d;return A.RegEx.wrappedValueAlreadyExtracted.test(c)?d=c:(d=c.toString().match(A.RegEx.valueUnwrap),d=d?d[1].replace(/,(\s+)?/g," "):c),d;case"inject":return"rect("+c+")"}},blur:function(a,b,c){switch(a){case"name":return y.State.isFirefox?"filter":"-webkit-filter";case"extract":var d=parseFloat(c);if(!d&&0!==d){var e=c.toString().match(/blur\(([0-9]+[A-z]+)\)/i);d=e?e[1]:0}return d;case"inject":return parseFloat(c)?"blur("+c+")":"none"}},opacity:function(a,b,c){if(8>=p)switch(a){case"name":return"filter";case"extract":var d=c.toString().match(/alpha\(opacity=(.*)\)/i);return c=d?d[1]/100:1;case"inject":return b.style.zoom=1,parseFloat(c)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(c),10)+")"}else switch(a){case"name":return"opacity";case"extract":return c;case"inject":return c}}},register:function(){function a(a,b,c){var d="border-box"===A.getPropertyValue(b,"boxSizing").toString().toLowerCase();if(d===(c||!1)){var e,f,g=0,h="width"===a?["Left","Right"]:["Top","Bottom"],i=["padding"+h[0],"padding"+h[1],"border"+h[0]+"Width","border"+h[1]+"Width"];for(e=0;e<i.length;e++)f=parseFloat(A.getPropertyValue(b,i[e])),isNaN(f)||(g+=f);return c?-g:g}return 0}function b(b,c){return function(d,e,f){switch(d){case"name":return b;case"extract":return parseFloat(f)+a(b,e,c);case"inject":return parseFloat(f)-a(b,e,c)+"px"}}}p&&!(p>9)||y.State.isGingerbread||(A.Lists.transformsBase=A.Lists.transformsBase.concat(A.Lists.transforms3D));for(var c=0;c<A.Lists.transformsBase.length;c++)!function(){var a=A.Lists.transformsBase[c];A.Normalizations.registered[a]=function(b,c,e){switch(b){case"name":return"transform";case"extract":return g(c)===d||g(c).transformCache[a]===d?/^scale/i.test(a)?1:0:g(c).transformCache[a].replace(/[()]/g,"");case"inject":var f=!1;switch(a.substr(0,a.length-1)){case"translate":f=!/(%|px|em|rem|vw|vh|\d)$/i.test(e);break;case"scal":case"scale":y.State.isAndroid&&g(c).transformCache[a]===d&&1>e&&(e=1),f=!/(\d)$/i.test(e);break;case"skew":f=!/(deg|\d)$/i.test(e);break;case"rotate":f=!/(deg|\d)$/i.test(e)}return f||(g(c).transformCache[a]="("+e+")"),g(c).transformCache[a]}}}();for(var e=0;e<A.Lists.colors.length;e++)!function(){var a=A.Lists.colors[e];A.Normalizations.registered[a]=function(b,c,e){switch(b){case"name":return a;case"extract":var f;if(A.RegEx.wrappedValueAlreadyExtracted.test(e))f=e;else{var g,h={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(e)?g=h[e]!==d?h[e]:h.black:A.RegEx.isHex.test(e)?g="rgb("+A.Values.hexToRgb(e).join(" ")+")":/^rgba?\(/i.test(e)||(g=h.black),f=(g||e).toString().match(A.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return(!p||p>8)&&3===f.split(" ").length&&(f+=" 1"),f;case"inject":return/^rgb/.test(e)?e:(8>=p?4===e.split(" ").length&&(e=e.split(/\s+/).slice(0,3).join(" ")):3===e.split(" ").length&&(e+=" 1"),(8>=p?"rgb":"rgba")+"("+e.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")")}}}();A.Normalizations.registered.innerWidth=b("width",!0),A.Normalizations.registered.innerHeight=b("height",!0),A.Normalizations.registered.outerWidth=b("width"),A.Normalizations.registered.outerHeight=b("height")}},Names:{camelCase:function(a){return a.replace(/-(\w)/g,function(a,b){return b.toUpperCase()})},SVGAttribute:function(a){var b="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(p||y.State.isAndroid&&!y.State.isChrome)&&(b+="|transform"),new RegExp("^("+b+")$","i").test(a)},prefixCheck:function(a){if(y.State.prefixMatches[a])return[y.State.prefixMatches[a],!0];for(var b=["","Webkit","Moz","ms","O"],c=0,d=b.length;d>c;c++){var e;if(e=0===c?a:b[c]+a.replace(/^\w/,function(a){return a.toUpperCase()}),u.isString(y.State.prefixElement.style[e]))return y.State.prefixMatches[a]=e,[e,!0]}return[a,!1]}},Values:{hexToRgb:function(a){var b,c=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return a=a.replace(c,function(a,b,c,d){return b+b+c+c+d+d}),b=d.exec(a),b?[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]:[0,0,0]},isCSSNullValue:function(a){return!a||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(a)},getUnitType:function(a){return/^(rotate|skew)/i.test(a)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(a)?"":"px"},getDisplayType:function(a){var b=a&&a.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(b)?"inline":/^(li)$/i.test(b)?"list-item":/^(tr)$/i.test(b)?"table-row":/^(table)$/i.test(b)?"table":/^(tbody)$/i.test(b)?"table-row-group":"block"},addClass:function(a,b){if(a)if(a.classList)a.classList.add(b);else if(u.isString(a.className))a.className+=(a.className.length?" ":"")+b;else{var c=a.getAttribute(7>=p?"className":"class")||"";a.setAttribute("class",c+(c?" ":"")+b)}},removeClass:function(a,b){if(a)if(a.classList)a.classList.remove(b);else if(u.isString(a.className))a.className=a.className.toString().replace(new RegExp("(^|\\s)"+b.split(" ").join("|")+"(\\s|$)","gi")," ");else{var c=a.getAttribute(7>=p?"className":"class")||"";a.setAttribute("class",c.replace(new RegExp("(^|s)"+b.split(" ").join("|")+"(s|$)","gi")," "))}}},getPropertyValue:function(a,c,e,f){function h(a,c){var e=0;if(8>=p)e=o.css(a,c);else{var i=!1;/^(width|height)$/.test(c)&&0===A.getPropertyValue(a,"display")&&(i=!0,A.setPropertyValue(a,"display",A.Values.getDisplayType(a)));var j=function(){i&&A.setPropertyValue(a,"display","none")};if(!f){if("height"===c&&"border-box"!==A.getPropertyValue(a,"boxSizing").toString().toLowerCase()){var k=a.offsetHeight-(parseFloat(A.getPropertyValue(a,"borderTopWidth"))||0)-(parseFloat(A.getPropertyValue(a,"borderBottomWidth"))||0)-(parseFloat(A.getPropertyValue(a,"paddingTop"))||0)-(parseFloat(A.getPropertyValue(a,"paddingBottom"))||0);return j(),k}if("width"===c&&"border-box"!==A.getPropertyValue(a,"boxSizing").toString().toLowerCase()){var l=a.offsetWidth-(parseFloat(A.getPropertyValue(a,"borderLeftWidth"))||0)-(parseFloat(A.getPropertyValue(a,"borderRightWidth"))||0)-(parseFloat(A.getPropertyValue(a,"paddingLeft"))||0)-(parseFloat(A.getPropertyValue(a,"paddingRight"))||0);return j(),l}}var m;m=g(a)===d?b.getComputedStyle(a,null):g(a).computedStyle?g(a).computedStyle:g(a).computedStyle=b.getComputedStyle(a,null),"borderColor"===c&&(c="borderTopColor"),e=9===p&&"filter"===c?m.getPropertyValue(c):m[c],(""===e||null===e)&&(e=a.style[c]),j()}if("auto"===e&&/^(top|right|bottom|left)$/i.test(c)){var n=h(a,"position");("fixed"===n||"absolute"===n&&/top|left/i.test(c))&&(e=o(a).position()[c]+"px")}return e}var i;if(A.Hooks.registered[c]){var j=c,k=A.Hooks.getRoot(j);e===d&&(e=A.getPropertyValue(a,A.Names.prefixCheck(k)[0])),A.Normalizations.registered[k]&&(e=A.Normalizations.registered[k]("extract",a,e)),i=A.Hooks.extractValue(j,e)}else if(A.Normalizations.registered[c]){var l,m;l=A.Normalizations.registered[c]("name",a),"transform"!==l&&(m=h(a,A.Names.prefixCheck(l)[0]),A.Values.isCSSNullValue(m)&&A.Hooks.templates[c]&&(m=A.Hooks.templates[c][1])),i=A.Normalizations.registered[c]("extract",a,m)}if(!/^[\d-]/.test(i)){var n=g(a);if(n&&n.isSVG&&A.Names.SVGAttribute(c))if(/^(height|width)$/i.test(c))try{i=a.getBBox()[c]}catch(q){i=0}else i=a.getAttribute(c);else i=h(a,A.Names.prefixCheck(c)[0])}return A.Values.isCSSNullValue(i)&&(i=0),y.debug>=2,i},setPropertyValue:function(a,c,d,e,f){var h=c;if("scroll"===c)f.container?f.container["scroll"+f.direction]=d:"Left"===f.direction?b.scrollTo(d,f.alternateValue):b.scrollTo(f.alternateValue,d);else if(A.Normalizations.registered[c]&&"transform"===A.Normalizations.registered[c]("name",a))A.Normalizations.registered[c]("inject",a,d),h="transform",d=g(a).transformCache[c];else{if(A.Hooks.registered[c]){var i=c,j=A.Hooks.getRoot(c);e=e||A.getPropertyValue(a,j),d=A.Hooks.injectValue(i,d,e),c=j}if(A.Normalizations.registered[c]&&(d=A.Normalizations.registered[c]("inject",a,d),c=A.Normalizations.registered[c]("name",a)),h=A.Names.prefixCheck(c)[0],8>=p)try{a.style[h]=d}catch(k){y.debug}else{var l=g(a);l&&l.isSVG&&A.Names.SVGAttribute(c)?a.setAttribute(c,d):a.style[h]=d}y.debug>=2}return[h,d]},flushTransformCache:function(a){var b="",c=g(a);if((p||y.State.isAndroid&&!y.State.isChrome)&&c&&c.isSVG){var d=function(b){return parseFloat(A.getPropertyValue(a,b))},e={translate:[d("translateX"),d("translateY")],skewX:[d("skewX")],skewY:[d("skewY")],scale:1!==d("scale")?[d("scale"),d("scale")]:[d("scaleX"),d("scaleY")],rotate:[d("rotateZ"),0,0]};o.each(g(a).transformCache,function(a){/^translate/i.test(a)?a="translate":/^scale/i.test(a)?a="scale":/^rotate/i.test(a)&&(a="rotate"),e[a]&&(b+=a+"("+e[a].join(" ")+") ",delete e[a])})}else{var f,h;o.each(g(a).transformCache,function(c){return f=g(a).transformCache[c],"transformPerspective"===c?(h=f,!0):(9===p&&"rotateZ"===c&&(c="rotate"),void(b+=c+f+" "))}),h&&(b="perspective"+h+" "+b)}A.setPropertyValue(a,"transform",b)}};A.Hooks.register(),A.Normalizations.register(),y.hook=function(a,b,c){var e;return a=f(a),o.each(a,function(a,f){if(g(f)===d&&y.init(f),c===d)e===d&&(e=A.getPropertyValue(f,b));else{var h=A.setPropertyValue(f,b,c);"transform"===h[0]&&y.CSS.flushTransformCache(f),e=h}}),e};var B=function(){function a(){return k?z.promise||null:p}function e(a,e){function f(f){var k,n;if(i.begin&&0===D)try{i.begin.call(r,r)}catch(p){setTimeout(function(){throw p},1)}if("scroll"===G){var q,w,x,B=/^x$/i.test(i.axis)?"Left":"Top",E=parseFloat(i.offset)||0;i.container?u.isWrapped(i.container)||u.isNode(i.container)?(i.container=i.container[0]||i.container,q=i.container["scroll"+B],x=q+o(a).position()[B.toLowerCase()]+E):i.container=null:(q=y.State.scrollAnchor[y.State["scrollProperty"+B]],w=y.State.scrollAnchor[y.State["scrollProperty"+("Left"===B?"Top":"Left")]],x=o(a).offset()[B.toLowerCase()]+E),j={scroll:{rootPropertyValue:!1,startValue:q,currentValue:q,endValue:x,unitType:"",easing:i.easing,scrollData:{container:i.container,direction:B,alternateValue:w}},element:a},y.debug}else if("reverse"===G){if(k=g(a),!k)return;if(!k.tweensContainer)return void o.dequeue(a,i.queue);"none"===k.opts.display&&(k.opts.display="auto"),"hidden"===k.opts.visibility&&(k.opts.visibility="visible"),k.opts.loop=!1,k.opts.begin=null,k.opts.complete=null,v.easing||delete i.easing,v.duration||delete i.duration,i=o.extend({},k.opts,i),n=o.extend(!0,{},k?k.tweensContainer:null);for(var F in n)if(n.hasOwnProperty(F)&&"element"!==F){var H=n[F].startValue;n[F].startValue=n[F].currentValue=n[F].endValue,n[F].endValue=H,u.isEmptyObject(v)||(n[F].easing=i.easing),y.debug}j=n}else if("start"===G){k=g(a),k&&k.tweensContainer&&k.isAnimating===!0&&(n=k.tweensContainer);var I=function(b,c){var d,f,g;return u.isFunction(b)&&(b=b.call(a,e,C)),u.isArray(b)?(d=b[0],!u.isArray(b[1])&&/^[\d-]/.test(b[1])||u.isFunction(b[1])||A.RegEx.isHex.test(b[1])?g=b[1]:u.isString(b[1])&&!A.RegEx.isHex.test(b[1])&&y.Easings[b[1]]||u.isArray(b[1])?(f=c?b[1]:l(b[1],i.duration),g=b[2]):g=b[1]||b[2]):d=b,c||(f=f||i.easing),u.isFunction(d)&&(d=d.call(a,e,C)),u.isFunction(g)&&(g=g.call(a,e,C)),[d||0,f,g]},J=function(e,f){var g,l=A.Hooks.getRoot(e),m=!1,p=f[0],q=f[1],r=f[2];if(!(k&&k.isSVG||"tween"===l||A.Names.prefixCheck(l)[1]!==!1||A.Normalizations.registered[l]!==d))return void y.debug;(i.display!==d&&null!==i.display&&"none"!==i.display||i.visibility!==d&&"hidden"!==i.visibility)&&/opacity|filter/.test(e)&&!r&&0!==p&&(r=0),i._cacheValues&&n&&n[e]?(r===d&&(r=n[e].endValue+n[e].unitType),m=k.rootPropertyValueCache[l]):A.Hooks.registered[e]?r===d?(m=A.getPropertyValue(a,l),r=A.getPropertyValue(a,e,m)):m=A.Hooks.templates[l][1]:r===d&&(r=A.getPropertyValue(a,e));var s,t,v,w=!1,x=function(a,b){var c,d;return d=(b||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(a){return c=a,""}),c||(c=A.Values.getUnitType(a)),[d,c]};if(r!==p&&u.isString(r)&&u.isString(p)){g="";var z=0,B=0,C=[],D=[],E=0,F=0,G=0;for(r=A.Hooks.fixColors(r),p=A.Hooks.fixColors(p);z<r.length&&B<p.length;){var H=r[z],I=p[B];if(/[\d\.-]/.test(H)&&/[\d\.-]/.test(I)){for(var J=H,K=I,L=".",N=".";++z<r.length;){if(H=r[z],H===L)L="..";else if(!/\d/.test(H))break;J+=H}for(;++B<p.length;){if(I=p[B],I===N)N="..";else if(!/\d/.test(I))break;K+=I}var O=A.Hooks.getUnit(r,z),P=A.Hooks.getUnit(p,B);if(z+=O.length,B+=P.length,O===P)J===K?g+=J+O:(g+="{"+C.length+(F?"!":"")+"}"+O,C.push(parseFloat(J)),D.push(parseFloat(K)));else{var Q=parseFloat(J),R=parseFloat(K);g+=(5>E?"calc":"")+"("+(Q?"{"+C.length+(F?"!":"")+"}":"0")+O+" + "+(R?"{"+(C.length+(Q?1:0))+(F?"!":"")+"}":"0")+P+")",Q&&(C.push(Q),D.push(0)),R&&(C.push(0),D.push(R))}}else{if(H!==I){E=0;break}g+=H,z++,B++,0===E&&"c"===H||1===E&&"a"===H||2===E&&"l"===H||3===E&&"c"===H||E>=4&&"("===H?E++:(E&&5>E||E>=4&&")"===H&&--E<5)&&(E=0),0===F&&"r"===H||1===F&&"g"===H||2===F&&"b"===H||3===F&&"a"===H||F>=3&&"("===H?(3===F&&"a"===H&&(G=1),F++):G&&","===H?++G>3&&(F=G=0):(G&&(G?5:4)>F||F>=(G?4:3)&&")"===H&&--F<(G?5:4))&&(F=G=0)}}(z!==r.length||B!==p.length)&&(y.debug,g=d),g&&(C.length?(y.debug,r=C,p=D,t=v=""):g=d)}g||(s=x(e,r),r=s[0],v=s[1],s=x(e,p),p=s[0].replace(/^([+-\/*])=/,function(a,b){return w=b,""}),t=s[1],r=parseFloat(r)||0,p=parseFloat(p)||0,"%"===t&&(/^(fontSize|lineHeight)$/.test(e)?(p/=100,t="em"):/^scale/.test(e)?(p/=100,t=""):/(Red|Green|Blue)$/i.test(e)&&(p=p/100*255,t="")));var S=function(){var d={myParent:a.parentNode||c.body,position:A.getPropertyValue(a,"position"),fontSize:A.getPropertyValue(a,"fontSize")},e=d.position===M.lastPosition&&d.myParent===M.lastParent,f=d.fontSize===M.lastFontSize;M.lastParent=d.myParent,M.lastPosition=d.position,M.lastFontSize=d.fontSize;var g=100,h={};if(f&&e)h.emToPx=M.lastEmToPx,h.percentToPxWidth=M.lastPercentToPxWidth,h.percentToPxHeight=M.lastPercentToPxHeight;else{var i=k&&k.isSVG?c.createElementNS("http://www.w3.org/2000/svg","rect"):c.createElement("div");y.init(i),d.myParent.appendChild(i),o.each(["overflow","overflowX","overflowY"],function(a,b){y.CSS.setPropertyValue(i,b,"hidden")}),y.CSS.setPropertyValue(i,"position",d.position),y.CSS.setPropertyValue(i,"fontSize",d.fontSize),y.CSS.setPropertyValue(i,"boxSizing","content-box"),o.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(a,b){y.CSS.setPropertyValue(i,b,g+"%")}),y.CSS.setPropertyValue(i,"paddingLeft",g+"em"),h.percentToPxWidth=M.lastPercentToPxWidth=(parseFloat(A.getPropertyValue(i,"width",null,!0))||1)/g,h.percentToPxHeight=M.lastPercentToPxHeight=(parseFloat(A.getPropertyValue(i,"height",null,!0))||1)/g,h.emToPx=M.lastEmToPx=(parseFloat(A.getPropertyValue(i,"paddingLeft"))||1)/g,d.myParent.removeChild(i)}return null===M.remToPx&&(M.remToPx=parseFloat(A.getPropertyValue(c.body,"fontSize"))||16),null===M.vwToPx&&(M.vwToPx=parseFloat(b.innerWidth)/100,M.vhToPx=parseFloat(b.innerHeight)/100),h.remToPx=M.remToPx,h.vwToPx=M.vwToPx,h.vhToPx=M.vhToPx,y.debug>=1,h};if(/[\/*]/.test(w))t=v;else if(v!==t&&0!==r)if(0===p)t=v;else{h=h||S();var T=/margin|padding|left|right|width|text|word|letter/i.test(e)||/X$/.test(e)||"x"===e?"x":"y";switch(v){case"%":r*="x"===T?h.percentToPxWidth:h.percentToPxHeight;break;case"px":break;default:r*=h[v+"ToPx"]}switch(t){case"%":r*=1/("x"===T?h.percentToPxWidth:h.percentToPxHeight);break;case"px":break;default:r*=1/h[t+"ToPx"]}}switch(w){case"+":p=r+p;break;case"-":p=r-p;break;case"*":p=r*p;break;case"/":p=r/p}j[e]={rootPropertyValue:m,startValue:r,currentValue:r,endValue:p,unitType:t,easing:q},g&&(j[e].pattern=g),y.debug};for(var K in s)if(s.hasOwnProperty(K)){var L=A.Names.camelCase(K),O=I(s[K]);if(t(A.Lists.colors,L)){var P=O[0],Q=O[1],R=O[2];if(A.RegEx.isHex.test(P)){for(var S=["Red","Green","Blue"],T=A.Values.hexToRgb(P),U=R?A.Values.hexToRgb(R):d,V=0;V<S.length;V++){var W=[T[V]];Q&&W.push(Q),U!==d&&W.push(U[V]),J(L+S[V],W)}continue}}J(L,O)}j.element=a}j.element&&(A.Values.addClass(a,"velocity-animating"),N.push(j),k=g(a),k&&(""===i.queue&&(k.tweensContainer=j,k.opts=i),k.isAnimating=!0),D===C-1?(y.State.calls.push([N,r,i,null,z.resolver,null,0]),y.State.isTicking===!1&&(y.State.isTicking=!0,m())):D++)}var h,i=o.extend({},y.defaults,v),j={};switch(g(a)===d&&y.init(a),parseFloat(i.delay)&&i.queue!==!1&&o.queue(a,i.queue,function(b){y.velocityQueueEntryFlag=!0;var c=y.State.delayedElements.count++;y.State.delayedElements[c]=a;var d=function(a){return function(){y.State.delayedElements[a]=!1,b()}}(c);g(a).delayBegin=(new Date).getTime(),g(a).delay=parseFloat(i.delay),g(a).delayTimer={setTimeout:setTimeout(b,parseFloat(i.delay)),next:d}}),i.duration.toString().toLowerCase()){case"fast":i.duration=200;break;case"normal":i.duration=w;break;case"slow":i.duration=600;break;default:i.duration=parseFloat(i.duration)||1}if(y.mock!==!1&&(y.mock===!0?i.duration=i.delay=1:(i.duration*=parseFloat(y.mock)||1,i.delay*=parseFloat(y.mock)||1)),i.easing=l(i.easing,i.duration),i.begin&&!u.isFunction(i.begin)&&(i.begin=null),i.progress&&!u.isFunction(i.progress)&&(i.progress=null),i.complete&&!u.isFunction(i.complete)&&(i.complete=null),i.display!==d&&null!==i.display&&(i.display=i.display.toString().toLowerCase(),"auto"===i.display&&(i.display=y.CSS.Values.getDisplayType(a))),i.visibility!==d&&null!==i.visibility&&(i.visibility=i.visibility.toString().toLowerCase()),i.mobileHA=i.mobileHA&&y.State.isMobile&&!y.State.isGingerbread,i.queue===!1)if(i.delay){var k=y.State.delayedElements.count++;y.State.delayedElements[k]=a;var n=function(a){return function(){y.State.delayedElements[a]=!1,f()}}(k);g(a).delayBegin=(new Date).getTime(),g(a).delay=parseFloat(i.delay),g(a).delayTimer={setTimeout:setTimeout(f,parseFloat(i.delay)),next:n}}else f();else o.queue(a,i.queue,function(a,b){return b===!0?(z.promise&&z.resolver(r),!0):(y.velocityQueueEntryFlag=!0,void f(a))});""!==i.queue&&"fx"!==i.queue||"inprogress"===o.queue(a)[0]||o.dequeue(a)}var j,k,p,q,r,s,v,x=arguments[0]&&(arguments[0].p||o.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||u.isString(arguments[0].properties));u.isWrapped(this)?(k=!1,q=0,r=this,p=this):(k=!0,q=1,r=x?arguments[0].elements||arguments[0].e:arguments[0]);var z={promise:null,resolver:null,rejecter:null};if(k&&y.Promise&&(z.promise=new y.Promise(function(a,b){z.resolver=a,z.rejecter=b})),x?(s=arguments[0].properties||arguments[0].p,v=arguments[0].options||arguments[0].o):(s=arguments[q],v=arguments[q+1]),r=f(r),!r)return void(z.promise&&(s&&v&&v.promiseRejectEmpty===!1?z.resolver():z.rejecter()));var C=r.length,D=0;if(!/^(stop|finish|finishAll|pause|resume)$/i.test(s)&&!o.isPlainObject(v)){var E=q+1;v={};for(var F=E;F<arguments.length;F++)u.isArray(arguments[F])||!/^(fast|normal|slow)$/i.test(arguments[F])&&!/^\d/.test(arguments[F])?u.isString(arguments[F])||u.isArray(arguments[F])?v.easing=arguments[F]:u.isFunction(arguments[F])&&(v.complete=arguments[F]):v.duration=arguments[F]}var G;switch(s){case"scroll":G="scroll";break;case"reverse":G="reverse";break;case"pause":var H=(new Date).getTime();return o.each(r,function(a,b){h(b,H)}),o.each(y.State.calls,function(a,b){var c=!1;b&&o.each(b[1],function(a,e){var f=v===d?"":v;return f===!0||b[2].queue===f||v===d&&b[2].queue===!1?(o.each(r,function(a,d){return d===e?(b[5]={resume:!1},c=!0,!1):void 0}),c?!1:void 0):!0})}),a();case"resume":return o.each(r,function(a,b){i(b,H)}),o.each(y.State.calls,function(a,b){var c=!1;b&&o.each(b[1],function(a,e){var f=v===d?"":v;return(f===!0||b[2].queue===f||v===d&&b[2].queue===!1)&&b[5]?(o.each(r,function(a,d){return d===e?(b[5].resume=!0,c=!0,!1):void 0}),c?!1:void 0):!0})}),a();case"finish":case"finishAll":case"stop":o.each(r,function(a,b){g(b)&&g(b).delayTimer&&(clearTimeout(g(b).delayTimer.setTimeout),g(b).delayTimer.next&&g(b).delayTimer.next(),delete g(b).delayTimer),"finishAll"!==s||v!==!0&&!u.isString(v)||(o.each(o.queue(b,u.isString(v)?v:""),function(a,b){u.isFunction(b)&&b()}),o.queue(b,u.isString(v)?v:"",[]))});var I=[];return o.each(y.State.calls,function(a,b){b&&o.each(b[1],function(c,e){var f=v===d?"":v;return f===!0||b[2].queue===f||v===d&&b[2].queue===!1?void o.each(r,function(c,d){if(d===e)if((v===!0||u.isString(v))&&(o.each(o.queue(d,u.isString(v)?v:""),function(a,b){u.isFunction(b)&&b(null,!0)}),o.queue(d,u.isString(v)?v:"",[])),"stop"===s){var h=g(d);h&&h.tweensContainer&&f!==!1&&o.each(h.tweensContainer,function(a,b){b.endValue=b.currentValue}),I.push(a)}else("finish"===s||"finishAll"===s)&&(b[2].duration=1)}):!0})}),"stop"===s&&(o.each(I,function(a,b){n(b,!0)}),z.promise&&z.resolver(r)),a();default:if(!o.isPlainObject(s)||u.isEmptyObject(s)){if(u.isString(s)&&y.Redirects[s]){j=o.extend({},v);var J=j.duration,K=j.delay||0;return j.backwards===!0&&(r=o.extend(!0,[],r).reverse()),o.each(r,function(a,b){parseFloat(j.stagger)?j.delay=K+parseFloat(j.stagger)*a:u.isFunction(j.stagger)&&(j.delay=K+j.stagger.call(b,a,C)),j.drag&&(j.duration=parseFloat(J)||(/^(callout|transition)/.test(s)?1e3:w),j.duration=Math.max(j.duration*(j.backwards?1-a/C:(a+1)/C),.75*j.duration,200)),y.Redirects[s].call(b,b,j||{},a,C,r,z.promise?z:d)}),a()}var L="Velocity: First argument ("+s+") was not a property map, a known action, or a registered redirect. Aborting.";return z.promise?z.rejecter(new Error(L)):b.console,a()}G="start"}var M={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},N=[];o.each(r,function(a,b){u.isNode(b)&&e(b,a)}),j=o.extend({},y.defaults,v),j.loop=parseInt(j.loop,10);var O=2*j.loop-1;if(j.loop)for(var P=0;O>P;P++){var Q={delay:j.delay,progress:j.progress};P===O-1&&(Q.display=j.display,Q.visibility=j.visibility,Q.complete=j.complete),B(r,"reverse",Q)}return a()};y=o.extend(B,y),y.animate=B;var C=b.requestAnimationFrame||q;if(!y.State.isMobile&&c.hidden!==d){var D=function(){c.hidden?(C=function(a){return setTimeout(function(){a(!0)},16)},m()):C=b.requestAnimationFrame||q};D(),c.addEventListener("visibilitychange",D)}return a.Velocity=y,a!==b&&(a.fn.velocity=B,a.fn.velocity.defaults=y.defaults),o.each(["Down","Up"],function(a,b){y.Redirects["slide"+b]=function(a,c,e,f,g,h){var i=o.extend({},c),j=i.begin,k=i.complete,l={},m={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""};i.display===d&&(i.display="Down"===b?"inline"===y.CSS.Values.getDisplayType(a)?"inline-block":"block":"none"),i.begin=function(){0===e&&j&&j.call(g,g);for(var c in m)if(m.hasOwnProperty(c)){l[c]=a.style[c];var d=A.getPropertyValue(a,c);m[c]="Down"===b?[d,0]:[0,d]}l.overflow=a.style.overflow,a.style.overflow="hidden"},i.complete=function(){for(var b in l)l.hasOwnProperty(b)&&(a.style[b]=l[b]);e===f-1&&(k&&k.call(g,g),h&&h.resolver(g))},y(a,m,i)}}),o.each(["In","Out"],function(a,b){y.Redirects["fade"+b]=function(a,c,e,f,g,h){var i=o.extend({},c),j=i.complete,k={opacity:"In"===b?1:0};0!==e&&(i.begin=null),e!==f-1?i.complete=null:i.complete=function(){j&&j.call(g,g),h&&h.resolver(g)},i.display===d&&(i.display="In"===b?"auto":"none"),y(this,k,i)}}),y}(window.jQuery||window.Zepto||window,window,window?window.document:void 0)}),function(a){"use strict";"function"==typeof require&&"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define("toast/animations/_velocity.ui",["./_velocity"],a):a()}(function(){"use strict";return function(a,b,c,d){function e(a,b){var c=[];return a&&b?(g.each([a,b],function(a,b){var d=[];g.each(b,function(a,b){for(;b.toString().length<5;)b="0"+b;d.push(b)}),c.push(d.join(""))}),parseFloat(c[0])>parseFloat(c[1])):!1}var f=a.Velocity;if(!f||!f.Utilities)return void b.console;var g=f.Utilities,h=f.version,i={major:1,minor:1,patch:0};if(e(i,h)){var j="Velocity UI Pack: You need to update Velocity (velocity.js) to a newer version. Visit http://github.com/julianshapiro/velocity.";throw alert(j),new Error(j)}f.RegisterEffect=f.RegisterUI=function(a,b){function c(a,b,c,d){var e,h=0;g.each(a.nodeType?[a]:a,function(a,b){d&&(c+=a*d),e=b.parentNode;var i=["height","paddingTop","paddingBottom","marginTop","marginBottom"];"border-box"===f.CSS.getPropertyValue(b,"boxSizing").toString().toLowerCase()&&(i=["height"]),g.each(i,function(a,c){h+=parseFloat(f.CSS.getPropertyValue(b,c))})}),f.animate(e,{height:("In"===b?"+":"-")+"="+h},{queue:!1,easing:"ease-in-out",duration:c*("In"===b?.6:1)})}return f.Redirects[a]=function(e,h,i,j,k,l,m){var n=i===j-1,o=0;m=m||b.loop,"function"==typeof b.defaultDuration?b.defaultDuration=b.defaultDuration.call(k,k):b.defaultDuration=parseFloat(b.defaultDuration);for(var p=0;p<b.calls.length;p++)u=b.calls[p][1],"number"==typeof u&&(o+=u);var q=o>=1?0:b.calls.length?(1-o)/b.calls.length:1;for(p=0;p<b.calls.length;p++){var r=b.calls[p],s=r[0],t=1e3,u=r[1],v=r[2]||{},w={};if(h.duration!==d?t=h.duration:b.defaultDuration!==d&&(t=b.defaultDuration),w.duration=t*("number"==typeof u?u:q),w.queue=h.queue||"",w.easing=v.easing||"ease",w.delay=parseFloat(v.delay)||0,w.loop=!b.loop&&v.loop,w._cacheValues=v._cacheValues||!0,0===p){if(w.delay+=parseFloat(h.delay)||0,0===i&&(w.begin=function(){h.begin&&h.begin.call(k,k);var b=a.match(/(In|Out)$/);b&&"In"===b[0]&&s.opacity!==d&&g.each(k.nodeType?[k]:k,function(a,b){f.CSS.setPropertyValue(b,"opacity",0)}),h.animateParentHeight&&b&&c(k,b[0],t+w.delay,h.stagger)}),null!==h.display)if(h.display!==d&&"none"!==h.display)w.display=h.display;else if(/In$/.test(a)){var x=f.CSS.Values.getDisplayType(e);w.display="inline"===x?"inline-block":x}h.visibility&&"hidden"!==h.visibility&&(w.visibility=h.visibility)}if(p===b.calls.length-1){var y=function(){h.display!==d&&"none"!==h.display||!/Out$/.test(a)||g.each(k.nodeType?[k]:k,function(a,b){f.CSS.setPropertyValue(b,"display","none")}),h.complete&&h.complete.call(k,k),l&&l.resolver(k||e)};w.complete=function(){if(m&&f.Redirects[a](e,h,i,j,k,l,m===!0?!0:Math.max(0,m-1)),b.reset){for(var c in b.reset)if(b.reset.hasOwnProperty(c)){var g=b.reset[c];f.CSS.Hooks.registered[c]!==d||"string"!=typeof g&&"number"!=typeof g||(b.reset[c]=[b.reset[c],b.reset[c]])}var o={duration:0,queue:!1};n&&(o.complete=y),f.animate(e,b.reset,o)}else n&&y()},"hidden"===h.visibility&&(w.visibility=h.visibility)}f.animate(e,s,w)}},f},f.RegisterEffect.packagedEffects={"callout.bounce":{defaultDuration:550,calls:[[{translateY:-30},.25],[{translateY:0},.125],[{translateY:-15},.125],[{translateY:0},.25]]},"callout.shake":{defaultDuration:800,calls:[[{translateX:-11}],[{translateX:11}],[{translateX:-11}],[{translateX:11}],[{translateX:-11}],[{translateX:11}],[{translateX:-11}],[{translateX:0}]]},"callout.flash":{defaultDuration:1100,calls:[[{opacity:[0,"easeInOutQuad",1]}],[{opacity:[1,"easeInOutQuad"]}],[{opacity:[0,"easeInOutQuad"]}],[{opacity:[1,"easeInOutQuad"]}]]},"callout.pulse":{defaultDuration:825,calls:[[{scaleX:1.1,scaleY:1.1},.5,{easing:"easeInExpo"}],[{scaleX:1,scaleY:1},.5]]},"callout.swing":{defaultDuration:950,calls:[[{rotateZ:15}],[{rotateZ:-10}],[{rotateZ:5}],[{rotateZ:-5}],[{rotateZ:0}]]},"callout.tada":{defaultDuration:1e3,calls:[[{scaleX:.9,scaleY:.9,rotateZ:-3},.1],[{scaleX:1.1,scaleY:1.1,rotateZ:3},.1],[{scaleX:1.1,scaleY:1.1,rotateZ:-3},.1],["reverse",.125],["reverse",.125],["reverse",.125],["reverse",.125],["reverse",.125],[{scaleX:1,scaleY:1,rotateZ:0},.2]]},"transition.fadeIn":{defaultDuration:500,calls:[[{opacity:[1,0]}]]},"transition.fadeOut":{defaultDuration:500,calls:[[{opacity:[0,1]}]]},"transition.flipXIn":{defaultDuration:700,calls:[[{opacity:[1,0],transformPerspective:[800,800],rotateY:[0,-55]}]],reset:{transformPerspective:0}},"transition.flipXOut":{defaultDuration:700,calls:[[{opacity:[0,1],transformPerspective:[800,800],rotateY:55}]],reset:{transformPerspective:0,rotateY:0}},"transition.flipYIn":{
defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],rotateX:[0,-45]}]],reset:{transformPerspective:0}},"transition.flipYOut":{defaultDuration:800,calls:[[{opacity:[0,1],transformPerspective:[800,800],rotateX:25}]],reset:{transformPerspective:0,rotateX:0}},"transition.flipBounceXIn":{defaultDuration:900,calls:[[{opacity:[.725,0],transformPerspective:[400,400],rotateY:[-10,90]},.5],[{opacity:.8,rotateY:10},.25],[{opacity:1,rotateY:0},.25]],reset:{transformPerspective:0}},"transition.flipBounceXOut":{defaultDuration:800,calls:[[{opacity:[.9,1],transformPerspective:[400,400],rotateY:-10}],[{opacity:0,rotateY:90}]],reset:{transformPerspective:0,rotateY:0}},"transition.flipBounceYIn":{defaultDuration:850,calls:[[{opacity:[.725,0],transformPerspective:[400,400],rotateX:[-10,90]},.5],[{opacity:.8,rotateX:10},.25],[{opacity:1,rotateX:0},.25]],reset:{transformPerspective:0}},"transition.flipBounceYOut":{defaultDuration:800,calls:[[{opacity:[.9,1],transformPerspective:[400,400],rotateX:-15}],[{opacity:0,rotateX:90}]],reset:{transformPerspective:0,rotateX:0}},"transition.swoopIn":{defaultDuration:850,calls:[[{opacity:[1,0],transformOriginX:["100%","50%"],transformOriginY:["100%","100%"],scaleX:[1,0],scaleY:[1,0],translateX:[0,-700],translateZ:0}]],reset:{transformOriginX:"50%",transformOriginY:"50%"}},"transition.swoopOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformOriginX:["50%","100%"],transformOriginY:["100%","100%"],scaleX:0,scaleY:0,translateX:-700,translateZ:0}]],reset:{transformOriginX:"50%",transformOriginY:"50%",scaleX:1,scaleY:1,translateX:0},resetEffectName:"transition.swoopIn"},"transition.whirlIn":{defaultDuration:850,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,0],scaleY:[1,0],rotateY:[0,160]},1,{easing:"easeInOutSine"}]]},"transition.whirlOut":{defaultDuration:750,calls:[[{opacity:[0,"easeInOutQuint",1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:0,scaleY:0,rotateY:160},1,{easing:"swing"}]],reset:{scaleX:1,scaleY:1,rotateY:0},resetEffectName:"transition.whirlIn"},"transition.shrinkIn":{defaultDuration:750,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,1.5],scaleY:[1,1.5],translateZ:0}]]},"transition.shrinkOut":{defaultDuration:600,calls:[[{opacity:[0,1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:1.3,scaleY:1.3,translateZ:0}]],reset:{scaleX:1,scaleY:1},resetEffectName:"transition.shrinkIn"},"transition.expandIn":{defaultDuration:700,calls:[[{opacity:[1,0],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:[1,.625],scaleY:[1,.625],translateZ:0}]]},"transition.expandOut":{defaultDuration:700,calls:[[{opacity:[0,1],transformOriginX:["50%","50%"],transformOriginY:["50%","50%"],scaleX:.5,scaleY:.5,translateZ:0}]],reset:{scaleX:1,scaleY:1},resetEffectName:"transition.expandIn"},"transition.bounceIn":{defaultDuration:800,calls:[[{opacity:[1,0],scaleX:[1.05,.3],scaleY:[1.05,.3]},.35],[{scaleX:.9,scaleY:.9,translateZ:0},.2],[{scaleX:1,scaleY:1},.45]]},"transition.bounceOut":{defaultDuration:800,calls:[[{scaleX:.95,scaleY:.95},.35],[{scaleX:1.1,scaleY:1.1,translateZ:0},.35],[{opacity:[0,1],scaleX:.3,scaleY:.3},.3]],reset:{scaleX:1,scaleY:1},resetEffectName:"transition.bounceIn"},"transition.bounceUpIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[-30,1e3]},.6,{easing:"easeOutCirc"}],[{translateY:10},.2],[{translateY:0},.2]]},"transition.bounceUpOut":{defaultDuration:1e3,calls:[[{translateY:20},.2],[{opacity:[0,"easeInCirc",1],translateY:-1e3},.8]],reset:{translateY:0},resetEffectName:"transition.bounceUpIn"},"transition.bounceDownIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[30,-1e3]},.6,{easing:"easeOutCirc"}],[{translateY:-10},.2],[{translateY:0},.2]]},"transition.bounceDownOut":{defaultDuration:1e3,calls:[[{translateY:-20},.2],[{opacity:[0,"easeInCirc",1],translateY:1e3},.8]],reset:{translateY:0},resetEffectName:"transition.bounceDownIn"},"transition.bounceLeftIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[30,-1250]},.6,{easing:"easeOutCirc"}],[{translateX:-10},.2],[{translateX:0},.2]]},"transition.bounceLeftOut":{defaultDuration:750,calls:[[{translateX:30},.2],[{opacity:[0,"easeInCirc",1],translateX:-1250},.8]],reset:{translateX:0},resetEffectName:"transition.bounceLeftIn"},"transition.bounceRightIn":{defaultDuration:750,calls:[[{opacity:[1,0],translateX:[-30,1250]},.6,{easing:"easeOutCirc"}],[{translateX:10},.2],[{translateX:0},.2]]},"transition.bounceRightOut":{defaultDuration:750,calls:[[{translateX:-30},.2],[{opacity:[0,"easeInCirc",1],translateX:1250},.8]],reset:{translateX:0},resetEffectName:"transition.bounceRightIn"},"transition.slideUpIn":{defaultDuration:900,calls:[[{opacity:[1,0],translateY:[0,"100%"],translateZ:0}]]},"transition.slideUpOut":{defaultDuration:900,calls:[[{opacity:[0,1],translateY:"-100%",translateZ:0}]],reset:{translateY:0},resetEffectName:"transition.slideUpIn"},"transition.slideDownIn":{defaultDuration:900,calls:[[{opacity:[1,0],translateY:[0,"-100%"],translateZ:0}]]},"transition.slideDownOut":{defaultDuration:900,calls:[[{opacity:[0,1],translateY:"100%",translateZ:0}]],reset:{translateY:0},resetEffectName:"transition.slideDownIn"},"transition.slideLeftIn":{defaultDuration:1e3,calls:[[{opacity:[1,0],translateX:[0,"-100%"],translateZ:0}]]},"transition.slideLeftOut":{defaultDuration:1050,calls:[[{opacity:[0,1],translateX:"-100%",translateZ:0}]],reset:{translateX:0},resetEffectName:"transition.slideLeftIn"},"transition.slideRightIn":{defaultDuration:1e3,calls:[[{opacity:[1,0],translateX:[0,"100%"],translateZ:0}]]},"transition.slideRightOut":{defaultDuration:1050,calls:[[{opacity:[0,1],translateX:"100%",translateZ:0}]],reset:{translateX:0},resetEffectName:"transition.slideRightIn"},"transition.slideUpBigIn":{defaultDuration:850,calls:[[{opacity:[1,0],translateY:[0,"-100%"],translateZ:0}]]},"transition.slideUpBigOut":{defaultDuration:800,calls:[[{opacity:[0,1],translateY:"-100%",translateZ:0}]],reset:{translateY:0},resetEffectName:"transition.slideUpBigIn"},"transition.slideDownBigIn":{defaultDuration:850,calls:[[{opacity:[1,0],translateY:[0,"-100%"],translateZ:0}]]},"transition.slideDownBigOut":{defaultDuration:800,calls:[[{opacity:[0,1],translateY:"100%",translateZ:0}]],reset:{translateY:0},resetEffectName:"transition.slideDownBigIn"},"transition.slideLeftBigIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateX:[0,"-100%"],translateZ:0}]]},"transition.slideLeftBigOut":{defaultDuration:750,calls:[[{opacity:[0,1],translateX:"-100%",translateZ:0}]],reset:{translateX:0},resetEffectName:"transition.slideLeftBigIn"},"transition.slideRightBigIn":{defaultDuration:800,calls:[[{opacity:[1,0],translateX:[0,"100%"],translateZ:0}]]},"transition.slideRightBigOut":{defaultDuration:750,calls:[[{opacity:[0,1],translateX:"100%",translateZ:0}]],reset:{translateX:0},resetEffectName:"transition.slideRightBigIn"},"transition.perspectiveUpIn":{defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:["100%","100%"],rotateX:[0,-180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveUpOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:["100%","100%"],rotateX:-180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateX:0},resetEffectName:"transition.perspectiveUpIn"},"transition.perspectiveDownIn":{defaultDuration:800,calls:[[{opacity:[1,0],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:[0,0],rotateX:[0,180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveDownOut":{defaultDuration:850,calls:[[{opacity:[0,1],transformPerspective:[800,800],transformOriginX:[0,0],transformOriginY:[0,0],rotateX:180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateX:0},resetEffectName:"transition.perspectiveDownIn"},"transition.perspectiveLeftIn":{defaultDuration:950,calls:[[{opacity:[1,0],transformPerspective:[2e3,2e3],transformOriginX:[0,0],transformOriginY:[0,0],rotateY:[0,-180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveLeftOut":{defaultDuration:950,calls:[[{opacity:[0,1],transformPerspective:[2e3,2e3],transformOriginX:[0,0],transformOriginY:[0,0],rotateY:-180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateY:0},resetEffectName:"transition.perspectiveLeftIn"},"transition.perspectiveRightIn":{defaultDuration:950,calls:[[{opacity:[1,0],transformPerspective:[2e3,2e3],transformOriginX:["100%","100%"],transformOriginY:[0,0],rotateY:[0,180]}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%"}},"transition.perspectiveRightOut":{defaultDuration:950,calls:[[{opacity:[0,1],transformPerspective:[2e3,2e3],transformOriginX:["100%","100%"],transformOriginY:[0,0],rotateY:180}]],reset:{transformPerspective:0,transformOriginX:"50%",transformOriginY:"50%",rotateY:0},resetEffectName:"transition.perspectiveRightIn"}};for(var k in f.RegisterEffect.packagedEffects)f.RegisterEffect.packagedEffects.hasOwnProperty(k)&&f.RegisterEffect(k,f.RegisterEffect.packagedEffects[k]);f.RunSequence=function(a){var b=g.extend(!0,[],a);b.length>1&&(g.each(b.reverse(),function(a,c){var d=b[a+1];if(d){var e=c.o||c.options,h=d.o||d.options,i=e&&e.sequenceQueue===!1?"begin":"complete",j=h&&h[i],k={};k[i]=function(){var a=d.e||d.elements,b=a.nodeType?[a]:a;j&&j.call(b,b),f(c)},d.o?d.o=g.extend({},h,k):d.options=g.extend({},h,k)}}),b.reverse()),f(b[0])}}(window.jQuery||window.Zepto||window,window,window?window.document:void 0)}),define("toast/animations/Animation",["../core","./_velocity","./_velocity.ui"],function(Toast,Velocity){"use strict";var STATUS_NONE=-1,STATUS_PLAYING=1,STATUS_REVERING=2,STATUS_COMPLETED=3,Animation=Toast.Animation=function(a,b,c){a||(a=[]),c||(c={}),this.id=Toast.UUID4().prefix("ani"),this.view=a,this.$el=this.view.$parent,this.options=c,this.initialize.apply(this,arguments)};return _.extend(Animation.prototype,{initialize:function(view,model,options){var Model=eval("Toast.Animation.Model."+model.name);Model&&(this.model=new Model(view,model),this.model.options.complete=$.proxy(this._complete,this)),this.playCount=0},play:function(){var a=_.extend({},this.model.options);this.isAnimating()&&(a.queue=!1),this.$el.velocity(this.model.properties(),a),this.setAnimating(!0),this.ref(),this.status(this.id,STATUS_PLAYING),this.playCount++;var b=this.data("animations");b||(this.data("animations",[]),b=this.data("animations")),b.push(this)},isAnimating:function(){return this.data("isAnimating-"+this.view.model.id)},setAnimating:function(a){this.data("isAnimating-"+this.view.model.id,a)},stop:function(){this.reset(),this.$el.velocity("stop",!0),this.model.options._reverse&&this.$el.velocity(this.model.reverses(),{duration:0})},count:function(a){return a?this.data("count-"+(a+"-"+this.view.model.id)):this.data("count-"+this.view.model.id)},ref:function(a){var b;b=a?a+"-"+this.view.model.id:this.view.model.id;var c=this.data("count-"+b);return c?c++:c=1,this.data("count-"+b,c),c},unref:function(a){var b;b=a?a+"-"+this.view.model.id:this.view.model.id;var c=this.data("count-"+b);return c?c--:c=1,c=Math.max(0,c),this.data("count-"+b,c),c},status:function(a,b){var c="status";return a&&(c+="-"+a),1===arguments.length?this.data(c):void this.data(c,b)},reset:function(){this.removeData("animations"),this.removeData("count-"+this.view.model.id),this.setAnimating(!1),this.status(this.view.model.id,STATUS_NONE),this.status(this.id,STATUS_NONE),this.playCount=0},data:function(a,b){return 1===arguments.length?this.$el.data(a):void(2===arguments.length&&this.$el.data(a,b))},removeData:function(a){this.$el.removeData(a)},_complete:function(a){var b=this.unref();if(!this.model.options._loop&&this.model.options.count===this.playCount&&this.status(this.id)===STATUS_REVERING)return this.playCount=0,this.status(this.view.model.id,STATUS_NONE),this.status(this.id,STATUS_NONE),void this.options.completeCallback(this.data("animations"));if(this.model.options._reverse||this.model.options._loop||this.model.options.count>1){if(this.status(this.id)===STATUS_REVERING&&(this.model.options._loop||this.model.options.count>1))return void this.play();var c=_.extend({},this.model.options);this.status(this.view.model.id)===STATUS_REVERING?c.queue=!1:this.status(this.view.model.id,STATUS_REVERING),this.status(this.id,STATUS_REVERING),this.$el.velocity(this.model.reverses(),c)}else 0==b&&this.options.completeCallback&&this.options.completeCallback(this.data("animations"))}}),_.extend(Animation,{create:function(a,b,c){return c||(c={}),c.effect?new Toast.Animation.Effect(a,b,c):new Animation(a,b,c)}}),Toast.Velocity=Velocity,Animation.extend=Toast.extend,Toast.Animation=Animation}),define("toast/animations/Sequence",["../core","./Animation"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{}),a.Animation.Sequence=d}),define("toast/animations/Effect",["../core","./Animation"],function(Toast,Animation){"use strict";var __super__=Animation.prototype,Effect=Animation.extend();return _.extend(Effect.prototype,__super__,{initialize:function(view,model,options){var Model=eval("Toast.Animation.Model");Model&&(this.model=new Model(view,model),this.model.options.complete=$.proxy(this._complete,this)),this.name=this.model._.name;var registerEffect=Toast.Velocity.RegisterEffect.packagedEffects[this.name];if(registerEffect){if(!model.properties.inputDuration&&model.properties.namedDurations){var defaultDuration=Toast.Velocity.RegisterEffect.packagedEffects[this.name].defaultDuration,model_=this.model._;switch(model_.properties.namedDurations){case"fast":this.model.options.duration=.7*defaultDuration;break;case"normal":this.model.options.duration=defaultDuration;break;case"slow":this.model.options.duration=defaultDuration+1.5;break;default:this.model.options.duration=defaultDuration}}this.isRegisterEffect=!0}},play:function(){this.isRegisterEffect&&(this.data("org-style")||this.data("org-style",this.$el.attr("style")),this.$el.show(),this.$el.velocity(this.name,this.model.options))},stop:function(){this.isRegisterEffect&&(this.$el.velocity("stop",!0),this.$el.attr("style",this.data("org-style")),"showpage"===this.model._.event.type&&this.$el.hide())},_complete:function(a){var b=this;_.each(a,function(a){var c=$(a);if(b.model.options._loop){b.$el.velocity("stop",!0);var d=Toast.Velocity.RegisterEffect.packagedEffects[b.name].resetEffectName;if(d){var e={duration:0,queue:!1};c.velocity(d,e),b.play()}else b.$el.css("style",b.data("org-style")),b.play()}},this)}}),Toast.Animation.Effect=Effect}),define("toast/animations/Model",["../core","./Animation"],function(a,b){"use strict";var c=500,d=function(a,b){if(this.view=a,this._=b,this.options={},b.properties.easing&&(this.options.easing=b.properties.easing),b.properties.inputDuration)this.options.duration=b.properties.duration;else if(b.properties.namedDurations)switch(b.properties.namedDurations){case"fast":this.options.duration=300;break;case"normal":this.options.duration=c;break;case"slow":this.options.duration=800;break;default:this.options.duration=c}this.options.duration||(this.options.duration=c),b.properties.delay&&(this.options.delay=b.properties.delay),b.properties.reverse&&(this.options._reverse=b.properties.reverse),_.isUndefined(b.properties.count)?this.options.count=1:this.options.count=Number(b.properties.count),b.properties.loop&&(this.options._loop=b.properties.loop),this.initialize.apply(this,arguments)};return _.extend(d.prototype,{initialize:function(a,b,c){},properties:function(){return{}},reverses:function(){return{}}}),d.extend=a.extend,a.Animation.Model=d}),define("toast/animations/Opacity",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){_.isUndefined(a.style.opacity)?this._opacity=1:this._opacity=a.style.opacity},properties:function(){return{opacity:this._.properties.opacity/100}},reverses:function(){return{opacity:this._opacity}}}),a.Animation.Model.Opacity=d}),define("toast/animations/Position",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){this._left=a.$parent.position().left,this._top=a.$parent.position().top},properties:function(){return{left:this._.properties.left,top:this._.properties.top}},reverses:function(){return{left:this._left,top:this._top}}}),a.Animation.Model.Position=d}),define("toast/animations/Size",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){this._width=a.$parent.width(),this._height=a.$parent.height()},properties:function(){return{width:this._.properties.width,height:this._.properties.height}},reverses:function(){return{width:this._width,height:this._height}}}),a.Animation.Model.Size=d}),define("toast/animations/Rotate",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){this._deg=a.$parent.tt_angle().deg},properties:function(){return{rotateZ:this._.properties.angle+"deg"}},reverses:function(){return{rotateZ:this._deg+"deg"}}}),a.Animation.Model.Rotate=d}),define("toast/animations/Zoom",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){this._scale=a.$parent.tt_scale()},properties:function(){return{scale:this._.properties.zoomScale/100}},reverses:function(){return{scale:this._scale}}}),a.Animation.Model.Zoom=d}),define("toast/animations/Text",["../core","./Model"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{initialize:function(a,b,c){}}),a.Animation.Model.Text=d}),define("toast/animations",["exports","./core","./animations/Animation","./animations/Sequence","./animations/Effect","./animations/Opacity","./animations/Position","./animations/Size","./animations/Rotate","./animations/Zoom","./animations/Text"],function(a,b){}),define("toast/utils/LocalStorage",["exports","../core"],function(a,b){"use strict";function c(a,b){1!=f?g.set(a,b):window.localStorage.setItem(a,b)}function d(a){1!=f?g.unset(a,{silent:!0}):window.localStorage.removeItem(a)}function e(a){return 1!=f?g.get(a):window.localStorage.getItem(a)}var f="undefined"!=typeof window.localStorage,g=new Backbone.Model({});a.setItem=c,a.removeItem=d,a.getItem=e,b.LocalStorage=a}),define("toast/utils/PathUtils",["../core"],function(a){"use strict";function b(){function a(a){return function(b){return c.parseUrl(b)[a]}}var b,d,e=c.parsedUrlPropNames,f=e.length;for(b=0;f>b;b++)d=e[b],c[d]||(c[d]=a(d))}var c=a.PathUtils={urlParseRE:/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#\.]*(?:\.[^\?#\.]+)*(\.[^\?#\.]+)|[^\?#]*)))?(\?[^#]+)?)(#.*)?/,parsedUrlPropNames:["href","hrefNoHash","hrefNoSearch","domain","protocol","doubleSlash","authority","userinfo","username","password","host","hostname","port","pathname","directory","filename","filenameExtension","search","hash"],defaultPorts:{http:"80",https:"443",ftp:"20",ftps:"990"},parseUrl:function(a){if(a&&"object"==typeof a)return a;var b,d=c.urlParseRE.exec(a||"")||[],e=c.parsedUrlPropNames,f=e.length,g={};for(b=0;f>b;b++)g[e[b]]=d[b]||"";return g},port:function(a){var b=c.parseUrl(a);return b.port||c.defaultPorts[b.protocol]},isSameDomain:function(a,b){return c.parseUrl(a).domain===c.parseUrl(b).domain},isRelativeUrl:function(a){return""===c.parseUrl(a).protocol},isAbsoluteUrl:function(a){return""!==c.parseUrl(a).protocol},makePathAbsolute:function(a,b){if(a&&"/"===a.charAt(0))return a;a=a||"",b=b?b.replace(/^\/|(\/[^\/]*|[^\/]+)$/g,""):"";for(var c=b?b.split("/"):[],d=a.split("/"),e=0;e<d.length;e++){var f=d[e];switch(f){case".":break;case"..":c.length&&c.pop();break;default:c.push(f)}}return"/"+c.join("/")},makePathRelative:function(a,b){b=b?b.replace(/^\/|\/?[^\/]*$/g,""):"",a=a?a.replace(/^\//,""):"";for(var c=b?b.split("/"):[],d=a.split("/"),e=[],f=c.length,g=!1,h=0;f>h;h++)g=g||d[0]!==c[h],g?e.push(".."):d.shift();return e.concat(d).join("/")},makeUrlAbsolute:function(a,b){if(!c.isRelativeUrl(a))return a;var d=c.parseUrl(a),e=c.parseUrl(b),f=d.protocol||e.protocol,g=d.protocol?d.doubleSlash:d.doubleSlash||e.doubleSlash,h=d.authority||e.authority,i=""!==d.pathname,j=c.makePathAbsolute(d.pathname||e.filename,e.pathname),k=d.search||!i&&e.search||"",l=d.hash;return f+g+h+j+k+l}};return b(),c}),define("toast/utils/Loader",["require","exports","module","../core","./PathUtils"],function(a,b,c,d,e){"use strict";function f(a){return $("<style>").text(a).appendTo("head")[0]}function g(a,b,c){var d={type:"text/css",rel:"stylesheet",href:a},e=$("<link/>").attr(d);return c&&e.attr(c),b&&b.resolve(),e.appendTo("head"),e[0]}function h(a,b){var c={type:"text/javascript",src:a},d=$("head").find('script[src="'+c.src+'"]');return _.isUndefined(d[0])?(d=$("<script/>").attr(c),b&&d.on("load",b.resolve).on("error",b.reject),d.appendTo("head"),d[0]):(b&&b.resolve(),d[0])}function i(a,b){var c=a.uri.substr(0,a.uri.lastIndexOf("/")+1);return b&&(c+=b),c}function j(a,b){var c=encodeURI(i(a,b));return"win"===d.platform&&-1!==c.indexOf(":")&&(c="file:///"+c),c}function k(a,b){var c=e.isAbsoluteUrl(b)?b:j(a,b),d=$.get(c);return d}function l(a,b){var c=new $.Deferred;return k(a,b).done(function(a){var b=this.url,d=new $.Deferred,e=g(b,d);d.done(function(){c.resolve(e)}).fail(c.reject)}).fail(c.reject),c.fail(function(a,b,c){void 0!==a.readyState}),c.promise()}function m(a,b){var c=new $.Deferred;return k(a,b).done(function(a){var b=this.url,d=new $.Deferred,e=h(b,d);d.done(function(){c.resolve(e)}).fail(c.reject)}).fail(c.reject),c.fail(function(a,b,c){void 0!==a.readyState}),c.promise()}function n(a){return o(a+"/package.json")}function o(b){var c=new $.Deferred;return a(["text!"+b],function(a){try{var b=JSON.parse(a);c.resolve(b)}catch(d){c.reject()}}),c.promise()}b.addEmbeddedStyleSheet=f,b.addLinkedStyleSheet=g,b.getModulePath=i,b.getModuleUrl=j,b.loadFile=k,b.loadStyleSheet=l,b.loadScript=m,b.loadJson=o,b.loadPackageJson=n,b.addJavascript=h,d.Loader=b}),define("toast/utils/ThemeLoader",["exports","../core"],function(a,b){"use strict";function c(a,b){var c=new $.Deferred,d=new $.Deferred;return TT.Loader.addLinkedStyleSheet(a,d,b),d.done(c.resolve).fail(c.reject),c.promise()}function d(a){var b=new $.Deferred,c={Startmenu:"../html-templates/startmenu-template.html",PopupModal:"../html-templates/popup-modal-template.html",MyLibrary:"../html-templates/mylibrary-template.html",Searchbar:"../html-templates/searchbar-template.html",Searchlist:"../html-templates/searchlist-template.html",TOC:"../html-templates/toc-template.html",Thumbnail:"../html-templates/thumbnail-template.html",PrintModal:"../html-templates/print-dialog-template.html",Zoombar:"../html-templates/zoombar-template.html",ShareEbook:"../html-templates/share-ebook-template.html",Help:"../html-templates/help-template.html",MobileHelp:"../html-templates/mobile-help-template.html",ImageViewer:"../html-templates/image-viewer-template.html"};return a(["text!theme.json"],function(d){_.isEmpty(d)||_.isUndefined(d)?e(a,c,b):(d=JSON.parse(d),_.isUndefined(d.templates)||(d.templates=_.extend(c,d.templates)),e(a,d,b))},function(){var d={templates:c};e(a,d,b)}),b.promise()}function e(a,b,c){var d=[];_.each(Object.keys(b.templates),function(a){d.push("text!"+b.templates[a])}),a(d,function(){var a=0,d=arguments;_.each(Object.keys(b.templates),function(b){k[b]=d[a],a++}),c&&c.resolve(b)})}function f(){return k}function g(a,e,f,g){var g=new $.Deferred;i&&j&&(i(j).unload(),b.send(b.Events.THEME_DID_UNLOAD,i(j)),i.undef(j),j=null);var h=$("head > #theme");return _.isUndefined(h[0])||h.remove(),h=$("head > #mobile-theme"),_.isUndefined(h[0])||h.remove(),c(e+f+".css",{id:"theme"}).always(function(){var h={context:a,baseUrl:e,paths:o,locale:b.getLocale()},k=window.require.config(h);i=k,k([f],function(){j=f,d(k).done(function(a){i(j).theme=a,b.isMobileDevice&&_.isFunction(i(j).hasMobileStyleSheet)&&i(j).hasMobileStyleSheet()?c(e+f+".mobile.css",{id:"mobile-theme"}).always(function(){i(j).load(e),b.send(b.Events.THEME_DID_LOAD,i(j)),g.resolve()}):(i(j).load(e),b.send(b.Events.THEME_DID_LOAD,i(j)),g.resolve())})},g.resolve)}),g.promise()}function h(){return i(j)}var i,j,k={},l=decodeURI(window.location.pathname),m=l.substr(0,l.lastIndexOf("/")),n=unescape(m);-1!==n.indexOf(":")&&"/"===n[0]&&(n=n.substr(1));var o={text:n+"/framework/text",i18n:n+"/framework/i18n"};a.load=g,a.getHTMLTemplates=f,a.getCurrentTheme=h,b.ThemeLoader=a}),define("toast/utils/UrlParams",["../core","./StringUtils"],function(a){"use strict";var b=a.UrlParams=function(){this._store={}};return _.extend(b.prototype,{parse:function(a){var b,c,d="",e=this;e._store={},a?-1!==a.indexOf("?")&&(d=a.substring(a.indexOf("?")+1)):d=window.document.location.search.substring(1),d=d.trim(),d&&(b=d.split("&"),b.forEach(function(a){c=a.split("="),c[1]=c[1]||"",e._store[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}))},put:function(a,b){this._store[a]=b},get:function(a){return this._store[a]},remove:function(a){delete this._store[a]},isEmpty:function(a){return _.isEmpty(this._store)},toString:function(){var a=[],b=this;return _.forEach(b._store,function(b,c){a.push(encodeURIComponent(c)+"="+encodeURIComponent(b))}),a.join("&")}}),b}),define("toast/utils/ImageUtils",["../core"],function(a){"use strict";var b=a.ImageUtils={getImageSize:function(a){var b=new $.Deferred,c=new Image;return c.onload=function(){b.resolve(this.width,this.height)},c.onerror=function(a){b.reject("Cannot load the image!")},c.src=a,b.promise()},resizeImage:function(a,b){var c=new $.Deferred,d=new Image;return d.onload=function(){var a=document.createElement("canvas");a.webkitImageSmoothingEnabled=!0;var e=a.getContext("2d"),f=Math.max(d.width/b,d.height/b),g={};g.width=Math.round(d.width/f),g.height=Math.round(d.height/f),a.width=g.width,a.height=g.height,e.drawImage(d,0,0,d.width,d.height,0,0,g.width,g.height),c.resolve(a.toDataURL(),g.width,g.height)},d.onerror=function(){c.reject("Cannot load the image!")},d.src=a,c.promise()}};return b}),define("toast/utils/Rect",["../core"],function(a){"use strict";var b=a.Rect={};return _.extend(b,{union:function(a,b){var c,d,e,f;return c=a.left<b.left?a.left:b.left,e=a.left+a.width>b.left+b.width?a.left+a.width:b.left+b.width,d=a.top<b.top?a.top:b.top,f=a.top+a.height>b.top+b.height?a.top+a.height:b.top+b.height,{left:c,top:d,width:e-c,height:f-d}}}),b}),define("toast/utils/Async",["../core"],function(a){"use strict";var b=a.Async={ERROR_TIMEOUT:{}};return _.extend(b,{doInParallel:function(a,b,c){var d=[],e=new $.Deferred;if(0===a.length)e.resolve();else{var f=0,g=!1;a.forEach(function(h,i){var j=b(h,i);d.push(j),j.fail(function(){c?e.reject():g=!0}),j.always(function(){f++,f===a.length&&(g?e.reject():e.resolve())})})}return e.promise()},doSequentially:function(a,b,c){function d(g){if(g>=a.length)return void(f?e.reject():e.resolve());var h=b(a[g],g);h.done(function(){d(g+1)}),h.fail(function(){c?e.reject():(f=!0,d(g+1))})}var e=new $.Deferred,f=!1;return d(0),e.promise()},doSequentiallyInBackground:function(a,b,c,d){c=c||15,d=d||30;var e=(new Date).getTime();return doSequentially(a,function(a,f){var g=new $.Deferred;return b(a,f),(new Date).getTime()-e>=c?window.setTimeout(function(){e=(new Date).getTime(),g.resolve()},d):g.resolve(),g},!1)},firstSequentially:function(a,b){function c(e){return e>=a.length?void d.reject():void b(a[e],e).fail(function(){c(e+1)}).done(function(){d.resolve(a[e])})}var d=new $.Deferred;return c(0),d.promise()},withTimeout:function(a,c,d){var e,f=new $.Deferred;return c>0&&(e=window.setTimeout(function(){d?f.resolve():f.reject(b.ERROR_TIMEOUT)},c)),a.always(function(){e&&window.clearTimeout(e)}),a.then(f.resolve,f.reject),f.promise()},waitForAll:function(a,b,c){var d=new $.Deferred,e=[],f=0,g=!1;return a&&0!==a.length?(b=void 0===b?!1:!0,void 0!==c&&withTimeout(d,c),a.forEach(function(c){c.fail(function(a){g=!0}).done(function(a){e.push(a)}).always(function(){f++,f===a.length&&(b&&g?d.reject():d.resolve(e))})}),d.promise()):(d.resolve(),d.promise())},ready:function(a,b,c){return this.waitForAll(a,b,c)},chain:function(a,b){function c(b,e){if(a.length===b)d.resolveWith(null,e);else{var f=a[b++];try{var g=f.apply(null,e);g.hasOwnProperty("done")&&g.hasOwnProperty("fail")?(g.done(function(){c(b,arguments)}),g.fail(function(){d.rejectWith(null,arguments)})):c(b,[g])}catch(h){d.reject(h)}}}var d=$.Deferred();return c(0,b||[]),d.promise()},promisify:function(a,b){var c=new $.Deferred,d=Array.prototype.slice.call(arguments,2);return d.push(function(a){a?c.reject(a):c.resolve.apply(c,Array.prototype.slice.call(arguments,1))}),a[b].apply(a,d),c.promise()}}),b}),define("toast/utils/Animate",["../core","./Async"],function(a,b){"use strict";a.animateUsingClass=function(a,c,d){function e(b){b.target===a&&g.resolve()}function f(){h.removeClass(c).off("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",e)}var g=new $.Deferred,h=$(a);return d=d||400,h.is(":hidden")?g.resolve():h.addClass(c).on("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",e),b.withTimeout(g.promise(),d,!0).done(f)},jQuery.fn.extend({animateUsingClass:function(b,c){return a.animateUsingClass(this[0],b,c)}})}),define("toast/utils/jquery.toast.utils",["../core"],function(a){"use strict";var b="",c=["Moz","Webkit","Khtml","O","ms"],d=c.length;for(b="";d--;)c[d]+"Transform"in document.body.style&&(b="-"+c[d].toLowerCase()+"-");jQuery.fn.extend({tt_enable:function(){return this.removeAttr("disabled")},tt_disable:function(){return this.attr("disabled","disabled")},tt_isDisabled:function(){return"disabled"===this.attr("disabled")},tt_select:function(){return this.each(function(){var a,b,c=$(this).get(0);document.body.createTextRange?(a=document.body.createTextRange(),a.moveToElementText(c),a.select()):window.getSelection&&(b=window.getSelection(),a=document.createRange(),a.selectNodeContents(c),b.removeAllRanges(),b.addRange(a))})},tt_deselect:function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},tt_moveCaretToEnd:function(){var a=$(this).get(0);if("undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var b=document.createRange();b.selectNodeContents(a),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else if("undefined"!=typeof document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(a),d.collapse(!1),d.select()}},tt_getCaretPosition:function(){var a=$(this).get(0);if(a)return document.selection&&a.focus(),"selectionStart"in a?a.selectionStart:Math.abs(document.selection.createRange().moveStart("character",-a.value.length))},tt_rotate:function(a){return this.tt_transform("rotate("+a+"rad)")},tt_scale:function(a){if(0==arguments.length){var b=this.css("-webkit-transform")||this.css("-moz-transform")||this.css("-ms-transform")||this.css("-o-transform")||"";return(b=b.match("matrix\\((.*)\\)"))?(b=b[1].split(","),parseFloat(b[0])):1}return this.tt_transform("scale("+a+")")},tt_transform:function(a,c){var d={};return c&&(d[b+"transform-origin"]=c),d[b+"transform"]=a,d.transform=a,this.css(d)},tt_removeAttrsWithPrefix:function(a){return this.each(function(){var b=$.map(this.attributes,function(a){return a.name}),c=$(this);$.each(b,function(b,d){a===d.substr(0,a.length)&&c.removeAttr(d)})})},tt_highlight:function(a){function b(a,c){
var d=0;if(3==a.nodeType){var e=a.data.toUpperCase().indexOf(c);if(e-=a.data.substr(0,e).toUpperCase().length-a.data.substr(0,e).length,e>=0){var f=document.createElement("span");f.className="highlight";var g=a.splitText(e),h=(g.splitText(c.length),g.cloneNode(!0));f.appendChild(h),g.parentNode.replaceChild(f,g),d=1}}else if(1==a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(var i=0;i<a.childNodes.length;++i)i+=b(a.childNodes[i],c);return d}return this.length&&a&&a.length?this.each(function(){b(this,a.toUpperCase())}):this},tt_removeHighlight:function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName,this.parentNode.replaceChild(this.firstChild,this),this.parentNode.normalize()}).end()},tt_angle:function(){var a=this.css("-webkit-transform")||this.css("-moz-transform")||this.css("-ms-transform")||this.css("-o-transform")||"",b={rad:0,deg:0};return(a=a.match("matrix\\((.*)\\)"))&&(a=a[1].split(","),"undefined"!=typeof a[0]&&"undefined"!=typeof a[1]&&(b.rad=Math.atan2(a[1],a[0]),b.deg=parseInt(180*b.rad/Math.PI))),b},tt_changeTag:function(a){var b=$("<"+a+">"),c={};$.each(this.get(0).attributes,function(a,b){c[b.name]=b.value}),b.attr(c),b.data(this.data());var d=this.children().clone(!0);return b.append(d),this.replaceWith(b),b}}),jQuery.fn.doubletap=jQuery.fn.doubletap||function(a,b){b=null==b?300:b,this.bind("touchend",function(c){var d=(new Date).getTime(),e=$(this).data("lastTouch")||d+1,f=d-e;b>f&&f>0?($(this).data("lastTouch",null),null!==a&&"function"==typeof a&&a(c)):$(this).data("lastTouch",d)})},jQuery.tt_getScrollbarWidth=function(){var a=document.createElement("div");a.style.visibility="hidden",a.style.width="100px",a.style.msOverflowStyle="scrollbar",document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var c=document.createElement("div");c.style.width="100%",a.appendChild(c);var d=c.offsetWidth;return a.parentNode.removeChild(a),b-d}}),define("toast/utils/BackboneUtils",["../core"],function(a){"use strict";function b(a,b){Object.defineProperty(a,b,{get:function(){return a.get(b)},set:function(c){return a.set(b,c),a}})}function c(a,b){Object.defineProperty(a,b,{get:function(){return a.attributes[b]},set:function(c){a.attributes[b]=c}})}_.extend(Backbone.Model.prototype,{defineProperty:function(a){b(this,a)}}),_.extend(Backbone.Collection.prototype,{defineProperty:function(a){(_.isNull(this[a])||_.isUndefined(this[a]))&&c(this,a)}})}),define("toast/utils/DropdownMenAutoScroller",["exports","../core"],function(a,b){"use strict";function c(a){var b=$(a.target).hasClass("dropup"),c=$(a.target).find(".dropdown-toggle"),d=$(a.target).find(".dropdown-menu");if(d.hasClass("auto-scrollbar")){var e,f={left:0,top:c.offset().top};d[0];e=b?f.top:$(window).outerHeight()-(f.top+c.outerHeight()),d.height()>e?(d.addClass("auto-scrollbar-on"),d.css({width:d.outerWidth()+g+"px",height:e+"px"})):(d.removeClass("auto-scrollbar-on"),d.css({width:"",height:""}))}}function d(a){var b=$(a.target).find(".dropdown-menu");b.hasClass("auto-scrollbar")&&b.css({width:"",height:""})}function e(){g=$.tt_getScrollbarWidth(),$(document.body).on("show.bs.dropdown",c),$(document.body).on("hide.bs.dropdown",d)}function f(){$(document.body).off("show.bs.dropdown",c),$(document.body).off("hide.bs.dropdown",d)}var g;a.on=e,a.off=f,b.DropdownMenAutoScroller=a}),define("toast/utils",["./core","./utils/LocalStorage","./utils/Loader","./utils/ThemeLoader","./utils/StringUtils","./utils/UrlParams","./utils/ImageUtils","./utils/Rect","./utils/Async","./utils/Animate","./utils/jquery.toast.utils","./utils/BackboneUtils","./utils/DropdownMenAutoScroller","./utils/PopupSubpage"],function(a){}),define("toast/views/UIView",["../core","../core/Model","../actions","../animations","../utils"],function(a,b,c,d){"use strict";var e=["viewController","$parent","style","label"],f=Backbone.View.prototype,g=function(a){this.defineProperties=this.properties(),this.__events__=[],_.extend(this,_.pick(a,e)),f.constructor.apply(this,arguments)};return _.extend(g.prototype,f,{label:"View",viewController:null,tagName:"div",className:"",attributes:{},style:{},model:b,$el:null,$parent:null,useAction:!1,useAnimation:!1,minsize:{width:10,height:10},__events__:[],__eventTypes__:"ontouchstart"in window?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},properties:function(){return[{name:"DefaultProperty",label:" ",properties:[{label:"",name:"label",value:"",_default:!0,control:{type:"text",width:130,placeholder:" "}},{label:"/",name:"visible",value:!0,control:{type:"select",valueList:[{label:"",value:!0},{label:"",value:!1}]}},{label:"<small>(px)</small>",group:[{label:"",name:"left",_default:!0,control:{type:"spinedit",width:55,step:1,max:5e3,min:-5e3,numberOfDecimals:0}},{label:"",name:"top",_default:!0,control:{type:"spinedit",width:55,step:1,max:1e4,min:-1e4,numberOfDecimals:0}}]},{label:"<small>(px)</small>",group:[{label:"",name:"width",_default:!0,control:{type:"spinedit",width:55,step:1,max:1e4,min:1,numberOfDecimals:0}},{label:"",name:"height",_default:!0,control:{type:"spinedit",width:55,step:1,max:1e4,min:1,numberOfDecimals:0}}]},{label:"",name:"opacity",value:100,_default:!0,control:{type:"spinedit",step:1,max:100,min:0,numberOfDecimals:0,unit:"%"}},{label:"",name:"draggable",value:!1,control:{type:"checkbox",label:""}}]}]},propertyDefaultValues:function(){return[]},initialize:function(a){_.extend(this,_.pick(a,e)),this.model.view=this,this.$el.attr("data-view-type",this.model.get("viewType")),this.style=_.extend({},this.style,this.model.get("style")),this.$el.css(this.style),this.$el.appendTo(this.$parent)},mergeProperties:function(a,b){if(TT.isNative||TT.__dev__){var c=a.properties(),d=b.properties(),e=c;_.each(d,function(a){if(!a)return!0;var b=_.find(c,{name:a.name});b?b.properties=_.union(b.properties,a.properties):e.push(a)});var f=b.propertyDefaultValues();_.each(f,function(a){_.each(c,function(b){var c;c=b.group?b.group.properties:b.properties;var d=_.find(c,{name:a.name});d&&(d.value=a.value,a.hidden&&(d.hidden=a.hidden))})}),this.defineProperties=e}},_resetStyle:function(){this.style=_.extend({},this.style,this.model.get("style")),this.$el.attr("style",""),this.$parent.css({left:this.model.get("left"),top:this.model.get("top"),width:this.model.get("width"),height:this.model.get("height")}),this.$el.css(this.style)},present:function(){return this._setBorder(),this},update:function(a,b){return this._resetStyle(),this._setBorder(),this},_setBorder:function(a){if(0!==arguments.length)return void(a?this.$parent.addClass("border"):this.$parent.removeClass("border"));var a,b=parseFloat(this.$el.css("opacity"));if(.1>b&&(a=!0),!a){var c=this.$el.css("backgroundColor");if(c&&-1!==c.indexOf("a")){var d=Number(c.replace(/^.*,(.+)\)/,"$1"));.1>d&&(a=!0)}a&&this._hasVisibility()&&(a=!1)}a?this.$parent.addClass("border"):this.$parent.removeClass("border")},_hasVisibility:function(){return!1},render:function(){return _.isUndefined(this.model.properties.visible)&&(this.model.properties.visible=!0),this.model.properties.visible!==!0&&this.$parent.hide(),this._setStyleToParent(),this},_setStyleToParent:function(){var a=this.$el.css("opacity");a&&(this.$parent.css("opacity",a),this.$el.css("opacity",""))},reset:function(){this._stopAnimations(),this.style=_.extend({},this.style,this.model.get("style")),this.$el.css(this.style),this.model.properties.visible!==!0&&this.$parent.hide(),this._setStyleToParent()},__on__:function(b,c,d){d||(d=this),c=$.proxy(c,d),this.__events__.push({name:b,callback:c}),a.on(b,c,d)},__off__:function(b,c){0===arguments.length?(_.each(this.__events__,function(b){a.off(b.name,b.callback)},this),this.__events__=[]):a.off(b,c)},remove:function(){this.__off__(),this.model.__changeState__&&delete this.model.__changeState__,f.remove.call(this)},states:function(){return[]},state:function(a){return 0===arguments.length?this._currentState:(this._currentState=a,this.model.__changeState__&&this._conditionalChangeStates(this.model.__changeState__.action)&&this._executeActions(this.model.__changeState__.action.instances),this.model.__changeState__&&this._conditionalChangeStates(this.model.__changeState__.animation)&&this._executeAnimations(this.model.__changeState__.animation.instances),void 0)},_conditionalChangeStates:function(a){if(!a)return!1;var b,c=!0,d=a.states,e=a.models,f=a.condition;return"if"===f?b=!0:"else"===f&&(b=!1),_.each(d,function(a){if(!c)return!1;var f=[];_.each(d,function(b){b.target===a.target&&f.push(b)},this);var g=_.find(e,{id:a.target});if(!g)return c=!1,!1;if(b){var h;if(_.each(f,function(a){return g.view._currentState===a.value?(h=!0,!1):void 0}),h!==!0)return c=!1,!1}else{var h;if(_.each(f,function(a){return g.view._currentState!==a.value?(h=!0,!1):void 0}),h)return c=!1,!1}}),c},viewsDidMount:function(){this.actions={},this.useAction&&!_.isEmpty(this.model.actions)&&(this.$el.css("cursor","pointer"),_.each(this.model.actions,function(a){a.event||(a.event={type:"click"});var b=this.actions[a.event.type];b||(b=this.actions[a.event.type]=[]);var a=TT.Action.create(this,a);a&&b.push(a)},this)),this.animations={},this.useAnimation&&!_.isEmpty(this.model.animations)&&(this.$el.css("cursor","pointer"),_.each(this.model.animations,function(a){a.event||(a.event={type:"click"});var b=this.animations[a.event.type];b||(b=this.animations[a.event.type]=[]);var c=[];_.isEmpty(a.properties.targets)?c.push(this.model):_.each(a.properties.targets,function(a){var a=this.viewController.find("id",a);a&&c.push(a)},this),_.each(c,function(c){var d=TT.Animation.create(c.view,a,{effect:a.effect,completeCallback:$.proxy(this.onAnimationComplete,this)});d&&b.push(d)},this)},this)),this.__refreshTimeout__||(this.__refreshTimeout__={}),this.model.properties.draggable&&(this.$el.css("cursor","pointer"),this.$parent.off("draginit drag dragstart dragend"),this.$parent.drag("start",$.proxy(this._onDragStart,this),{distance:1,drop:!0}),this.$parent.drag("drag",$.proxy(this._onDrag,this)),this.$parent.drag("end",$.proxy(this._onDragEnd,this))),(this.actions.showpage||this.animations.showpage)&&(this._stopAnimations(null,this.animations.showpage),this._onShowPage()),this.__on__(a.Events.PAGE_DID_CHANGE,this._onShowPage),(this.actions.click||this.animations.click)&&this.$parent.on("click",$.proxy(this._onClick,this)),(this.actions.mouseover||this.animations.mouseover)&&this.$parent.on("mouseover",$.proxy(this._onMouseOver,this)),(this.actions.mouseout||this.animations.mouseout)&&this.$parent.on("mouseout",$.proxy(this._onMouseOut,this)),(this.actions.drop||this.animations.drop)&&this.$parent.drop($.proxy(this._onDrop,this))},execute:function(a,b){this._executeActions(this.actions[a]),this._executeAnimations(this.animations[a],b)},_executeActions:function(a){return _.isEmpty(a)?!1:(_.isArray(a)||(a=[a]),_.each(a,function(a){a.execute()},this),!0)},_executeAnimations:function(a,b){return _.isEmpty(a)?!1:(b||(b={stopAndPlay:!0}),_.isArray(a)||(a=[a]),b.stopAndPlay?(_.each(a,function(a){a.stop()}),void this._executeAnimations(a,{play:!0})):(_.each(a,function(a){b.play?a.play():b.stop&&a.stop()},this),!0))},_stopAnimations:function(a,b){b&&this._executeAnimations(b,{stop:!0}),a?this._executeAnimations(this.animations[a],{stop:!0}):_.each(Object.keys(this.animations),function(a){this._executeAnimations(this.animations[a],{stop:!0})},this)},_onShowPage:function(b,c){a.lazyOnce(function(){a.Book.availableCurrentPage(this.viewController.index+1)?this.execute("showpage",{stopAndPlay:!0}):this._stopAnimations()},50,this.__refreshTimeout__,this)},_onClick:function(a){return this.__isDragging__?void(this.__isDragging__=!1):void this.execute("click")},_onMouseOver:function(b){this.execute("mouseover"),this.$parent.off("mouseover",$.proxy(this.onMouseOver,this)),a.lazyOnce(function(){this.$parent.on("mouseover",$.proxy(this.onMouseOver,this))},200,this.__refreshTimeout__,this)},_onMouseOut:function(a){this.execute("mouseout")},_onDragStart:function(a,b){a.stopPropagation(),this.__isDragging__=!0,b.dropActions&&delete b.dropActions,b.dropAnimations&&delete b.dropAnimations,b.dropAccepts&&delete b.dropAccepts,b.dropRejects&&delete b.dropRejects;var c=$(b.drag);b.zIndex=c.css("zIndex"),b.startOffset={left:parseInt(c.css("left"),10),top:parseInt(c.css("top"),10)},b.contentScale=this.viewController.contentScale,c.css("zIndex",9999),b.drag.view=this,this.execute("dragStart"),TT.$el.addClass("dragging")},_onDrag:function(a,b){var c=$(b.drag),d={};d.left=b.startOffset.left+b.deltaX/b.contentScale,d.top=b.startOffset.top+b.deltaY/b.contentScale,c.css(d)},_onDragEnd:function(b,c){var d=$(c.drag);d.css("zIndex",c.zIndex),this.execute("dragEnd"),_.isEmpty(c.drop)&&this.execute("dropReject"),c.dropAccepts&&(_.each(c.dropAccepts,function(a){this.onDropAccept(a)},this),delete c.dropAccepts),c.dropRejects&&(_.each(c.dropRejects,function(a){this.onDropReject(a)},this),delete c.dropRejects),c.dropActions&&(this._executeActions(c.dropActions),delete c.dropActions),c.dropAnimations&&(this._executeAnimations(c.dropAnimations),delete c.dropAnimations),TT.$el.removeClass("dragging"),a.lazy(function(){this.__isDragging__=!1},5,this)},_onDrop:function(a,b){var c=b.drag.view,d=$(b.drag),e=d.attr("id"),f=!1,g=c.viewController.find("id",this.$parent.attr("id"));if(!g)return!1;var h=g.view,i=[],j=[],k=[],l=[];return _.each(h.actions.drop,function(a){var b=_.find(a.properties.dropTargets,function(a){return a==e?!0:void 0});if(b){var c=h.viewController.find("id",b,!0);c&&(_.isUndefined(a.properties.dropResult)?k.push(a):a.properties.dropResult?i.push(c.view):j.push(c.view))}}),_.each(h.animations.drop,function(a){var b=_.find(a.model._.properties.dropTargets,function(a){return a==e?!0:void 0});if(b){var c=h.viewController.find("id",b);c&&(l.drop=c.view,l.push(a))}}),_.isEmpty(i)||(b.dropAccepts=i),_.isEmpty(j)||(b.dropRejects=j),_.isEmpty(k)&&_.isEmpty(l)||(_.isEmpty(k)||(b.dropActions=k),_.isEmpty(l)||(b.dropAnimations=l),f=!0),f},onDropAccept:function(a){a?a.execute("dropAccept"):this.execute("dropAccept")},onDropReject:function(a){a?a.execute("dropReject"):this.execute("dropReject")},onShow:function(){this.execute("show")},onHide:function(){this.execute("hide")},onAnimationComplete:function(a){!_.isEmpty(a)&&a[0].drop&&a[0].drop!==this&&a[0].drop.onAnimationComplete(a)}}),g.extend=Backbone.View.extend,a.UIView=g}),define("toast/views/UIGroup",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Group",style:{},useAction:!0,useAnimation:!0,initialize:function(a){c.initialize.call(this,a),this.initializeChildren()},initializeChildren:function(){var b;b=__app__.activeEditor?!1:!0;var c=this.model.__children__;_.each(c,function(c){this.$el.append(this.viewController.__createElement(c)),0!=c.rotate&&this.$el.find("#"+c.id).tt_rotate(c.rotate),c.view=a.Factory.create(this.viewController,c,this.$el.find("#"+c.id),b)},this)},_hasVisibility:function(){return!_.isEmpty(this.model.__children__)}}),a.UIGroup=d}),define("toast/events/KeyEvent",{DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_SEMICOLON:186,DOM_VK_EQUALS:187,DOM_VK_COMMA:188,DOM_VK_DASH:189,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}),define("toast/views/UIText",["../core","../events/KeyEvent","./UIView"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{label:"Text",attributes:{"data-text-content":!0},style:{fontSize:"18px",fontFamily:"Nanum Gothic",whiteSpace:"pre-wrap",wordBreak:"break-all"},textEditable:!0,useAction:!0,useAnimation:!0,initialize:function(a){this.style=_.extend({},d.style,this.style),d.initialize.call(this,a),this.isEmpty()||_.isEmpty(this.getText())||(this.hasTag(this.getText())?this.$el.html(this.getText()):this.$el.html("<div>"+this.getText()+"</div>"))},present:function(){d.present.call(this);var a=$('<div id="dummy" />');return a.css({position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"}),a.appendTo(this.$parent),a.on("dblclick",$.proxy(this.startEditing,this)),this._setFontAttrs(),this},render:function(){return d.render.call(this),this._setFontAttrs(),this},update:function(){d.update.call(this),this.modelHeight=this.model.get("height"),this._autoFit({delay:!1});var a=parseInt(this.$el.css("height"),10);return this.model.set("height",a),this._setFontAttrs(),this},_hasVisibility:function(){var a=this.$el.css("color");if(a&&-1!==a.indexOf("a")){var b=Number(a.replace(/^.*,(.+)\)/,"$1"));if(.1>b)return!1}return!this.isEmpty()},isEmpty:function(){return void 0===this.getText()?!0:0===this.getText().replace(/(<([^>]+)>)/gi,"").replace("&nbsp;","").length},_setFontAttrs:function(){this.style.fontFamily||(this.style.fontFamily=""),this.style.fontWeight||(this.style.fontWeight=""),this.$el.attr("data-font-name",this.style.fontFamily),this.$el.attr("data-font-weight",this.style.fontWeight)},getText:function(){return this.model.get("htmlText")},setText:function(a){this.model.set("htmlText",a)},_canTextEditing:function(){return this.viewController.$el.hasClass("editor")?this.viewController.isTextEditing()||this.model.get("locked")?!1:this.model.topParent().hasChildren()&&!this.viewController.groupEditor.isEditing(this.model.topParent())?!1:!0:!1},startEditing:function(b){if(!this._canTextEditing())return void(b&&b.preventDefault());this.viewController.deselectAll(),this.viewController.deselect(this.model),this.viewController.currentEditingTextView=this;var c=$('<div class="text-editing-modal" />').css({position:"fixed",width:"100%",height:"100%",left:0,top:0,zoom:this.viewController.viewScale(),zIndex:9990}).appendTo($(document.body));c.on("mousedown",$.proxy(this.handleModalClick,this));var d=this.model.topParent().view.$parent;c.attr("data-element-index",d.index()),0!=this.model.topParent().rotate&&d.tt_rotate(0),d.css({left:d.offset().left/this.viewController.viewScale(),top:d.offset().top/this.viewController.viewScale()}).appendTo(c),0!=this.model.topParent().rotate&&d.tt_rotate(this.model.topParent().rotate),this.viewController.groupEditor.isEditing()&&_.each(this.model.topParent().__children__,function(a){a.view.$parent.off("draginit drag dragstart dragend click dblclick")},this),this.model.draggable=!1,this._setBorder(!1),this.$parent.children("#dummy").hide(),this.$el.attr("contenteditable",!0),this.$el.attr("spellcheck",!1),this.$el.addClass("show"),this.modelHeight=this.model.get("height"),this._autoFit();for(var e=0,f=$.popline.instances.length;f>e;e++)$.popline.instances[e].destroy(),delete $.popline.instances[e];$.popline.instances=[],a.lazy(function(){this.$el.popline({position:"fixed",zIndex:9991,update:function(){this._isModified_=!0,this._autoFit(),this._setFontAttrs()}.bind(this)})},100,this),this.$el.on("keydown",$.proxy(this.handleKeyDown,this));var g=this.$el.text();return 0==g.length?this.$el.tt_moveCaretToEnd():this.$el.tt_select(),!0},endEditing:function(){for(var a=0,b=$.popline.instances.length;b>a;a++)$.popline.instances[a].destroy(),delete $.popline.instances[a];$.popline.current&&($.popline.current.destroy(),delete $.popline.current),$.popline.instances=[];var c=$(".text-editing-modal"),d=this.model.topParent().view.$parent;0!=this.model.topParent().rotate&&d.tt_rotate(0),d.css({left:this.model.topParent().left,top:this.model.topParent().top});var e=this.viewController.$el.children().eq(c.attr("data-element-index"));if(0===e.length?this.viewController.$el.append(d):e.before(d),0!=this.model.topParent().rotate&&d.tt_rotate(this.model.topParent().rotate),this.hasTag(this.$el.html())||this.$el.html($("<div>"+this.$el.text()+"</div>")),this.$parent.children("#dummy").show(),c.remove(),this.$el.removeAttr("contenteditable"),this.$el.removeAttr("spellcheck"),this.$el.removeClass("show"),this.$el.off("keydown",$.proxy(this.handleKeyDown,this)),this._isModified_){var f=this.model.topParent(),g=parseInt(this.$el.css("height"),10);f.set("isModified",!0),this.model.set("height",g),this.model.__parent__&&this.model.initialArea&&(this.model.__extra__.initialArea.height=g),this.$parent.css("height",g),this.model.set("htmlText",this.$el.html()),f.set("isModified",!1),this._isModified_=!1}this.viewController.groupEditor.isEditing()?(_.each(this.model.topParent().__children__,function(a){a.view.$parent.on("draginit drag dragstart dragend click dblclick")},this),this.viewController.groupEditor.done(),this.viewController.select(this.model.topParent())):this.viewController.select(this.model),this.viewController.currentEditingTextView=null,this._setBorder(),this.model.draggable=!0},hasTag:function(a){return new RegExp("(<(/?[^>]+)>)").test(a)},getContentHeight:function(){0!=this.model.rotate&&this.$parent.tt_rotate(0);var a=0,b=0,c=!0;this.$el.children().each(function(d,e){var f=$(e),g=f.offset().top,h=g+(c?f.outerHeight():f.height());a>g&&(a=g),h>b&&(b=h)});var d=b-a-this.$el.offset().top;return this.$el.offset().top<0&&(d-=Math.abs(this.$el.offset().top)),0!=this.model.rotate&&this.$parent.tt_rotate(this.model.rotate),d<this.modelHeight&&(d=this.modelHeight),d},_autoFit:function(a){if(a||(a={}),a=_.extend({delay:!0},a),a.delay===!1)this.$parent.css("height",this.getContentHeight()+"px");else{var b=this;setTimeout(function(){b.$parent.css("height",b.getContentHeight()+"px")},5)}},handleKeyDown:function(a){if(a.keyCode==b.DOM_VK_RETURN);else if(a.keyCode==b.DOM_VK_BACK_SPACE);else if(a.keyCode==b.DOM_VK_ESCAPE)return void this.endEditing();this._isModified_=!0,this._autoFit()},handleModalClick:function(a){var b=$(a.target).parents("#"+this.$parent.attr("id"));0===b.length&&this.endEditing()}}),a.UIText=e}),define("toast/views/UIButton",["../core","../utils/StringUtils","../utils/ImageUtils","./UIText"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{label:"Button",tagName:"Button",className:"btn",style:{fontSize:"14px",width:"100%",height:"100%",minHeight:"20px",outline:"none",whiteSpace:"pre-wrap",wordBreak:"break-all",color:"#333",backgroundColor:"#fff",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"},useAction:!0,useAnimation:!0,properties:function(){return[{name:"DefaultProperty",properties:[{label:" ",name:"buttonState",value:"normal",update:!0,control:{type:"select",valueList:[{label:"",value:"normal"},{label:"",value:"selected"}]}}]},{name:"ButtonImage",label:" ",properties:[{label:" ",name:"normalImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:" ",name:"overImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:" ",name:"downImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:" ",name:"selectedImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}}]}]},initialize:function(a){this.style=_.extend({},e.style,this.style),this.mergeProperties(e,this),_.isEmpty(this.model.properties.normalImage)||(this.$el.removeClass("btn"),this.$el.addClass("image")),e.initialize.call(this,a),this.setState(this.model.properties.buttonState,!0)},present:function(){return e.present.call(this),this},update:function(b,d){if(b||(b={}),d||(d={}),e.update.call(this,d),this.setState(this.model.properties.buttonState,!0),_.isEmpty(b)||"normalImage"!==b.name)return!0;if(b.value){var f=this,g=a.ImageAssets.url(b.value);c.getImageSize(g).done(function(a,b){f.setText("");var c=$('<div contenteditable="true">&nbsp;</div>');f.$el.html(c);var d=a/b;f.model.height=parseInt(f.model.width/d),f.$parent.css({width:f.model.width+"px",height:f.model.height+"px"}),f.$el.addClass("image"),f.setState(f.model.properties.buttonState,!0),f.model.topParent().set("isModified",!1),f._setBorder()})}else this.$el.removeClass("image"),this.model.topParent().set("isModified",!1),this._setBorder();return!1},_hasVisibility:function(){return!_.isEmpty(this.model.properties.normalImage)},setState:function(b,c){if(this.buttonState!==b||c){var d;if("selected"===b?d=this.model.properties.selectedImage:"disabled"===b&&(d=this.model.properties.disabledImage),d||(d=this.model.properties.normalImage),d){var e=a.ImageAssets.url(d);this.$el.css("backgroundImage",'url("'+e+'")'),this.$el.css("backgroundColor","")}else this.$el.css("backgroundImage",""),this.model.style.backgroundColor&&this.$el.css("backgroundColor",this.model.style.backgroundColor);this.buttonState=b}},render:function(){this.isEmpty()||this.$el.html('<div class="text-wrap">'+this.getText()+"</div>"),this.$el=this.$el.tt_changeTag("a"),e.render.call(this);var b=this.model.properties.downImage;!_.isEmpty(b)&&a.ImageAssets.url(b)&&(this.$el.on(this.__eventTypes__.start,$.proxy(this._onDown,this)),this.$el.on(this.__eventTypes__.end,$.proxy(this._onUp,this)));var c=this.model.properties.overImage;return!_.isEmpty(c)&&a.ImageAssets.url(c)&&this.$el.hover($.proxy(this._onHover,this),$.proxy(this._onOut,this)),this},_onDown:function(){if(this.model.properties.downImage){var b=a.ImageAssets.url(this.model.properties.downImage);this.$el.css("backgroundImage",'url("'+b+'")')}},_onUp:function(){_.isEmpty(this.model.properties.overImage)?this._onOut():this._onHover()},_onOut:function(){this.setState(this.model.properties.buttonState,!0)},_onHover:function(){var b=a.ImageAssets.url(this.model.properties.overImage);this.$el.css("backgroundImage",'url("'+b+'")')},startEditing:function(){e.startEditing.call(this)&&(this.$el.attr("contenteditable",!1),this.$el.css("cursor","text"),this.__$contenteditable__=$("<div />",{contenteditable:!0}),this.__$contenteditable__.html(this.$el.html()),this.$el.html(this.__$contenteditable__),this.__$contenteditable__.tt_select(),this.__$contenteditable__.addClass("show"))},endEditing:function(){var a=this.__$contenteditable__.html();this.__$contenteditable__.remove(),this.$el.html(a),this.__$contenteditable__=null,e.endEditing.call(this),this.$parent.children("#dummy").show()},updateSize:function(){}}),a.UIButton=f}),define("toast/views/UILabel",["../core","./UIText"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Label",style:{borderTopLeftRadius:"15px",borderTopRightRadius:"15px",borderBottomRightRadius:"15px",borderBottomLeftRadius:"15px",textAlign:"center",backgroundColor:"rgb(26, 188, 156)",color:"rgba(255, 255, 255, 1)",fontSize:"14px",boxShadow:"none",minHeight:"18px"},useAction:!0,useAnimation:!0,properties:function(){return[]},initialize:function(a){this.style=_.extend({},c.style,this.style),this.mergeProperties(c,this),c.initialize.call(this,a)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this}}),a.UILabel=d}),define("toast/views/UILink",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Link",style:{},useAction:!0,defaultAction:{name:"LinkUrl",properties:{url:"",openWindow:!0}},useAnimation:!0,properties:function(){return[{name:"UILinkProperty",label:" ",properties:[{label:" ",name:"hoverColor",value:"rgba(45,237,232,0.2)",control:{type:"color"}}]}]},initialize:function(a){c.initialize.call(this,a),this.mergeProperties(c,this),this.events=_.extend({},c.events,this.events),this.delegateEvents(this.events)},present:function(){return c.present.call(this),this},render:function(){c.render.call(this);var a=this;return a.$el.hover(function(){a.$el.css("backgroundColor",a.model.properties.hoverColor)},function(){a.$el.css("backgroundColor","")}),this}}),a.UILink=d}),define("toast/views/UIImage",["../core","../utils/StringUtils","./UIView"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,{label:"Image",style:{backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"},useAction:!0,useAnimation:!0,properties:function(){return[{name:"ImageProperty",label:" ",properties:[{label:"",name:"asset",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}}]}]},initialize:function(b){if(this.style.backgroundImage="",!_.isEmpty(this.model.properties.asset)){this._asset=this.model.properties.asset;var c=a.ImageAssets.url(this._asset);c&&(this.style.backgroundImage='url("'+c+'")')}this.style=_.extend({},d.style,this.style),this.mergeProperties(d,this),d.initialize.call(this,b)},present:function(){return d.present.call(this),this},render:function(){return d.render.call(this),this},update:function(b,c){if(b||(b={}),c||(c={}),c.replace||this._asset!==this.model.properties.asset){this._asset=this.model.properties.asset;var e=a.ImageAssets.url(this._asset);e?this.style.backgroundImage='url("'+e+'")':this.style.backgroundImage=""}return d.update.call(this,b,c),this},_hasVisibility:function(){return!_.isEmpty(this.model.properties.asset)}}),a.UIImage=e}),define("toast/views/UIImageSlide",["../core","../utils/StringUtils","./UIView","../actions"],function(a,b,c,d){"use strict";var e=c.prototype,f=c.extend();return _.extend(f.prototype,e,{label:"Image Slide",style:{backgroundColor:"#ddd",backgroundSize:"100% 100%",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"},properties:function(){return[{name:"ImageSlideProperty",label:"  ",properties:[{label:"  ",name:"transition",value:"slide",control:{type:"select",valueList:[{label:" ",value:"slide"},{label:" ",value:"fade"}]}},{label:"",name:"assets",control:{type:"file",allowMultipleSelection:!0,assetType:"image",placeholder:"  "}},{label:"  ",name:"popupImage",value:!0,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}},{label:"",name:"backgroundColor",value:"#ddd",control:{type:"color"}},{label:"/  ",name:"buttonColor",value:"#acacac",control:{type:"color"}},{label:"  ",name:"pageDotColor",value:"#222222",control:{type:"color"}},{label:" <br> ",name:"currentPageDotColor",value:"#428bca",control:{type:"color"}}]}]},initialize:function(a){this.style=_.extend({},e.style,this.style),this.mergeProperties(e,this),_.isUndefined(this.model.properties.backgroundColor)||(this.style.backgroundColor=this.model.properties.backgroundColor),e.initialize.call(this,a)},present:function(){
e.present.call(this);require(["text!toast/html-templates/image-slide-preview-template.html"],function(a){this.$el.append(a),this.preview={},this.preview.$centerIcon=this.$el.find(".image-slide-preview .center-icon"),this.preview.$navigation=this.$el.find(".image-slide-preview .slide-navigation"),this.preview.$pager=this.$el.find(".image-slide-preview .slide-pager"),this.update()}.bind(this));return this},update:function(){var a=this.model.properties.backgroundColor;_.isUndefined(a)&&(a=""),this.style.backgroundColor=a,this.preview.$navigation.children("span").css("color",this.model.properties.buttonColor),this.preview.$pager.children("span").css("backgroundColor",this.model.properties.pageDotColor),this.preview.$pager.children("span.active").css("backgroundColor",this.model.properties.currentPageDotColor),this._resetStyle();var b,c,d,e;b=this.$el.width(),c=this.$el.height(),d=this.preview.$centerIcon.width(),e=this.preview.$centerIcon.height();var f=Math.min(b,c)-5;return(b>d||c>e)&&(f=Math.min(128,f)-5),this.preview.$centerIcon.css({width:f+"px",height:f+"px"}),this},render:function(){e.render.call(this),this.$parent.show(),this.model.properties.visible!==!0&&this.$parent.css("opacity",0);var b=this.model.properties.assets;if(!_.isUndefined(b)&&0!=b.length){var c,d=this,f=!1;this.$el.on(this.__eventTypes__.start,function(a){c=a.pageX,f=!1}).on(this.__eventTypes__.move,function(b){a.isMobileDevice&&b.stopPropagation()}).on(this.__eventTypes__.end,function(a){var b=Math.abs(c-a.pageX);b>2&&(f=!0)}),this.model.properties.popupImage===!0&&_.isUndefined(this.__action__)&&(this.$el.css("cursor","pointer"),this.__action__=TT.Action.create(this,{name:"PopupImage",properties:{title:"",assets:this.model.properties.assets}}),this.$el.on("click",function(b){a.lazy(function(){f||d.__action__.execute()},5)}));var g=$("<ul />"),h=this.$el.css("borderTopWidth"),i=this.$el.css("borderBottomWidth");h=parseFloat(h),i=parseFloat(i),isNaN(h)&&(h=0),isNaN(i)&&(i=0);var j=(h+i).toFixed(1),k=this.$el.parent().height()-j;return _.each(b,function(b){g.append('<li><img src="'+a.ImageAssets.url(b)+'"height="'+k+'"></li>')},this),this.$el.append(g),g.lightSlider({mode:this.model.properties.transition,adaptiveHeight:!0,item:1,slideMargin:0,thumbMargin:0,galleryMargin:0,onSliderLoad:function(a){d.$slider=a,TT.lazy(function(){d.$slider.refresh(),d.model.properties.visible!==!0&&(d.$parent.hide(),d.$parent.css("opacity",1))},500),d.$pager=d.$el.find(".lSPager"),d.$pager.attr("data-dot-color",d.model.properties.pageDotColor),d.$pager.attr("data-current-dot-color",d.model.properties.currentPageDotColor);var b=Math.abs(d.$el.parent().width()/8);b=Math.min(30,Math.abs(d.$el.parent().width()/8)),d.$prev=d.$el.find(".lSPrev"),d.$prev.css({left:8*(b/30)+"px",width:b+"px",height:b+"px",fontSize:b+"px",marginTop:-b/2+"px",color:d.model.properties.buttonColor}),d.$next=d.$el.find(".lSNext"),d.$next.css({right:5*(b/30)+"px",width:b+"px",height:b+"px",fontSize:b+"px",marginTop:-b/2+"px",color:d.model.properties.buttonColor})},onAfterSlide:function(a,b){d.__action__.options.start=b}}),this.__on__(a.Events.WILL_MOVE_PAGE,this._onWillMovePage),this}},_onWillMovePage:function(b,c){if(a.Book.availableCurrentPage(this.viewController.index+1)){var d=!1;this.$parent.is(":visible")||(this.$parent.show(),this.model.properties.visible!==!0&&(d=!0,this.$parent.css("opacity",0))),TT.lazy(function(){this.$slider.refresh(),d===!0&&(this.$parent.hide(),this.$parent.css("opacity",1))},100,this)}}}),a.UIImageSlide=f}),define("toast/views/UIIcon",["require","../core","../utils/StringUtils","./UIView"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{label:"Icon",style:{},useAction:!0,useAnimation:!0,properties:function(){return[{name:"IconProperty",label:" ",properties:[{label:"",name:"asset",control:{type:"file",allowMultipleSelection:!1,assetType:"svg",placeholder:"  "}}]}]},initialize:function(a){this.mergeProperties(e,this),_.isUndefined(this.model.__extra__.fill)&&(this.model.__extra__.fill="#000"),this.style=_.extend({},e.style,this.style),e.initialize.call(this,a),this._load()},svgLoaded:function(a){this.$svg&&this.$svg.remove(),this.$svg=$(a),this.$svg.prop("viewBox")||(this.$svg=this.$svg.find("svg")),this.$svg.attr("width","100%"),this.$svg.attr("height","100%"),this.$svg.attr("pointer-events","none"),_.isUndefined(this.model.__extra__.preserveAspectRatio)||this.$svg.get(0).setAttribute("preserveAspectRatio",this.model.__extra__.preserveAspectRatio),_.isUndefined(this.model.__extra__.fill)||this.$svg.get(0).setAttribute("fill",this.model.__extra__.fill);var b=$("<div />");b.css({position:"absolute",left:0,top:0,height:"100%",width:"100%"}),this.$el.prepend(b),this.$el.prepend(this.$svg)},render:function(){return e.render.call(this),this},present:function(){return e.present.call(this),this},update:function(){return e.update.call(this),_.isUndefined(this.$svg)?this:(void 0!==this.model.__extra__.preserveAspectRatio?this.$svg.get(0).setAttribute("preserveAspectRatio",this.model.__extra__.preserveAspectRatio):this.$svg.get(0).removeAttribute("preserveAspectRatio"),_.isUndefined(this.model.__extra__.fill)||this.$svg.get(0).setAttribute("fill",this.model.__extra__.fill),this._load(),this)},_hasVisibility:function(){var a=this.model.__extra__.fill;if(a&&-1!==a.indexOf("a")){var b=Number(a.replace(/^.*,(.+)\)/,"$1"));if(.1>b)return!1}return!_.isEmpty(this.model.properties.asset)},_load:function(){if(this._asset!==this.model.properties.asset){this._asset=this.model.properties.asset;var a=b.SVGAssets.url(this._asset);a?$.ajax({type:"GET",url:a,dataType:"xml",success:$.proxy(this.svgLoaded,this)}):this.$svg&&this.$svg.remove()}}}),b.UIIcon=f}),define("toast/views/UIShape",["../core","./UIText"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Shape",style:{},useAction:!0,initialize:function(a){this.style=_.extend({},c.style,this.style),c.initialize.call(this,a)},_hasVisibility:function(){return!1}}),a.UIShape=d}),define("toast/views/UILine",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Line",style:{},useAction:!0,properties:function(){return[{name:"UILineProperty",label:" ",properties:[{label:" ",name:"color",value:"#c8c8c8",control:{type:"color"}},{label:" ",name:"lineWidth",value:1,control:{type:"spinedit"}}]}]},initialize:function(a){c.initialize.call(this,a),this.mergeProperties(c,this),this._setLine()},_setLine:function(){var a=$("<div />",{"class":"inner-line"});"horizon"===this.model.direction?a.css({position:"absolute",width:"100%"}):"vertical"===this.model.direction&&a.css({position:"absolute",height:"100%"}),this.$el.append(a),this.$line=a,this.update()},update:function(){var a=1;_.isUndefined(this.model.properties.lineWidth)||(a=this.model.properties.lineWidth);var b="#c8c8c8";_.isUndefined(this.model.properties.color)||(b=this.model.properties.color),"horizon"===this.model.direction?(this.$line.css("height",a+"px"),this.$line.css({top:"50%",marginTop:-(a/2)+"px"})):"vertical"===this.model.direction&&(this.$line.css("width",a+"px"),this.$line.css({left:"50%",marginLeft:-(a/2)+"px"})),this.$line.css("backgroundColor",b)},render:function(){return c.render.call(this),this}}),a.UILine=d}),define("toast/views/UICheckBox",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"CheckBox",style:{},initialize:function(a){c.initialize.call(this,a),this.$input=$("<input />"),this.$input.attr({type:"checkbox"}).css("display","none"),this.$parent.prepend(this.$input),this.$check=$("<check />"),this.$check.css("display","none"),this.$check.appendTo(this.$el)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this.$check.css({"-webkit-transform":"rotate(-45deg) scale("+this.$el.height()/24+")","-moz-transform":"rotate(-45deg) scale("+this.$el.height()/24+")","-ms-transform":"rotate(-45deg) scale("+this.$el.height()/24+")","-o-transform":"rotate(-45deg) scale("+this.$el.height()/24+")",transform:"rotate(-45deg) scale("+this.$el.height()/24+")"}),this.$input.attr("checked")?(this.$check.css("display",""),this.$el.css("borderColor",this.$check.css("borderColor"))):(this.$check.css("display","none"),this.$el.css("borderColor","#c4cbd2")),this},events:{click:"handleClick"},handleClick:function(a){this.$input.attr("checked")?this.$input.removeAttr("checked"):this.$input.attr("checked",!0),this.render()}}),a.UICheckBox=d}),define("toast/views/UIRadioButton",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Radio Button",style:{},initialize:function(a){c.initialize.call(this,a)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this},events:{click:"handleClick"},handleClick:function(a){}}),a.UIRadioButton=d}),define("toast/views/UITooltip",["../core","./UILabel"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Tooltip",style:{borderTopLeftRadius:"5px",borderTopRightRadius:"5px",borderBottomRightRadius:"5px",borderBottomLeftRadius:"5px",textAlign:"center",backgroundColor:"#666",color:"rgb(255, 255, 255)",fontSize:"15px",boxShadow:"none",minHeight:"20px",padding:"4px"},arrowStyle:{position:"absolute",width:0,height:0,left:"15px",bottom:"-10px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"12px solid {color}"},initialize:function(a){this.style=_.extend({},c.style,this.style),c.initialize.call(this,a),this.$el.css("lineHeight","20px"),this.$arrow=$("<span />"),this.arrowStyle=$.extend(this.arrowStyle,this.model.get("arrowStyle")),this.$parent.append(this.$arrow),this._resetStyle()},_resetStyle:function(){c._resetStyle.call(this);var a=$.extend(!0,{},this.arrowStyle),b=JSON.stringify(a);b=b.replace("{color}",this.$el.css("backgroundColor"));var d=JSON.parse(b);return this.$arrow.css(d),this},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this}}),a.UITooltip=d}),define("toast/views/UIMessage",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Message",style:{},initialize:function(a){c.initialize.call(this,a)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this},events:{}}),a.UIMessage=d}),define("toast/views/UIMemo",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Memo",style:{},initialize:function(a){c.initialize.call(this,a)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this},events:{}}),a.UIMemo=d}),define("toast/views/UIMoviePlayer",["require","module","../core","./UIView","../utils"],function(a,b,c,d){"use strict";var e=d.prototype,f=d.extend();return _.extend(f.prototype,e,{label:"Movie Player",style:{},useAnimation:!0,properties:function(){return[{name:"MoviePlayerProperty",label:"  ",properties:[{label:"",name:"asset",control:{type:"file",allowMultipleSelection:!1,assetType:"movie",placeholder:"  "}},{label:"",name:"url",control:{type:"text",placeholder:"http://"}},{label:" ",name:"autoplay",value:!1,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}},{label:" ",name:"cover",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:"",name:"backgroundColor",value:"#000",control:{type:"color"}}]}]},initialize:function(a){this.mergeProperties(e,this),_.isUndefined(this.model.properties.backgroundColor)||(this.style.backgroundColor=this.model.properties.backgroundColor),e.initialize.call(this,a)},present:function(){e.present.call(this),this.$el.css("pointer-events","none"),this.preview={};var a=$("<img />",{"class":"center-icon"});return a.attr("src","assets/images/movie-player.png"),this.preview.$centerIcon=a,this.$parent.append(this.preview.$centerIcon),this.update(),this},update:function(){var a=this.model.properties.backgroundColor;_.isUndefined(a)&&(a=""),this.style.backgroundColor=a,this._resetStyle();var b,c,d,e;b=this.$parent.width(),c=this.$parent.height(),d=this.preview.$centerIcon.width(),e=this.preview.$centerIcon.height();var f=Math.min(b,c)-5;return(b>d||c>e)&&(f=Math.min(128,f)-5),this.preview.$centerIcon.css({width:f+"px",height:f+"px"}),this},render:function(){e.render.call(this);var a;_.isEmpty(this.model.properties.asset)?_.isEmpty(this.model.properties.url)||(a=this.model.properties.url,-1===a.indexOf("../")&&-1===a.indexOf("./")&&"http:"!==a.protocol()&&"https"!==a.protocol()&&(a="http://"+this.model.properties.url)):a=c.MovieAssets.url(this.model.properties.asset);var b=this.model.properties.cover;return b&&(b=c.ImageAssets.url(b)),this.$video=$("<video />"),this.$video.attr({id:this.model.id+"-inner",src:a,type:"video/mp4",poster:b,controls:"controls"}),this.$video.css({width:"100%",height:"100%"}),this.$el.append(this.$video),this.model.properties.autoplay===!0&&this.$video.on("loadeddata",$.proxy(this._loaded,this)),this.__on__(c.Events.PAGE_DID_CHANGE,this._onPageDidChange),this.__on__(c.Events.ZOOM_MODE_DID_CHANGE,this._onZoomModeDidChange),this},_loaded:function(){this.model.properties.autoplay===!0&&(this.$video.attr("data-autoplay",!0),this.viewController.modal===!0?this.$video[0].play():this._autoPlayAndStop())},_onPageDidChange:function(a,b){this.viewController.modal!==!0&&this._autoPlayAndStop()},_onZoomModeDidChange:function(a){this.$video[0].pause()},_autoPlayAndStop:function(){c.Book.availableCurrentPage(this.viewController.index+1)&&this.model.properties.autoplay?this.$video[0].play():c.Book.availableCurrentPage(this.viewController.index+1)===!1&&this.$video[0].pause()},events:{}}),c.UIMoviePlayer=f}),define("toast/views/UIYoutubePlayer",["require","module","../core","./UIView","../utils"],function(a,b,c,d){"use strict";function e(a){f.promise().done(a),f.ok===!0&&f.resolve()}var f=new $.Deferred;$.getScript("https://www.youtube.com/iframe_api").done(function(a,b){var c=setInterval(function(){"function"==typeof YT.Player&&(clearInterval(c),f.ok=!0,f.resolve())},10)});var g=d.prototype,h=d.extend();return _.extend(h.prototype,g,{label:"Youtube Player",style:{},__player__:null,properties:function(){return[{name:"YoutubePlayerProperty",label:"  ",properties:[{label:"",name:"url",control:{type:"text",placeholder:" "}},{label:" ",name:"autoplay",value:!1,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}}]}]},initialize:function(a){this.mergeProperties(g,this),g.initialize.call(this,a)},present:function(){g.present.call(this),this.$el.css("backgroundColor","#f3f3f3");a(["text!toast/html-templates/youtube-player-preview-template.html"],function(a){this.$el.append(a),this.preview={},this.preview.$centerIcon=this.$el.find(".center-icon"),this.update()}.bind(this));return this},update:function(){this._resetStyle(),this.$el.css("backgroundColor","#f3f3f3");var a,b,c,d;a=this.$el.width(),b=this.$el.height(),c=this.preview.$centerIcon.width(),d=this.preview.$centerIcon.height();var e=Math.min(a,b)-5;return(a>c||b>d)&&(e=Math.min(128,e)-5),this.preview.$centerIcon.css({width:e+"px",height:e+"px"}),this},render:function(){return g.render.call(this),this.$preloader=$("<div />",{"class":"preloader preloader-md"}),this.$preloader.append($("<span />",{"class":"fa-spin"})),this.__on__(c.Events.PAGE_DID_CHANGE,this._onPageDidChange),this.__on__(c.Events.PAGE_DID_UNLOAD,this._onPageDidUnLoad),this},_onPlayerReady:function(a){return this.__player__.readyok=!0,this.__doDestroy__===!0?(this._destroyPlayer(),void(this.__doDestroy__=!1)):(this.$el.children(".preloader").remove(),void(c.Book.availableCurrentPage(this.viewController.index+1)&&this.model.properties.autoplay===!0&&a.target.playVideo()))},_onPlayerStateChange:function(a){a.data===YT.PlayerState.ENDED&&a.target.cueVideoById(a.target.getVideoData().video_id)},_play:function(){_.isNull(this.__player__)||this.__player__.playVideo()},_stop:function(){_.isNull(this.__player__)||this.__player__.stopVideo()},_pause:function(){_.isNull(this.__player__)||this.__player__.pauseVideo()},_createPlayer:function(){if(this.__createPlayer__!==!0){this.__createPlayer__=!0;var a=this,b=$("<div />",{"class":"youtube-player-container"});b.attr("id","ypc-"+_tt.UUID4()),this.$el.append(b),e(function(){a.__player__=new YT.Player(b.attr("id"),{height:b.height(),width:b.width(),videoId:a._getVideoId(),events:{onReady:$.proxy(a._onPlayerReady,a),onStateChange:$.proxy(a._onPlayerStateChange,a)}})})}},_getVideoId:function(){var a=this.model.properties.url;if(_.isEmpty(a))return"";var b;if(-1!=a.indexOf("iframe")){var c=new RegExp(/src=(["'])(.*?)\1/),d=a.match(c);if(d.length>2){var e=d[2].split("/");-1!==e.length&&(b=e[e.length-1])}}var e=a.split("/");if(-1!==e.length&&(b=e[e.length-1]),!_.isEmpty(b)){var e=b.split("?");return-1!==e.length&&(b=e[0]),b}return""},_destroyPlayer:function(){_.isNull(this.__player__)||this.__player__.readyok!==!0?_.isNull(this.__player__)||(this.__doDestroy__=!0):(this.__player__.destroy(),this.__player__=null,this.__createPlayer__=!1,this.__doDestroy__=!1)},_onPageDidChange:function(a){c.Book.availableCurrentPage(this.viewController.index+1)?(this.__createPlayer__!==!0&&0===this.$el.children(".preloader").length&&(this.$el.append(this.$preloader),this.$el.show()),this._createPlayer(),this.$el.show()):(this._destroyPlayer(),this.$el.children(".preloader").remove(),this.$el.hide())},_onPageDidUnLoad:function(a){this.viewController.index+1===a&&this._destroyPlayer()},events:{}}),c.UIYoutubePlayer=h}),define("toast/views/UIAudioPlayer",["module","../core","./UIView"],function(a,b,c){"use strict";var d;require(["text!toast/html-templates/audioplayer.html"],function(a){d=a});var e=c.prototype,f=c.extend();return _.extend(f.prototype,e,{label:"AudioPlayer",style:{},properties:function(){return[{name:"AudioPlayerProperty",label:"  ",properties:[{label:"",name:"assets",control:{type:"file",allowMultipleSelection:!0,assetType:"audio",placeholder:"  "}},{label:"",name:"url",control:{type:"text",placeholder:"http://"}},{label:" ",name:"autoplay",value:!1,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}},{label:" ",name:"loop",value:!1,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}},{label:" ",name:"backgroundColor",value:"",control:{type:"color"},tooltip:"  .      ."},{label:" ",name:"buttonIconColor",value:"",control:{type:"color"},tooltip:"   .      ."},{label:" ",name:"textColor",value:"",control:{type:"color"},tooltip:", ()   ."},{label:" ",name:"seekbarBgColor",value:"",control:{type:"color"},tooltip:"  .      ."},{label:" ",name:"seekbarColor",value:"",control:{type:"color"},tooltip:"  .      ."}]}]},initialize:function(a){this.mergeProperties(e,this),e.initialize.call(this,a),this.$el.append(d)},present:function(){return e.present.call(this),this.update(),this},update:function(){this._resetStyle(),_.isUndefined(this.$audioPlayer)&&(this.$audioPlayer=this.$el.find(".audioplayer"));var a=this.model.properties.backgroundColor;_.isUndefined(a)&&(a=""),this.$el.css("backgroundColor",a),this.$audioPlayer.css("backgroundColor",a),this.$audioPlayer.find(".audioplayer-volume-adjust").css("backgroundColor",a);var b=this.model.properties.textColor;_.isUndefined(b)&&(b=""),this.$audioPlayer.find(".audioplayer-text").css("color",b);var c=this.model.properties.buttonIconColor;_.isUndefined(c)&&(c=""),this.$audioPlayer.find(".audioplayer-icon").css("color",c);var d=this.model.properties.seekbarBgColor;_.isUndefined(d)&&(d=""),this.$audioPlayer.find(".audioplayer-bar").css("backgroundColor",d);var e=this.model.properties.seekbarColor;return _.isUndefined(e)&&(e=""),this.$audioPlayer.find(".audioplayer-bar-played").css("backgroundColor",e),this.$audioPlayer.find(".audioplayer-volume-adjust div div").css("backgroundColor",e),this},render:function(){e.render.call(this);var a=$("<audio controls />",{id:this.$el.attr("id")+"-inner",width:"100%",preload:"auto"});if(this.model.properties.url){var c=this.model.properties.url;-1===c.indexOf("../")&&-1===c.indexOf("./")&&"http:"!==c.protocol()&&"https"!==c.protocol()&&(c="http://"+this.model.properties.url),c=b.StringUtils.replaceTemplate(c).encodeFilePath(),a.attr({"data-audio-id":c.getBaseName().getFilenameWithoutExtension(),src:c})}return _.each(this.model.properties.assets,function(c){var d=b.AudioAssets.url(c);if(d){var e=$("<source />",{"data-audio-id":c,src:d});a.append(e)}}),a.children("source").length>0&&a.attr({"data-audio-id":a.children("source").eq(0).attr("data-audio-id"),src:a.children("source").eq(0).attr("src")}),this.model.properties.loop===!0&&a.attr("loop","loop"),this.$el.append(a),a.audioPlayer(),this.$audioPlayer=this.$el.find(".audioplayer"),this.$audioPlayer.children(".audioplayer-overlay").remove(),this.$audio=this.$audioPlayer.find("audio"),this.update(),this.model.properties.autoplay===!0&&this.$audio.on("loadeddata",$.proxy(this._loaded,this)),this.__on__(b.Events.PAGE_DID_CHANGE,this._onPageDidChange),this.__on__(b.Events.PAGE_DID_UNLOAD,this._onPageDidUnLoad),this.__on__(b.Events.ZOOM_MODE_DID_CHANGE,this._onZoomModeDidChange),this.__on__(b.Events.ZOOM_SCALE_DID_CHANGE,this._onZoomScaleDidChange),this.__on__(b.Events.PARTIAL_ZOOM_SCALE_DID_CHANGE,this._onPartialZoomScaleDidChange),this.__on__(b.Events.STOP_ALL_SOUND,this._onStopAllSound),this.viewController.on(b.Events.CONTENT_SCALE_DID_CHANGE,$.proxy(this._onContentScaleDidChange,this)),this},_loaded:function(){this.model.properties.autoplay===!0&&(this.$audio.attr("data-autoplay",!0),this.viewController.modal===!0?this.play():this._autoPlayAndStop())},_onPageDidChange:function(a,b){this._updateZoom(),_.isUndefined(this.$audio[0])||this.viewController.modal!==!0&&this._autoPlayAndStop()},_onZoomModeDidChange:function(a){_.isUndefined(this.$audio[0])||"function"!=typeof this.$audio[0].pause||this.$audio[0].pause(),this.$audioPlayer.removeClass("audioplayer-playing")},_onZoomScaleDidChange:function(a){this._updateZoom()},_onPartialZoomScaleDidChange:function(a){_.isUndefined(this.$audio[0])||"function"!=typeof this.$audio[0].pause||this.$audio[0].pause(),this.$audioPlayer.removeClass("audioplayer-playing"),this._updateZoom()},_onContentScaleDidChange:function(a){this._updateZoom()},_onStopAllSound:function(a){a?this.stop():this.pause()},_autoPlayAndStop:function(){b.Book.availableCurrentPage(this.viewController.index+1)&&this.model.properties.autoplay?this.play():b.Book.availableCurrentPage(this.viewController.index+1)===!1&&this.pause()},_updateZoom:function(){b.Book.availableCurrentPage(this.viewController.index+1)&&(_.isUndefined(this.$audio[0])||this.$audio.attr("data-zoom",this.viewController.contentScale))},remove:function(){_.isUndefined(this.$audio[0])||(this.$audio.remove(),delete this.$audio[0]),e.remove.call(this)},play:function(){_.isUndefined(this.$audio[0])||0===this.$audio[0].readyState||this.$audioPlayer.hasClass("audioplayer-playing")||this.$audioPlayer.find(".audioplayer-playpause").trigger("click")},pause:function(){_.isUndefined(this.$audio[0])||"function"!=typeof this.$audio[0].pause||this.$audio[0].pause(),this.$audioPlayer.removeClass("audioplayer-playing")},stop:function(){this.$audioPlayer.removeClass("audioplayer-playing"),_.isUndefined(this.$audio[0])||0===this.$audio[0].readyState||("function"==typeof this.$audio[0].pause&&this.$audio[0].pause(),_.isUndefined(this.$audio[0].currentTime)||(this.$audio[0].currentTime=0,this.$audio.trigger("timeupdate")))}}),b.UIAudioPlayer=f}),function(a,b,c,d){var e="ontouchstart"in b,f=e?"touchstart":"mousedown",g=e?"touchmove":"mousemove",h=e?"touchcancel":"mouseup",i=function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.ceil(a%3600%60);return(0==b?"":b>0&&b.toString().length<2?"0"+b+":":b+":")+(c.toString().length<2?"0"+c:c)+":"+(d.toString().length<2?"0"+d:d)},j=function(a){var b=c.createElement("audio");return!(!b.canPlayType||!b.canPlayType("audio/"+a.split(".").pop().toLowerCase()+";").replace(/no/,""))};a.fn.audioPlayer=function(b){var b=a.extend({classPrefix:"audioplayer",strPlay:"Play",strPause:"Pause",strVolume:"Volume"},b),c={},k={playPause:"playpause",playing:"playing",time:"time",timeCurrent:"time-current",timeDuration:"time-duration",bar:"bar",barLoaded:"bar-loaded",barPlayed:"bar-played",volume:"volume",volumeButton:"volume-button",volumeAdjust:"volume-adjust",noVolume:"novolume",mute:"mute",mini:"mini"};for(var l in k)c[l]=b.classPrefix+"-"+k[l];return this.each(function(){if("audio"!=a(this).prop("tagName").toLowerCase())return!1;var k=a(this),l=k.attr("src"),m=k.get(0).getAttribute("autoplay"),m=""===m||"autoplay"===m?!0:!1,n=k.get(0).getAttribute("loop"),n=""===n||"loop"===n?!0:!1,o=!1,p=!1;"undefined"==typeof l?(p=!0,k.find("source").each(function(){return l=a(this).attr("src"),"undefined"!=typeof l&&j(l)?(o=!0,p=!1,!1):void 0})):0==l.length?p=!0:j(l)&&(o=!0);var q=k.parent().children("."+b.classPrefix);o?q.prepend(k.eq(0).clone()):q.prepend('<embed src="'+l+'" width="0" height="0" volume="100" autostart="'+m.toString()+'" loop="'+n.toString()+'" />');var r=o?q.find("audio"):q.find("embed"),r=r.get(0);q.find("audio").css({width:0,height:0,visibility:"hidden"});var s=q.find("."+c.bar),t=q.find("."+c.barPlayed),u=q.find("."+c.barLoaded),v=q.find("."+c.timeCurrent+">span"),w=q.find("."+c.timeDuration+">span"),x=q.find("."+c.volumeButton),y=q.find("."+c.volumeAdjust+" > div"),z=0,A=1,B=function(b){theRealEvent=e?b.originalEvent.touches[0]:b;var c=a(r).attr("data-zoom");_.isUndefined(c)||(A=Number(c)),r.currentTime=Math.round(r.duration*(theRealEvent.pageX-s.offset().left)/(s.width()*A))},C=function(b){theRealEvent=e?b.originalEvent.touches[0]:b;var c=a(r).attr("data-zoom");_.isUndefined(c)||(A=Number(c)),r.volume=Math.abs((theRealEvent.pageY-(y.offset().top+y.height()*A))/(y.height()*A))},D=setInterval(function(){o&&_.isUndefined(r)&&!isNaN(r.duration)&&0!==r.readyState&&(u.width(r.buffered.end(0)/r.duration*100+"%"),r.buffered.end(0)>=r.duration&&clearInterval(D))},100),E=r.volume,F=r.volume=.111;Math.round(1e3*r.volume)/1e3==F?r.volume=E:q.addClass(c.noVolume),w.html("&hellip;"),v.text(i(0)),r.addEventListener("loadeddata",function(){w.text(i(r.duration)),y.find("div").height(100*r.volume+"%"),z=r.volume}),r.addEventListener("timeupdate",function(){v.text(i(r.currentTime)),t.width(r.currentTime/r.duration*100+"%")}),r.addEventListener("volumechange",function(){y.find("div").height(100*r.volume+"%"),r.volume>0&&q.hasClass(c.mute)&&q.removeClass(c.mute),r.volume<=0&&!q.hasClass(c.mute)&&q.addClass(c.mute)}),r.addEventListener("ended",function(){var b=a(r).children(),e=a(r).children(".on");e[0]===d?b.eq(1).addClass("on"):b.length-1>e.index()?(b.removeClass("on"),b.eq(e.index()+1).addClass("on")):b.removeClass("on"),q.removeClass(c.playing),a(r).attr("src",""),e=a(r).children(".on"),e[0]!==d?(a(r).attr({"data-audio-id":e.attr("data-audio-id"),src:e.attr("src")}),q.find("."+c.playPause).trigger("click")):a(r).attr({"data-audio-id":b.eq(0).attr("data-audio-id"),src:b.eq(0).attr("src")})}),s.on(f,function(a){B(a),s.on(g,function(a){B(a)})}).on(h,function(){s.unbind(g)}),x.on("click",function(){return q.hasClass(c.mute)?(q.removeClass(c.mute),r.volume=z):(q.addClass(c.mute),z=r.volume,r.volume=0),!1}),y.on(f,function(a){C(a),y.on(g,function(a){C(a)})}).on(h,function(){y.unbind(g)}),m&&q.addClass(c.playing),q.find("."+c.playPause).on("click",function(){return p?void alert("    ."):(q.hasClass(c.playing)?(a(this).attr("title",b.strPlay).find("a").html(b.strPlay),q.removeClass(c.playing),o?r.pause():r.Stop()):(a(this).attr("title",b.strPause).find("a").html(b.strPause),q.addClass(c.playing),o?r.play():r.Play()),!1)}),k.replaceWith(q)}),this}}(jQuery,window,document),define("toast/views/UIIFrame",["../core","./UIView","../utils/StringUtils"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{label:"IFrame",style:{backgroundColor:"#000"},properties:function(){return[{name:"IFrameProperty",label:" ",properties:[{label:" ",name:"relativePath",control:{type:"text",placeholder:"    ."},tooltip:"     "},{label:" ",name:"url",control:{type:"text",placeholder:"http://"},tooltip:"       .      ."},{label:"",name:"scrollbarHidden",value:!1,control:{type:"select",valueList:[{label:"",value:!1},{label:"",value:!0}]}}]}]},initialize:function(a){this.style=_.extend({},d.style,this.style),this.mergeProperties(d,this),d.initialize.call(this,a)},present:function(){d.present.call(this),this.$el.css("pointer-events","none"),this.preview={};var a=$("<img />",{"class":"center-icon"});return a.attr("src","assets/images/html-icon.png"),this.preview.$centerIcon=a,this.$parent.append(this.preview.$centerIcon),this},update:function(){this._resetStyle();var a,b,c,d;a=this.$parent.width(),b=this.$parent.height(),c=this.preview.$centerIcon.width(),d=this.preview.$centerIcon.height();var e=Math.min(a,b)-5;return(a>c||b>d)&&(e=Math.min(128,e)-5),this.preview.$centerIcon.css({width:e+"px",height:e+"px"}),this},_frameDidLoaded:function(a){this.$el.find(".preloader").hide(),this.$el.css("backgroundColor","transparent")},render:function(){if(d.render.call(this),this.__$iframe__=$("<iframe />"),this.__$iframe__.attr("allowTransparency",!0),this.$preloader=$("<div />",{"class":"preloader preloader-md"}),this.$preloader.append($("<span />",{"class":"fa-spin"})),_.isUndefined(this.model.properties.url)||_.isEmpty(this.model.properties.url)){if(!_.isUndefined(this.model.properties.relativePath)&&!_.isEmpty(this.model.properties.relativePath)){var b=this.model.properties.relativePath,e=c.replaceTemplate("{ASSETS_DIR}"+b).encodeFilePath();this.__$iframe__.attr("src",e)}}else{var e=this.model.properties.url;"http:"!==this.model.properties.url.protocol()&&"https"!==this.model.properties.url.protocol()&&(e="http://"+this.model.properties.url),this.__$iframe__.attr("src",e)}return this.model.properties.scrollbarHidden===!0?this.__$iframe__.attr("scrolling","no"):TT.isMobileDevice&&this.$el.css({overflow:"auto","-webkit-overflow-scrolling":"touch"}),this._$iframeOverlay=$("<div />",{"class":"toast-iframe-overlay"}),this.$parent.append(this._$iframeOverlay),this._$iframeOverlay.on("click",$.proxy(this._overlayClickHandler,this)),this.__on__(a.Events.PAGE_DID_CHANGE,this._onPageDidChange),this},_overlayClickHandler:function(a){TT.$el.removeClass("flipping")},_onOver:function(){TT.Book.enableAction(!1)},_onOut:function(){TT.Book.enableAction(!0)},_onPageDidChange:function(b,c){if(a.Book.availableCurrentPage(this.viewController.index+1)){this.$el.css("backgroundColor","black");var d=!1;0!==this.$el.children("iframe").length||_.isEmpty(this.__$iframe__.attr("src"))||(d=!0),0===this.$el.children(".preloader").length&&d===!0&&(this.$el.append(this.$preloader),this.$preloader.show()),this.model.properties.scrollbarHidden!==!0&&this.__$iframe__.hover($.proxy(this._onOver,this),$.proxy(this._onOut,this)),this.__$iframe__.off("load",$.proxy(this._frameDidLoaded,this)),this.__$iframe__.on("load",$.proxy(this._frameDidLoaded,this)),0===this.$el.children("iframe").length&&d===!0&&this.$el.append(this.__$iframe__),this.$parent.show()}else a.Book.availableCurrentPage(this.viewController.index+1)===!1&&(this.model.properties.scrollbarHidden!==!0&&this.__$iframe__.off("mouseenter mouseleave"),this.__$iframe__.off("load",$.proxy(this._frameDidLoaded,this)),
this.__$iframe__.remove(),this.$el.children(".preloader").remove(),this.$parent.hide())}}),a.UIIFrame=e}),define("toast/views/UIPartialZoom",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"PartialZoom",style:{},className:"ui-partial-zoom",properties:function(){return[{name:"PartialZoomProperty",label:"  ",properties:[{label:" ",name:"zoomScale",value:300,control:{type:"text",width:50,unit:"%"}}]}]},propertyDefaultValues:function(){return[{name:"draggable",hidden:!0}]},initialize:function(a){c.initialize.call(this,a),this.mergeProperties(c,this),this.events=_.extend({},c.events,this.events),this.delegateEvents(this.events)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),(_.isUndefined(this.model.properties.zoomScale)||_.isNull(this.model.properties.zoomScale))&&(this.model.properties.zoomScale=300),!_.isNumber(this.model.properties.zoomScale)&&_.isEmpty(this.model.properties.zoomScale)&&(this.model.properties.zoomScale=300),this.model.properties.zoomScale=this.model.properties.zoomScale/100,this.__on__(a.Events.ZOOM_MODE_DID_CHANGE,this._zoomModeChanged),this.__on__(a.Events.PAGE_DID_CHANGE,this._onPageDidChange),this},_onPageDidChange:function(a,b){this._isPartialZoomOpen()&&this.close()},_zoomModeChanged:function(a){a?this.model.properties.visible===!0&&this.$el.parent().hide():this.model.properties.visible===!0&&this.$el.parent().show()},_windowResize:function(b){var c=this._context();this.$modal.find(".modal-dialog").css("maxWidth",c.modalSize.width+"px"),this.$modal.find(".partial-zoom-body").css("height",c.modalSize.height+"px");var d=this.$modal.find(".partial-page-container"),e=this.$modal.find("section"),f=e.find('.toast-ctrl[data-index="'+this.viewController.index+'"]');0!==f.length&&(e.css("width",this.context.pageSize.width*c.zoomScale+"px"),e.css("height",this.context.pageSize.height*c.zoomScale+"px"),d.css("top",-(this.context.position.top*c.zoomScale)+"px"),d.css("left",-(this.context.position.left*c.zoomScale)+"px"),TT.Book.fitPage(this.viewController.index+1),a.send(a.Events.PARTIAL_ZOOM_SCALE_DID_CHANGE,this.viewController.contentScale))},open:function(){a.BookZoom.isActivate()||this._isPartialZoomOpen()||(a.Book.$getBook().turn("stop"),a.Book.enableAction(!1),this.$parent.is(":visible")&&this.$parent.attr("data-pz-visible",!0),this.$parent.show(),this._showModal(),this._setPage(),this.$parent.hide(),$(window).on("resize",$.proxy(this._windowResize,this)))},_context:function(){this.context||(this.context={}),this._padding||(this._padding=0);var a={width:$(window).width()-2*this._padding,height:$(window).height()-60},b=Number(this.model.properties.zoomScale);this.context.bounds||(this.context.bounds={width:this.$parent[0].getBoundingClientRect().width,height:this.$parent[0].getBoundingClientRect().height});var c=this.context.bounds,d={width:this.model.get("width")*Number(this.model.properties.zoomScale),height:this.model.get("height")*Number(this.model.properties.zoomScale)},e=Math.min(a.width,a.height),f=Math.min(c.width,c.height);b=e/f;var g={};return g.width=Math.min(d.width,c.width*b),g.width=Math.min(a.width,g.width),g.height=Math.min(d.height,c.height*b),g.height=Math.min(a.height,g.height),f=Math.max(g.width,g.height),b=f/Math.max(c.width,c.height),g.width=c.width*b,g.height=c.height*b,this.context.modalSize=g,this.context.zoomScale=b,this.context},_isPartialZoomOpen:function(){return 0!==$(document.body).find(".partial-zoom-modal").length},_showModal:function(){var b={modalClassName:"partial-zoom-modal"},c=Mustache.render(a.ThemeLoader.getHTMLTemplates().PopupModal,b);this.$modal=$(c),this._padding=this.$modal.find(".modal-content").attr("data-padding");var d=this._context();this.$modal.find(".modal-dialog").css({maxWidth:d.modalSize.width+"px"});var e=$("<div />",{"class":"partial-zoom-body"});e.css({height:d.modalSize.height+"px"}),this.$modal.find(".modal-body").append(e),$(document.body).append(this.$modal),this.$modal.find(".close").on("click",$.proxy(this.close,this))},_setPage:function(){var b=TT.Book.getCurrentPage(),c=$("<div />",{"class":"partial-page-container"});c.css({position:"relative",width:"100%",height:"100%"}),_.any(b,function(b){"SECTION"!==b[0].tagName&&(b=b.find("section"));var d=b.find('.toast-ctrl[data-index="'+this.viewController.index+'"]');if(0!==d.length){var e=this._context();e.pageSize||(this.context.pageSize={width:d.width(),height:d.height()}),e.position||(this.context.position={top:this.$el.parent().position().top,left:this.$el.parent().position().left});var f=$("<section />");f.css("width",d.width()*e.zoomScale+"px"),f.css("height",d.height()*e.zoomScale+"px"),c.css("top",-(this.$el.parent().position().top*e.zoomScale)+"px"),c.css("left",-(this.$el.parent().position().left*e.zoomScale)+"px");var g=d.clone();return d.before(g),f.append(d),c.append(f),TT.Book.fitPage(this.viewController.index+1),this.$modal.find(".partial-zoom-body").append(c),a.send(a.Events.PARTIAL_ZOOM_SCALE_DID_CHANGE,this.viewController.contentScale),!0}},this)},close:function(){this._unsetPage(),this._dismissModal(),"true"===this.$parent.attr("data-pz-visible")&&this.$parent.show(),this.$parent.removeAttr("data-pz-visible"),$(window).off("resize",$.proxy(this._windowResize,this)),a.send(a.Events.PARTIAL_ZOOM_SCALE_DID_CHANGE,this.viewController.contentScale),a.Book.enableAction(!0),this.context&&delete this.context},_dismissModal:function(){this.$modal.find(".close").off("click",$.proxy(this.close,this)),this.$modal.remove()},_unsetPage:function(){var a=this.$modal.find(".partial-zoom-body").children(".partial-page-container").children(),b=a.children(),c=TT.Book.$getBook().find('.toast-ctrl[data-index="'+this.viewController.index+'"]');c.before(b),TT.Book.fitPage(this.viewController.index+1),c.remove()},events:{click:"handleClick"},handleClick:function(a){this.viewController.$el.hasClass("editor")||this.open()}}),a.UIPartialZoom=d}),define("toast/views/UIFlash",["../core","./UIView","../utils/StringUtils"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{label:"Flash",style:{backgroundColor:"#ddd"},properties:function(){return[{name:"FlashProperty",label:" ",properties:[{label:"",name:"asset",control:{type:"file",allowMultipleSelection:!1,assetType:"flash",placeholder:"  "}},{label:" ",name:"url",control:{type:"text",placeholder:"http://"}}]}]},initialize:function(a){this.style=_.extend({},d.style,this.style),this.mergeProperties(d,this),d.initialize.call(this,a)},present:function(){d.present.call(this),this.$el.css("pointer-events","none"),this.preview={};var a=$("<img />",{"class":"center-icon"});return a.attr("src","assets/images/flash-icon.png"),this.preview.$centerIcon=a,this.$parent.append(this.preview.$centerIcon),this},update:function(){this._resetStyle();var a,b,c,d;a=this.$parent.width(),b=this.$parent.height(),c=this.preview.$centerIcon.width(),d=this.preview.$centerIcon.height();var e=Math.min(a,b)-5;return(a>c||b>d)&&(e=Math.min(80,e)-5),this.preview.$centerIcon.css({width:e+"px",height:e+"px"}),this},isEmpty:function(){return _.isEmpty(this.model.properties.asset)},_swfLoadEvent:function(a){if(!a.success||!a.ref)return!1;var b=this,c=setInterval(function(){if("undefined"!=typeof a.ref.PercentLoaded&&a.ref.PercentLoaded()){clearInterval(c);var d=setInterval(function(){100===a.ref.PercentLoaded()&&(b._swfDidLoaded(),clearInterval(d))},5)}},5)},_swfDidLoaded:function(){this.$preloader.hide(),this.$el=this.$parent.children(),this.$el.css("backgroundColor","transparent")},render:function(){if(d.render.call(this),!a.isMobileDevice){this.cid=this.model.get("id")+"-flash",this.$el.attr("id",this.cid),this.$preloader=$("<div />",{"class":"preloader preloader-md"}),this.$preloader.append($("<span />",{"class":"fa-spin"})),this.$parent.append(this.$preloader),this.$preloader.show();var b;if(_.isUndefined(this.model.properties.asset)||_.isEmpty(this.model.properties.asset)?_.isUndefined(this.model.properties.url)||_.isEmpty(this.model.properties.url)||(b=this.model.properties.url,"http:"!==this.model.properties.url.protocol()&&"https"!==this.model.properties.url.protocol()&&(b="http://"+this.model.properties.url)):b=a.FlashAssets.url(this.model.properties.asset),b){var c={},e={wmode:"transparent",scale:"exactFit",allowScriptAccess:"always"},f={};swfobject.embedSWF(b,this.cid,"100%","100%","9",!1,c,e,f,$.proxy(this._swfLoadEvent,this))}return this}}}),a.UIFlash=e}),define("toast/views/UIContainer",["../core","./UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Container",container:!0,style:{},initialize:function(a){c.initialize.call(this,a),this.renderViewController()},renderViewController:function(){var a=new tt.ViewController({el:this.$el});a.parentViewController=this.viewController,a.index=this.viewController.index,a.load(this.model.toJSON(),{showLoader:!0,readyonly:!0}),a.isLoaded=!0,tt.Book.fitPage(a),this.containerViewController=a,this.style.backgroundColor="";var b=this.containerViewController.collection.attributes.background.color;return _.isUndefined(b)||(this.style.backgroundColor=b),this.$el.css(this.style),this.$el.addClass("toast-container"),this},present:function(){if(c.present.call(this),!this._$overlay){var a=$("<div />",{"class":"toast-object-overlay"});this.$el.parent().append(a),this._$overlay=a}return this},render:function(){return c.render.call(this),this},remove:function(){this.containerViewController.reset(),c.remove.call(this)}}),a.UIContainer=d}),define("toast/views/UIScrollContainer",["../core","./UIContainer"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Scroll Container",style:{},initialize:function(a){c.initialize.call(this,a)},present:function(){return c.present.call(this),this},render:function(){return c.render.call(this),this}}),a.UIScrollContainer=d}),define("toast/views/UIDragLineConnector",["../core","./UIView","../utils/ImageUtils"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{label:"DragLineConnector",useAction:!0,useAnimation:!0,properties:function(){return[{name:"DragLineConnector",label:"  ",properties:[{label:" ",name:"dlc_normalImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:" ",name:"dlc_handleImage",control:{type:"file",allowMultipleSelection:!1,assetType:"image",placeholder:"  "}},{label:" ",name:"dlc_lineWidth",value:10,control:{type:"spinedit",width:55,step:1,max:1e4,min:1,numberOfDecimals:0}},{label:" ",name:"dlc_lineColor",value:"#e10000",control:{type:"color"}}]}]},propertyDefaultValues:function(){return[{name:"draggable",value:!0,hidden:!0}]},initialize:function(a){this.style=_.extend({},d.style,this.style),this.mergeProperties(d,this),this.model.states=_.extend(this.model.states,this.states(),d.states()),d.initialize.call(this,a)},present:function(){return d.present.call(this),this._setImage(),this},states:function(){return[{value:"",readonly:!0},{value:"",readonly:!0}]},_setImage:function(){var b;if(_.isEmpty(this.model.properties.dlc_handleImage)?_.isEmpty(this.model.properties.dlc_normalImage)||(b=this.model.properties.dlc_normalImage):b=this.model.properties.dlc_handleImage,b){var c=a.ImageAssets.url(b);this.$el.css("backgroundImage",'url("'+c+'")')}else this.style.backgroundImage="",this.$el.css("backgroundImage","")},update:function(b,e){if(b||(b={}),e||(e={}),d.update.call(this,e),this._setImage(),_.isEmpty(b)||"dlc_normalImage"!==b.name||"dlc_handleImage"!==b.name)return!0;var f;switch(b.name){case"dlc_normalImage":this.model.properties.dlc_handleImage||(f=b.value);break;case"dlc_handleImage":f=b.value?b.value:this.model.properties.dlc_normalImage}if(f){var g=this,h=a.ImageAssets.url(f);c.getImageSize(h).done(function(a,b){var c=a/b;g.model.height=parseInt(g.model.width/c),g.$parent.css({width:g.model.width+"px",height:g.model.height+"px"}),g.$el.css("backgroundImage",'url("'+h+'")'),g.model.topParent().set("isModified",!1),g._setBorder()})}else this.model.properties.dlc_normalImage&&this.model.properties.dlc_handleImage&&(this.$el.css("backgroundImage",""),this.model.topParent().set("isModified",!1),this._setBorder());return!1},_hasVisibility:function(){return _.isEmpty(this.model.properties.dlc_normalImage)&&_.isEmpty(this.model.properties.dlc_handleImage)?!1:!0},render:function(){if(d.render.call(this),this.model.properties.dlc_handleImage){var b=a.ImageAssets.url(this.model.properties.dlc_handleImage);this.$el.css("backgroundImage",'url("'+b+'")')}var c={left:parseInt(this.$parent[0].style.left),top:parseInt(this.$parent[0].style.top),width:parseInt(this.$parent[0].style.width),height:parseInt(this.$parent[0].style.height)};return this._orgRect=c,this._$line=$("<div />",{"class":"line"}),this._$line.css({position:"absolute",left:c.left+(c.width-this.model.properties.dlc_lineWidth)/2,top:c.top+(c.height-this.model.properties.dlc_lineWidth)/2,width:this.model.properties.dlc_lineWidth,height:this.model.properties.dlc_lineWidth,backgroundColor:this.model.properties.dlc_lineColor}),this.$parent.before(this._$line),this._$normalImage=$("<img />",{src:a.ImageAssets.url(this.model.properties.dlc_normalImage)}),this._$normalImage.css({position:"absolute",left:c.left,top:c.top,width:c.width,height:c.height}),this.$parent.before(this._$normalImage),this._$ghost=$("<div />",{id:this.$parent.attr("id")}),this._$ghost.css({position:"absolute",left:c.left,top:c.top,width:c.width,height:c.height,cursor:"pointer"}),this.$parent.before(this._$ghost),this._$ghost.drag("start",$.proxy(this._onGhostDragStart,this),{distance:1,drop:!0}),this._$ghost.drag("drag",$.proxy(this._onGhostDrag,this)),this._$ghost.drag("end",$.proxy(this._onGhostDragEnd,this)),this},reset:function(){d.reset.call(this),this._resetDrag()},_onDragStart:function(a,b){d._onDragStart.call(this,a,b)},_onDrag:function(a,b){d._onDrag.call(this,a,b),this._draw()},_onDragEnd:function(a,b){d._onDragEnd.call(this,a,b),this._dragEndHandler()},_onDrop:function(a,b){var c=d._onDrop.call(this,a,b);if(c){var e=$(b.drag),f=e.attr("id");TT.$el.data(this.model.id+"-drop",f)}return c},onAnimationComplete:function(a){_.each(a,function(a){return a.view===this?(this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null),!1):void 0},this)},_onGhostDragStart:function(a,b){d._onDragStart.call(this,a,b),this._resetDrag()},_onGhostDrag:function(a,b){d._onDrag.call(this,a,b);var c={left:parseInt(this._$ghost[0].style.left),top:parseInt(this._$ghost[0].style.top),width:parseInt(this._$ghost[0].style.width),height:parseInt(this._$ghost[0].style.height)};this.$parent.css(c),this._draw()},_onGhostDragEnd:function(a,b){this._dragEndHandler(),this._$ghost.css(this._orgRect),d._onDragEnd.call(this,a,b)},_dragEndHandler:function(){this._update()},onDropAccept:function(){d.onDropAccept.call(this),this.state(this.states()[0].value)},onDropReject:function(){d.onDropReject.call(this),this.state(this.states()[1].value)},_update:function(){this._intervalId&&clearInterval(this._intervalId);var a=this;this._intervalId=setInterval(function(){a._draw()},10)},_resetDrag:function(a){this.$parent.css(this._orgRect),this._draw()},_draw:function(){var a=this._$normalImage[0].getBoundingClientRect(),b=this.$parent[0].getBoundingClientRect(),c=([a.left,a.top],Math.sqrt(Math.pow(b.top-a.top,2)+Math.pow(b.left-a.left,2))),d=Math.atan2(b.top-a.top,b.left-a.left);this._$line.css({width:c/this.viewController.contentScale,transform:"rotate("+d+"rad)",transformOrigin:this.model.properties.dlc_lineWidth/2+"px 50% 0px"}),TT.$el.data(this.model.id+"-angle",d)}}),a.UIDragLineConnector=e}),define("toast/views/UITextInput",["../core","./UIView","i18n!nls/strings"],function(a,b,c){"use strict";var d=b.prototype,e=Backbone.View.extend();return _.extend(e.prototype,d,{tagName:"input",className:"form-control",style:{color:"#999",fontSize:"20px",padding:"10px"},textEditable:!0,attributes:{type:"text"},useAction:!1,defineProperties:[{name:"TextInputProperty",label:" ",properties:[{label:" ",name:"placeholder",value:"",control:{type:"text",placeholder:"   "}},{label:"",name:"padding",control:{type:"spinedit",placeholder:"   "}}]}],initialize:function(a){this.style=_.extend({},d.style,this.style),this.defineProperties=_.union(d.defineProperties,this.defineProperties),_.isUndefined(this.model.properties.placeholder)&&(this.model.properties.placeholder=c.TEXT_INPUT_PLACEHOLDER),_.isUndefined(this.model.properties.padding)?this.model.properties.padding=parseInt(this.style.padding):this.style.padding=this.model.properties.padding+"px",d.initialize.call(this,a)},present:function(){return d.present.call(this),this.attr("readonly",!0),this._update(),this},_update:function(a){this.minsize.width=2*this.model.properties.padding,this.minsize.height=2*this.model.properties.padding,this._setVal(),this.model.get("width")<Number(parseFloat(this.css("width")).toFixed(1))&&this.$parent.css("width",this.css("width")),this.model.get("height")<Number(parseFloat(this.css("height")).toFixed(1))&&this.$parent.css("height",this.css("height")),this.css("pointer-events","none")},update:function(a){this.style.padding=this.model.properties.padding+"px",d.update.call(this),this._update();var b=this.model.properties.placeholder;return this.$el.val(""),TT.lazy(function(){this.$el.val(b)},0,this),this},_setVal:function(){_.isUndefined(this.model.properties.placeholder)&&_.isEmpty(this.model.properties.placeholder)?this.$el.val(c.TEXT_INPUT_PLACEHOLDER):this.$el.val(this.model.properties.placeholder)},render:function(){d.render.call(this),this.__storageId=a.director.config.publishUniqueId+"-"+this.$parent.attr("id");var b=a.LocalStorage.getItem(this.__storageId);return _.isNull(b)||_.isEmpty(b)?this._setVal():this.$el.val(b),this},events:{focus:"_onFocus",focusout:"_onFocusOut",change:"_onChange"},_onFocus:function(){var b=a.LocalStorage.getItem(this.__storageId);(_.isNull(b)||_.isEmpty(b))&&this.$el.val("")},_onFocusOut:function(){_.isEmpty(this.$el.val())&&this._setVal()},_onChange:function(b){a.LocalStorage.setItem(this.__storageId,this.$el.val())}}),a.UITextInput=e}),define("toast/views/UITextInputBox",["../core","./UITextInput","i18n!nls/strings"],function(a,b,c){"use strict";var d=b.prototype,e=Backbone.View.extend();return _.extend(e.prototype,d,{tagName:"textarea",style:{color:"#999",fontSize:"28px",padding:"10px"},initialize:function(a){this.style=_.extend({},d.style,this.style),d.initialize.call(this,a)}}),a.UITextInputBox=e}),define("toast/views",["./core","./views/UIGroup","./views/UIButton","./views/UILabel","./views/UILink","./views/UIImage","./views/UIImageSlide","./views/UIIcon","./views/UIText","./views/UIShape","./views/UILine","./views/UICheckBox","./views/UIRadioButton","./views/UITooltip","./views/UIMessage","./views/UIMemo","./views/UIMoviePlayer","./views/UIYoutubePlayer","./views/UIAudioPlayer","./views/UIIFrame","./views/UIPartialZoom","./views/UIFlash","./views/UIContainer","./views/UIScrollContainer","./views/UIDragLineConnector","./views/UITextInput","./views/UITextInputBox"],function(a){}),define("toast/core/Factory",["../core","../views"],function(Toast){"use strict";var Factory={create:function(viewController,model,$parent,doRender){var View=eval("Toast.UI"+model.get("viewType")),viewInstance=new View({viewController:viewController,model:model,$parent:$parent,doRender:doRender,__events__:[]});return doRender?viewInstance.render():viewInstance.present(),viewInstance},has:function(viewType){var Factory=eval("Toast.UI"+viewType);return"function"!=typeof Factory?!1:!0}};return Toast.Factory=Factory}),define("toast/core/ViewController",["../core","./Model","./Contents","./Factory"],function(a,b,c,d){"use strict";function e(){return{id:"page-b16aea9c-d10f",title:"untitled",width:595,height:845,background:{url:"",width:0,height:0,color:"#fff"},thumbnail:{width:70,height:100,src:""},config:{},_doc:{},contents:[],subpages:[]}}function f(){return{id:"toast-object-"+TT.UUID6(),label:"",viewType:"View",__parent__:null,__children__:[],__extra__:{},left:0,top:0,width:100,height:100,rotate:0,rotatable:!0,properties:{},style:{},actions:[],animations:[],states:[],selected:!1,locked:!1,hidden:!1,draggable:!0,isModified:!1}}var g=["viewSelector"],h=Backbone.View.extend({collection:null,viewSelector:".toast-object",promises:[],xhrs:[],backgroundImages:[],contentScale:1,initialize:function(a){a||(a={}),_.extend(this,_.pick(a,g)),this.viewClassName=this.viewSelector.replace(/\./g,""),this.collection=new c(null,{attributes:e(),model:b.extend({defaults:f})}),this.model=this.collection},viewScale:function(){var a=this.$el.css("-webkit-transform")||this.$el.css("-moz-transform")||this.$el.css("-ms-transform")||this.$el.css("-o-transform")||"";return(a=a.match("matrix\\((.*)\\)"))?(a=a[1].split(","),parseFloat(a[0])):1},_create:function(a){if(void 0!==a.isBackground)return this.updateBackground(),!1;if(a.__parent__)return!1;this.$el.find("#"+a.get("id")).remove();var b=this.__createElement(a);return this.$contents.append(b),0!=a.rotate&&b.tt_rotate(a.rotate),a.view=d.create(this,a,b,!0),!0},__createElement:function(a){return $("<div />",{"class":this.viewClassName}).attr("id",a.get("id")).css({left:a.get("left"),top:a.get("top"),width:a.get("width"),height:a.get("height")})},__removeElement:function(a){this.$el.find("#"+a.get("id")).remove()},find:function(a,b,c){arguments.length<3&&(c=!1);var d=null;return _.find(this.collection.models,function(e){if(e.get(a)==b)return d=e,!0;if(c&&e.hasChildren()){var f=[];if(e.hasChildren()?this.findChildren(f,e.__children__,a,b):!_.isEmpty(e.contents)&&e.view&&this.findChildren(f,e.view.containerViewController.collection.models),f.length>0)return d=f[0],!0}},this),d},finds:function(a,b,c){var d=[];return arguments.length<3&&(c=!0),this.collection.each(function(e){e.get(a)==b&&d.push(e),c&&(e.hasChildren()?this.findChildren(d,e.__children__,a,b):!_.isEmpty(e.contents)&&e.view&&this.findChildren(d,e.view.containerViewController.collection.models,a,b))},this),d},findChildren:function(a,b,c,d){_.each(b,function(b){return b.isBackground?!0:(c?b.get(c)==d&&a.push(b):a.push(b),void(b.hasChildren()?this.findChildren(a,b.__children__,c,d):!_.isEmpty(b.contents)&&b.view&&this.findChildren(a,b.view.containerViewController.collection.models)))},this)},findAll:function(){var a=[];return _.each(this.collection.models,function(b){return b.isBackground?!0:(a.push(b),void(b.hasChildren()?this.findChildren(a,b.__children__):!_.isEmpty(b.contents)&&b.view&&this.findChildren(a,b.view.containerViewController.collection.models)))},this),a},findProperty:function(a,b){var c=[];_.isUndefined(a.properties)||c.push(a.properties),_.each(a.actions,function(a){c.push(a.properties)}),_.each(c,function(a){_.each(Object.keys(a),function(c){var d=a[c];if(_.isEmpty(d))return!0;if(_.isArray(d))_.each(d,function(a,e){var f=b(a,c);_.isUndefined(f)||(d[e]=f)});else{var e=b(d,c);_.isUndefined(e)||(a[c]=e)}})})},findSubpage:function(a){return _.find(this.model.subpages.models,{id:a})},updateBackground:function(b){b||(b={});var c=this.collection.attributes;if(this.$el.css({width:c.width,height:c.height,backgroundColor:c.background.color}),this.__removeBackground__(),this.__removeHtmlPageDocument__(),_.isEmpty(c.background.url)&&_.isEmpty(c._doc.url))return(new $.Deferred).resolve().promise();var d=new $.Deferred,e=d.promise();if(e.$defer=d,this.promises.push(e),!a.isMobileDevice||_.isUndefined(c.config.mobile)||_.isEmpty(c.config.mobile.url))if("html"==c._doc.type){var f=_tt.StringUtils.replaceTemplate(c._doc.url,"ASSETS_DIR",__app__.paths.assets);this.__asyncLoadHtmlPageDocument__(f).always(function(){d.resolve()})}else{var g,f=_tt.StringUtils.replaceTemplate(c.background.url,"ASSETS_DIR",__app__.paths.assets);"svg"!==c._doc.type||_.isEmpty(c._doc.url)||(g=_tt.StringUtils.replaceTemplate(c._doc.url,"ASSETS_DIR",__app__.paths.assets)),this.__asyncLoadBackground__(f,g,c.width,c.height,b.refresh).always(function(){d.resolve()}.bind(this))}else{var f=_tt.StringUtils.replaceTemplate(c.config.mobile.url,"MOBILE_PAGE_DIR",a.StringUtils.templateStrings.MOBILE_PAGE_DIR);this.__asyncLoadBackground__(f,null,c.width,c.height).always(function(){d.resolve()})}return e},__asyncLoadBackground__:function(b,c,d,e,f){var g=new $.Deferred;d||(d=this.collection.attributes.width),e||(e=this.collection.attributes.height);var h=(new Date).getTime();f&&(b+="?timestamp="+h,_.isEmpty(c)||(c+="?timestamp="+h));var i=this,j=new Image;return j.onload=function(){if(i.$el.css("backgroundRepeat","no-repeat"),_.isEmpty(c)){var d=$("<img />",{"class":"background",src:b,border:0});a.config.brokenPageCorrection===!0?d.css({width:"100.2%",height:"100.2%"}):d.css({width:"100%",height:"100%"}),d.mousedown(function(a){a.preventDefault()}),i.$el.prepend(d),g.resolve()}else{var e=new Image;e.onload=function(){i.$el.css("backgroundImage",'url("'+j.src+'")');var b=$("<img />",{"class":"background svg-background","data-url":e.src,width:"100%",height:"100%",border:0});a._msieVersion<10&&a.Book._isFlipTransition?b[0].src=e.src:(b[0].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",b.css("backgroundSize","100% 100%"),b.css("backgroundRepeat","no-repeat"),b.css("backgroundPosition","50% 50%"),b.css("backgroundImage",'url("'+e.src+'")')),b.mousedown(function(a){a.preventDefault()}),i.$el.css("backgroundSize","100.4% 100.4%"),i.$el.prepend(b),g.resolve()},e.onerror=function(){g.resolve()},i.backgroundImages.push(e),e.src=c}},j.onerror=function(){g.resolve()},i.backgroundImages.push(j),j.src=b,g.promise()},__removeBackground__:function(){_.each(this.backgroundImages,function(a){a.src=""}),this.backgroundImages=[],this.$el.children(".background").remove(),this.$el.css("backgroundImage",""),this.$el.css("backgroundSize",""),this.$el.css("backgroundRepeat",""),this.$el.css("backgroundPosition","")},__asyncLoadHtmlPageDocument__:function(a){var b=new $.Deferred,c=this.collection.attributes._doc.url.split("/")[0];c=c.replace("{ASSETS_DIR}",""),a||(a=_tt.StringUtils.replaceTemplate(this.collection.attributes._doc.url,"ASSETS_DIR",__app__.paths.assets)),a=_tt.StringUtils.encodeFilePath(a);var d=this,e=$.ajax({type:"GET",url:a,dataType:"html",success:function(a){if(d.$htmlPageDocument=$(a),d.$htmlPageDocument.hasClass("pf")){d.$htmlPageDocument.addClass("pdf2html"),d.$htmlPage=d.$htmlPageDocument;var e=d.$htmlPageDocument.children().children().first();if(e.hasClass("bi")){var f=e.attr("src");e.attr("src",__app__.paths.assets+c+"/"+f),e.mousedown(function(a){a.preventDefault()})}}else d.$htmlPage=d.$htmlPageDocument.children().first().parent(),d.$htmlPage.addClass("html-page");d.$contents?d.$contents.prepend(d.$htmlPageDocument):d.$el&&d.$el.prepend(d.$htmlPageDocument),d.__stopEmbeddedContent__(),b.resolve()},error:function(a,c,d){b.resolve()}});return this.xhrs.push(e),b.promise()},__removeHtmlPageDocument__:function(){this.$htmlPage&&(this.$htmlPage.find("*").off(),this.$htmlPage=null),this.$htmlPageDocument&&(this.$htmlPageDocument.remove(),this.$htmlPageDocument=null)},__hasBackgroundImage__:function(){if(this.$el.first().hasClass("background"))return!0;var a=this.$el.css("backgroundImage");return _.isUndefined(a)||_.isEmpty(a)||"none"===a?!1:!0},load:function(a,b){var c={showLoader:!1,readyonly:!1};if(b||(b={}),b=_.extend(c,b),this.reset(),this.collection.load(a,{silent:!0}),b.readyonly&&(this.$contents=$("<div />",{"class":"contents"}),this.$el.append(this.$contents)),b.showLoader===!0){var d=this.$el.parent().children(".loader");0===d.length&&(d=$("<div />",{"class":"loader"}),this.$el.parent().append(d))}var e=new this.collection.model({isBackground:!0});e.set("width",_.clone(this.collection.attr("width"))),e.set("height",_.clone(this.collection.attr("height"))),e.set("background",_.clone(this.collection.attr("background"))),e.defineProperty("background"),this.collection.add(e,{at:0,silent:!0}),e.set("thumbnail",_.clone(this.collection.attr("thumbnail"))),e.defineProperty("thumbnail"),e.set("_doc",_.clone(this.collection.attr("_doc"))),e.defineProperty("_doc"),_.each(this.collection.models,function(a){this._create(a)},this),__app__.activeEditor||_.each(this.collection.models,function(a){a.isBackground||(a.view.viewsDidMount(this),this.__setChangeState__(a.view.actions.changeState,a,"action"),this.__setChangeState__(a.view.animations.changeState,a,"animation"))},this),_.isEmpty(this.promises)&&this.$el.parent().children(".loader").remove(),this.ready()},__setChangeState__:function(a,b,c){var d;d="action"===c?!1:!0,_.each(a,function(a){var e;e=d?a.model._.properties:a.properties;var f=e.stateTargets;f||(f=[b.id]);var g=[];_.each(f,function(a){var b=_.find(this.collection.models,{id:a});b&&g.push(b)},this),_.each(g,function(b){b.__changeState__||(b.__changeState__={}),b.__changeState__[c]||(b.__changeState__[c]={states:e.states,condition:e.condition,instances:[],models:g}),b.__changeState__[c].instances.push(a)},this)},this)},reset:function(){_.each(this.xhrs,function(a){!_.isUndefined(a)&&_.isFunction(a.abort)&&a.abort()},this),this.xhrs=[],_.each(this.promises,function(a){!_.isUndefined(a.$defer)&&_.isFunction(a.$defer.reject)&&a.$defer.reject()},this),this.promises=[],this.__removeBackground__(),this.__removeHtmlPageDocument__();var a=this.findAll();_.each(a,function(a){a.view&&a.view.remove()},this),this.$contents&&this.$contents.children().remove(),this.$el.children().remove(),this._$ready=new $.Deferred,this.collection=new c(null,{attributes:e(),model:b.extend({defaults:f})}),this.model=this.collection,this.collection.on("add",this._onCreate,this),this.collection.on("change",this._onChange,this),this.collection.on("remove",this._onRemove,this)},output:function(a){var b=this.collection.attributes;return b.contents=this.collection.output(),b.contents.splice(0,1),a?JSON.stringify(b,null,4):b},ready:function(a){this._$ready||(this._$ready=new $.Deferred),a&&this._$ready.promise().done(a),this._$ready.ok=_.isEmpty(this.promises),this._$ready.ok===!0?this._$ready.resolve():TT.Async.waitForAll(this.promises).then(function(){this._$ready.ok=!0,this.promises=[],this.$el.parent().children(".loader").remove(),this._$ready.resolve()}.bind(this))},topParentViewController:function(){var a=this.parentViewController;if(!a)return null;for(;;){if(!a.parentViewController)break;a=a.parentViewController}return a}});return h.getDefaultAttributes=e,a.ViewController=h}),define("toast/core/book/BookCommon",["require","exports","module"],function(a,b,c){"use strict";var d={has3d:null,vendor:"",PI:Math.PI,A90:Math.PI/2,isTouch:"ontouchstart"in window,events:"ontouchstart"in window?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},corners:{backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br"]},displays:["single","double"],turnOptions:{page:1,cover:!0,gradients:!0,duration:600,acceleration:!0,display:"double",when:null},flipOptions:{folding:null,corners:"forward",cornerSize:100,gradients:!0,duration:600,acceleration:!0},pagesInDOM:6,pagePosition:{0:{top:0,left:0,right:"auto",bottom:"auto"},1:{top:0,right:0,left:"auto",bottom:"auto"}},divAtt:function(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden","z-index":c||"auto"}}},bezier:function(a,b,c,e,f){var g=1-f,h=g*g*g,i=f*f*f;return d.point2D(Math.round(h*a.x+3*f*g*g*b.x+3*f*f*g*c.x+i*e.x),Math.round(h*a.y+3*f*g*g*b.y+3*f*f*g*c.y+i*e.y))},rad:function(a){return a/180*d.PI},deg:function(a){return a/d.PI*180},point2D:function(a,b){return{x:a,y:b}},translate:function(a,b,c){return d.has3d&&c?" translate3d("+a+"px,"+b+"px, 0px) ":" translate("+a+"px, "+b+"px) "},rotate:function(a){return" rotate("+a+"deg) "},has:function(a,b){return Object.prototype.hasOwnProperty.call(b,a)},getPrefix:function(){
var a=["Moz","Webkit","Khtml","O","ms"],b=a.length;for(d.vendor="";b--;)a[b]+"Transform"in document.body.style&&(d.vendor="-"+a[b].toLowerCase()+"-");return d.vendor},gradient:function(a,b,c,e,f){var g,h=[];if(a.addClass("gradient"),"-webkit-"==this.vendor){for(g=0;f>g;g++)h.push("color-stop("+e[g][0]+", "+e[g][1]+")");a.css({"background-image":"-webkit-gradient(linear, "+b.x+"% "+b.y+"%,  "+c.x+"% "+c.y+"%, "+h.join(",")+" )"})}else{b={x:b.x/100*a.width(),y:b.y/100*a.height()},c={x:c.x/100*a.width(),y:c.y/100*a.height()};var i=c.x-b.x,j=c.y-b.y,k=Math.atan2(j,i),l=k-Math.PI/2,m=Math.abs(a.width()*Math.sin(l))+Math.abs(a.height()*Math.cos(l)),n=Math.sqrt(j*j+i*i),o=d.point2D(c.x<b.x?a.width():0,c.y<b.y?a.height():0),p=Math.tan(k),q=-1/p,r=(q*o.x-o.y-p*b.x+b.y)/(q-p),s={x:r,y:q*r-q*o.x+o.y},t=Math.sqrt(Math.pow(s.x-b.x,2)+Math.pow(s.y-b.y,2));for(g=0;f>g;g++)h.push(" "+e[g][1]+" "+100*(t+n*e[g][0])/m+"%");a.css({"background-image":this.vendor+"linear-gradient("+-k+"rad,"+h.join(",")+")"})}},distanceBetween:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)}};return $.isTouch=d.isTouch,d}),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&ya&&d-e===0,g=b&(Aa|Ba)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===ya||f.eventType===Aa)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ba&&(i>xa||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Ca:ma(a)>=ma(b)?a>0?Da:Ea:b>0?Fa:Ga}function I(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],La)-J(a[1],a[0],La)}function L(a,b){return I(b[0],b[1],La)/I(a[0],a[1],La)}function M(){this.evEl=Na,this.evWin=Oa,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Ra,this.evWin=Sa,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ua,this.evWin=Va,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Aa|Ba)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Xa,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(ya|za)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===ya)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Aa|Ba)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bb))return bb;var b=q(a,cb),c=q(a,db);return b&&c?cb+" "+db:b||c?b?cb:db:q(a,ab)?ab:_a}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=eb,this.simultaneous={},this.requireFail=[]}function W(a){return a&jb?"cancel":a&hb?"end":a&gb?"move":a&fb?"start":""}function X(a){return a==Ga?"down":a==Fa?"up":a==Da?"left":a==Ea?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="pen",va="mouse",wa="kinect",xa=25,ya=1,za=2,Aa=4,Ba=8,Ca=1,Da=2,Ea=4,Fa=8,Ga=16,Ha=Da|Ea,Ia=Fa|Ga,Ja=Ha|Ia,Ka=["x","y"],La=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ma={mousedown:ya,mousemove:za,mouseup:Aa},Na="mousedown",Oa="mousemove mouseup";j(M,y,{handler:function(a){var b=Ma[a.type];b&ya&&0===a.button&&(this.pressed=!0),b&za&&1!==a.which&&(b=Aa),this.pressed&&this.allow&&(b&Aa&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:va,srcEvent:a}))}});var Pa={pointerdown:ya,pointermove:za,pointerup:Aa,pointercancel:Ba,pointerout:Ba},Qa={2:ta,3:ua,4:va,5:wa},Ra="pointerdown",Sa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ra="MSPointerDown",Sa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Pa[d],f=Qa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&ya&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Aa|Ba)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ta={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Ua="touchstart",Va="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ta[a.type];if(b===ya&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Aa|Ba)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Wa={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Xa="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Wa[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==va;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Aa|Ba)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ya=v(ja.style,"touchAction"),Za=Ya!==d,$a="compute",_a="auto",ab="manipulation",bb="none",cb="pan-x",db="pan-y";T.prototype={set:function(a){a==$a&&(a=this.compute()),Za&&(this.manager.element.style[Ya]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){return},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var eb=1,fb=2,gb=4,hb=8,ib=hb,jb=16,kb=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;hb>d&&b(!0),b(),d>=hb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kb|eb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ib|jb|kb)&&(this.state=eb),this.state=this.process(b),void(this.state&(fb|gb|hb|jb)&&this.tryEmit(b))):(this.reset(),void(this.state=kb))},process:function(a){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fb|gb),e=this.attrTest(a);return d&&(c&Ba||!e)?b|jb:d||e?c&Aa?b|hb:b&fb?b|gb:fb:kb}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ja},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ha&&b.push(db),a&Ia&&b.push(cb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ha?(e=0===f?Ca:0>f?Da:Ea,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ca:0>g?Fa:Ga,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fb||!(this.state&fb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Aa|Ba)&&!f)this.reset();else if(a.eventType&ya)this.reset(),this._timer=e(function(){this.state=ib,this.tryEmit()},b.time,this);else if(a.eventType&Aa)return ib;return kb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ib&&(a&&a.eventType&Aa?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fb)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ha|Ia,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ha|Ia)?b=a.velocity:c&Ha?b=a.velocityX:c&Ia&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&Aa},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ab]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&ya&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Aa)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ib,this.tryEmit()},b.interval,this),fb):ib}return kb},failTimeout:function(){return this._timer=e(function(){this.state=kb},this.options.interval,this),kb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ib&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:$a,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Ha}],[$,{direction:Ha},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lb=1,mb=2;fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mb:lb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ib)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fb|gb|hb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:ya,INPUT_MOVE:za,INPUT_END:Aa,INPUT_CANCEL:Ba,STATE_POSSIBLE:eb,STATE_BEGAN:fb,STATE_CHANGED:gb,STATE_ENDED:hb,STATE_RECOGNIZED:ib,STATE_CANCELLED:jb,STATE_FAILED:kb,DIRECTION_NONE:Ca,DIRECTION_LEFT:Da,DIRECTION_RIGHT:Ea,DIRECTION_UP:Fa,DIRECTION_DOWN:Ga,DIRECTION_HORIZONTAL:Ha,DIRECTION_VERTICAL:Ia,DIRECTION_ALL:Ja,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==ka&&define.amd?define("toast/libs/hammer",[],function(){return ea}):"undefined"!=typeof module&&module.exports?module.exports=ea:a[c]=ea}(window,document,"Hammer"),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("toast/libs/Spinner",b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width;if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h}),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("Viewer requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a){return Oa.call(a).slice(8,-1).toLowerCase()}function d(a){return"string"==typeof a}function e(a){return"number"==typeof a&&!isNaN(a)}function f(a){return"undefined"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){var b,c;if(!g(a))return!1;try{return b=a.constructor,c=b.prototype,b&&c&&Pa.call(c,"isPrototypeOf")}catch(d){return!1}}function i(a){return"function"===c(a)}function j(a){return Array.isArray?Array.isArray(a):"array"===c(a)}function k(a,b){return b=b>=0?b:0,Array.from?Array.from(a).slice(b):Qa.call(a,b)}function l(a,b){var c=-1;return b.indexOf?b.indexOf(a):(n(b,function(b,d){return b===a?(c=d,!1):void 0}),c)}function m(a){return d(a)&&(a=a.trim?a.trim():a.replace(Fa,"1")),a}function n(a,b){var c,d;if(a&&i(b))if(j(a)||e(a.length))for(d=0,c=a.length;c>d&&b.call(a,a[d],d,a)!==!1;d++);else if(g(a))for(d in a)if(a.hasOwnProperty(d)&&b.call(a,a[d],d,a)===!1)break;return a}function o(a){var b;if(arguments.length>1){if(b=k(arguments),Object.assign)return Object.assign.apply(Object,b);b.shift(),n(b,function(b){n(b,function(b,c){a[c]=b})})}return a}function p(a,b){var c=k(arguments,2);return function(){return a.apply(b,c.concat(k(arguments)))}}function q(a,b){var c=a.style;n(b,function(a,b){Da.test(b)&&e(a)&&(a+="px"),c[b]=a})}function r(b){return a.getComputedStyle?a.getComputedStyle(b,null):b.currentStyle}function s(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function t(a,b){var c;if(b){if(e(a.length))return n(a,function(a){t(a,b)});if(a.classList)return a.classList.add(b);c=m(a.className),c?c.indexOf(b)<0&&(a.className=c+" "+b):a.className=b}}function u(a,b){return b?e(a.length)?n(a,function(a){u(a,b)}):a.classList?a.classList.remove(b):void(a.className.indexOf(b)>=0&&(a.className=a.className.replace(b,""))):void 0}function v(a,b,c){return e(a.length)?n(a,function(a){v(a,b,c)}):void(c?t(a,b):u(a,b))}function w(a){return a.replace(Ea,"$1-$2").toLowerCase()}function x(a,b){return g(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+w(b))}function y(a,b,c){g(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+w(b),c)}function z(a,b){g(a[b])?delete a[b]:a.dataset?delete a.dataset[b]:a.removeAttribute("data-"+w(b))}function A(a,b,c,d){var e=m(b).split(Ga),f=c;return e.length>1?n(e,function(b){A(a,b,c)}):(d&&(c=function(){return B(a,b,c),f.apply(a,arguments)}),void(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)))}function B(a,b,c){var d=m(b).split(Ga);return d.length>1?n(d,function(b){B(a,b,c)}):void(a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c))}function C(a,b,c){var d;return a.dispatchEvent?(i(U)&&i(CustomEvent)?d=f(c)?new U(b,{bubbles:!0,cancelable:!0}):new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):f(c)?(d=T.createEvent("Event"),d.initEvent(b,!0,!0)):(d=T.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)):a.fireEvent?a.fireEvent("on"+b):void 0}function D(a){a.preventDefault?a.preventDefault():a.returnValue=!1}function E(b){var c,d=b||a.event;return d.target||(d.target=d.srcElement||T),e(d.pageX)||(c=T.documentElement,d.pageX=d.clientX+(a.scrollX||c&&c.scrollLeft||0)-(c&&c.clientLeft||0),d.pageY=d.clientY+(a.scrollY||c&&c.scrollTop||0)-(c&&c.clientTop||0)),d}function F(b){var c=T.documentElement,d=b.getBoundingClientRect();return{left:d.left+(a.scrollX||c&&c.scrollLeft||0)-(c&&c.clientLeft||0),top:d.top+(a.scrollY||c&&c.scrollTop||0)-(c&&c.clientTop||0)}}function G(a){var b=a.length,c=0,d=0;return b&&(n(a,function(a){c+=a.pageX,d+=a.pageY}),c/=b,d/=b),{pageX:c,pageY:d}}function H(a,b){return a.getElementsByTagName(b)}function I(a,b){return a.getElementsByClassName?a.getElementsByClassName(b):a.querySelectorAll("."+b)}function J(a,b){return b.length?n(b,function(b){J(a,b)}):void a.appendChild(b)}function K(a){a.parentNode&&a.parentNode.removeChild(a)}function L(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function M(a,b){f(a.textContent)?a.innerText=b:a.textContent=b}function N(a){return a.offsetWidth}function O(a){return d(a)?a.replace(/^.*\//,"").replace(/[\?&#].*$/,""):""}function P(a,b){var c;return a.naturalWidth?b(a.naturalWidth,a.naturalHeight):(c=T.createElement("img"),c.onload=function(){b(this.width,this.height)},void(c.src=a.src))}function Q(a){var b=[],c=a.rotate,d=a.scaleX,f=a.scaleY;return e(c)&&b.push("rotate("+c+"deg)"),e(d)&&b.push("scaleX("+d+")"),e(f)&&b.push("scaleY("+f+")"),b.length?b.join(" "):"none"}function R(a){switch(a){case 2:return aa;case 3:return ba;case 4:return ca}}function S(a,b){var c=this;c.element=a,c.options=o({},S.DEFAULTS,h(b)&&b),c.isImg=!1,c.isBuilt=!1,c.isShown=!1,c.isViewed=!1,c.isFulled=!1,c.isPlayed=!1,c.wheeling=!1,c.playing=!1,c.fading=!1,c.tooltiping=!1,c.transitioning=!1,c.action=!1,c.target=!1,c.timeout=!1,c.index=0,c.length=0,c.init()}var T=a.document,U=a.Event,V="viewer",W=V+"-fixed",X=V+"-open",Y=V+"-show",Z=V+"-hide",aa="viewer-hide-xs-down",ba="viewer-hide-sm-down",ca="viewer-hide-md-down",da=V+"-fade",ea=V+"-in",fa=V+"-move",ga=V+"-active",ha=V+"-invisible",ia=V+"-transition",ja=V+"-fullscreen",ka=V+"-fullscreen-exit",la=V+"-close",ma="mousedown touchstart pointerdown MSPointerDown",na="mousemove touchmove pointermove MSPointerMove",oa="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",pa="wheel mousewheel DOMMouseScroll",qa="transitionend",ra="load",sa="keydown",ta="click",ua="resize",va="ready",wa="show",xa="shown",ya="hide",za="hidden",Aa="view",Ba="viewed",Ca="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",Da=/^(width|height|left|top|marginLeft|marginTop)$/,Ea=/([a-z\d])([A-Z])/g,Fa=/^\s+(.*)\s+$/,Ga=/\s+/,Ha="undefined"!=typeof T.createElement(V).style.transition,Ia=Math.min,Ja=Math.max,Ka=Math.abs,La=Math.sqrt,Ma=Math.round,Na=Object.prototype,Oa=Na.toString,Pa=Na.hasOwnProperty,Qa=Array.prototype.slice;S.prototype={constructor:S,init:function(){var b=this,c=b.options,d=b.element,e="img"===d.tagName.toLowerCase(),f=e?[d]:H(d,"img"),g=f.length,h=p(b.ready,b);S.TEMPLATE=Toast.ThemeLoader.getHTMLTemplates().ImageViewer,x(d,V)||(y(d,V,b),g&&(i(c.ready)&&A(d,va,c.ready,!0),Ha||(c.transition=!1),b.isImg=e,b.length=g,b.count=0,b.images=f,b.body=T.body,b.scrollbarWidth=a.innerWidth-T.body.clientWidth,c.inline?(A(d,va,function(){b.view()},!0),n(f,function(a){a.complete?h():A(a,ra,h,!0)})):A(d,ta,b._start=p(b.start,b)),A(T,Ca,b._changeFullScreen=p(b._changeFullScreen,b))))},ready:function(){var a=this;a.count++,a.count===a.length&&a.build()},build:function(){var a,b,c,d,e,f,g,h,i,j,k,l=this,m=l.options,n=l.element;if(!l.isBuilt){if(a=T.createElement("div"),a.innerHTML=S.TEMPLATE,l.parent=b=n.parentNode,l.viewer=c=I(a,"iviewer")[0],l.viewerWindow=d=I(a,"viewer-window")[0],l.canvas=I(c,"viewer-canvas")[0],l.footer=I(c,"viewer-footer")[0],l.title=h=I(c,"viewer-title")[0],l.description=i=I(c,"viewer-description")[0],l.number=j=I(c,"viewer-number")[0],l.toolbar=f=I(c,"viewer-toolbar")[0],l.navbar=g=I(c,"viewer-navbar")[0],l.button=e=I(c,"viewer-button")[0],l.tooltipBox=I(c,"viewer-tooltip")[0],l.player=I(c,"viewer-player")[0],l.list=I(c,"viewer-list")[0],l.preloader=I(c,"preloader")[0],l.sideNavigateButtons=k=I(c,"side-navigate-buttons")[0],t(h,m.title?R(m.title):Z),t(i,m.description?R(m.description):Z),t(j,m.number&&1!==l.images.length?R(m.number):Z),t(f,m.toolbar?R(m.toolbar):Z),t(g,m.navbar?R(m.navbar):Z),m.zoomable||$(l.toolbar).addClass("hide-zoom"),1===l.images.length){var o=I(c,"viewer-prev")[0],p=I(c,"viewer-play")[0],s=I(c,"viewer-next")[0];t(o,Z),t(p,Z),t(s,Z),t(k,Z),t(l.toolbar,"viewer-one-image"),t(l.viewer,"viewer-one-image")}else if(Toast._msieVersion&&Toast._msieVersion<11){var p=I(c,"viewer-play")[0];t(p,Z),t(l.toolbar,"viewer-play-hide")}v(e,Z,!m.button),v(f.querySelector(".viewer-one-to-one"),Z,!m.zoomable),v(f.querySelectorAll('li[class*="zoom"]'),Z,!m.zoomable),v(f.querySelectorAll(".viewer-reset"),Z,!m.zoomable),m.inline?(t(e,ja),q(c,{zIndex:m.zIndexInline}),"static"===r(b).position&&q(b,{position:"relative"})):(t(e,la),t(c,W),t(c,da),t(c,Z),q(c,{zIndex:m.zIndex})),_.isEmpty(m.backgroundColor)||q(c,{backgroundColor:m.backgroundColor}),_.isEmpty(m.toolbarColor)||q(l.footer,{backgroundColor:m.toolbarColor}),b.insertBefore(c,n.nextSibling),m.inline&&(l.render(),l.bind(),l.isShown=!0),$(l.title).html(m.title),$(l.description).html(m.description),l.isBuilt=!0,C(n,va)}},unbuild:function(){var a=this;a.isBuilt&&(a.isBuilt=!1,
K(a.viewer))},bind:function(){var b=this,c=b.options,d=b.element,e=b.viewer;i(c.view)&&A(d,Aa,c.view),i(c.viewed)&&A(d,Ba,c.viewed),A(e,ta,b._click=p(b.click,b)),A(e,pa,b._wheel=p(b.wheel,b)),A(b.canvas,ma,b._mousedown=p(b.mousedown,b)),A(T,na,b._mousemove=p(b.mousemove,b)),A(T,oa,b._mouseup=p(b.mouseup,b)),A(T,sa,b._keydown=p(b.keydown,b)),A(a,ua,b._resize=p(b.resize,b))},unbind:function(){var b=this,c=b.options,d=b.element,e=b.viewer;i(c.view)&&B(d,Aa,c.view),i(c.viewed)&&B(d,Ba,c.viewed),B(e,ta,b._click),B(e,pa,b._wheel),B(b.canvas,ma,b._mousedown),B(T,na,b._mousemove),B(T,oa,b._mouseup),B(T,sa,b._keydown),B(a,ua,b._resize)},render:function(){var a=this;a.initContainer(),a.initViewer(),a.initList(),a.renderViewer()},initContainer:function(){var b=this;b.containerData={width:a.innerWidth,height:a.innerHeight}},initViewer:function(){var a,b=this,c=b.options,d=b.parent;c.inline&&(b.parentData=a={width:Ja(d.offsetWidth,c.minWidth),height:Ja(d.offsetHeight,c.minHeight)}),(b.isFulled||!a)&&(a=b.containerData),b.viewerData=o({},a)},renderViewer:function(){var a=this;a.options.inline&&!a.isFulled&&q(a.viewer,a.viewerData)},initCanvas:function(){var a=this;a.viewerCanvasData={width:$(a.viewerWindow).width(),height:$(a.viewerWindow).height()-a.footer.offsetHeight}},renderCanvas:function(){var a=this;q(a.canvas,a.viewerCanvasData)},initList:function(){var a=this,b=a.options,c=(a.element,a.list),e=[];n(a.images,function(a,c){var f=a.getAttribute("data-original-url"),g=a.alt||O(f),h=b.url;f&&(d(h)?h=a.getAttribute(h):i(h)&&(h=h.call(a,a)),e.push('<li><img src="'+f+'" data-action="view" data-index="'+c+'" data-original-url="'+(h||f)+'" alt="'+g+'"></li>'))}),c.innerHTML=e.join(""),q(c,{opacity:0}),n(H(c,"img"),function(b){y(b,"filled",!0),A(b,ra,p(a.loadImage,a),!0)}),a.items=H(c,"li")},renderList:function(a){var b=this,c=b.options,d=a||b.index,e=b.items[d].offsetWidth||30,f=e+1,g=b.list.style;0==g.opacity?g.opacity=1:c.transition&&!s(b.list,ia)&&t(b.list,ia),q(b.list,{width:f*b.length,marginLeft:($(b.viewerWindow).width()-e)/2-f*d})},resetList:function(){var a=this;L(a.list),u(a.list,ia),q({marginLeft:0})},initImage:function(a){var b=this,c=b.options,d=b.image;P(d,function(e,f){var g,h,j,k,l,m=(b.viewerData,b.number),n=b.imageData||{},p=({width:$(b.viewerWindow).width(),height:$(b.viewerWindow).height()},e/f);b.initCanvas(),b.renderCanvas(),b.renderList(),l=Math.min(b.viewerCanvasData.width/e,b.viewerCanvasData.height/f),g=parseInt(e*l),h=parseInt(f*l),c.extractFit!==!0&&(g=Math.min(g,e),h=Math.min(h,f)),$(m).text(b.index+1+"/"+b.images.length),j={naturalWidth:e,naturalHeight:f,aspectRatio:p,ratio:l,width:g,height:h,left:(b.viewerCanvasData.width-g)/2,top:(b.viewerCanvasData.height-h)/2},k=o({},j),c.rotatable&&(j.rotate=n.rotate||0,k.rotate=0),c.scalable&&(j.scaleX=n.scaleX||1,j.scaleY=n.scaleY||1,k.scaleX=1,k.scaleY=1),b.imageData=j,b.initialImageData=k,c.minZoomRatio=Math.min(b.viewerCanvasData.width/e,b.viewerCanvasData.height/f),c.minZoomRatio=Math.min(1,c.minZoomRatio),c.minZoomRatio>.95&&c.minZoomRatio<1.05&&(c.minZoomRatio=1),c.maxZoomRatio>.95&&c.maxZoomRatio<1.05&&(c.maxZoomRatio=1),c.minZoomRatio===c.maxZoomRatio?(u(d,fa),c.zoomable&&$(b.toolbar).addClass("hide-zoom")):(t(d,fa),c.zoomable&&$(b.toolbar).removeClass("hide-zoom")),i(a)&&a()})},renderImage:function(a){var b=this,c=b.image,d=b.imageData,e=Q(d);q(c,{width:d.width,height:d.height,marginLeft:d.left,marginTop:d.top,WebkitTransform:e,msTransform:e,transform:e}),i(a)&&(b.transitioning?A(c,qa,a,!0):a())},resetImage:function(){var a=this;a.image&&(K(a.image),a.image=null)},start:function(a){var b=this,c=E(a),d=c.target;"img"===d.tagName.toLowerCase()&&(b.target=d,b.show())},click:function(a){var b=this,c=E(a),d=c.target,e=x(d,"action"),f=b.imageData;switch(e){case"mix":b.isPlayed?b.isFulled?b.exitFullscreen():b.stop():b.options.inline?b.isFulled?b.exit():b.full():b.hide();break;case"view":b.view(x(d,"index"));break;case"zoom-in":b.zoom(.1,!0);break;case"zoom-out":b.zoom(-.1,!0);break;case"one-to-one":b.toggle();break;case"reset":b.reset();break;case"prev":b.prev();break;case"play":b.play();break;case"next":b.next();break;case"rotate-left":b.rotate(-90);break;case"rotate-right":b.rotate(90);break;case"flip-horizontal":b.scaleX(-f.scaleX||-1);break;case"flip-vertical":b.scaleY(-f.scaleY||-1);break;default:b.isPlayed}},load:function(){var a=this,b=a.options,c=a.image,d=a.index,e=a.viewerData;a.timeout&&(clearTimeout(a.timeout),a.timeout=!1),u(c,ha),c.style.cssText="width:0;height:0;margin-left:"+e.width/2+"px;margin-top:"+e.height/2+"px;max-width:none!important;visibility:visible;",a.initImage(function(){b.minZoomRatio===b.maxZoomRatio?u(c,fa):v(c,fa,b.movable),t(c,da),a.renderImage(function(){$(a.preloader).is(":visible")&&$(a.preloader).hide();var e,f;e=I(a.canvas,"btn-side-previous")[0],f=I(a.canvas,"btn-side-next")[0],d+1>=a.length?$(f).hide():$(f).show(),0>=d?$(e).hide():$(e).show(),q(a.footer,{opacity:1}),Toast.lazy(function(){v(c,ia,b.transition),t(c,ea)},0),a.isViewed=!0,C(a.element,Ba,{originalImage:a.images[d],index:d,image:c}),Toast.send(Toast.Events.IMAGEVIEWER_VIEWED,{originalImage:a.images[d],index:d,image:c})})})},loadImage:function(a){var b=E(a),c=b.target,d=c.parentNode,e=d.offsetWidth||30,f=d.offsetHeight||50,g=!!x(c,"filled");P(c,function(a,b){var d=a/b,h=e,i=f;f*d>e?g?h=f*d:i=e/d:g?i=e/d:h=f*d,q(c,{width:h,height:i,marginLeft:(e-h)/2,marginTop:(f-i)/2})})},resize:function(){var a=this;a.initContainer(),a.initViewer(),a.renderViewer(),q(a.canvas,{bottom:$(a.footer).height()+"px"}),a.isViewed&&a.initImage(function(){a.renderImage(),Toast.lazy(function(){Toast.send(Toast.Events.IMAGEVIEWER_RESIZED)},300)}),a.isPlayed&&n(H(a.player,"img"),function(b){A(b,ra,p(a.loadImage,a),!0),C(b,ra)})},wheel:function(a){var b=this,c=E(a),d=Number(b.options.zoomRatio)||.1,e=1;b.isViewed&&(D(c),b.wheeling||(b.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),c.deltaY?e=c.deltaY>0?1:-1:c.wheelDelta?e=-c.wheelDelta/120:c.detail&&(e=c.detail>0?1:-1),b.zoom(-e*d,!0,c)))},keydown:function(a){var b=this,c=E(a),d=b.options,e=c.keyCode||c.which||c.charCode;if(b.isFulled&&d.keyboard)switch(e){case 27:b.isPlayed?b.stop():d.inline?b.isFulled&&b.exit():b.hide();break;case 32:b.isPlayed&&b.stop();break;case 37:b.prev();break;case 38:D(c),b.zoom(d.zoomRatio,!0);break;case 39:b.next();break;case 40:D(c),b.zoom(-d.zoomRatio,!0);break;case 48:case 49:(c.ctrlKey||c.shiftKey)&&(D(c),b.toggle())}},mousedown:function(a){var b,c,d=this,e=d.options,f=E(a),g=e.movable?"move":!1,h=f.touches;if(d.isViewed){if(h){if(b=h.length,b>1){if(!e.zoomable||2!==b)return;c=h[1],d.startX2=c.pageX,d.startY2=c.pageY,g="zoom"}else d.isSwitchable()&&(g="switch");c=h[0]}if(g){if(Toast.isMobileDevice&&!_.isUndefined(f.target)){var i=f.target,j=x(i,"action");_.isUndefined(j)&&D(f)}else D(f);d.action=g,d.startX=c?c.pageX:f.pageX,d.startY=c?c.pageY:f.pageY}}},mousemove:function(a){var b,c,d=this,e=d.options,f=E(a),g=d.action,h=d.image,i=f.touches;if(d.isViewed){if(i){if(b=i.length,b>1){if(!e.zoomable||2!==b)return;c=i[1],d.endX2=c.pageX,d.endY2=c.pageY}c=i[0]}g&&(D(f),"move"===g&&e.transition&&s(h,ia)&&u(h,ia),d.endX=c?c.pageX:f.pageX,d.endY=c?c.pageY:f.pageY,d.change(f))}},mouseup:function(a){var b=this,c=E(a),d=b.action;if(d){if(Toast.isMobileDevice&&!_.isUndefined(c.target)){var e=c.target,f=x(e,"action");_.isUndefined(f)&&D(c)}else D(c);"move"===d&&b.options.transition&&t(b.image,ia),b.action=!1}},_isFullScreen:function(){return"undefined"!=typeof external&&"undefined"!=typeof external.isFullscreen?external.isFullscreen():T.fullscreenElement?T.fullscreenElement:T.msFullscreenElement?T.msFullscreenElement:T.mozFullScreenElement?T.mozFullScreenElement:T.webkitFullscreenElement?T.webkitFullscreenElement:void 0},_changeFullScreen:function(a){var b=this,c=b.options;b._isFullScreen()||(b.isPlayed?b.stop():c.inline?b.isFulled&&b.exit():b.hide())},show:function(){var a,b=this,c=b.options,d=b.element;return c.inline||b.transitioning?b:(b.isBuilt||b.build(),a=b.viewer,i(c.show)&&A(d,wa,c.show,!0),C(d,wa)===!1?b:(b.open(),u(a,Z),Toast.send(Toast.Events.IMAGEVIEWER_SHOW),A(d,xa,function(){b.view(b.target?l(b.target,k(b.images)):b.index),b.target=!1},!0),c.transition?(b.transitioning=!0,t(a,ia),N(a),A(a,qa,p(b.shown,b),!0),t(a,ea)):(t(a,ea),b.shown()),b))},hide:function(){var a=this,b=a.options,c=a.element,d=a.viewer;return b.inline||a.transitioning||!a.isShown?a:(i(b.hide)&&A(c,ya,b.hide,!0),C(c,ya)===!1?a:(Toast.send(Toast.Events.IMAGEVIEWER_HIDE),a.isViewed&&b.transition?(a.transitioning=!0,A(a.image,qa,function(){A(d,qa,p(a.hidden,a),!0),u(d,ea)},!0),u(a.image,ea),v(a.image,ia,b.transition)):(u(d,ea),a.hidden()),a))},view:function(a){var b,c,d,e,f,g=this,h=g.element,i=(g.title,g.canvas),j=g.tooltipBox,k=g.sideNavigateButtons;return a=Number(a)||0,!g.isShown||g.isPlayed||0>a||a>=g.length||g.isViewed&&a===g.index?g:(c=g.items[a],d=H(c,"img")[0],e=x(d,"originalUrl"),f=d.getAttribute("alt"),b=T.createElement("img"),b.src=e,b.alt=f,C(h,Aa,{originalImage:g.images[a],index:a,image:b})===!1?g:(g.image=b,g.isViewed&&u(g.items[g.index],ga),t(c,ga),g.isViewed=!1,g.index=a,g.imageData=null,L(i),J(i,b),J(i,j),J(i,k),t(b,ha),A(h,Ba,function(){var a=g.imageData;a.naturalWidth,a.naturalHeight},!0),b.complete?g.load():(A(b,ra,p(g.load,g),!0),g.timeout&&(clearTimeout(g.timeout),g.timeout=!1)),g))},prev:function(){var a=this;return a.view(Ja(a.index-1,0)),a},next:function(){var a=this;return a.view(Ia(a.index+1,a.length-1)),a},move:function(a,b){var c=this,d=c.imageData;return c.moveTo(f(a)?a:d.left+Number(a),f(b)?b:d.top+Number(b)),c},limit:function(){var a,b,c=this,d=c.imageData,e={width:d.width,height:d.height},f={width:$(c.canvas).width(),height:$(c.canvas).height()};e.width>f.width?(a=e.width-Math.abs(d.left)<f.width?f.width-e.width:Math.min(0,d.left),d.left=a):d.left=(f.width-d.width)/2,e.height>f.height?(b=e.height-Math.abs(d.top)<f.height?f.height-e.height:Math.min(0,d.top),d.top=b):d.top=(f.height-d.height)/2},moveTo:function(a,b){var c=this,d=c.imageData,g=!1;return f(b)&&(b=a),a=Number(a),b=Number(b),c.isViewed&&!c.isPlayed&&c.options.movable&&(e(a)&&(d.left=a,g=!0),e(b)&&(d.top=b,g=!0),g&&c.limit(),g&&c.renderImage()),c},zoom:function(a,b,c){var d=this,e=d.imageData;return a=Number(a),a=0>a?1/(1-a):1+a,d.zoomTo(e.width*a/e.naturalWidth,b,c),d},zoomTo:function(a,b,c,d){var f,g,h,i,j,k=this,l=k.options,m=.01,n=100,o=k.imageData;k.canvas;if(a=Ja(0,a),e(a)&&k.isViewed&&!k.isPlayed&&(d||l.zoomable)){if(d||(m=Ja(m,l.minZoomRatio),n=Ia(n,l.maxZoomRatio),a=Ia(Ja(a,m),n)),m===n)return;a>.95&&1.05>a&&(a=1),a=Math.max(a,l.minZoomRatio),f=o.naturalWidth*a,g=o.naturalHeight*a,c?(h=F(k.viewer),i=c.touches?G(c.touches):{pageX:c.pageX,pageY:c.pageY},j=F(k.viewerWindow),o.left-=(f-o.width)*((i.pageX-(h.left+j.left)-o.left)/o.width),o.top-=(g-o.height)*((i.pageY-(h.top+j.top)-o.top)/o.height)):(o.left-=(f-o.width)/2,o.top-=(g-o.height)/2),o.width=f,o.height=g,o.ratio=a,k.limit(),k.renderImage(),b&&k.tooltip(),l.zoomTo&&l.zoomTo(a,m,n),Toast.send(Toast.Events.IMAGEVIEWER_ZOOM_TO,a,m,n)}return k},rotate:function(a){var b=this;return b.rotateTo((b.imageData.rotate||0)+Number(a)),b},rotateTo:function(a){var b=this,c=b.imageData;return a=Number(a),e(a)&&b.isViewed&&!b.isPlayed&&b.options.rotatable&&(c.rotate=a,b.renderImage()),b},scale:function(a,b){var c=this,d=c.imageData,g=!1;return f(b)&&(b=a),a=Number(a),b=Number(b),c.isViewed&&!c.isPlayed&&c.options.scalable&&(e(a)&&(d.scaleX=a,g=!0),e(b)&&(d.scaleY=b,g=!0),g&&c.renderImage()),c},scaleX:function(a){var b=this;return b.scale(a,b.imageData.scaleY),b},scaleY:function(a){var b=this;return b.scale(b.imageData.scaleX,a),b},play:function(){var a,b=this,c=b.options,d=b.player,f=p(b.loadImage,b),g=[],h=0,i=0;return!b.isShown||b.isPlayed?b:(c.fullscreen&&b.requestFullscreen(),b.isPlayed=!0,t(d,Y),n(b.items,function(a,b){var e=H(a,"img")[0],j=T.createElement("img");j.src=x(e,"originalUrl"),j.alt=e.getAttribute("alt"),h++,t(j,da),v(j,ia,c.transition),s(a,ga)&&(t(j,ea),i=b),g.push(j),A(j,ra,f,!0),J(d,j)}),e(c.interval)&&c.interval>0&&(a=function(){b.playing=setTimeout(function(){u(g[i],ea),i++,i=h>i?i:0,t(g[i],ea),a()},c.interval)},h>1&&a()),b)},stop:function(){var a=this,b=a.player;return a.isPlayed?(a.options.fullscreen&&a.exitFullscreen(),a.isPlayed=!1,clearTimeout(a.playing),u(b,Y),L(b),a):a},full:function(){var a=this,b=a.options,c=a.viewer,d=a.image,e=a.list;return!a.isShown||a.isPlayed||a.isFulled||!b.inline?a:(a.isFulled=!0,a.open(),t(a.button,ka),b.transition&&(u(d,ia),u(e,ia)),t(c,W),c.setAttribute("style",""),q(c,{zIndex:b.zIndex}),a.initContainer(),a.viewerData=o({},a.containerData),a.initImage(function(){a.renderImage(function(){b.transition&&setTimeout(function(){t(d,ia),t(e,ia)},0)})}),a)},exit:function(){var a=this,b=a.options,c=a.viewer,d=a.image,e=a.list;return a.isFulled?(a.isFulled=!1,a.close(),u(a.button,ka),b.transition&&(u(d,ia),u(e,ia)),u(c,W),q(c,{zIndex:b.zIndexInline}),a.viewerData=o({},a.parentData),a.renderViewer(),a.initImage(function(){a.renderImage(function(){b.transition&&setTimeout(function(){t(d,ia),t(e,ia)},0)})}),a):a},tooltip:function(){var a=this,b=a.options,c=a.tooltipBox,d=a.imageData;return a.isViewed&&!a.isPlayed&&b.tooltip?(M(c,Ma(100*d.ratio)+"%"),a.tooltiping?clearTimeout(a.tooltiping):b.transition?(a.fading&&C(c,qa),t(c,Y),t(c,da),t(c,ia),N(c),t(c,ea)):t(c,Y),a.tooltiping=setTimeout(function(){b.transition?(A(c,qa,function(){u(c,Y),u(c,da),u(c,ia),a.fading=!1},!0),u(c,ea),a.fading=!0):u(c,Y),a.tooltiping=!1},1e3),a):a},toggle:function(){var a=this;return 1===a.imageData.ratio?a.zoomTo(a.initialImageData.ratio,!0):a.zoomTo(1,!0),a},reset:function(){var a=this;return a.isViewed&&!a.isPlayed&&(a.imageData=o({},a.initialImageData),a.renderImage(),Toast.send(Toast.Events.IMAGEVIEWER_RESET)),a},update:function(){var a,b=this,c=[];return b.isImg&&!b.element.parentNode?b.destroy():(b.length=b.images.length,b.isBuilt&&(n(b.items,function(a,d){var e=H(a,"img")[0],f=b.images[d];f?f.src!==e.src&&c.push(d):c.push(d)}),q(b.list,{width:"auto"}),b.initList(),b.isShown&&(b.length?b.isViewed&&(a=l(b.index,c),a>=0?(b.isViewed=!1,b.view(Ja(b.index-(a+1),0))):t(b.items[b.index],ga)):(b.image=null,b.isViewed=!1,b.index=0,b.imageData=null,L(b.canvas)))),b)},destroy:function(){var a=this,b=a.element;return a.options.inline?a.unbind():(a.isShown&&a.unbind(),B(b,ta,a._start)),B(T,Ca,a._changeFullScreen),a.unbuild(),z(b,V),a},open:function(){var a=this.body;t(a,X),a.style.paddingRight=this.scrollbarWidth+"px"},close:function(){var a=this.body;u(a,X),a.style.paddingRight=0},shown:function(){var a=this,b=a.options,c=a.element;a.transitioning=!1,a.isFulled=!0,a.isShown=!0,a.isVisible=!0,a.render(),a.bind(),i(b.shown)&&A(c,xa,b.shown,!0),C(c,xa),Toast.send(Toast.Events.IMAGEVIEWER_SHOWN)},hidden:function(){var a=this,b=a.options,c=a.element;a.transitioning=!1,a.isViewed=!1,a.isFulled=!1,a.isShown=!1,a.isVisible=!1,a.unbind(),a.close(),t(a.viewer,Z),a.resetList(),a.resetImage(),i(b.hidden)&&A(c,za,b.hidden,!0),C(c,za),Toast.send(Toast.Events.IMAGEVIEWER_HIDDEN),a.destroy()},requestFullscreen:function(){var a=this,b=T.documentElement;!a.isFulled||T.fullscreenElement||T.mozFullScreenElement||T.webkitFullscreenElement||T.msFullscreenElement||(b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT))},exitFullscreen:function(){var a=this;a.isFulled&&(T.exitFullscreen?T.exitFullscreen():T.msExitFullscreen?T.msExitFullscreen():T.mozCancelFullScreen?T.mozCancelFullScreen():T.webkitExitFullscreen&&T.webkitExitFullscreen())},change:function(a){var b=this,c=b.endX-b.startX,d=b.endY-b.startY;switch(b.action){case"move":b.move(c,d);break;case"zoom":b.zoom(function(a,b,c,d){var e=La(a*a+b*b),f=La(c*c+d*d);return(f-e)/e}(Ka(b.startX-b.startX2),Ka(b.startY-b.startY2),Ka(b.endX-b.endX2),Ka(b.endY-b.endY2)),!1,a),b.startX2=b.endX2,b.startY2=b.endY2;break;case"switch":b.action="switched",Ka(c)>Ka(d)&&(c>1?b.prev():-1>c&&b.next())}b.startX=b.endX,b.startY=b.endY},isSwitchable:function(){var a=this,b=a.imageData,c=a.viewerData;return b.left>=0&&b.top>=0&&b.width<=c.width&&b.height<=c.height}},S.DEFAULTS={inline:!1,button:!0,navbar:!0,title:!0,toolbar:!0,tooltip:!0,movable:!0,zoomable:!0,rotatable:!1,scalable:!0,transition:!0,fullscreen:!0,keyboard:!0,interval:5e3,minWidth:200,minHeight:100,zoomRatio:.3,minZoomRatio:.5,maxZoomRatio:1,zIndex:9998,zIndexInline:0,url:"src",backgroundColor:"transparent",toolbarColor:"transparent",number:!0,extractFit:!1,build:null,built:null,show:null,shown:null,hide:null,hidden:null,view:null,viewed:null,zoomTo:null};var Ra=a.ImageViewer;return S.noConflict=function(){return a.ImageViewer=Ra,S},S.setDefaults=function(a){o(S.DEFAULTS,a)},"function"==typeof define&&define.amd&&define("toast/libs/ImageViewer",[],function(){return S}),b||(a.ImageViewer=S),S}),function(a){"use strict";a(jQuery)}(function(a,b){"use strict";function c(b,c,d,e){for(var f=[],g=0;g<b.length;g++){var h=b[g];if(h){var i=tinycolor(h),j=i.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";j+=tinycolor.equals(c,h)?" sp-thumb-active":"";var k=i.toString(e.preferredFormat||"rgb"),l=p?"background-color:"+i.toRgbString():"filter:"+i.toFilter();f.push('<span title="'+k+'" data-color="'+i.toRgbString()+'" class="'+j+'"><span class="sp-thumb-inner" style="'+l+';" /></span>')}else{var m="sp-clear-display";f.push(a("<div />").append(a('<span data-color="" style="background-color:transparent;" class="'+m+'"></span>').attr("title",e.noColorSelectedText)).html())}}return"<div class='sp-cf "+d+"'>"+f.join("")+"</div>"}function d(){for(var a=0;a<n.length;a++)n[a]&&n[a].hide()}function e(b,c){var d=a.extend({},m,b);return d.callbacks={move:j(d.move,c),change:j(d.change,c),show:j(d.show,c),hide:j(d.hide,c),beforeShow:j(d.beforeShow,c)},d}function f(f,h){function j(){if(T.showPaletteOnly&&(T.showPalette=!0),Ka.text(T.showPaletteOnly?T.togglePaletteMoreText:T.togglePaletteLessText),T.palette){la=T.palette.slice(0),ma=a.isArray(la[0])?la:[la],na={};for(var b=0;b<ma.length;b++)for(var c=0;c<ma[b].length;c++){var d=tinycolor(ma[b][c]).toRgbString();na[d]=!0}}va.toggleClass("sp-flat",U),va.toggleClass("sp-input-disabled",!T.showInput),va.toggleClass("sp-alpha-enabled",T.showAlpha),va.toggleClass("sp-clear-enabled",Xa),va.toggleClass("sp-buttons-disabled",!T.showButtons),va.toggleClass("sp-palette-buttons-disabled",!T.togglePaletteOnly),va.toggleClass("sp-palette-disabled",!T.showPalette),va.toggleClass("sp-palette-only",T.showPaletteOnly),va.toggleClass("sp-initial-disabled",!T.showInitial),va.addClass(T.className).addClass(T.containerClassName),N()}function m(){function b(b){return b.data&&b.data.ignore?(G(a(b.target).closest(".sp-thumb-el").data("color")),J()):(G(a(b.target).closest(".sp-thumb-el").data("color")),J(),M(!0),T.hideAfterPaletteSelect&&E()),!1}if(o&&va.find("*:not(input)").attr("unselectable","on"),j(),Na&&ta.after(Oa).hide(),Xa||Ia.hide(),U)ta.after(va).hide();else{var c="parent"===T.appendTo?ta.parent():a(T.appendTo);1!==c.length&&(c=a("body")),c.append(va)}t(),Pa.bind("click.spectrum touchstart.spectrum",function(b){ua||B(),b.stopPropagation(),a(b.target).is("input")||b.preventDefault()}),(ta.is(":disabled")||T.disabled===!0)&&R(),va.click(i),Ea.change(A),Ea.bind("paste",function(){setTimeout(A,1)}),Ea.keydown(function(a){13==a.keyCode&&A()}),Ha.text(T.cancelText),Ha.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),F(),E()}),Ia.attr("title",T.clearText),Ia.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),Wa=!0,J(),U&&M(!0)}),Ja.text(T.chooseText),Ja.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),I()&&(M(!0),E())}),Ka.text(T.showPaletteOnly?T.togglePaletteMoreText:T.togglePaletteLessText),Ka.bind("click.spectrum",function(a){a.stopPropagation(),a.preventDefault(),T.showPaletteOnly=!T.showPaletteOnly,T.showPaletteOnly||U||va.css("left","-="+(wa.outerWidth(!0)+5)),j()}),k(Ca,function(a,b,c){ka=a/ea,Wa=!1,c.shiftKey&&(ka=Math.round(10*ka)/10),J()},y,z),k(za,function(a,b){ha=parseFloat(b/ca),Wa=!1,T.showAlpha||(ka=1),J()},y,z),k(xa,function(a,b,c){if(c.shiftKey){if(!ra){var d=ia*_,e=aa-ja*aa,f=Math.abs(a-d)>Math.abs(b-e);ra=f?"x":"y"}}else ra=null;var g=!ra||"x"===ra,h=!ra||"y"===ra;g&&(ia=parseFloat(a/_)),h&&(ja=parseFloat((aa-b)/aa)),Wa=!1,T.showAlpha||(ka=1),J()},y,z),Ra?(G(Ra),K(),Ua=Ta||tinycolor(Ra).format,u(Ra)):K(),U&&C();var d=o?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Fa.delegate(".sp-thumb-el",d,b),Ga.delegate(".sp-thumb-el:nth-child(1)",d,{ignore:!0},b)}function t(){if(W&&window.localStorage){try{var b=window.localStorage[W].split(",#");b.length>1&&(delete window.localStorage[W],a.each(b,function(a,b){u(b)}))}catch(c){}try{oa=window.localStorage[W].split(";")}catch(c){}}}function u(b){if(V){var c=tinycolor(b).toRgbString();if(!na[c]&&-1===a.inArray(c,oa))for(oa.push(c);oa.length>pa;)oa.shift();if(W&&window.localStorage)try{window.localStorage[W]=oa.join(";")}catch(d){}}}function v(){var a=[];if(T.showPalette)for(var b=0;b<oa.length;b++){var c=tinycolor(oa[b]).toRgbString();na[c]||a.push(oa[b])}return a.reverse().slice(0,T.maxSelectionSize)}function w(){var b=H(),d=a.map(ma,function(a,d){return c(a,b,"sp-palette-row sp-palette-row-"+d,T)});t(),oa&&d.push(c(v(),b,"sp-palette-row sp-palette-row-selection",T)),Fa.html(d.join(""))}function x(){if(T.showInitial){var a=Sa,b=H();Ga.html(c([a,b],b,"sp-palette-row-initial",T))}}function y(){(0>=aa||0>=_||0>=ca)&&N(),va.addClass(qa),ra=null,ta.trigger("dragstart.spectrum",[H()])}function z(){va.removeClass(qa),ta.trigger("dragstop.spectrum",[H()])}function A(){var a=Ea.val();if(null!==a&&""!==a||!Xa){var b=tinycolor(a);b.isValid()?(G(b),M(!0)):Ea.addClass("sp-validation-error")}else G(null),M(!0)}function B(){$?E():C()}function C(){var b=a.Event("beforeShow.spectrum");return $?void N():(ta.trigger(b,[H()]),void(Y.beforeShow(H())===!1||b.isDefaultPrevented()||(d(),$=!0,a(sa).bind("click.spectrum",D),a(window).bind("resize.spectrum",Z),Oa.addClass("sp-active"),va.removeClass("sp-hidden"),N(),K(),Sa=H(),x(),Y.show(Sa),ta.trigger("show.spectrum",[Sa]))))}function D(a){2!=a.button&&(Va?M(!0):F(),E())}function E(){$&&!U&&($=!1,a(sa).unbind("click.spectrum",D),a(window).unbind("resize.spectrum",Z),Oa.removeClass("sp-active"),va.addClass("sp-hidden"),Y.hide(H()),ta.trigger("hide.spectrum",[H()]))}function F(){G(Sa,!0)}function G(a,b){if(tinycolor.equals(a,H()))return void K();var c,d;!a&&Xa?Wa=!0:(Wa=!1,c=tinycolor(a),d=c.toHsv(),ha=d.h%360/360,ia=d.s,ja=d.v,ka=d.a),K(),c&&c.isValid()&&!b&&(Ua=Ta||c.getFormat())}function H(a){return a=a||{},Xa&&Wa?null:tinycolor.fromRatio({h:ha,s:ia,v:ja,a:Math.round(100*ka)/100},{format:a.format||Ua})}function I(){return!Ea.hasClass("sp-validation-error")}function J(){K(),Y.move(H()),ta.trigger("move.spectrum",[H()])}function K(){Ea.removeClass("sp-validation-error"),L();var a=tinycolor.fromRatio({h:ha,s:1,v:1});xa.css("background-color",a.toHexString());var b=Ua;1>ka&&(0!==ka||"name"!==b)&&("hex"===b||"hex3"===b||"hex6"===b||"name"===b)&&(b="rgb");var c=H({format:b}),d="";if(Qa.removeClass("sp-clear-display"),Qa.css("background-color","transparent"),!c&&Xa)Qa.addClass("sp-clear-display");else{var e=c.toHexString(),f=c.toRgbString();if(p||1===c.alpha?Qa.css("background-color",f):(Qa.css("background-color","transparent"),Qa.css("filter",c.toFilter())),T.showAlpha){var g=c.toRgb();g.a=0;var h=tinycolor(g).toRgbString(),i="linear-gradient(left, "+h+", "+e+")";o?Ba.css("filter",tinycolor(h).toFilter({gradientType:1},e)):(Ba.css("background","-webkit-"+i),Ba.css("background","-moz-"+i),Ba.css("background","-ms-"+i),Ba.css("background","linear-gradient(to right, "+h+", "+e+")"))}d=c.toString(b)}T.showInput&&Ea.val(d),T.showPalette&&w(),x()}function L(){var a=ia,b=ja;if(Xa&&Wa)Da.hide(),Aa.hide(),ya.hide();else{Da.show(),Aa.show(),ya.show();var c=a*_,d=aa-b*aa;c=Math.max(-ba,Math.min(_-ba,c-ba)),d=Math.max(-ba,Math.min(aa-ba,d-ba)),ya.css({top:d+"px",left:c+"px"});var e=ka*ea;Da.css({left:e-fa/2+"px"});var f=ha*ca;Aa.css({top:f-ga+"px"})}}function M(a){var b=H(),c="",d=!tinycolor.equals(b,Sa);b&&(c=b.toString(Ua),u(b)),La&&ta.val(c),a&&d&&(Y.change(b),ta.trigger("change",[b]))}function N(){_=xa.width(),aa=xa.height(),ba=ya.height(),da=za.width(),ca=za.height(),ga=Aa.height(),ea=Ca.width(),fa=Da.width(),U||(va.css("position","absolute"),T.offset?va.offset(T.offset):va.offset(g(va,Pa))),L(),T.showPalette&&w(),ta.trigger("reflow.spectrum")}function O(){ta.show(),Pa.unbind("click.spectrum touchstart.spectrum"),va.remove(),Oa.remove(),n[Ya.id]=null}function P(c,d){return c===b?a.extend({},T):d===b?T[c]:(T[c]=d,void j())}function Q(){ua=!1,ta.attr("disabled",!1),Pa.removeClass("sp-disabled")}function R(){E(),ua=!0,ta.attr("disabled",!0),Pa.addClass("sp-disabled")}function S(a){T.offset=a,N()}var T=e(h,f),U=T.flat,V=T.showSelectionPalette,W=T.localStorageKey===!1?"spectrum-"+f.id:T.localStorageKey,X=T.theme,Y=T.callbacks,Z=l(N,10),$=!1,_=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0,ha=0,ia=0,ja=0,ka=1,la=[],ma=[],na={},oa=T.selectionPalette.slice(0),pa=T.maxSelectionSize,qa="sp-dragging",ra=null,sa=f.ownerDocument,ta=(sa.body,a(f)),ua=!1,va=a(s,sa).addClass(X),wa=va.find(".sp-picker-container"),xa=va.find(".sp-color"),ya=va.find(".sp-dragger"),za=va.find(".sp-hue"),Aa=va.find(".sp-slider"),Ba=va.find(".sp-alpha-inner"),Ca=va.find(".sp-alpha"),Da=va.find(".sp-alpha-handle"),Ea=va.find(".sp-input"),Fa=va.find(".sp-palette"),Ga=va.find(".sp-initial"),Ha=va.find(".sp-cancel"),Ia=va.find(".sp-clear"),Ja=va.find(".sp-choose"),Ka=va.find(".sp-palette-toggle"),La=ta.is("input"),Ma=La&&q&&"color"===ta.attr("type"),Na=La&&!U,Oa=Na?a(r).addClass(X).addClass(T.className).addClass(T.replacerClassName):a([]),Pa=Na?Oa:ta,Qa=Oa.find(".sp-preview-inner"),Ra=T.color||La&&ta.val(),Sa=!1,Ta=T.preferredFormat,Ua=Ta,Va=!T.showButtons||T.clickoutFiresChange,Wa=!Ra,Xa=T.allowEmpty&&!Ma;m();var Ya={show:C,hide:E,toggle:B,reflow:N,option:P,enable:Q,disable:R,offset:S,set:function(a){G(a),M()},get:H,destroy:O,container:va};return Ya.id=n.push(Ya)-1,Ya}function g(b,c){var d=0,e=b.outerWidth(),f=b.outerHeight(),g=c.outerHeight(),h=b[0].ownerDocument,i=h.documentElement,j=i.clientWidth+a(h).scrollLeft(),k=i.clientHeight+a(h).scrollTop(),l=c.offset();return l.top+=g,l.left-=Math.min(l.left,l.left+e>j&&j>e?Math.abs(l.left+e-j):0),l.top-=Math.min(l.top,l.top+f>k&&k>f?Math.abs(f+g-d):d),l}function h(){}function i(a){a.stopPropagation()}function j(a,b){var c=Array.prototype.slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function k(b,c,d,e){function f(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.returnValue=!1}function g(a){if(k){if(o&&j.documentMode<9&&!a.button)return i();var d=a.originalEvent&&a.originalEvent.touches,e=d?d[0].pageX:a.pageX,g=d?d[0].pageY:a.pageY,h=Math.max(0,Math.min(e-l.left,n)),q=Math.max(0,Math.min(g-l.top,m));p&&f(a),c.apply(b,[h,q,a])}}function h(c){var e=c.which?3==c.which:2==c.button;e||k||d.apply(b,arguments)!==!1&&(k=!0,m=a(b).height(),n=a(b).width(),l=a(b).offset(),a(j).bind(q),a(j.body).addClass("sp-dragging"),p||g(c),f(c))}function i(){k&&(a(j).unbind(q),a(j.body).removeClass("sp-dragging"),e.apply(b,arguments)),k=!1}c=c||function(){},d=d||function(){},e=e||function(){};var j=document,k=!1,l={},m=0,n=0,p="ontouchstart"in window,q={};q.selectstart=f,q.dragstart=f,q["touchmove mousemove"]=g,q["touchend mouseup"]=i,a(b).bind("touchstart mousedown",h)}function l(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),(c||!d)&&(d=setTimeout(g,b))}}var m={beforeShow:h,move:h,change:h,show:h,hide:h,color:!1,flat:!1,showInput:!0,allowEmpty:!1,showButtons:!1,clickoutFiresChange:!1,showInitial:!0,showPalette:!0,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:"hex",className:"",containerClassName:"",replacerClassName:"",showAlpha:!0,theme:"sp-light",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],selectionPalette:[],disabled:!1,offset:null},n=[],o=!!/msie/i.exec(window.navigator.userAgent),p=function(){function a(a,b){return!!~(""+a).indexOf(b)}var b=document.createElement("div"),c=b.style;return c.cssText="background-color:rgba(0,0,0,.5)",a(c.backgroundColor,"rgba")||a(c.backgroundColor,"hsla")}(),q=function(){var b=a("<input type='color' value='!' />")[0];return"color"===b.type&&"!"!==b.value}(),r=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<span class='caret'></span>","</div>"].join(""),s=function(){var a="";if(o)for(var b=1;6>=b;b++)a+="<div class='sp-"+b+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",a,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),t="spectrum.id";a.fn.spectrum=function(b,c){if("string"==typeof b){var d=this,e=Array.prototype.slice.call(arguments,1);return this.each(function(){var c=n[a(this).data(t)];if(c){var f=c[b];if(!f)throw new Error("Spectrum: no such method: '"+b+"'");"get"==b?d=c.get():"container"==b?d=c.container:"option"==b?d=c.option.apply(c,e):"destroy"==b?(c.destroy(),a(this).removeData(t)):f.apply(c,e)}}),d}return this.spectrum("destroy").each(function(){var c=a.extend({},b,a(this).data()),d=f(this,c);a(this).data(t,d.id)})},a.fn.spectrum.load=!0,a.fn.spectrum.loadOpts={},
a.fn.spectrum.draggable=k,a.fn.spectrum.defaults=m,a.spectrum={},a.spectrum.localization={},a.spectrum.palettes={},a.fn.spectrum.processNativeColorInputs=function(){q||a("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function a(a){var c={r:0,g:0,b:0},e=1,g=!1,h=!1;return"string"==typeof a&&(a=G(a)),"object"==typeof a&&(a.hasOwnProperty("r")&&a.hasOwnProperty("g")&&a.hasOwnProperty("b")?(c=b(a.r,a.g,a.b),g=!0,h="%"===String(a.r).substr(-1)?"prgb":"rgb"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("v")?(a.s=D(a.s),a.v=D(a.v),c=f(a.h,a.s,a.v),g=!0,h="hsv"):a.hasOwnProperty("h")&&a.hasOwnProperty("s")&&a.hasOwnProperty("l")&&(a.s=D(a.s),a.l=D(a.l),c=d(a.h,a.s,a.l),g=!0,h="hsl"),a.hasOwnProperty("a")&&(e=a.a)),e=w(e),{ok:g,format:a.format||h,r:M(255,N(c.r,0)),g:M(255,N(c.g,0)),b:M(255,N(c.b,0)),a:e}}function b(a,b,c){return{r:255*x(a,255),g:255*x(b,255),b:255*x(c,255)}}function c(a,b,c){a=x(a,255),b=x(b,255),c=x(c,255);var d,e,f=N(a,b,c),g=M(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function d(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(a=x(a,360),b=x(b,100),c=x(c,100),0===b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function e(a,b,c){a=x(a,255),b=x(b,255),c=x(c,255);var d,e,f=N(a,b,c),g=M(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function f(a,b,c){a=6*x(a,360),b=x(b,100),c=x(c,100);var d=K.floor(a),e=a-d,f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=d%6,j=[c,g,f,f,h,c][i],k=[h,c,c,g,f,f][i],l=[f,f,h,c,c,g][i];return{r:255*j,g:255*k,b:255*l}}function g(a,b,c,d){var e=[C(L(a).toString(16)),C(L(b).toString(16)),C(L(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function h(a,b,c,d){var e=[C(E(d)),C(L(a).toString(16)),C(L(b).toString(16)),C(L(c).toString(16))];return e.join("")}function i(a,b){b=0===b?0:b||10;var c=P(a).toHsl();return c.s-=b/100,c.s=y(c.s),P(c)}function j(a,b){b=0===b?0:b||10;var c=P(a).toHsl();return c.s+=b/100,c.s=y(c.s),P(c)}function k(a){return P(a).desaturate(100)}function l(a,b){b=0===b?0:b||10;var c=P(a).toHsl();return c.l+=b/100,c.l=y(c.l),P(c)}function m(a,b){b=0===b?0:b||10;var c=P(a).toRgb();return c.r=N(0,M(255,c.r-L(255*-(b/100)))),c.g=N(0,M(255,c.g-L(255*-(b/100)))),c.b=N(0,M(255,c.b-L(255*-(b/100)))),P(c)}function n(a,b){b=0===b?0:b||10;var c=P(a).toHsl();return c.l-=b/100,c.l=y(c.l),P(c)}function o(a,b){var c=P(a).toHsl(),d=(L(c.h)+b)%360;return c.h=0>d?360+d:d,P(c)}function p(a){var b=P(a).toHsl();return b.h=(b.h+180)%360,P(b)}function q(a){var b=P(a).toHsl(),c=b.h;return[P(a),P({h:(c+120)%360,s:b.s,l:b.l}),P({h:(c+240)%360,s:b.s,l:b.l})]}function r(a){var b=P(a).toHsl(),c=b.h;return[P(a),P({h:(c+90)%360,s:b.s,l:b.l}),P({h:(c+180)%360,s:b.s,l:b.l}),P({h:(c+270)%360,s:b.s,l:b.l})]}function s(a){var b=P(a).toHsl(),c=b.h;return[P(a),P({h:(c+72)%360,s:b.s,l:b.l}),P({h:(c+216)%360,s:b.s,l:b.l})]}function t(a,b,c){b=b||6,c=c||30;var d=P(a).toHsl(),e=360/c,f=[P(a)];for(d.h=(d.h-(e*b>>1)+720)%360;--b;)d.h=(d.h+e)%360,f.push(P(d));return f}function u(a,b){b=b||6;for(var c=P(a).toHsv(),d=c.h,e=c.s,f=c.v,g=[],h=1/b;b--;)g.push(P({h:d,s:e,v:f})),f=(f+h)%1;return g}function v(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function w(a){return a=parseFloat(a),(isNaN(a)||0>a||a>1)&&(a=1),a}function x(a,b){A(a)&&(a="100%");var c=B(a);return a=M(b,N(0,parseFloat(a))),c&&(a=parseInt(a*b,10)/100),K.abs(a-b)<1e-6?1:a%b/parseFloat(b)}function y(a){return M(1,N(0,a))}function z(a){return parseInt(a,16)}function A(a){return"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)}function B(a){return"string"==typeof a&&-1!=a.indexOf("%")}function C(a){return 1==a.length?"0"+a:""+a}function D(a){return 1>=a&&(a=100*a+"%"),a}function E(a){return Math.round(255*parseFloat(a)).toString(16)}function F(a){return z(a)/255}function G(a){a=a.replace(H,"").replace(I,"").toLowerCase();var b=!1;if(Q[a])a=Q[a],b=!0;else if("transparent"==a)return{r:0,g:0,b:0,a:0,format:"name"};var c;return(c=S.rgb.exec(a))?{r:c[1],g:c[2],b:c[3]}:(c=S.rgba.exec(a))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=S.hsl.exec(a))?{h:c[1],s:c[2],l:c[3]}:(c=S.hsla.exec(a))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=S.hsv.exec(a))?{h:c[1],s:c[2],v:c[3]}:(c=S.hsva.exec(a))?{h:c[1],s:c[2],v:c[3],a:c[4]}:(c=S.hex8.exec(a))?{a:F(c[1]),r:z(c[2]),g:z(c[3]),b:z(c[4]),format:b?"name":"hex8"}:(c=S.hex6.exec(a))?{r:z(c[1]),g:z(c[2]),b:z(c[3]),format:b?"name":"hex"}:(c=S.hex3.exec(a))?{r:z(c[1]+""+c[1]),g:z(c[2]+""+c[2]),b:z(c[3]+""+c[3]),format:b?"name":"hex"}:!1}var H=/^[\s,#]+/,I=/\s+$/,J=0,K=Math,L=K.round,M=K.min,N=K.max,O=K.random,P=function T(b,c){if(b=b?b:"",c=c||{},b instanceof T)return b;if(!(this instanceof T))return new T(b,c);var d=a(b);this._originalInput=b,this._r=d.r,this._g=d.g,this._b=d.b,this._a=d.a,this._roundA=L(100*this._a)/100,this._format=c.format||d.format,this._gradientType=c.gradientType,this._r<1&&(this._r=L(this._r)),this._g<1&&(this._g=L(this._g)),this._b<1&&(this._b=L(this._b)),this._ok=d.ok,this._tc_id=J++};P.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1e3},setAlpha:function(a){return this._a=w(a),this._roundA=L(100*this._a)/100,this},toHsv:function(){var a=e(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=e(this._r,this._g,this._b),b=L(360*a.h),c=L(100*a.s),d=L(100*a.v);return 1==this._a?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHsl:function(){var a=c(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=c(this._r,this._g,this._b),b=L(360*a.h),d=L(100*a.s),e=L(100*a.l);return 1==this._a?"hsl("+b+", "+d+"%, "+e+"%)":"hsla("+b+", "+d+"%, "+e+"%, "+this._roundA+")"},toHex:function(a){return g(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(){return h(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:L(this._r),g:L(this._g),b:L(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+L(this._r)+", "+L(this._g)+", "+L(this._b)+")":"rgba("+L(this._r)+", "+L(this._g)+", "+L(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:L(100*x(this._r,255))+"%",g:L(100*x(this._g,255))+"%",b:L(100*x(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+L(100*x(this._r,255))+"%, "+L(100*x(this._g,255))+"%, "+L(100*x(this._b,255))+"%)":"rgba("+L(100*x(this._r,255))+"%, "+L(100*x(this._g,255))+"%, "+L(100*x(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:R[g(this._r,this._g,this._b,!0)]||!1},toFilter:function(a){var b="#"+h(this._r,this._g,this._b,this._a),c=b,d=this._gradientType?"GradientType = 1, ":"";if(a){var e=P(a);c=e.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+d+"startColorstr="+b+",endColorstr="+c+")"},toString:function(a){var b=!!a;a=a||this._format;var c=!1,d=this._a<1&&this._a>=0,e=!b&&d&&("hex"===a||"hex6"===a||"hex3"===a||"name"===a);return e?"name"===a&&0===this._a?this.toName():this.toRgbString():("rgb"===a&&(c=this.toRgbString()),"prgb"===a&&(c=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(c=this.toHexString()),"hex3"===a&&(c=this.toHexString(!0)),"hex8"===a&&(c=this.toHex8String()),"name"===a&&(c=this.toName()),"hsl"===a&&(c=this.toHslString()),"hsv"===a&&(c=this.toHsvString()),c||this.toHexString())},_applyModification:function(a,b){var c=a.apply(null,[this].concat([].slice.call(b)));return this._r=c._r,this._g=c._g,this._b=c._b,this.setAlpha(c._a),this},lighten:function(){return this._applyModification(l,arguments)},brighten:function(){return this._applyModification(m,arguments)},darken:function(){return this._applyModification(n,arguments)},desaturate:function(){return this._applyModification(i,arguments)},saturate:function(){return this._applyModification(j,arguments)},greyscale:function(){return this._applyModification(k,arguments)},spin:function(){return this._applyModification(o,arguments)},_applyCombination:function(a,b){return a.apply(null,[this].concat([].slice.call(b)))},analogous:function(){return this._applyCombination(t,arguments)},complement:function(){return this._applyCombination(p,arguments)},monochromatic:function(){return this._applyCombination(u,arguments)},splitcomplement:function(){return this._applyCombination(s,arguments)},triad:function(){return this._applyCombination(q,arguments)},tetrad:function(){return this._applyCombination(r,arguments)}},P.fromRatio=function(a,b){if("object"==typeof a){var c={};for(var d in a)a.hasOwnProperty(d)&&("a"===d?c[d]=a[d]:c[d]=D(a[d]));a=c}return P(a,b)},P.equals=function(a,b){return a&&b?P(a).toRgbString()==P(b).toRgbString():!1},P.random=function(){return P.fromRatio({r:O(),g:O(),b:O()})},P.mix=function(a,b,c){c=0===c?0:c||50;var d,e=P(a).toRgb(),f=P(b).toRgb(),g=c/100,h=2*g-1,i=f.a-e.a;d=h*i==-1?h:(h+i)/(1+h*i),d=(d+1)/2;var j=1-d,k={r:f.r*d+e.r*j,g:f.g*d+e.g*j,b:f.b*d+e.b*j,a:f.a*g+e.a*(1-g)};return P(k)},P.readability=function(a,b){var c=P(a),d=P(b),e=c.toRgb(),f=d.toRgb(),g=c.getBrightness(),h=d.getBrightness(),i=Math.max(e.r,f.r)-Math.min(e.r,f.r)+Math.max(e.g,f.g)-Math.min(e.g,f.g)+Math.max(e.b,f.b)-Math.min(e.b,f.b);return{brightness:Math.abs(g-h),color:i}},P.isReadable=function(a,b){var c=P.readability(a,b);return c.brightness>125&&c.color>500},P.mostReadable=function(a,b){for(var c=null,d=0,e=!1,f=0;f<b.length;f++){var g=P.readability(a,b[f]),h=g.brightness>125&&g.color>500,i=3*(g.brightness/125)+g.color/500;(h&&!e||h&&e&&i>d||!h&&!e&&i>d)&&(e=h,d=i,c=P(b[f]))}return c};var Q=P.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},R=P.hexNames=v(Q),S=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hsva:new RegExp("hsva"+e),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=P}(),a(function(){a.fn.spectrum.load&&a.fn.spectrum.processNativeColorInputs()})}),define("toast/libs/spectrum",function(){}),function(a){"function"==typeof define&&define.amd?define("toast/libs/Drager",a):a(jQuery)}(function(){"use strict";$.fn.drag=function(a,b,c){var d="string"==typeof a?a:"",e=$.isFunction(a)?a:$.isFunction(b)?b:null;return 0!==d.indexOf("drag")&&(d="drag"+d),c=(a==e?b:c)||{},e?this.bind(d,c,e):this.trigger(d)};var a=$.event,b=a.special,c=b.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!1,click:!1},datakey:"dragdata",noBubble:!0,add:function(a){var b=$.data(this,c.datakey),d=a.data||{};b.related+=1,$.each(c.defaults,function(a,c){void 0!==d[a]&&(b[a]=d[a])})},remove:function(){$.data(this,c.datakey).related-=1},setup:function(){if(!$.data(this,c.datakey)){var b=$.extend({related:0},c.defaults);$.data(this,c.datakey,b),a.add(this,"touchstart mousedown",c.init,b),this.attachEvent&&this.attachEvent("ondragstart",c.dontstart)}},teardown:function(){var b=$.data(this,c.datakey)||{};b.related||($.removeData(this,c.datakey),a.remove(this,"touchstart mousedown",c.init),c.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",c.dontstart))},init:function(d){if(!c.touched){var e,f=d.data;if(!(0!=d.which&&f.which>0&&d.which!=f.which)&&!$(d.target).is(f.not)&&(!f.handle||$(d.target).closest(f.handle,d.currentTarget).length)&&(c.touched="touchstart"==d.type?this:null,f.propagates=1,f.mousedown=this,f.interactions=[c.interaction(this,f)],f.target=d.target,f.pageX=d.pageX,f.pageY=d.pageY,f.dragging=null,e=c.hijack(d,"draginit",f),f.propagates))return e=c.flatten(e),e&&e.length&&(f.interactions=[],$.each(e,function(){f.interactions.push(c.interaction(this,f))})),f.propagates=f.interactions.length,f.drop!==!1&&b.drop&&b.drop.handler(d,f),c.textselect(!1),c.touched?a.add(c.touched,"touchmove touchend",c.handler,f):a.add(document,"mousemove mouseup",c.handler,f),!c.touched||f.live?!1:void 0}},interaction:function(a,b){var d=$(a)[b.relative?"position":"offset"]()||{top:0,left:0};return{drag:a,callback:new c.callback,droppable:[],offset:d}},handler:function(d){var e=d.data;switch(d.type){case!e.dragging&&"touchmove":d.preventDefault();case!e.dragging&&"mousemove":if(Math.pow(d.pageX-e.pageX,2)+Math.pow(d.pageY-e.pageY,2)<Math.pow(e.distance,2))break;d.target=e.target,c.hijack(d,"dragstart",e),e.propagates&&(e.dragging=!0);case"touchmove":d.preventDefault();case"mousemove":if(e.dragging){if(c.hijack(d,"drag",e),e.propagates){e.drop!==!1&&b.drop&&b.drop.handler(d,e);break}d.type="mouseup"}case"touchend":case"mouseup":default:c.touched?a.remove(c.touched,"touchmove touchend",c.handler):a.remove(document,"mousemove mouseup",c.handler),e.dragging&&(e.drop!==!1&&b.drop&&b.drop.handler(d,e),c.hijack(d,"dragend",e)),c.textselect(!0),e.click===!1&&e.dragging&&$.data(e.mousedown,"suppress.click",(new Date).getTime()+5),e.dragging=c.touched=!1}},hijack:function(b,d,e,f,g){if(e){var h,i,j,k={event:b.originalEvent,type:b.type},l=d.indexOf("drop")?"drag":"drop",m=f||0,n=isNaN(f)?e.interactions.length:f;b.type=d,b.originalEvent=null,e.results=[];do if(i=e.interactions[m]){if("dragend"!==d&&i.cancelled)continue;j=c.properties(b,e,i),i.results=[],$(g||i[l]||e.droppable).each(function(f,g){return j.target=g,b.isPropagationStopped=function(){return!1},h=g?a.dispatch.call(g,b,j):null,h===!1?("drag"==l&&(i.cancelled=!0,e.propagates-=1),"drop"==d&&(i[l][f]=null)):"dropinit"==d&&i.droppable.push(c.element(h)||g),"dragstart"==d&&(i.proxy=$(c.element(h)||i.drag)[0]),i.results.push(h),delete b.result,"dropinit"!==d?h:void 0}),e.results[m]=c.flatten(i.results),"dropinit"==d&&(i.droppable=c.flatten(i.droppable)),"dragstart"!=d||i.cancelled||j.update()}while(++m<n);return b.type=k.type,b.originalEvent=k.event,c.flatten(e.results)}},properties:function(a,b,d){var e=d.callback;return e.drag=d.drag,e.proxy=d.proxy||d.drag,e.startX=b.pageX,e.startY=b.pageY,e.deltaX=a.pageX-b.pageX,e.deltaY=a.pageY-b.pageY,e.originalX=d.offset.left,e.originalY=d.offset.top,e.offsetX=e.originalX+e.deltaX,e.offsetY=e.originalY+e.deltaY,e.drop=c.flatten((d.drop||[]).slice()),e.available=c.flatten((d.droppable||[]).slice()),e},element:function(a){return a&&(a.jquery||1==a.nodeType)?a:void 0},flatten:function(a){return $.map(a,function(a){return a&&a.jquery?$.makeArray(a):a&&a.length?c.flatten(a):a})},textselect:function(a){$(document)[a?"unbind":"bind"]("selectstart",c.dontstart).css("MozUserSelect",a?"":"none"),document.unselectable=a?"off":"on"},dontstart:function(){return!1},callback:function(){}};c.callback.prototype={update:function(){b.drop&&this.available.length&&$.each(this.available,function(a){b.drop.locate(this,a)})}};var d=a.dispatch;a.dispatch=function(a){return $.data(this,"suppress."+a.type)-(new Date).getTime()>0?void $.removeData(this,"suppress."+a.type):d.apply(this,arguments)};var e=a.fixHooks.touchstart=a.fixHooks.touchmove=a.fixHooks.touchend=a.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(a,b){if(b){var c=b.touches&&b.touches[0]||b.changedTouches&&b.changedTouches[0]||null;c&&$.each(e.props,function(b,d){a[d]=c[d]})}return a}};b.draginit=b.dragstart=b.dragend=c}),function(a){"function"==typeof define&&define.amd?define("toast/libs/Drop",a):a(jQuery)}(function(){"use strict";$.fn.drop=function(a,b,c){var d="string"==typeof a?a:"",e=$.isFunction(a)?a:$.isFunction(b)?b:null;return 0!==d.indexOf("drop")&&(d="drop"+d),c=(a==e?b:c)||{},e?this.bind(d,c,e):this.trigger(d)},$.drop=function(a){a=a||{},c.multi=a.multi===!0?1/0:a.multi===!1?1:isNaN(a.multi)?c.multi:a.multi,c.delay=a.delay||c.delay,c.tolerance=$.isFunction(a.tolerance)?a.tolerance:null===a.tolerance?null:c.tolerance,c.mode=a.mode||c.mode||"intersect",a.page&&(c.page=a.page)};var a=$.event,b=a.special,c=$.event.special.drop={page:null,multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(a){var b=$.data(this,c.datakey);b.related+=1},remove:function(){$.data(this,c.datakey).related-=1},setup:function(){if(!$.data(this,c.datakey)){var a={related:0,active:[],anyactive:0,winner:0,location:{}};$.data(this,c.datakey,a),c.targets.push(this)}},teardown:function(){var a=$.data(this,c.datakey)||{};if(!a.related){$.removeData(this,c.datakey);var b=this;c.targets=$.grep(c.targets,function(a){return a!==b})}},handler:function(a,d){var e;if(d)switch(a.type){case"mousedown":case"touchstart":e=$(c.targets),"string"==typeof d.drop&&(e=e.filter(d.drop)),e.each(function(){var a=$.data(this,c.datakey);a.active=[],a.anyactive=0,a.winner=0}),d.droppable=e,b.drag.hijack(a,"dropinit",d);break;case"mousemove":case"touchmove":c.event=a,c.timer||c.tolerate(d);break;case"mouseup":case"touchend":c.timer=clearTimeout(c.timer),d.propagates&&(b.drag.hijack(a,"drop",d),b.drag.hijack(a,"dropend",d))}},locate:function(a,b){var d=$.data(a,c.datakey),e=$(a),f=e.offset()||{},g=e.outerHeight(),h=e.outerWidth(),i={elem:a,width:h,height:g,top:f.top,left:f.left,right:f.left+h,bottom:f.top+g};return d&&(d.location=i,d.index=b,d.elem=a),i},contains:function(a,b){return(b[0]||b.left)>=a.left&&(b[0]||b.right)<=a.right&&(b[1]||b.top)>=a.top&&(b[1]||b.bottom)<=a.bottom},modes:{intersect:function(a,b,c){return this.contains(c,[a.pageX,a.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(a,b,c){var b=$(b.elem)[0].getBoundingClientRect(),c=$(c.elem)[0].getBoundingClientRect();return!(b.top+b.height<c.top||b.top>c.top+c.height||b.left+b.width<c.left||b.left>c.left+c.width)},fit:function(a,b,c){return this.contains(c,b)?1:0},middle:function(a,b,c){return this.contains(c,[b.left+.5*b.width,b.top+.5*b.height])?1:0}},sort:function(a,b){return b.winner-a.winner||a.index-b.index},tolerate:function(a){var d,e,f,g,h,i,j,k,l=0,m=a.interactions.length,n=[c.event.pageX,c.event.pageY],o=c.tolerance||c.modes[c.mode];do if(k=a.interactions[l]){if(!k)return;k.drop=[],h=[],i=k.droppable.length,o&&(f=c.locate(k.proxy)),d=0;do if(j=k.droppable[d]){if(g=$.data(j,c.datakey),e=g.location,!e)continue;g.winner=o?o.call(c,c.event,f,e):c.contains(e,n)?1:0,h.push(g)}while(++d<i);h.sort(c.sort),d=0;do(g=h[d])&&(g.winner&&k.drop.length<c.multi?(g.active[l]||g.anyactive||(b.drag.hijack(c.event,"dropstart",a,l,g.elem)[0]!==!1?(g.active[l]=1,g.anyactive+=1):g.winner=0),g.winner&&k.drop.push(g.elem)):g.active[l]&&1==g.anyactive&&(b.drag.hijack(c.event,"dropend",a,l,g.elem),g.active[l]=0,g.anyactive-=1));while(++d<i)}while(++l<m);c.last&&n[0]==c.last.pageX&&n[1]==c.last.pageY?delete c.timer:c.timer=setTimeout(function(){c.tolerate(a)},c.delay),c.last=c.event}};b.dropinit=b.dropstart=b.dropend=c}),"undefined"==typeof gj&&(gj={}),gj.widget=function(){var a=this;a.xhr=null,a.generateGUID=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},a.mouseX=function(a){if(a){if(tt.isMobile&&(a=a.originalEvent.touches[0]),a.pageX)return a.pageX;if(a.clientX)return a.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft)}return null},a.mouseY=function(a){if(a){if(tt.isMobile&&(a=a.originalEvent.touches[0]),a.pageY)return a.pageY;if(a.clientY)return a.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)}return null}},gj.widget.prototype.init=function(a,b){var c,d,e;d=$.extend(!0,{},this.getHTMLConfig()||{}),$.extend(!0,d,a||{}),e=this.getConfig(d,b),this.attr("data-guid",e.guid),this.data(e);for(c in e)gj[b].events.hasOwnProperty(c)&&(this.on(c,e[c]),delete e[c]);for(plugin in gj[b].plugins)gj[b].plugins.hasOwnProperty(plugin)&&gj[b].plugins[plugin].configure(this,e,d);return this},gj.widget.prototype.getConfig=function(a,b){var c,d,e;c=$.extend(!0,{},gj[b].config.base),d=a.uiLibrary||c.uiLibrary,gj[b].config[d]&&$.extend(!0,c,gj[b].config[d]);for(e in gj[b].plugins)gj[b].plugins.hasOwnProperty(e)&&($.extend(!0,c,gj[b].plugins[e].config.base),gj[b].plugins[e].config[d]&&$.extend(!0,c,gj[b].plugins[e].config[d]));return $.extend(!0,c,a),c.guid||(c.guid=this.generateGUID()),c},gj.widget.prototype.getHTMLConfig=function(){var a=this.data(),b=this[0].attributes;return b.width&&(a.width=b.width.nodeValue),b.height&&(a.height=b.height.nodeValue),b.align&&(a.align=b.align.nodeValue),a&&a.source&&(a.dataSource=a.source,delete a.source),a},gj.widget.prototype.createDoneHandler=function(){var a=this;return function(b){"string"==typeof b&&JSON&&(b=JSON.parse(b)),gj[a.data("type")].methods.render(a,b)}},gj.widget.prototype.createErrorHandler=function(){return function(a){a&&a.statusText&&"abort"!==a.statusText&&alert(a)}},gj.widget.prototype.reload=function(a){var b,c,d=this.data();return void 0===d.dataSource&&gj[this.data("type")].methods.useHtmlDataSource(this,d),$.extend(d.params,a),$.isArray(d.dataSource)?(c=gj[this.data("type")].methods.filter(this),gj[this.data("type")].methods.render(this,c)):"string"==typeof d.dataSource?(b={url:d.dataSource,data:d.params},this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b).done(this.createDoneHandler()).fail(this.createErrorHandler())):"object"==typeof d.dataSource&&(d.dataSource.data||(d.dataSource.data={}),$.extend(d.dataSource.data,d.params),b=$.extend(!0,{},d.dataSource),"json"===b.dataType&&"object"==typeof b.data&&(b.data=JSON.stringify(b.data)),b.success||(b.success=this.createDoneHandler()),b.error||(b.error=this.createErrorHandler()),this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b)),this},gj.documentManager={events:{},subscribeForEvent:function(a,b,c){if(gj.documentManager.events[a]&&0!==gj.documentManager.events[a].length){if(gj.documentManager.events[a][b])throw"Event "+a+" for widget with guid='"+b+"' is already attached.";gj.documentManager.events[a].push({widgetId:b,callback:c})}else gj.documentManager.events[a]=[{widgetId:b,callback:c}],$(document).on(a,gj.documentManager.executeCallbacks)},executeCallbacks:function(a){var b=gj.documentManager.events[a.type];if(b)for(var c=0;c<b.length;c++)b[c].callback(a)},unsubscribeForEvent:function(a,b){var c=!1,d=gj.documentManager.events[a];if(d){for(var e=0;e<d.length;e++)d[e].widgetId===b&&($(document).off(a,d[e].callback),d.splice(e,1),c=!0);0===d.length&&delete gj.documentManager.events[a]}if(!c)throw'The "'+a+'" for widget with guid="'+b+"\" can't be removed."}},"undefined"==typeof gj.dialog&&(gj.dialog={plugins:{},messages:[]}),gj.dialog.messages["en-us"]={Close:"Close",DefaultTitle:"Dialog"},gj.dialog.config={base:{autoOpen:!0,closeOnEscape:!0,closeButtonInHeader:!0,draggable:!0,height:"auto",locale:"en-us",minHeight:void 0,maxHeight:void 0,width:300,minWidth:void 0,maxWidth:void 0,modal:!1,resizable:!1,title:void 0,uiLibrary:void 0,style:{modal:"gj-modal",content:"gj-content",header:"gj-header",headerTitle:"gj-title gj-unselectable",headerCloseButton:"gj-close",body:"gj-body",footer:"gj-dialog-footer gj-footer"}},bootstrap:{style:{modal:"modal",content:"modal-content",header:"modal-header",headerTitle:"modal-title",headerCloseButton:"close",body:"modal-body",footer:"gj-dialog-footer modal-footer"}},jqueryui:{style:{modal:"gj-modal",content:"ui-widget ui-widget-content gj-dialog-content",header:"gj-dialog-ui-header ui-widget-header",headerTitle:"gj-dialog-ui-title",headerCloseButton:"gj-dialog-ui-close ui-button ui-widget ui-state-default ui-corner-all",body:"gj-dialog-ui-body",footer:"gj-dialog-footer"}},foundation:{style:{modal:"reveal-modal-bg",content:"reveal-modal gj-dialog-fd-content",header:"",headerTitle:"gj-dialog-fd-title gj-unselectable",headerCloseButton:"close-reveal-modal right gj-dialog-fd-close",body:"gj-dialog-fd-body",footer:"gj-dialog-footer gj-dialog-fd-footer"}},materialdesign:{style:{modal:"gj-modal",content:"mdl-dialog gj-dialog-mdl-content",header:"",headerTitle:"mdl-dialog__title gj-unselectable",headerCloseButton:"gj-dialog-mdl-close",body:"mdl-dialog__content",footer:"gj-dialog-footer"}}},gj.dialog.events={initialized:function(a){a.trigger("initialized")},opening:function(a){a.trigger("opening")},opened:function(a){a.trigger("opened")},closing:function(a){a.trigger("closing")},closed:function(a){a.trigger("closed")},drag:function(a){a.trigger("drag")},dragStart:function(a){a.trigger("dragStart")},dragStop:function(a){a.trigger("dragStop")},resize:function(a){a.trigger("resize")},resizeStart:function(a){a.trigger("resizeStart")},resizeStop:function(a){a.trigger("resizeStop")}},gj.dialog.methods={init:function(a){return this.attr("data-type","dialog"),gj.widget.prototype.init.call(this,a,"dialog"),gj.dialog.methods.localization(this),gj.dialog.methods.initialize(this),gj.dialog.events.initialized(this),this},localization:function(a){var b=a.data();"undefined"==typeof b.title&&(b.title=gj.dialog.messages[b.locale].DefaultTitle)},getHTMLConfig:function(){var a=gj.widget.prototype.getHTMLConfig.call(this),b=this[0].attributes;return b.title&&(a.title=b.title.nodeValue),a},initialize:function(a){var b,c,d=a.data();a.addClass(d.style.content),gj.dialog.methods.setSize(a),d.closeOnEscape&&$(document).keyup(function(b){27===b.keyCode&&a.close()}),c=a.children('div[data-role="body"]'),0===c.length?(c=$('<div data-role="body"/>').addClass(d.style.body),a.wrapInner(c)):c.addClass(d.style.body),b=gj.dialog.methods.renderHeader(a),a.children('div[data-role="footer"]').addClass(d.style.footer),a.find('[data-role="close"]').on("click",function(){a.close()}),d.draggable&&$.fn.draggable&&gj.dialog.methods.draggable(a,b),d.resizable&&$.fn.draggable&&gj.dialog.methods.resizable(a),gj.dialog.methods.setPosition(a),d.modal&&a.wrapAll('<div data-role="modal" class="'+d.style.modal+'"/>'),d.autoOpen&&a.open()},setSize:function(a){var b=a.data();b.width&&a.css("width",b.width),b.height&&a.css("height",b.height)},renderHeader:function(a){var b,c,d,e=a.data();return b=a.children('div[data-role="header"]'),0===b.length&&(b=$('<div data-role="header" />'),a.prepend(b)),b.addClass(e.style.header),c=b.find('[data-role="title"]'),0===c.length&&(c=$('<h4 data-role="title">'+e.title+"</h4>"),b.append(c)),c.addClass(e.style.headerTitle),d=b.find('[data-role="close"]'),0===d.length&&e.closeButtonInHeader?(d=$('<button type="button" data-role="close" title="'+gj.dialog.messages[e.locale].Close+'"><span></span></button>'),d.addClass(e.style.headerCloseButton),b.prepend(d)):d.length>0&&e.closeButtonInHeader===!1&&d.hide(),b},setPosition:function(a){var b=$(window).width()/2-a.width()/2,c=$(window).height()/2-a.height()/2;a.css("position","absolute"),a.css("left",b>0?b:0),a.css("top",c>0?c:0)},draggable:function(a,b){a.appendTo("body"),b.addClass("gj-draggable"),a.draggable({handle:b,start:function(){a.addClass("gj-unselectable"),gj.dialog.events.dragStart(a)},stop:function(){a.removeClass("gj-unselectable"),gj.dialog.events.dragStop(a)}})},resizable:function(a){var b={drag:gj.dialog.methods.resize,start:function(){a.addClass("gj-unselectable"),gj.dialog.events.resizeStart(a)},stop:function(){this.removeAttribute("style"),a.removeClass("gj-unselectable"),gj.dialog.events.resizeStop(a)}};a.append($('<div class="gj-resizable-handle gj-resizable-n"></div>').draggable($.extend(!0,{horizontal:!1},b))),a.append($('<div class="gj-resizable-handle gj-resizable-e"></div>').draggable($.extend(!0,{vertical:!1},b))),a.append($('<div class="gj-resizable-handle gj-resizable-s"></div>').draggable($.extend(!0,{horizontal:!1},b))),a.append($('<div class="gj-resizable-handle gj-resizable-w"></div>').draggable($.extend(!0,{vertical:!1},b))),a.append($('<div class="gj-resizable-handle gj-resizable-ne"></div>').draggable($.extend(!0,{},b))),a.append($('<div class="gj-resizable-handle gj-resizable-nw"></div>').draggable($.extend(!0,{},b))),a.append($('<div class="gj-resizable-handle gj-resizable-sw"></div>').draggable($.extend(!0,{},b))),a.append($('<div class="gj-resizable-handle gj-resizable-se"></div>').draggable($.extend(!0,{},b)))},resize:function(a,b){var c,d,e,f,g,h,i,j=!1;return c=$(this),d=c.parent(),e=d.data(),c.hasClass("gj-resizable-n")?(f=d.height()-b.top,h=d.offset().top+b.top):c.hasClass("gj-resizable-e")?g=d.width()+b.left:c.hasClass("gj-resizable-s")?f=d.height()+b.top:c.hasClass("gj-resizable-w")?(g=d.width()-b.left,i=d.offset().left+b.left):c.hasClass("gj-resizable-ne")?(f=d.height()-b.top,
h=d.offset().top+b.top,g=d.width()+b.left):c.hasClass("gj-resizable-nw")?(f=d.height()-b.top,h=d.offset().top+b.top,g=d.width()-b.left,i=d.offset().left+b.left):c.hasClass("gj-resizable-se")?(f=d.height()+b.top,g=d.width()+b.left):c.hasClass("gj-resizable-sw")&&(f=d.height()+b.top,g=d.width()-b.left,i=d.offset().left+b.left),f&&(!e.minHeight||f>=e.minHeight)&&(!e.maxHeight||f<=e.maxHeight)&&(d.height(f),h&&d.css("top",h),j=!0),g&&(!e.minWidth||g>=e.minWidth)&&(!e.maxWidth||g<=e.maxWidth)&&(d.width(g),i&&d.css("left",i),j=!0),j&&gj.dialog.events.resize(d),!1},open:function(a){var b;return gj.dialog.events.opening(a),a.css("display","block"),a.closest('div[data-role="modal"]').css("display","block"),b=a.children('div[data-role="footer"]'),b.length&&b.outerHeight()&&a.children('div[data-role="body"]').css("margin-bottom",b.outerHeight()),gj.dialog.events.opened(a),a},close:function(a){return a.is(":visible")&&(gj.dialog.events.closing(a),a.css("display","none"),a.closest('div[data-role="modal"]').css("display","none"),gj.dialog.events.closed(a)),a},isOpen:function(a){return a.is(":visible")}},gj.dialog.widget=function(a,b){var c=this,d=gj.dialog.methods;return c.open=function(){return d.open(this)},c.close=function(){return d.close(this)},c.isOpen=function(){return d.isOpen(this)},$.extend(a,c),"dialog"!==a.attr("data-type")&&d.init.apply(a,b),a},gj.dialog.widget.prototype=new gj.widget,gj.dialog.widget.constructor=gj.dialog.widget,gj.dialog.widget.prototype.getHTMLConfig=gj.dialog.methods.getHTMLConfig,function(a){a.fn.dialog=function(a){var b;if(this&&this.length){if("object"!=typeof a&&a){if(b=new gj.dialog.widget(this,null),b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+a+" does not exist."}return new gj.dialog.widget(this,arguments)}}}(jQuery),define("toast/libs/dialog",function(){}),"undefined"==typeof gj&&(gj={}),gj.widget=function(){var a=this;a.xhr=null,a.generateGUID=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},a.mouseX=function(a){if(a){if(tt.isMobile&&(a=a.originalEvent.touches[0]),a.pageX)return a.pageX;if(a.clientX)return a.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft)}return null},a.mouseY=function(a){if(a){if(tt.isMobile&&(a=a.originalEvent.touches[0]),a.pageY)return a.pageY;if(a.clientY)return a.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)}return null}},gj.widget.prototype.init=function(a,b){var c,d,e;d=$.extend(!0,{},this.getHTMLConfig()||{}),$.extend(!0,d,a||{}),e=this.getConfig(d,b),this.attr("data-guid",e.guid),this.data(e);for(c in e)gj[b].events.hasOwnProperty(c)&&(this.on(c,e[c]),delete e[c]);for(plugin in gj[b].plugins)gj[b].plugins.hasOwnProperty(plugin)&&gj[b].plugins[plugin].configure(this,e,d);return this},gj.widget.prototype.getConfig=function(a,b){var c,d,e;c=$.extend(!0,{},gj[b].config.base),d=a.uiLibrary||c.uiLibrary,gj[b].config[d]&&$.extend(!0,c,gj[b].config[d]);for(e in gj[b].plugins)gj[b].plugins.hasOwnProperty(e)&&($.extend(!0,c,gj[b].plugins[e].config.base),gj[b].plugins[e].config[d]&&$.extend(!0,c,gj[b].plugins[e].config[d]));return $.extend(!0,c,a),c.guid||(c.guid=this.generateGUID()),c},gj.widget.prototype.getHTMLConfig=function(){var a=this.data(),b=this[0].attributes;return b.width&&(a.width=b.width.nodeValue),b.height&&(a.height=b.height.nodeValue),b.align&&(a.align=b.align.nodeValue),a&&a.source&&(a.dataSource=a.source,delete a.source),a},gj.widget.prototype.createDoneHandler=function(){var a=this;return function(b){"string"==typeof b&&JSON&&(b=JSON.parse(b)),gj[a.data("type")].methods.render(a,b)}},gj.widget.prototype.createErrorHandler=function(){return function(a){a&&a.statusText&&"abort"!==a.statusText&&alert(a)}},gj.widget.prototype.reload=function(a){var b,c,d=this.data();return void 0===d.dataSource&&gj[this.data("type")].methods.useHtmlDataSource(this,d),$.extend(d.params,a),$.isArray(d.dataSource)?(c=gj[this.data("type")].methods.filter(this),gj[this.data("type")].methods.render(this,c)):"string"==typeof d.dataSource?(b={url:d.dataSource,data:d.params},this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b).done(this.createDoneHandler()).fail(this.createErrorHandler())):"object"==typeof d.dataSource&&(d.dataSource.data||(d.dataSource.data={}),$.extend(d.dataSource.data,d.params),b=$.extend(!0,{},d.dataSource),"json"===b.dataType&&"object"==typeof b.data&&(b.data=JSON.stringify(b.data)),b.success||(b.success=this.createDoneHandler()),b.error||(b.error=this.createErrorHandler()),this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b)),this},gj.documentManager={events:{},subscribeForEvent:function(a,b,c){if(gj.documentManager.events[a]&&0!==gj.documentManager.events[a].length){if(gj.documentManager.events[a][b])throw"Event "+a+" for widget with guid='"+b+"' is already attached.";gj.documentManager.events[a].push({widgetId:b,callback:c})}else gj.documentManager.events[a]=[{widgetId:b,callback:c}],$(document).on(a,gj.documentManager.executeCallbacks)},executeCallbacks:function(a){var b=gj.documentManager.events[a.type];if(b)for(var c=0;c<b.length;c++)b[c].callback(a)},unsubscribeForEvent:function(a,b){var c=!1,d=gj.documentManager.events[a];if(d){for(var e=0;e<d.length;e++)d[e].widgetId===b&&($(document).off(a,d[e].callback),d.splice(e,1),c=!0);0===d.length&&delete gj.documentManager.events[a]}if(!c)throw'The "'+a+'" for widget with guid="'+b+"\" can't be removed."}},"undefined"==typeof gj.draggable&&(gj.draggable={}),gj.draggable.config={base:{handle:void 0,vertical:!0,horizontal:!0}},gj.draggable.methods={init:function(a){var b,c=this;return gj.widget.prototype.init.call(this,a,"draggable"),c.attr("data-draggable","true"),b=gj.draggable.methods.getHandleElement(c),b.on(gj.draggable.events.types.start,function(a){$(a.target).hasClass(".close")||0!==$(a.target).parents(".close").length||(a.originalEvent.preventDefault(),c.attr("data-draggable-dragging",!0),c.removeAttr("data-draggable-x"),c.removeAttr("data-draggable-y"),c.css("position","absolute"))}),gj.documentManager.subscribeForEvent(gj.draggable.events.types.move,c.data("guid"),gj.draggable.methods.createMouseMoveHandler(c)),gj.documentManager.subscribeForEvent(gj.draggable.events.types.end,c.data("guid"),gj.draggable.methods.createMouseUpHandler(c)),c},getHandleElement:function(a){var b=a.data("handle");return b&&b.length?b:a},createMouseUpHandler:function(a){return function(b){"true"===a.attr("data-draggable-dragging")&&(a.attr("data-draggable-dragging",!1),gj.draggable.events.stop(a,{left:a.mouseX(b),top:a.mouseY(b)}))}},createMouseMoveHandler:function(a){return function(b){var c,d,e,f,g,h;"true"===a.attr("data-draggable-dragging")&&(c=a.mouseX(b),d=a.mouseY(b),g=a.attr("data-draggable-x"),h=a.attr("data-draggable-y"),g&&h?(e=a.data("horizontal")?c-parseInt(g,10):0,f=a.data("vertical")?d-parseInt(h,10):0,!1!==gj.draggable.events.drag(a,e,f,c,d)&&gj.draggable.methods.move(a,e,f)):gj.draggable.events.start(a),a.attr("data-draggable-x",c),a.attr("data-draggable-y",d))}},move:function(a,b,c){var d=a.get(0),e=d.style.top?parseInt(d.style.top):a.position().top,f=d.style.left?parseInt(d.style.left):a.position().left;d.style.top=e+c+"px",d.style.left=f+b+"px"},destroy:function(a){return"true"===a.attr("data-draggable")&&(gj.documentManager.unsubscribeForEvent(gj.draggable.events.types.end,a.data("guid")),gj.documentManager.unsubscribeForEvent(gj.draggable.events.types.move,a.data("guid")),a.removeData(),a.removeAttr("data-guid"),a.removeAttr("data-draggable"),a.off("drag").off("start").off("stop"),gj.draggable.methods.getHandleElement(a).off(gj.draggable.events.types.start)),a}},gj.draggable.events={types:"ontouchstart"in window?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},drag:function(a,b,c,d,e){return a.triggerHandler("drag",[{top:c,left:b},{top:e,left:d}])},start:function(a){a.triggerHandler("start")},stop:function(a,b){a.triggerHandler("stop",[b])}},gj.draggable.widget=function(a,b){var c=this,d=gj.draggable.methods;return c.destroy=function(){return d.destroy(this)},$.extend(a,c),"true"!==a.attr("data-draggable")&&d.init.apply(a,b),a},gj.draggable.widget.prototype=new gj.widget,gj.draggable.widget.constructor=gj.draggable.widget,function(a){a.fn.draggable=function(a){var b;if(this&&this.length){if("object"!=typeof a&&a){if(b=new gj.draggable.widget(this,null),b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+a+" does not exist."}return new gj.draggable.widget(this,arguments)}}}(jQuery),define("toast/libs/draggable",function(){}),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("toast/libs/Sketchpad",b):a.Spinner=b()}(this,function(){function a(a){for(var b in this.constructor.prototype)this[b]=this[b].bind(this);a.hasOwnProperty("element")&&("string"==typeof a.element?this.element=$(a.element):this.element=a.element,this.penModes={draw:0,eraser:1},this._width=a.width||this.element.attr("data-width")||0,this._height=a.height||this.element.attr("data-height")||0,this.color=a.color||this.element.attr("data-color")||"#000000",this.penSize=a.penSize||this.element.attr("data-penSize")||5,this.penMode=a.penMode||this.element.attr("data-penMode")||this.penModes.draw,this.scale=1,this.readOnly=a.readOnly||this.element.attr("data-readOnly")||!1,this.readOnly||this.element.css({cursor:"crosshair"}),this.strokes=a.strokes||[],this._currentStroke={color:null,size:null,lines:[]},this.undoHistory=a.undoHistory||[],this.animateIds=[],this._sketching=!1,this.reset())}return a.prototype._cursorPosition=function(a){return{x:(a.pageX-$(this.canvas).offset().left)/this.scale,y:(a.pageY-$(this.canvas).offset().top)/this.scale}},a.prototype._draw=function(a,b,c,d){this._stroke(a,b,c,d,"source-over")},a.prototype._erase=function(a,b,c,d){this._stroke(a,b,c,d,"destination-out")},a.prototype._stroke=function(a,b,c,d,e){this.context.save(),this.context.lineJoin="round",this.context.lineCap="round",this.context.strokeStyle=c,this.context.lineWidth=d,this.context.globalCompositeOperation=e,this.context.beginPath(),this.context.moveTo(a.x,a.y),this.context.lineTo(b.x,b.y),this.context.closePath(),this.context.stroke(),this.context.restore()},a.prototype._mouseDown=function(a){this._lastPosition=this._cursorPosition(a),this._currentStroke.color=this.color,this._currentStroke.size=this.penSize,this._currentStroke.lines=[],this._sketching=!0,document.addEventListener("mousemove",this._mouseMove)},a.prototype._mouseUp=function(a){this._sketching&&(this.strokes.push($.extend(!0,{},this._currentStroke)),this._sketching=!1),document.removeEventListener("mousemove",this._mouseMove)},a.prototype._mouseMove=function(a){var b=this._cursorPosition(a);this.penMode===this.penModes.draw?this._draw(this._lastPosition,b,this.color,this.penSize):this._erase(this._lastPosition,b,this.color,this.penSize),this._currentStroke.lines.push({start:$.extend(!0,{},this._lastPosition),end:$.extend(!0,{},b)}),this._lastPosition=b},a.prototype._touchStart=function(a){this._sketching||(a.preventDefault(),this._lastPosition=this._cursorPosition(a.changedTouches[0]),this._currentStroke.color=this.color,this._currentStroke.size=this.penSize,this._currentStroke.lines=[],this._sketching=!0,document.addEventListener("touchmove",this._touchMove,!1),TT.$el.addClass("drawing"))},a.prototype._touchEnd=function(a){this._sketching&&(a.preventDefault(),this.strokes.push($.extend(!0,{},this._currentStroke)),this._sketching=!1),document.removeEventListener("touchmove",this._touchMove),TT.$el.removeClass("drawing")},a.prototype._touchCancel=function(a){this._sketching&&(a.preventDefault(),this.strokes.push($.extend(!0,{},this._currentStroke)),this._sketching=!1),document.removeEventListener("touchmove",this._touchMove),TT.$el.removeClass("drawing")},a.prototype._touchLeave=function(a){a.preventDefault(),this._sketching&&(this.strokes.push($.extend(!0,{},this._currentStroke)),this._sketching=!1),document.removeEventListener("touchmove",this._touchMove),TT.$el.removeClass("drawing")},a.prototype._touchMove=function(a){a.preventDefault();var b=this._cursorPosition(a.changedTouches[0]);this.penMode===this.penModes.draw?this._draw(this._lastPosition,b,this.color,this.penSize):this._erase(this._lastPosition,b,this.color,this.penSize),this._currentStroke.lines.push({start:$.extend(!0,{},this._lastPosition),end:$.extend(!0,{},b)}),this._lastPosition=b},a.prototype.reset=function(){this.canvas=this.element[0],this.canvas.width=this._width,this.canvas.height=this._height,this.context=this.canvas.getContext("2d"),this.redraw(this.strokes),this.readOnly||(this.canvas.addEventListener("mousedown",this._mouseDown),document.addEventListener("mouseup",this._mouseUp),this.canvas.addEventListener("touchstart",this._touchStart),document.addEventListener("touchend",this._touchEnd))},a.prototype.drawStroke=function(a){for(var b=0;b<a.lines.length;b++){var c=a.lines[b];this._draw(c.start,c.end,a.color,a.size)}},a.prototype.redraw=function(a){for(var b=0;b<a.length;b++)this.drawStroke(a[b])},a.prototype.toObject=function(){return{width:this.canvas.width,height:this.canvas.height,strokes:this.strokes,undoHistory:this.undoHistory}},a.prototype.toJSON=function(){return JSON.stringify(this.toObject())},a.prototype.animate=function(a,b,c){this.clear();for(var d=a,e=null,f=0;f<this.strokes.length;f++)for(var g=this.strokes[f],h=0;h<g.lines.length;h++){var i=g.lines[h];e=this._draw.bind(this,i.start,i.end,g.color,g.size),this.animateIds.push(setTimeout(e,d)),d+=a}b&&(c=c||0,e=this.animate.bind(this,a,b,c),this.animateIds.push(setTimeout(e,d+c)))},a.prototype.cancelAnimation=function(){for(var a=0;a<this.animateIds.length;a++)clearTimeout(this.animateIds[a])},a.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},a.prototype.undo=function(){this.clear();var a=this.strokes.pop();a&&(this.undoHistory.push(a),this.redraw(this.strokes))},a.prototype.redo=function(){var a=this.undoHistory.pop();a&&(this.strokes.push(a),this.drawStroke(a))},a}),define("toast/libs",["./core","./libs/hammer","./libs/Spinner","./libs/ImageViewer","./libs/spectrum","./libs/Drager","./libs/Drop","./libs/dialog","./libs/draggable","./libs/Sketchpad"],function(a,b,c,d){a.Hammer=b,a.Spinner=c,a.ImageViewer=d}),define("toast/events/Events",["exports","../core"],function(a,b){"use strict";a.PROJECT_DID_LOAD="tt_projectDidLoad",a.READY_BOOK="tt_bookReady",a.BOOK_READY="tt_bookReady",a.BOOK_HTML_READY="tt_bookHtmlReady",a.LOAD_PAGE="tt_loadPage",a.PAGE_DID_LOAD="tt_pageDidLoad",a.UNLOAD_PAGE="tt_unloadPage",a.PAGE_DID_UNLOAD="tt_pageDidUnLoad",a.WILL_MOVE_PAGE="tt_willMovePage",a.PAGE_DID_CHANGE="tt_pageDidChange",a.BEFORE_SHOW_DROPDOWN_MENU="tt_beforeShowDropdownMenu",a.MEMO_DID_CHANGE="tt_memoDidChange",a.SLIDE_DID_LOAD_COMPLETE="tt_slideDidLoadComplete",a.BOOKMARK_DID_CHANGE="tt_bookmarkDidChanged",a.ZOOM_MODE_DID_CHANGE="tt_zoomModeDidChanged",a.ZOOM_SCALE_DID_CHANGE="tt_zoomScaleDidChanged",a.PARTIAL_ZOOM_SCALE_DID_CHANGE="tt_partialZoomScaleDidChanged",a.THEME_DID_LOAD="tt_themeDidLoad",a.THEME_DID_UNLOAD="tt_themeDidUnload",a.BEGIN_SEARCH_MODE="tt_beginSearchMode",a.END_SEARCH_MODE="tt_endSearchMode",a.AUTOSLIDE_DID_RESUME="tt_autoSlideDidResume",a.AUTOSLIDE_DID_PAUSE="tt_autoSlideDidPause",a.ORIENTATION_DID_CHANGE="tt_orientationDidChange",a.START_MENU_DID_LOAD="tt_startmenuDidLoad",a.READY_AUTOPLAY_FOR_MOBILE="tt_readyAutoplayForMobile",a.DOUBLEPAGE_DID_CHANGE="tt_doublePageDidChange",a.START_PAGE_TRANSITIONS="tt_startPageTransitions",a.STOP_ALL_SOUND="tt_stopAllSound",a.CONTENT_SCALE_DID_CHANGE="tt_contentScaleDidChange",a.IMAGEVIEWER_SHOW="tt_imageViewerShow",a.IMAGEVIEWER_SHOWN="tt_imageViewerShown",a.IMAGEVIEWER_VIEWED="tt_imageViewerViewed",a.IMAGEVIEWER_RESET="tt_imageViewerReset",a.IMAGEVIEWER_RESIZED="tt_imageViewerResized",a.IMAGEVIEWER_HIDE="tt_imageViewerHide",a.IMAGEVIEWER_HIDDEN="tt_imageViewerHidden",a.IMAGEVIEWER_ZOOM_TO="tt_imageViewerZoomTo",b.Events=_.extend({},b.Events,a)}),define("toast/events/EventDispatcher",["exports","../core"],function(a,b){"use strict";function c(a){var b=a.indexOf(".");return-1===b?{eventName:a}:{eventName:a.substring(0,b),ns:a.substring(b)}}function d(a){$.extend(a,{on:h,off:i,one:j,trigger:k,_EventDispatcher:!0})}function e(a,b,c){var d=[b].concat(c);a.trigger.apply(a,d)}function f(a,b,c){h.call(a,b,c)}function g(a,b,c){a._deprecatedEvents||(a._deprecatedEvents={}),a._deprecatedEvents[b]=c||!0}var h=function(a,b){var d,e=a.split(/\s+/).map(c);if(this._deprecatedEvents)for(d=0;d<e.length;d++){var f=this._deprecatedEvents[e[d].eventName];if(f){var g="Registering for deprecated event '"+e[d].eventName+"'.";"string"==typeof f&&(g+=" Instead, use "+f+".")}}for(d=0;d<e.length;d++){var h=e[d].eventName;this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[h]||(this._eventHandlers[h]=[]),e[d].handler=b,this._eventHandlers[h].push(e[d])}return this},i=function(a,b){if(!this._eventHandlers)return this;var d,e=a.split(/\s+/).map(c),f=function(a,c){var d,e=this._eventHandlers[c];if(e){for(d=e.length-1;d>=0;d--)if(!a.ns||a.ns===e[d].ns){var f=e[d].handler;b&&b!==f&&b._eventOnceWrapper!==f||e.splice(d,1)}e.length||delete this._eventHandlers[c]}}.bind(this),g=function(a){a.eventName?f(a,a.eventName):_.forEach(this._eventHandlers,function(b,c){f(a,c)})}.bind(this);for(d=0;d<e.length;d++)g(e[d]);return this},j=function(a,b){return b._eventOnceWrapper||(b._eventOnceWrapper=function(a){a.target.off(a.type,b._eventOnceWrapper),b.apply(this,arguments)}),this.on(a,b._eventOnceWrapper)},k=function(a){var b,c={type:a,target:this},d=this._eventHandlers&&this._eventHandlers[a];if(d){d=d.slice();var e=Array.prototype.slice.call(arguments,1);for(e.unshift(c),b=0;b<d.length;b++)try{d[b].handler.apply(null,e)}catch(f){}}};a.makeEventDispatcher=d,a.triggerWithArray=e,a.on_duringInit=f,a.markDeprecated=g,b.EventDispatcher=a}),define("toast/events/Commands",["exports","../core"],function(a,b){"use strict";a.TOC="toc",a.THUMBNAIL="thumbnail",a.TOGGLE_ZOOM="toggleZoom",a.SEARCH="search",a.TOGGLE_BOOKMARK="toggleBookmark",a.ADD_MEMO="addmemo",a.MY_LIBRARY="mylibrary",a.MY_STORAGE="mystorage",a.FIRST_PAGE="firstPage",a.PREVIOUS_PAGE="previousPage",a.NEXT_PAGE="nextPage",a.LAST_PAGE="lastPage",a.FULLSCREEN="fullscreen",a.TOGGLE_AUTO_SLIDE="toggleAutoSlide",a.START_AUTO_SLIDE="startAutoSlide",a.STOP_AUTO_SLIDE="stopAutoSlide",a.DOUBLE_PAGE="doublepage",a.TOGGLE_DOUBLEPAGE="toggleDoublePage",a.PRINT="print",a.SHOW_HELP="showhelp",a.CONFIG="config",a.TOGGLE_BGSOUND="toggleBgSound",a.PLAY_BGSOUND="playBgSound",a.PAUSE_BGSOUND="pauseBgSound",a.MOVE_PAGE="movePage",b.Commands=a}),define("toast/events/CommandManager",["exports","../core","./EventDispatcher"],function(a,b,c){"use strict";function d(a,b,c){this._name=a,this._id=b,this._commandFn=c,this._checked=void 0,this._enabled=!0}function e(b,c,e,f){if(k[c])return null;if(!b||!c||!e)return null;var g=new d(b,c,e);return f&&(g.userKeyBinding=!0),k[c]=g,a.trigger("commandRegistered",g),g}function f(b,c,e){if(k[b])return null;if(!b||!c)return null;var f=new d(null,b,c);return e&&(f.userKeyBinding=!0),k[b]=f,a.trigger("commandRegistered",f),f}function g(a){var b=k[a];b&&(delete k[a],k[a]=null)}function h(a){return k[a]}function i(){return Object.keys(k)}function j(b){var c=k[b];if(c){try{a.trigger("beforeExecuteCommand",b)}catch(d){}return c.execute.apply(c,Array.prototype.slice.call(arguments,1))}return(new $.Deferred).reject().promise()}var k={};c.makeEventDispatcher(d.prototype),d.prototype.getID=function(){return this._id},d.prototype.execute=function(){if(!this._enabled)return(new $.Deferred).reject().promise();var a=this._commandFn.apply(this,arguments);return a?a:(new $.Deferred).resolve().promise()},d.prototype.getEnabled=function(){return this._enabled},d.prototype.setEnabled=function(a){var b=this._enabled!==a;this._enabled=a,b&&this.trigger("enabledStateChange")},d.prototype.setChecked=function(a){var b=this._checked!==a;this._checked=a,b&&this.trigger("checkedStateChange")},d.prototype.getChecked=function(){return this._checked},d.prototype.setName=function(a){var b=this._name!==a;this._name=a,b&&this.trigger("nameChange")},d.prototype.getName=function(){return this._name},c.makeEventDispatcher(a),a.register=e,a.registerInternal=f,a.remove=g,a.execute=j,a.get=h,a.getAll=i,b.CommandManager=a}),define("toast/events",["./core","./events/KeyEvent","./events/Events","./events/EventDispatcher","./events/Commands","./events/CommandManager"],function(a,b){a.KeyEvent=b}),define("toast/core/book/BookZoom",["exports","../../core","./BookCommon","../../libs","../../events"],function(a,b,c){"use strict";function d(a){if(!ba&&!l()){if(a||(a={}),S=!0,oa={width:N.width(),height:N.height()},TT.$el.addClass("bookzoom-activate"),ba=!0,ja=!0,sa={},aa=X,i(),f(),a.pinch!==!0&&pa===!0){var c=b.LocalStorage.getItem(qa);_.isUndefined(c)||_.isNull(c)||(ca=c,ca=Math.max(ea,ca),ca=Math.min(da,ca))}else a.pinch===!0&&(ca=ea);if(ga={x:0,y:0},a.pinch!==!0){var d={x:0,y:0};if(a.tapPoint){a.tapPoint.x=(a.tapPoint.x-K.$getBook().offset().left)*ca,a.tapPoint.y=(a.tapPoint.y-K.$getBook().offset().top)*ca;var j=L.width()*ca,n=L.height()*ca,p=j/2,q=n/2;d.x=p-a.tapPoint.x,d.y=q-a.tapPoint.y,ga=d,t(),d=ga}o(ca,d),b.lazy(function(){e(),S=!1},200)}else h(),S=!1;K.$getBook().hide(),m(!0),b.Book.enableAction(!1),document.addEventListener("keyup",v),$(window).on("resize",w),N.height()!==oa.height&&g(),b.send(b.Events.ZOOM_MODE_DID_CHANGE,ba),b.send(b.Events.ZOOM_SCALE_DID_CHANGE,ca),b.on(b.Events.PAGE_DID_CHANGE,k)}}function e(){L.removeClass("animate");var a=parseFloat(L.css("marginLeft"))*ca,b=parseFloat(L.css("marginTop"))*ca;ha.left=ga.x+a,ha.top=ga.y+b,L.bookTransform(""),h()}function f(){ea=Math.min(oa.width/ra.fit.width,oa.height/ra.fit.height),b.isMobileDevice||(ea=.5*ea);var a,c;a=ra.page.width*(fa._default/100),c=ra.page.height*(fa._default/100),a+=a%2,a+=a/2%2*2,c+=c%2,b.Book.isDoublePage()&&!b.Book.isCoverPage()&&(a*=2),T=a,U=c,ca=Number(Math.max(a/b.Book.$getBook().width(),c/b.Book.$getBook().height()));var d=fa.max;_.isEmpty(sa.url)||(d=300);var e,f;e=ra.page.width*(d/100),f=ra.page.height*(d/100),e+=e%2,e+=e/2%2*2,f+=f%2,b.Book.isDoublePage()&&!b.Book.isCoverPage()&&(e*=2),V=e,W=f,da=Number(Math.max(e/b.Book.$getBook().width(),f/b.Book.$getBook().height()))}function g(){oa={width:N.width(),height:N.height()},ea=Math.min(oa.width/ra.fit.width,oa.height/ra.fit.height),b.isMobileDevice||(ea=.5*ea)}function h(a){a=_.extend({smooth:!1,fitPage:!0},a),a.smooth?L.addClass("animate"):L.removeClass("animate");var b=parseInt(ra.fit.width*ca),c=parseInt(ra.fit.height*ca);b+=b%2,b+=b/2%2*2,c+=c%2,Math.abs(T-b)<=5&&Math.abs(U-c)<=5?(b=T,c=U):Math.abs(V-b)<=5&&Math.abs(W-c)<=5&&(b=V,c=W),L.css({width:b+"px",height:c+"px",marginLeft:ha.left+"px",marginTop:ha.top+"px"}),a.fitPage&&_.each(Q,function(a){K.fitPage(a)})}function i(){L=$("<div />",{"class":"bookzoom"}),N.append(L),ra=b.Book.getBookSize(),Q=b.Book.getCurrentPageNumber(),_.each(Q,function(a){var c=TT.project.viewControllers[a-1],d=c.collection.attributes;if(sa=d._doc,ta.width<c.collection.background.width&&(ta.width=c.collection.background.width,ta.height=c.collection.background.height),b.isMobileDevice&&!_.isUndefined(d.config.mobile)&&!_.isEmpty(d.config.mobile.url))if("html"===sa.type)c.__asyncLoadHtmlPageDocument__();else{var e=_tt.StringUtils.replaceTemplate(d.background.url,"ASSETS_DIR",__app__.paths.assets);c.__asyncLoadBackgroundImage__(e)}}),!K.isCoverPage()&&K.$getBook().hasClass("doublepage")&&L.addClass("doublepage");var a=K.getCurrentPage();_.each(a,function(a){var b=$("<section />");b.attr("data-element-index",a.index()),"SECTION"!==a[0].tagName&&(a=a.find("section")),b.append(a.children()),L.append(b),ka.push(b)}),ha.left=-(ra.fit.width/2),ha.top=-(ra.fit.height/2),L.css({left:"50%",top:"50%",width:ra.fit.width+"px",height:ra.fit.height+"px",marginLeft:ha.left+"px",marginTop:ha.top+"px"}),L.tt_deselect(),P=$('<div class="bookzoom-overlay" />'),P.css({position:"absolute",left:0,top:0,width:"100%",height:"100%"}).appendTo(L)}function j(){b.isMobileDevice&&_.each(Q,function(a){var c=TT.project.viewControllers[a-1],d=c.collection.attributes;if(!_.isUndefined(d.config.mobile)&&!_.isEmpty(d.config.mobile.url))if("html"===c.collection._doc.type)c.__removeHtmlPageDocument__();else{var e=_tt.StringUtils.replaceTemplate(d.config.mobile.url,"MOBILE_PAGE_DIR",b.StringUtils.templateStrings.MOBILE_PAGE_DIR);c.__asyncLoadBackground__(e)}}),_.each(ka,function(a){var b=Number(a.attr("data-element-index")),c=K.$getBook().children().eq(b);"SECTION"===c[0].tagName?c.prepend(a.children()):c.find("section").prepend(a.children())}),K.$getBook().show(),_.each(Q,function(a){K.fitPage(a)}),L.remove(),ka=[]}function k(a){ba&&(a||(a={animate:!0}),S=!0,B(),pa===!0&&b.LocalStorage.setItem(qa,ca),$(".toast").removeClass("bookzoom-activate"),m(!1),N.tt_deselect(),$(window).off("resize",w),b.off(b.Events.PAGE_DID_CHANGE,k),document.removeEventListener("keyup",v),ba=!1,ja=!1,j(),A(),a.callback&&"function"==typeof a.callback&&a.callback(),P.remove(),b.Book.enableAction(!0),b.send(b.Events.ZOOM_MODE_DID_CHANGE,ba),b.lazy(function(){S=!1},50))}function l(){var a=!0,c=b.Book.getCurrentPageNumber();return _.any(c,function(b){var c=TT.project.viewControllers[b-1];c.isLoaded!==!0&&(a=!1)}),a!==!0?!0:!1}function m(a){b.isMobileDevice&&(N.unbind("touchstart",n),N.unbind("touchmove",n),a&&(N.bind("touchstart",n),N.bind("touchmove",n)))}function n(a){return a.preventDefault(),!1}function o(a,b){L.addClass("animate"),b||(b={x:0,y:0});var c=["translate("+b.x+"px, "+b.y+"px)","scale("+a+")"];c=c.join(" "),L[0].style.webkitTransform=c,L[0].style.mozTransform=c,L[0].style.msTransform=c,L[0].style.transform=c}function p(a){ba&&ja&&ba&&!la&&($(document).tt_deselect(),ia={x:parseFloat(L.css("marginLeft")),y:parseFloat(L.css("marginTop"))},P.addClass("grabbing"))}function q(a){ba&&ja&&ba&&!la&&(ha={left:ia.x+a.deltaX,top:ia.y+a.deltaY},aa==Y&&(ha.left=ia.x),h())}function r(a){ba&&ja&&ba&&!la&&(u(),h({smooth:!0}),P.removeClass("grabbing"))}function s(a){if(!l())if("pinchstart"==a.type)la=!0,ba||d({tapPoint:a.center,pinch:!0}),R=ca,na={x:ha.left,y:ha.top},ma={x:a.center.x-(N.offset().left+N.width()/2),y:a.center.y-(N.offset().top+N.height()/2)};else if("pinchend"==a.type)u()&&h({smooth:!0}),la=!1;else if("pinchmove"==a.type){var c=R*a.scale;if(c>=ea&&da>=c){ca=c;var e=ma.x*(c/R),f=ma.y*(c/R),g=a.center.x-$(window).width()/2,i=a.center.y-$(window).height()/2,j=na.x*(c/R),k=na.y*(c/R),m=j-e+g,n=k-f+i;ha.left=m,ha.top=n,h(),b.send(b.Events.ZOOM_SCALE_DID_CHANGE,ca)}}}function t(){var a={width:L.width()*ca,height:L.height()*ca},b=a.width/2>x().width/2?a.width/2-x().width/2:0;ga.x>b?ga.x=b:ga.x<0&&Math.abs(ga.x)>b&&(ga.x=-b);var c=a.height/2>x().height/2?a.height/2-x().height/2:0;c<ga.y?ga.y=c:Math.abs(ga.y)>c&&(ga.y=-c)}function u(){var a,b,c=!1,d={width:L.width(),height:L.height()},e=x();return d.width>e.width?(a=e.width/2,c=!0):(a=d.width/2,c=!0),d.height>e.height?(b=e.height/2,c=!0):(b=d.height/2,c=!0),Math.abs(ha.left)<a?(ha.left=-a,c=!0):d.width+ha.left<a&&(d.width<e.width?ha.left=-a:ha.left=e.width/2-d.width,c=!0),Math.abs(ha.top)<b?(ha.top=-b,c=!0):Math.abs(d.height+ha.top)<b&&(d.height<e.height?ha.top=-b:ha.top=e.height/2-d.height,c=!0),c}function v(a){a.keyCode===b.KeyEvent.DOM_VK_ESCAPE&&k()}function w(){k({animate:!1}),b.Book.layout()}function x(){return{width:window.innerWidth-(window.innerWidth-M.parent().width()),height:window.innerHeight-(window.innerHeight-M.parent().height())}}function y(){S!==!0&&(ba?k():d())}function z(a){S!==!0&&($(a.target).hasClass("gradient")||(ba?k():d({tapPoint:a.center})))}function A(){O.on("doubletap",z),O.on("pinchstart pinchmove pinchend",s),O.on("panstart",p),O.on("panmove",q),O.on("panend",r)}function B(){O.off("doubletap",z),O.off("pinchstart pinchmove pinchend",s),O.off("panstart",p),O.off("panmove",q),O.off("panend",r)}function C(a){K=b.Book,M=K.$getBook(),N=M.parent(),O=new TT.Hammer.Manager(N.get(0),{inputClass:b.isMobileDevice?TT.Hammer.TouchInput:TT.Hammer.MouseInput,cssProps:{userSelect:"inherit"}}),O.add(new TT.Hammer.Pan({threshold:0,pointers:0})),O.add(new TT.Hammer.Tap({event:"doubletap",taps:2,threshold:15,posThreshold:15})).recognizeWith([O.get("pan")]),O.add(new TT.Hammer.Pinch({threshold:0})).recognizeWith([O.get("pan")]),A(),ba=!1,ja=!0}function D(){return ba}function E(a){pa=a}function F(){return{min:ea,zoom:ca,max:da}}function G(a){var b={_default:150,max:200};a||(a={}),fa=_.extend(b,a)}function H(a){ja=a,1==ja?(P.show(),L.tt_deselect(),L.find(".toast-ctrl").css(c.vendor+"user-select","none"),O.on("pinchstart pinchmove pinchend",s),O.on("panstart",p),O.on("panmove",q),O.on("panend",r)):(P.hide(),L.find(".toast-ctrl").css(c.vendor+"user-select","text"),O.off("pinchstart pinchmove pinchend",s),O.off("panstart",p),O.off("panmove",q),O.off("panend",r)),m(ja)}function I(a){aa=a,aa==Y?ca=(x().width/ra.fit.width).toFixed(2):aa==Z&&(ca=(x().height/ra.fit.height).toFixed(2)),ea=Math.max(ea,ca),ha.left=-(ra.fit.width*ca)/2,ha.top=-(ra.fit.height*ca)/2,h(),b.send(b.Events.ZOOM_SCALE_DID_CHANGE,ca)}function J(a){var c=ra.fit.width*ca,d=ra.fit.height*ca,e=ra.fit.width*a,f=ra.fit.height*a;ca=a,h({fitPage:!1}),ha.left-=(e-c)/2,ha.top-=(f-d)/2,u(),L.css({marginLeft:ha.left+"px",marginTop:ha.top+"px"}),_.each(Q,function(a){K.fitPage(a)}),b.send(b.Events.ZOOM_SCALE_DID_CHANGE,ca)}var K,L,M,N,O,P,Q,R,S,T,U,V,W,X=0,Y=1,Z=2,aa=X,ba=!1,ca=1.5,da=2,ea=.5,fa={_default:150,max:200},ga={x:0,y:0},ha={left:0,top:0},ia={left:0,top:0},ja=!0,ka=[],la=!1,ma={},na={},oa={},pa=!1,qa="Toast.BookZoom.ZoomScale",ra={},sa={},ta={};b.CommandManager.registerInternal(b.Commands.TOGGLE_ZOOM,y),a._initialize=C,a.isActivate=D,a.activate=d,a.deactivate=k,a.getCurrentScales=F,a.setKeepZoomScale=E,a.setZoomPercents=G,a.setDragMode=H,a.setScaleMode=I,a.setZoomScale=J,a._on=A,a._off=B,b.BookZoom=a}),define("toast/core/book/BookTransition",["../../core"],function(a){"use strict";var b=function(a,b){b||(b={}),this.book=a,this.initialize.apply(this,arguments)};return _.extend(b.prototype,Backbone.Events,{initialize:function(a,b){this.configure(b)},configure:function(a){a||(a={}),this.options=$.extend(!0,this.options,a)},updateVisibility:function(){return!1},set:function(a){},resize:function(){},previous:function(a){},next:function(a){},move:function(a){},unset:function(){}}),b.extend=a.extend,b}),define("toast/core/book/BookFlipPage",["./BookCommon"],function(a){"use strict";var b={init:function(a){return a.gradients&&(a.frontGradient=!0,a.backGradient=!0),this.data({f:{disabled:!1}}),this.flip("options",a),b._addPageWrapper.call(this),this},setData:function(a){var b=this.data();return b.f=$.extend(b.f,a),this},getData:function(){return this.data()},options:function(c){var d=this.data().f;return c?(b.setData.call(this,{opts:$.extend({},d.opts||a.flipOptions,c)}),this):d.opts},z:function(a){var b=this.data().f;return b.opts["z-index"]=a,b.fwrapper.css({"z-index":a||parseInt(b.parent.css("z-index"),10)||0}),this},_cAllowed:function(){return a.corners[this.data().f.opts.corners]||this.data().f.opts.corners},_cornerActivated:function(c){if(void 0===c.originalEvent)return!1;c=a.isTouch?c.originalEvent.touches:[c];var d=this.data().f,e=d.parent.offset(),f=$(d.opts.turn).tt_scale(),g=this.width()*f,h=this.height()*f,i={x:Math.max(0,c[0].pageX-e.left),y:Math.max(0,c[0].pageY-e.top)},j=d.opts.cornerSize,k=b._cAllowed.call(this);if(i.x<=0||i.y<=0||i.x>=g||i.y>=h)return!1;if(i.y<j)i.corner="t";else{if(!(i.y>=h-j))return!1;i.corner="b"}if(i.x<=j)i.corner+="l";else{if(!(i.x>=g-j))return!1;i.corner+="r"}return-1==$.inArray(i.corner,k)?!1:i},_c:function(b,c){return c=c||0,{tl:a.point2D(c,c),tr:a.point2D(this.width()-c,c),bl:a.point2D(c,this.height()-c),
br:a.point2D(this.width()-c,this.height()-c)}[b]},_c2:function(b){return{tl:a.point2D(2*this.width(),0),tr:a.point2D(-this.width(),0),bl:a.point2D(2*this.width(),this.height()),br:a.point2D(-this.width(),this.height())}[b]},_foldingPage:function(a){var b=this.data().f.opts;if(b.folding)return b.folding;if(b.turn){var c=b.turn.data();return"single"==c.display?c.pageObjs[b.next]?c.pageObjs[0]:null:c.pageObjs[b.next]}},_backGradient:function(){var b=this.data().f,c=b.opts.turn,d=b.opts.backGradient&&(!c||"single"==c.data().display||2!=b.opts.page&&b.opts.page!=c.data().totalPages-1);return d&&!b.bshadow&&(b.bshadow=$("<div/>",a.divAtt(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(b.parent)),d},resize:function(a){var c=this.data().f,d=$(c.opts.turn).tt_scale(),e=this.width(),f=this.height(),g=Math.round(Math.sqrt(Math.pow(e,2)+Math.pow(f,2)));a&&(c.wrapper.css({width:g,height:g}),c.fwrapper.css({width:g,height:g}).children(":first-child").css({width:e,height:f}),c.fpage.css({width:f,height:e}),c.opts.frontGradient&&c.ashadow.css({width:f,height:e}),b._backGradient.call(this)&&c.bshadow.css({width:e,height:f})),c.parent.is(":visible")&&(c.fwrapper.css({top:c.parent.offset().top,left:c.parent.offset().left/d}),c.opts.turn&&c.fparent.css({top:-c.opts.turn.offset().top,left:-c.opts.turn.offset().left/d})),this.flip("z",c.opts["z-index"])},_addPageWrapper:function(){var c=this.data().f,d=this.parent();if(!c.wrapper){var e=(this.css("left"),this.css("top"),this.width()),f=this.height();Math.round(Math.sqrt(Math.pow(e,2)+Math.pow(f,2)));if(c.parent=d,c.fparent=c.opts.turn?c.opts.turn.data().fparent:$("#turn-fwrappers"),!c.fparent){var g=$("<div/>",{css:{"pointer-events":"none"}}).hide();g.data().flips=0,c.opts.turn?(g.css(a.divAtt(-c.opts.turn.offset().top,-c.opts.turn.offset().left,"auto","visible").css).appendTo(c.opts.turn),c.opts.turn.data().fparent=g):g.css(a.divAtt(0,0,"auto","visible").css).attr("id","turn-fwrappers").appendTo($("body")),c.fparent=g}this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),c.wrapper=$("<div/>",a.divAtt(0,0,this.css("z-index"))).appendTo(d).prepend(this),c.fwrapper=$("<div/>",a.divAtt(d.offset().top,d.offset().left)).hide().appendTo(c.fparent),c.fpage=$("<div/>",{css:{cursor:"default"}}).appendTo($("<div/>",a.divAtt(0,0,0,"visible")).appendTo(c.fwrapper)),c.opts.frontGradient&&(c.ashadow=$("<div/>",a.divAtt(0,0,1)).appendTo(c.fpage)),b.setData.call(this,c),b.resize.call(this,!0)}},_fold:function(c){var d,e,f,g,h,i,j=this,k=0,l=0,m=a.point2D(0,0),n=a.point2D(0,0),o=a.point2D(0,0),p=this.width(),q=this.height(),r=b._foldingPage.call(this),s=(Math.tan(l),this.data().f),t=s.opts.acceleration,u=s.wrapper.height(),v=b._c.call(this,c.corner),w="t"==c.corner.substr(0,1),x="l"==c.corner.substr(1,1),y=function(){var r,t=a.point2D(v.x?v.x-c.x:c.x,v.y?v.y-c.y:c.y),z=Math.atan2(t.y,t.x);l=a.A90-z,k=a.deg(l),r=a.point2D(x?p-t.x/2:c.x+t.x/2,t.y/2);var A=l-Math.atan2(r.y,r.x),B=Math.max(0,Math.sin(A)*Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)));if(o=a.point2D(B*Math.sin(l),B*Math.cos(l)),l>a.A90&&(o.x=o.x+Math.abs(o.y*Math.tan(z)),o.y=0,Math.round(o.x*Math.tan(a.PI-l))<q))return c.y=Math.sqrt(Math.pow(q,2)+2*r.x*t.x),w&&(c.y=q-c.y),y();if(l>a.A90){var C=a.PI-l,D=u-q/Math.sin(C);m=a.point2D(Math.round(D*Math.cos(C)),Math.round(D*Math.sin(C))),x&&(m.x=-m.x),w&&(m.y=-m.y)}d=Math.round(o.y/Math.tan(l)+o.x);var E=p-d,F=E*Math.cos(2*l),G=E*Math.sin(2*l);n=a.point2D(Math.round(x?E-F:d+F),Math.round(w?G:q-G)),h=E*Math.sin(l);var H=b._c2.call(j,c.corner),I=Math.sqrt(Math.pow(H.x-c.x,2)+Math.pow(H.y-c.y,2));return i=p>I?I/p:1,s.opts.frontGradient&&(g=h>100?(h-100)/h:0,e=a.point2D(h*Math.sin(a.A90-l)/q*100,h*Math.cos(a.A90-l)/p*100),w&&(e.y=100-e.y),x&&(e.x=100-e.x)),b._backGradient.call(j)&&(f=a.point2D(h*Math.sin(l)/p*100,h*Math.cos(l)/q*100),x||(f.x=100-f.x),w||(f.y=100-f.y)),o.x=Math.round(o.x),o.y=Math.round(o.y),!0},z=function(c,d,h,k){var o=["0","auto"],r=(p-u)*h[0]/100,v=(q-u)*h[1]/100,y={left:o[d[0]],top:o[d[1]],right:o[d[2]],bottom:o[d[3]]},z=90!=k&&-90!=k?x?-1:1:0;h=h[0]+"% "+h[1]+"%",j.css(y).bookTransform(a.rotate(k)+a.translate(c.x+z,c.y,t),h),s.fpage.parent().css(y),s.wrapper.bookTransform(a.translate(-c.x+r-z,-c.y+v,t)+a.rotate(-k),h),s.fwrapper.bookTransform(a.translate(-c.x+m.x+r,-c.y+m.y+v,t)+a.rotate(-k),h),s.fpage.parent().bookTransform(a.rotate(k)+a.translate(c.x+n.x-m.x,c.y+n.y-m.y,t),h),s.opts.frontGradient&&a.gradient(s.ashadow,a.point2D(x?100:0,w?100:0),a.point2D(e.x,e.y),[[g,"rgba(0,0,0,0)"],[.8*(1-g)+g,"rgba(0,0,0,"+.2*i+")"],[1,"rgba(255,255,255,"+.2*i+")"]],3,l),b._backGradient.call(j)&&a.gradient(s.bshadow,a.point2D(x?0:100,w?0:100),a.point2D(f.x,f.y),[[.8,"rgba(0,0,0,0)"],[1,"rgba(0,0,0,"+.3*i+")"],[1,"rgba(0,0,0,0)"]],3)};switch(c.corner){case"tl":c.x=Math.max(c.x,1),y(),z(o,[1,0,0,1],[100,0],k),s.fpage.bookTransform(a.translate(-q,-p,t)+a.rotate(90-2*k),"100% 100%"),r.bookTransform(a.rotate(90)+a.translate(0,-q,t),"0% 0%");break;case"tr":c.x=Math.min(c.x,p-1),y(),z(a.point2D(-o.x,o.y),[0,0,0,1],[0,0],-k),s.fpage.bookTransform(a.translate(0,-p,t)+a.rotate(-90+2*k),"0% 100%"),r.bookTransform(a.rotate(270)+a.translate(-p,0,t),"0% 0%");break;case"bl":c.x=Math.max(c.x,1),y(),z(a.point2D(o.x,-o.y),[1,1,0,0],[100,100],-k),s.fpage.bookTransform(a.translate(-q,0,t)+a.rotate(-90+2*k),"100% 0%"),r.bookTransform(a.rotate(270)+a.translate(-p,0,t),"0% 0%");break;case"br":c.x=Math.min(c.x,p-1),y(),z(a.point2D(-o.x,-o.y),[0,1,1,0],[0,100],k),s.fpage.bookTransform(a.rotate(90-2*k),"0% 0%"),r.bookTransform(a.rotate(90)+a.translate(0,-q,t),"0% 0%")}s.point=c},_moveFoldingPage:function(a){var c=this.data().f,d=b._foldingPage.call(this);d&&(a?c.fpage.children()[c.ashadow?"1":"0"]||(b.setData.call(this,{backParent:d.parent()}),c.fpage.prepend(d)):c.backParent&&c.backParent.prepend(d))},_showFoldedPage:function(a,c){var d=b._foldingPage.call(this),e=this.data(),f=e.f;if((!f.point||f.point.corner!=a.corner)&&f.opts.next){var g=$.Event("start");if(this.trigger(g,[f.opts,a.corner,c]),this.__out=!1,g.isDefaultPrevented())return!1}if(d){if(c){var h=this,i=f.point&&f.point.corner==a.corner?f.point:b._c.call(this,a.corner,1);this.animatef({from:[i.x,i.y],to:[a.x,a.y],duration:500,frame:function(c){a.x=Math.round(c[0]),a.y=Math.round(c[1]),b._fold.call(h,a)}})}else b._fold.call(this,a),e.effect&&!e.effect.turning&&this.animatef(!1);return f.fwrapper.is(":visible")||(f.fparent.show().data().flips++,b._moveFoldingPage.call(this,!0),f.fwrapper.show(),f.bshadow&&f.bshadow.show()),!0}return!1},hide:function(){var a=this.data().f,c=a.opts.turn,d=b._foldingPage.call(this);return 0===--a.fparent.data().flips&&a.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).bookTransform("","0% 100%"),a.wrapper.bookTransform("","0% 100%"),a.fwrapper.hide(),a.bshadow&&a.bshadow.hide(),d.bookTransform("","0% 0%"),c.data().opts.pressed=!1,this},hideFoldedPage:function(c){var d=this.data().f;if(d.point){var e=this,f=d.point,g=function(){d.point=null,e.flip("hide"),e.trigger("end",[!1])};if(c){var h=b._c.call(this,f.corner),i="t"==f.corner.substr(0,1),j=i?Math.min(0,f.y-h.y)/2:Math.max(0,f.y-h.y)/2,k=a.point2D(f.x,f.y+j),l=a.point2D(h.x,h.y-j);this.animatef({from:0,to:1,frame:function(c){var d=a.bezier(f,k,l,h,c);f.x=d.x,f.y=d.y,b._fold.call(e,f)},complete:g,duration:800,hiding:!0})}else this.animatef(!1),g()}},turnPage:function(c){var d=this,e=this.data().f;c={corner:e.corner?e.corner.corner:c||b._cAllowed.call(this)[0]};var f=e.point||b._c.call(this,c.corner,e.opts.turn?e.opts.turn.data().opts.elevation:0),g=b._c2.call(this,c.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(e){var h=a.bezier(f,f,g,g,e);c.x=h.x,c.y=h.y,b._showFoldedPage.call(d,c)},complete:function(){d.trigger("end",[!0])},duration:e.opts.duration,turning:!0}),e.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(a){var c=this.data().f,d=c.opts.turn;if(!c.corner&&!c.disabled&&!this.flip("isTurning")&&c.opts.page==d.data().pagePlace[c.opts.page]){if(c.corner=b._cornerActivated.call(this,a),c.corner&&b._foldingPage.call(this,c.corner))return b._moveFoldingPage.call(this,!0),d.data().opts.pressed=!0,this.trigger("pressed",[c.point]),!1;c.corner=null}},_eventMove:function(c){var d=this.data().f;if(!d.disabled){if(c=a.isTouch?c.originalEvent.touches:[c],d.corner){var e=d.parent.offset();d.corner.x=c[0].pageX-e.left,d.corner.y=c[0].pageY-e.top;var f=$(d.opts.turn).tt_scale();return d.corner.x/=f,d.corner.y/=f,b._showFoldedPage.call(this,d.corner),!1}if(!this.data().effect&&this.is(":visible")){var g=b._cornerActivated.call(this,c[0]);if(g){var f=$(d.opts.turn).tt_scale(),h=d.opts.cornerSize*f,i=d.opts.cornerSize/h,j=b._c.call(this,g.corner,d.opts.cornerSize*i);return g.x=j.x,g.y=j.y,b._showFoldedPage.call(this,g,!0),!1}b.hideFoldedPage.call(this,!0)}else if(!d.corner){var g=b._cornerActivated.call(this,c[0]);if(g||this.__out)return!this.data().effect;var k=$.Event("out");this.trigger(k,[d.opts]),this.__out=!0}}},_eventEnd:function(){var a=this.data().f;a.opts.turn;if(!a.disabled&&a.point){var c=$.Event("released");this.trigger(c,[a.point]),c.isDefaultPrevented()||b.hideFoldedPage.call(this,!0)}a.corner=null},disable:function(a){return b.setData.call(this,{disabled:a}),this}};return b}),define("toast/core/book/BookFlipManager",["./BookCommon","./BookFlipPage"],function(a,b){"use strict";var c={init:function(c){(void 0===a.has3d||null===a.has3d)&&(a.has3d="WebKitCSSMatrix"in window||"MSCSSMatrix"in window||"MozPerspective"in document.body.style,a.vendor=a.getPrefix()),c.cover===!1&&"double"===c.display&&this.prepend($("<div />",{"class":"Oops"}));var d,e=this.data(),f=this.children();if(c=$.extend({width:this.width(),height:this.height()},a.turnOptions,c),e.opts=c,e.pageObjs={},e.pages={},e.pageWrap={},e.pagePlace={},e.pageMv=[],e.totalPages=c.pages||0,c.when)for(d in c.when)a.has(d,c.when)&&this.bind(d,c.when[d]);for(this.css({width:c.width,height:c.height}),this.turn("display",c.display),d=0;d<f.length;d++)this.turn("addPage",f[d],d+1);return this.prepend($("<div />",{"class":"book-shadow"})),this.turn("page",c.page),a.corners=$.extend({},a.corners,c.corners),$(this).bind(a.events.start,function(c){for(var d in e.pages)if(a.has(d,e.pages)&&b._eventStart.call(e.pages[d],c)===!1)return a.isTouch}),$(document).bind(a.events.move,function(c){for(var d in e.pages)a.has(d,e.pages)&&(b._eventMove.call(e.pages[d],c)!==!1||a.isTouch||c.stopPropagation())}).bind(a.events.end,function(c){for(var d in e.pages)a.has(d,e.pages)&&b._eventEnd.call(e.pages[d],c)}),e.done=!0,this},addPage:function(a,b){var d,e=!1,f=this.data(),g=f.totalPages+1;if(b){if(b==g)b=g,e=!0;else if(b>g)throw new Error('It is impossible to add the page "'+b+'", the maximum value is: "'+g+'"')}else b=g,e=!0;return b>=1&&g>=b&&(d="double"==f.display?b%2?" odd":" even":"",f.done&&this.turn("stop"),b in f.pageObjs&&c._movePages.call(this,b,1),e&&(f.totalPages=g),f.pageObjs[b]=$(a).addClass("page p"+b+d),c._addPage.call(this,b),f.done&&this.turn("update"),c._removeFromDOM.call(this)),this},_addPage:function(b){var d=this.data(),e=d.pageObjs[b];if(e)if(c._necessPage.call(this,b)){if(!d.pageWrap[b]){var f="double"==d.display?!0:!1,g=f?this.width()/2:this.width(),h=this.height();if(e.css({width:g,height:h}),d.pagePlace[b]=b,d.pageWrap[b]=$("<div/>",{"class":"page-wrapper",page:b,css:{position:"absolute",overflow:"hidden",width:g,height:h}}).css(a.pagePosition["double"==d.display?b%2:0]),this.append(d.pageWrap[b]),d.pageWrap[b].prepend(d.pageObjs[b]),d.opts.shadow===!0&&0===d.pageObjs[b].children(".shadow").length){var i=$("<div/>",{"class":"shadow"});d.pageObjs[b].append(i)}this.trigger("addPage",b)}b&&1!=c._setPageLocation.call(this,b)||c._makeFlip.call(this,b)}else d.pagePlace[b]=0,d.pageObjs[b]&&d.pageObjs[b].remove()},hasPage:function(a){return a in this.data().pageObjs},_makeFlip:function(a){var b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){var d="single"==b.display,e=a%2;d===!1&&b.opts.cover===!1&&2===a?b.pages[a]=b.pageObjs[a].css({width:d?this.width():this.width()/2,height:this.height()}).flip({page:a,next:null,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,corners:d?"all":e?"forward":"backward",cornerSize:b.opts.cornerSize,backGradient:b.opts.gradients,frontGradient:b.opts.gradients}):(b.pages[a]=b.pageObjs[a].css({width:d?this.width():this.width()/2,height:this.height()}).flip({page:a,next:d&&a===b.totalPages?a-1:e||d?a+1:a-1,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,corners:d?"all":e?"forward":"backward",cornerSize:b.opts.cornerSize,backGradient:b.opts.gradients,frontGradient:b.opts.gradients}).flip("disable",b.disabled).bind("pressed",c._pressed).bind("released",c._released).bind("start",c._start).bind("end",c._end).bind("out",c._out).bind("flip",c._flip),1!==a&&a!==b.totalPages||"double"!=b.display||b.opts.cover!==!0||b.pageObjs[a].parents(".page-wrapper").addClass("cover")),c._setPageLocation.call(this,a)}return b.pages[a]},_makeRange:function(){var a,b,d=this.data();if(!(d.totalPages<1))for(b=this.turn("range"),a=b[0];a<=b[1];a++)c._addPage.call(this,a)},range:function(b){var d,e,f,g,h=this.data();if(b=b||h.tpage||h.page||1,g=c._view.call(this,b),1>b||b>h.totalPages)throw new Error('"'+b+'" is not a valid page');return g[1]=g[1]||g[0],g[0]>=1&&g[1]<=h.totalPages?(d=Math.floor((a.pagesInDOM-2)/2),h.totalPages-g[1]>g[0]?(e=Math.min(g[0]-1,d),f=2*d-e):(f=Math.min(h.totalPages-g[1],d),e=2*d-f)):(e=a.pagesInDOM-1,f=a.pagesInDOM-1),[Math.max(1,g[0]-e),Math.min(h.totalPages,g[1]+f)]},_necessPage:function(a){if(0===a)return!0;var b=this.turn("range");return a>=b[0]&&a<=b[1]},_removeFromDOM:function(){var b,d=this.data();for(b in d.pageWrap)a.has(b,d.pageWrap)&&!c._necessPage.call(this,b)&&(this.trigger("removePage",b),c._removePageFromDOM.call(this,b))},_removePageFromDOM:function(a){var b=this.data();if(b.pages[a]){var d=b.pages[a].data();d.f&&d.f.fwrapper&&d.f.fwrapper.remove(),b.pages[a].removeData(),b.pages[a].remove(),delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove(),b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]),c._removeMv.call(this,a),delete b.pagePlace[a]},removePage:function(a){var b=this.data();return b.pageObjs[a]&&(this.turn("stop"),c._removePageFromDOM.call(this,a),delete b.pageObjs[a],c._movePages.call(this,a,-1),b.totalPages=b.totalPages-1,b.page>b.totalPages?(b.page=null,c._fitPage.call(this,b.totalPages)):(c._makeRange.call(this),this.turn("update"))),this},_movePages:function(b,c){var d,e=this.data(),f="single"==e.display,g=function(b){var d=b+c,g=d%2,h=g?" odd ":" even ";e.pageObjs[b]&&(e.pageObjs[d]=e.pageObjs[b].removeClass("page"+b+" odd even").addClass("page"+d+h)),e.pagePlace[b]&&e.pageWrap[b]&&(e.pagePlace[d]=d,e.pageWrap[d]=e.pageWrap[b].css(a.pagePosition[f?0:g]).attr("page",d),e.pages[b]&&(e.pages[d]=e.pages[b].flip("options",{page:d,next:f||g?d+1:d-1,corners:f?"all":g?"forward":"backward"})),c&&(delete e.pages[b],delete e.pagePlace[b],delete e.pageObjs[b],delete e.pageWrap[b],delete e.pageObjs[b]))};if(c>0)for(d=e.totalPages;d>=b;d--)g(d);else for(d=b;d<=e.totalPages;d++)g(d)},display:function(b){var d=this.data(),e=d.display;if(b){if(-1==$.inArray(b,a.displays))throw new Error('"'+b+'" is not a value for display');if("single"==b?d.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),d.pageObjs[0]=$("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):d.pageObjs[0]&&(this.turn("stop").css({overflow:""}),d.pageObjs[0].remove(),delete d.pageObjs[0]),d.display=b,e){var f=this.turn("size");c._movePages.call(this,1,0),this.turn("size",f.width,f.height).turn("update")}return this}return e},animating:function(){return this.data().pageMv.length>0},disable:function(b){var c,d=this.data(),e=this.turn("view");d.disabled=void 0===b||b===!0;for(c in d.pages)a.has(c,d.pages)&&d.pages[c].flip("disable",d.disabled?!0:-1==$.inArray(parseInt(c,10),e));return this},disabled:function(a){return void 0===a?this.data().disabled===!0:(a&&this.turn("stop"),this.turn("disable",a))},getData:function(){return this.data()},size:function(b,c){if(b&&c){this.turn("stop");var d,e=this.data(),f="double"==e.display?b/2:b;this.css({width:b,height:c}),e.pageObjs[0]&&e.pageObjs[0].css({width:f,height:c});for(d in e.pageWrap)a.has(d,e.pageWrap)&&(e.pageObjs[d].css({width:f,height:c}),e.pageWrap[d].css({width:f,height:c}),e.pages[d]&&e.pages[d].css({width:f,height:c}));return this.turn("resize"),this}return{width:this.width(),height:this.height()}},resize:function(){var a,b=this.data();for(b.pages[0]&&(b.pageWrap[0].css({left:-this.width()}),b.pages[0].flip("resize",!0)),a=1;a<=b.totalPages;a++)b.pages[a]&&b.pages[a].flip("resize",!0)},_removeMv:function(a){var b,c=this.data();for(b=0;b<c.pageMv.length;b++)if(c.pageMv[b]==a)return c.pageMv.splice(b,1),!0;return!1},_addMv:function(a){var b=this.data();c._removeMv.call(this,a),b.pageMv.push(a)},_view:function(a){var b=this.data();return a=a||b.page,"double"==b.display?a%2?[a-1,a]:[a,a+1]:[a]},view:function(a){var b=this.data(),d=c._view.call(this,a);return"double"==b.display?[d[0]>0?d[0]:0,d[1]<=b.totalPages?d[1]:0]:[d[0]>0&&d[0]<=b.totalPages?d[0]:0]},stop:function(c){var d,e,f=this.data(),g=f.pageMv;f.pageMv=[],f.tpage&&(f.page=f.tpage,delete f.tpage);for(d in g)a.has(d,g)&&(e=f.pages[g[d]].data().f.opts,b._moveFoldingPage.call(f.pages[g[d]],null),f.pages[g[d]].flip("hideFoldedPage"),f.pagePlace[e.next]=e.next,e.force&&(e.next=e.page%2===0?e.page-1:e.page+1,delete e.force));return this.turn("update"),this},pages:function(a){var b=this.data();if(a){if(a<b.totalPages){for(var c=a+1;c<=b.totalPages;c++)this.turn("removePage",c);this.turn("page")>a&&this.turn("page",a)}return b.totalPages=a,this}return b.totalPages},_fitPage:function(a,b){var d=this.data(),e=this.turn("view",a);d.page!=a&&(this.trigger("turning",[a,e]),-1!=$.inArray(1,e)&&this.trigger("first"),-1!=$.inArray(d.totalPages,e)&&this.trigger("last",a)),d.pageObjs[a]&&(d.tpage=a,this.turn("stop",b),c._removeFromDOM.call(this),c._makeRange.call(this),this.trigger("turned",[a,e]),this.is(":visible")||this.show())},_turnPage:function(a){var b,d,e=this.data(),f=this.turn("view"),g=this.turn("view",a);if(e.page!=a){var h=e.page;if("prevented"==this.trigger("turning",this,[a,g]))return void(h==e.page&&-1!=$.inArray(place,e.pageMv)&&e.pages[place].flip("hideFoldedPage",!0));-1!=$.inArray(1,g)&&this.trigger("first"),-1!=$.inArray(e.totalPages,g)&&this.trigger("last")}if(e.pageObjs[a]&&(e.tpage=a,this.turn("stop"),c._makeRange.call(this),"single"==e.display?(b=f[0],d=g[0]):f[1]&&a>f[1]?(b=f[1],d=g[0]):f[0]&&a<f[0]&&(b=f[0],d=g[1]),e.pages[b])){var i=e.pages[b].data().f.opts;e.tpage=d,i.next!=d&&(i.next=d,e.pagePlace[d]=i.page,i.force=!0),"single"==e.display?e.pages[b].flip("turnPage",g[0]>f[0]?"br":"bl"):e.pages[b].flip("turnPage")}},page:function(a){var b=this.data();return void 0===a?b.page:(a=parseInt(a,10),a>0&&a<=b.totalPages?(b.opts.released=!1,b.done&&-1==$.inArray(a,this.turn("view"))?c._turnPage.call(this,a):c._fitPage.call(this,a),this):b.page)},next:function(){var a=this.data();return this.turn("page",c._view.call(this,a.page).pop()+1)},previous:function(){var a=this.data();return this.turn("page",c._view.call(this,a.page).shift()-1)},_addMotionPage:function(){var a=$(this).data().f.opts,b=a.turn,d=b.data();a.pageMv=a.page,c._addMv.call(b,a.pageMv),d.pagePlace[a.next]=a.page,b.turn("update")},_start:function(a,b,d,e){var f=b.turn.data();if(a.stopPropagation(),b.next&&b.next>=1&&b.next<=f.totalPages){var g=$.Event("start");if(b.turn.trigger(g,[b,d,e]),g.isDefaultPrevented())return void a.preventDefault()}if("single"==f.display){var h="l"==d.charAt(1);1==b.page&&h||b.page==f.totalPages&&!h?a.preventDefault():h?(b.next=b.next<b.page?b.next:b.page-1,b.force=!0):b.next=b.next>b.page?b.next:b.page+1}c._addMotionPage.call(this)},_end:function(a,b){var d=$(this),e=d.data().f,f=e.opts,g=f.turn,h=g.data();if(a.stopPropagation(),b||h.tpage)(h.tpage==f.next||h.tpage==f.page)&&(delete h.tpage,c._fitPage.call(g,h.tpage||f.next,!0));else if(g.turn("stop",!0),f.next&&f.next>=1&&f.next<=h.totalPages){var i=$.Event("end");f.turn.trigger(i,[f])}},_out:function(a,b){a.stopPropagation();var c=(b.turn.data(),$.Event("out"));b.turn.trigger(c)},_pressed:function(a){var b,c=$(this),d=c.data().f,e=d.opts.turn,f=e.data().pages;for(b in f)b!=d.opts.page&&f[b].flip("disable",!0);a.stopPropagation();var g=$.Event("pressed");return e.trigger(g),e.data().opts.released=!1,d.time=(new Date).getTime()},_released:function(a,b){var c=$(this),d=c.data().f,e=d.opts.turn,f="l"==d.point.corner.charAt(1),g=!1;a.stopPropagation(),"single"==e.data().display?f&&b.x>Math.floor($(this).width()/2)?g=!0:!f&&b.x<Math.floor($(this).width()/2)&&(g=!0):b.x<0?g=!0:b.x>$(this).width()&&(g=!0),((new Date).getTime()-d.time<200||g)&&(a.preventDefault(),d.opts.turn.data().tpage=d.opts.next,d.opts.turn.data().opts.released=!0,d.opts.turn.data().page>d.opts.next?d.opts.turn.data().opts.action="backward":d.opts.turn.data().opts.action="forward",d.opts.turn.turn("update"),$(c).flip("turnPage"));var h=$.Event("released");e.trigger(h)},_flip:function(){var a=$(this).data().f.opts;a.turn.trigger("turn",[a.next])},calculateZ:function(a){var b,c,d,e,f,g=this,h=this.data(),i=this.turn("view"),j=i[0]||i[1],k={pageZ:{},partZ:{},pageV:{}},l=function(a){var b=g.turn("view",a);b[0]&&(k.pageV[b[0]]=!0),b[1]&&(k.pageV[b[1]]=!0)};for(b=0;b<a.length;b++)c=a[b],d=h.pages[c].data().f.opts.next,e=h.pagePlace[c],l(c),l(d),f=h.pagePlace[d]==d?d:c,k.pageZ[f]=h.totalPages-Math.abs(j-f),k.partZ[e]=2*h.totalPages+Math.abs(j-f);return k},update:function(){var b,d=this.data();if(d.pageMv.length&&0!==d.pageMv[0]){var e,f=this.turn("calculateZ",d.pageMv),g=this.turn("view",d.tpage);d.pagePlace[g[0]]==g[0]?e=g[0]:d.pagePlace[g[1]]==g[1]&&(e=g[1]);for(b in d.pageWrap)a.has(b,d.pageWrap)&&(d.pageWrap[b].css({display:f.pageV[b]?"":"none","z-index":f.pageZ[b]||0}),d.pages[b]&&(d.pages[b].flip("z",f.partZ[b]||null),f.pageV[b]&&d.pages[b].flip("resize"),d.tpage&&d.pages[b].flip("disable",!0)))}else for(b in d.pageWrap)if(a.has(b,d.pageWrap)){var h=c._setPageLocation.call(this,b);d.pages[b]&&d.pages[b].flip("disable",d.disabled||1!=h).flip("z",null)}},_setPageLocation:function(a){var b=this.data(),c=this.turn("view");return a==c[0]||a==c[1]?(b.pageWrap[a].css({"z-index":b.totalPages,display:""}),1):"single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2?(b.pageWrap[a].css({"z-index":b.totalPages-1,display:""}),2):(b.pageWrap[a].css({"z-index":0,display:"none"}),0)},options:function(b){var d,e,f=this.data(),g=f.opts;if(g.display!==b.display){if(c.stop.call(this),g=$.extend(f.opts,b),g.cover===!1&&"double"===g.display){var h=f.totalPages;if(f.pageObjs[1]&&!f.pageObjs[1].hasClass("Oops")){var i=$("<div />",{"class":"Oops"});this.prepend(i),this.turn("addPage",i,1),h==f.totalPages&&f.totalPages++,f.page%2===0?f.page+=1:f.page+=2}}else f.pageObjs[1]&&f.pageObjs[1].hasClass("Oops")?(f.page%2===0?f.page-=1:f.page-=2,c.removePage.call(this,1)):g.cover===!0&&f.page%2!==0&&(f.page-=1);for(f.page=Math.max(1,f.page),f.page=Math.min(f.page,f.totalPages),f.pageObjs[1]&&f.pageObjs[1].hasClass("Oops")?g.firstPage=2:g.firstPage=1,this.turn("display",f.opts.display),e=this.turn("range"),d=e[0];d<=e[1];d++)a.has(d,f.pageWrap)&&c._necessPage.call(this,d)&&(this.trigger("removePage",d),c._removePageFromDOM.call(this,d));for(this.turn("page",f.page),1!==f.page&&f.page!==f.totalPages||"double"!=f.display||f.opts.cover!==!0||f.pageObjs[f.page].parents(".page-wrapper").addClass("cover"),e=this.turn("range"),d=e[0];d<=e[1];d++)a.has(d,f.pageWrap)&&c._necessPage.call(this,d)&&f.pageObjs[d].find(".loader").remove()}}};return c}),define("toast/core/book/BookFlipTransition",["./BookCommon","./BookTransition","./BookFlipManager","./BookFlipPage"],function(a,b,c,d){"use strict";var e=b.prototype,f=b.extend();return _.extend(f.prototype,e,{initialize:function(a,b){if(e.initialize.call(this,a,b),b.pageFlipSound===!0){var c;c=Toast.isNative||Toast.params.get("preview")?"{APP_DIR}assets/media/page-flip.mp3":"{ASSETS_DIR}media/page-flip.mp3",c=TT.StringUtils.replaceTemplate(c).encodeFilePath(),this.$pageFlipSound=$('<audio src="'+c+'" style="z-index:99999" />'),this.$pageFlipSound.on("loadeddata",function(a){this.isReadyPageFlipAudio=!0}.bind(this))}this.book.$getBook().parent().addClass(this.book.configure().transition),this.initializeFlip(),this._setCornerLayers()},configure:function(a){e.configure.call(this,a);var b=this.book.$getBook();b.turn("getData").done===!0&&(b.turn("options",{display:this.options.display}),b.parent().removeClass("cover"),b.parent().removeClass("last-page"),this.resize(),this._setCornerLayers())},initializeFlip:function(){var b=this,c=this.book.configure();this.addPages=[],this.book.$getBook().turn({display:this.options.display,elevation:50,cover:this.options.cover,shadow:this.options.shadow,page:this.options.cover===!1&&"double"===this.options.display?2:1,firstPage:this.options.cover===!1&&"double"===this.options.display?2:1,gradients:!0,acceleration:!0,cornerSize:60,duration:Toast.isMobileDevice?350:400,when:{start:function(a,d,e,f){var g=$(this).data();f===!0&&(tt.$el.addClass("flipping"),b.book._addOverlay(),Toast.send(Toast.Events.START_PAGE_TRANSITIONS),c.cover===!0&&b.book.isDoublePage()&&(1===d.next?b.$bookShadow.css({width:"50%",right:0}):d.next===g.totalPages&&g.totalPages%2===0&&b.$bookShadow.css({width:"50%",right:""})))},out:function(a){b.book._removeOverlay(),tt.$el.removeClass("flipping")},pressed:function(a){tt.$el.addClass("flipping")},released:function(a){},end:function(a){c.cover===!0&&b.book.isDoublePage()&&b.$bookShadow.css({width:"",right:""})},first:function(){},last:function(){b._layout()},turning:function(a,b,c){},turn:function(a,c){var d=$(this).data(),e=d.opts.firstPage-1;c-=e,d.opts.released===!0&&(b._playFlipSound(),b.book.turnByUserAction(d.opts.action)),d.opts.released=!1,b._layout(),Toast.send(Toast.Events.WILL_MOVE_PAGE,b.book.getCurrentPageNumber())},turned:function(c,d){b.addPages=b.addPages.slice(Math.max(0,b.addPages.length-a.pagesInDOM));var e=b.book.getCurrentPageNumber(),f=_.find(b.addPages,function(a){return a==e[0]});_.isUndefined(f)&&Toast.send(Toast.Events.LOAD_PAGE,e[0]),1!=e.length&&(f=_.find(b.addPages,function(a){return a==e[1]}),_.isUndefined(f)&&Toast.send(Toast.Events.LOAD_PAGE,e[1])),_.each(b.addPages,function(a){Toast.send(Toast.Events.LOAD_PAGE,a)}),b.addPages=[],b.book._startEmbeddedContent(),Toast.send(Toast.Events.PAGE_DID_CHANGE,b.book.getCurrentPageNumber(),b.book.getTotalPageNumber())},addPage:function(a,c){var d=$(this).data(),e=d.opts.firstPage-1;c-=e,b.addPages.push(c);var f=$(this).find('.toast-ctrl[data-index="'+(c-1)+'"]').parent().children(".loader");_.isUndefined(f[0])&&(f=$("<div />",{"class":"loader"}),$(this).find('.toast-ctrl[data-index="'+(c-1)+'"]').parent().append(f))},removePage:function(a,b){var c=$(this).data(),d=c.opts.firstPage-1;b-=d,Toast.send(Toast.Events.UNLOAD_PAGE,b)}}}),this.$bookShadow=this.book.$getBook().children(".book-shadow"),this.resize()},updateVisibility:function(){return!0},set:function(){},resize:function(){e.resize.call(this);var a=this.book.$getBook();a.turn("getData").done&&a.turn("size",a.width(),a.height()),this._layout()},_layout:function(){var a=this.book.$getBook(),b=Number(a.attr("data-left")),c=a.parent().children(".book-bg"),d=this.book.configure();d.cover===!0&&this.book.isDoublePage()&&(this.$bookShadow.css({width:"",right:""}),a.parent().hasClass("last-page")&&a.parent().removeClass("last-page")),this.book.isDoublePage()&&(this.book.getCurrentPageIndex()<=0||this.book.isLastPage())&&d.cover===!0?(a.parent().addClass("cover"),d.useBackground&&c.hide(),this.book.isLastPage()?(a.parent().addClass("last-page"),this.book.getTotalPageNumber()%2===0?a.css("left",b+a.width()/4+"px"):a.parent().hasClass("cover")&&(a.parent().removeClass("cover"),a.css("left",b+"px"),d.useBackground&&c.show())):a.css("left",b-a.width()/4+"px")):a.parent().hasClass("cover")&&(a.parent().removeClass("cover"),a.css("left",b+"px"),d.useBackground&&c.show())},previous:function(){this.book.$getBook().turn("previous"),this._playFlipSound()},next:function(){this.book.$getBook().turn("next"),this._playFlipSound()},move:function(a){var b=this.book.$getBook(),c=a.page-1,d=0!==c;c>=1&&"double"===this.options.display?(c*=2,this.options.cover===!1&&"double"===this.options.display&&(c+=2)):c+=1,this.options.cover===!1&&"double"===this.options.display&&(c=Math.max(2,c)),b.turn("page",c),this._playFlipSound(d)},_setCornerLayers:function(){var a=this.book.$getBook();$("<div />",{"class":"cl cl-lt"}).appendTo(a),$("<div />",{"class":"cl cl-lb"}).appendTo(a),$("<div />",{"class":"cl cl-rt"}).appendTo(a),$("<div />",{"class":"cl cl-rb"}).appendTo(a)},unset:function(){var a=this.book.$getBook();a.children(".cl").remove()},_playFlipSound:function(a){a!==!0&&this.oncePlayFlipSound!==!0||this.options.pageFlipSound!==!0||this.isReadyPageFlipAudio!==!0||(this.$pageFlipSound[0].currentTime=0,this.$pageFlipSound[0].play()),this.oncePlayFlipSound=!0}}),f}),define("toast/core/book/BookSlideTransition",["./BookTransition"],function(a){"use strict";var b=a.prototype,c=a.extend();return _.extend(c.prototype,b,{initialize:function(a,c){b.initialize.call(this,a,c)},configure:function(a){b.configure.call(this,a),this.book.$getBook().parent().removeClass(this.book.configure().transition),this.book.$getBook().parent().addClass(this.book.configure().transition),"double"===a.display?this.doublePage=!0:this.doublePage=!1},_set:function(a){var b=TT.project.viewControllers[a-1];if(b){var c=this.book.$getBook(),d=c.parent(),e={width:b.collection.width,height:b.collection.height},f=Math.min(c.parent().width()/e.width,c.parent().height()/e.height),g=Math.round(e.width*f),h=Math.round(e.height*f);g+=g%2,Math.abs(c.parent().width()-g)<=2&&(g=c.parent().width()),g+=g%2,Math.abs(c.parent().height()-h)<=2&&(h=c.parent().height());var i=parseInt((d.width()-g)/2);i+=i%2,c.css({left:i+"px",width:g+"px",height:h+"px"}),b.$el.css({width:g+"px",height:h+"px"});var j=b.$contents;j.css({width:e.width+"px",height:e.height+"px"});TT.project.models[a-1];if(f=Math.max(g/e.width,h/e.height),1!==f){var k=(g-e.width)/2/f,l=(h-e.height)/2/f;j.tt_transform("scale("+f+") translate("+k+"px, "+l+"px)")}return b.contentScale=f,f}},set:function(a){if(!this.doublePage&&(a||this._page)){a&&(this._page=a.page,this._prev=a.prev,this._next=a.next);var b=TT.project.viewControllers[this._page-1];if(b){var c=(this.book.$getBook(),this._set(this._page));b.contentScale=c}}},resize:function(){this.set({page:this._page})},previous:function(a){this.set(a)},next:function(a){this.set(a)},move:function(a){this.set(a)}}),c}),define("toast/core/book/BookFadeTransition",["./BookTransition"],function(a){"use strict";var b=a.prototype,c=a.extend();return _.extend(c.prototype,b,{initialize:function(a,c){b.initialize.call(this,a,c)},configure:function(a){b.configure.call(this,a),this.book.$getBook().parent().removeClass(this.book.configure().transition),this.book.$getBook().parent().addClass(this.book.configure().transition),"double"===a.display?this.doublePage=!0:this.doublePage=!1},set:function(a){if(!this.doublePage&&(a||this._page)){a&&(this._page=a.page,this._prev=a.prev,this._next=a.next);var b=TT.project.viewControllers[this._page-1];if(b){var c=this.book.$getBook(),d=c.parent(),e={width:b.collection.width,height:b.collection.height},f=Math.min(c.parent().width()/e.width,c.parent().height()/e.height),g=Math.round(e.width*f),h=Math.round(e.height*f);g+=g%2,Math.abs(c.parent().width()-g)<=2&&(g=c.parent().width()),g+=g%2,Math.abs(c.parent().height()-h)<=2&&(h=c.parent().height());var i=parseInt((d.width()-g)/2);i+=i%2,c.css({left:i+"px",width:g+"px",height:h+"px"}),b.$el.css({width:g+"px",
height:h+"px"});var j=b.$contents;j.css({width:e.width+"px",height:e.height+"px"});TT.project.models[this._page-1];if(f=Math.max(g/e.width,h/e.height),1!==f){var k=(g-e.width)/2/f,l=(h-e.height)/2/f;j.tt_transform("scale("+f+") translate("+k+"px, "+l+"px)")}b.contentScale=f}}},resize:function(){this.set()},previous:function(a){this.set(a)},next:function(a){this.set(a)},move:function(a){this.set(a)}}),c}),define("toast/core/book/Book.jquery.plugin",["./BookCommon","./BookFlipPage","./BookFlipManager"],function(a,b,c){"use strict";var d=function(a,b,c){if(c[0]&&"object"!=typeof c[0]){if(b[c[0]]&&"_"!=c[0].toString().substr(0,1))return b[c[0]].apply(a,Array.prototype.slice.call(c,1));throw c[0]+" is an invalid value"}return b.init.apply(a,c)};$.extend($.fn,{flip:function(a,c){return d(this,b,arguments)},turn:function(a){return d(this,c,arguments)},bookTransform:function(b,c){var d={};return c&&(d[a.vendor+"transform-origin"]=c),d[a.vendor+"transform"]=b,d.transform=b,this.css(d)},animatef:function(a){var b=this.data();if(b.effect&&clearInterval(b.effect.handle),a){a.to.length||(a.to=[a.to]),a.from.length||(a.from=[a.from]),a.easing||(a.easing=function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c});var c,d=[],e=a.to.length,f=this,g=a.fps||30,h=-g,i=function(){var c,i=[];for(h=Math.min(a.duration,h+g),c=0;e>c;c++)i.push(a.easing(1,h,a.from[c],d[c],a.duration));a.frame(1==e?i[0]:i),h==a.duration&&(clearInterval(b.effect.handle),delete b.effect,f.data(b),a.complete&&a.complete())};for(c=0;e>c;c++)d.push(a.to[c]-a.from[c]);b.effect=a,b.effect.handle=setInterval(i,g),this.data(b),i()}else delete b.effect}})}),define("toast/core/book/Book",["exports","../../core","./BookCommon","./BookZoom","./BookFlipTransition","./BookSlideTransition","./BookFadeTransition","./Book.jquery.plugin"],function(a,b,c,d,e,f,g){"use strict";function h(){if(!xa&&b.params.get("startpage")){var a=parseInt(b.params.get("startpage"));if(-1===oa||a!==P()[0])return I(a,{isLogical:!0}),void(xa=!0)}var c=window.location.hash,d=c.slice(2).split("/"),a=parseInt(d[0],10);_.isNaN(a)&&(a=S(1)),(-1===oa||a!==P()[0])&&I(a,{isLogical:!0})}function i(){if(la.history){var a="/";if(ha){var b=ha.attr("id");b&&(b=b.toLowerCase(),b=b.replace(/[^a-zA-Z0-9\-\_\:\.]/g,"")),"string"==typeof b&&b.length?a="/"+b:oa>=0&&(a+=R().current)}else oa>=0&&(a+=R().current);wa=!0,window.location.hash=a}}function j(a){wa===!0?wa=!1:h()}function k(a){if(ta===!0&&0===$(".modal.in").length&&Date.now()-ra>500){ra=Date.now();var b=a.detail||-a.wheelDelta;b>0?C():B()}}function l(a){if(ta===!0&&0===$(".modal.in").length&&!b.isInputBoxFocused())switch(a.keyCode){case b.KeyEvent.DOM_VK_PAGE_UP:case b.KeyEvent.DOM_VK_LEFT:Date.now()-ra>300&&(ra=Date.now(),B());break;case b.KeyEvent.DOM_VK_PAGE_DOWN:case b.KeyEvent.DOM_VK_RIGHT:Date.now()-ra>300&&(ra=Date.now(),C());break;case b.KeyEvent.DOM_VK_HOME:D();break;case b.KeyEvent.DOM_VK_END:E()}}function m(){return ta&&!b.BookZoom.isActivate()&&!TT.$el.hasClass("dragging")&&!TT.$el.hasClass("drawing")}function n(a){m()&&(va.startX=a.originalEvent.touches[0].clientX,va.startY=a.originalEvent.touches[0].clientY,va.startCount=a.originalEvent.touches.length,2===a.originalEvent.touches.length&&(va.startSpan=c.distanceBetween({x:a.originalEvent.touches[1].clientX,y:a.originalEvent.touches[1].clientY},{x:va.startX,y:va.startY})))}function o(a){if(m())if(va.captured)b.isAndroid&&a.originalEvent.preventDefault();else{var c=a.originalEvent.touches[0].clientX,d=a.originalEvent.touches[0].clientY;if(1===a.originalEvent.touches.length&&2!==va.startCount){var e=c-va.startX,f=d-va.startY;e>va.threshold&&Math.abs(e)>Math.abs(f)?(va.captured=!0,"flip"===la.transition?ga.turn("getData").opts.pressed!==!0&&B():B()):e<-va.threshold&&Math.abs(e)>Math.abs(f)&&(va.captured=!0,"flip"===la.transition?ga.turn("getData").opts.pressed!==!0&&C():C()),a.originalEvent.preventDefault()}}}function p(a){va.captured=!1}function q(a){a.preventDefault()}function r(a){var c=$(ma[a]);if(c.removeClass("present future past"),a>oa?c.addClass("future"):oa>a&&c.addClass("past"),c.css("display","block"),sa===!0&&(a*=2),b.send(b.Events.LOAD_PAGE,a+1),sa===!0){var d=Math.min(pa-1,a+1);d!==a&&b.send(b.Events.LOAD_PAGE,d+1)}}function s(a){var c=$(ma[a]);if(c.removeClass("present future past"),a>oa?c.addClass("future"):oa>a&&c.addClass("past"),c.css("display","none"),sa===!0&&(a*=2),b.send(b.Events.UNLOAD_PAGE,a+1),sa===!0){var d=Math.min(pa-1,a+1);d!==a&&b.send(b.Events.UNLOAD_PAGE,d+1)}}function t(){for(var a=2,b=[],c=Math.max(0,oa-a);c<=Math.min(ma.length-1,oa+a);c++)r(c),b.push(c);var d=_.difference(qa,b);_.each(d,function(a){s(a)}),_.isUndefined(ha)||(ha.removeClass("present"),_.isEmpty(ha.attr("class"))&&ha.removeAttr("class")),ha=$(ma[oa]),ha.removeClass("past future"),ha.addClass("present"),qa=b}function u(){return{history:!0,mouseWheel:!0,minScale:.2,maxScale:6,transition:"slide"}}function v(){document.addEventListener("keydown",l,!1),window.addEventListener("resize",ca,!1),c.isTouch===!0&&(ga.parent().on("touchstart",n),ga.parent().on("touchmove",o),ga.parent().on("touchend",p))}function w(a){ga=$(".book"),ma=ga.children("section"),pa=ga.children("section").find(".toast-ctrl").length,na=oa=-1,z(a),x(),v(),ca(),d._initialize(),h(),b.send(b.Events.BOOK_READY)}function x(){switch(_.isUndefined(ia)||_.isNull(ia)||ia.unset(),la.transition){case"slide":ia=new f(a,la);break;case"fade":ia=new g(a,la);break;default:ia=new e(a,la)}}function y(){TT.$el.hasClass("has-book-bg")&&TT.$el.removeClass("has-book-bg"),ja=$(".book-bg"),(0===ja.length||ya!==!0||b.isMobileDevice&&!b.isLandscape())&&(la.useBackground=!1),la.useBackground===!0&&la.useBackground===!0&&(ja.css("background",la.background),za={left:Number(ja.attr("data-offset-left")),right:Number(ja.attr("data-offset-right")),top:Number(ja.attr("data-offset-top")),bottom:Number(ja.attr("data-offset-bottom"))},TT.$el.addClass("has-book-bg"))}function z(a){if(void 0===a)return la;_.isEmpty(la)&&(la=u());var d=!1;if(la.display!==a.display&&-1!==oa){var e=P()[0];"single"===a.display?("flip"===la.transition&&la.cover===!1&&(oa+=e%2===0?1:0),oa=Math.floor(2*oa),"flip"===la.transition&&la.cover===!0&&(oa-=e%2===0?1:0)):("flip"===la.transition&&la.cover===!1&&(oa-=e%2===0?1:0),oa=Math.floor(oa/2),"flip"===la.transition&&la.cover===!0&&(oa+=e%2===0?1:0)),d=!0,oa=Math.max(0,Math.min(Q()-1,oa))}if(la=$.extend(!0,la,b.config.book,a),ya="flip"===la.transition,"double"===la.display?(ga.addClass("doublepage"),sa=!0):(ga.removeClass("doublepage"),sa=!1),la.bookSize={width:sa?2*la.pageSize.width:la.pageSize.width,height:la.pageSize.height},document.removeEventListener("DOMMouseScroll",k,!1),document.removeEventListener("mousewheel",k,!1),la.mouseWheel&&(document.addEventListener("DOMMouseScroll",k,!1),document.addEventListener("mousewheel",k,!1)),window.removeEventListener("hashchange",j,!1),la.history&&window.addEventListener("hashchange",j,!1),c.isTouch&&(document.removeEventListener("gesturestart",q,!1),document.addEventListener("gesturestart",q)),ia&&(ia.updateVisibility()===!1&&(ma=ga.children("section"),pa=ga.children("section").find(".toast-ctrl").length,t()),ia.configure(la),d)){var a={page:oa+1,direction:null};a.prev=1===a.page?null:a.page-1,a.next=a.page===pa?null:a.page+1,ia.set(a)}y(),ca(),d&&b.send(b.Events.PAGE_DID_CHANGE,P(),Q())}function A(a){ia&&ia.unset(),qa=[],z(a)}function B(){if(J()!==!0){var a=P()[0]-1;"double"===la.display&&(a-=1,la.cover===!0&&(a=Math.max(1,a))),H(a)}}function C(){var a=P()[0]+1;"double"===la.display&&("flip"!==la.transition||la.cover===!1||la.cover===!0&&J()!==!0)&&(a+=1),H(a)}function D(){H(1)}function E(){H(Q())}function F(){var a=V();_.each(a,function(a){var b=a.find(".toast-ctrl").children(".contents").children(".html-page");if(_.isUndefined(b[0]))return!0;var c=b.find("iframe[data-src]");if(c.length>0){a.$preloader=$("<div />",{"class":"preloader preloader-md"}),a.$preloader.append($("<span />",{"class":"fa-spin"})),a.append(a.$preloader);var d=[];$.each(c,function(a,b){var c=$(b),e=c.attr("data-src");if(!_.isEmpty(e)){var f=new $.Deferred;d.push(f.promise()),c.removeAttr("data-src"),c.attr("src",e),c.on("load",function(){f.resolve()}).on("onerror",function(){f.resolve()})}});TT.Async.waitForAll(d).then(function(){b.show(),a.$preloader.remove(),a.$preloader=null})}else TT.lazy(function(){b.show()},0)},this)}function G(){var a=V();_.each(a,function(a){var b=a.find(".toast-ctrl"),c=b.children(".contents").children(".html-page");if(_.isUndefined(c[0]))return!0;a.children(".preloader").remove(),c.hide();var d=c.find("iframe");$.each(d,function(a,b){var c=$(b);if(!c.parent().parent().hasClass("toast-object")){var d=c.attr("src");_.isEmpty(d)||(c.attr("data-src",c.attr("src")),c.attr("src",""))}}),d=b.find("video, audio"),$.each(d,function(a,b){"function"==typeof b.pause&&b.pause()})})}function H(a){if(d.isActivate())return void b.BookZoom.deactivate({callback:function(){H(a)}});if(!(oa>=0&&(Q()<a||1>a))){var c=Math.max(0,Math.min(Q()-1,a-1));if("double"===la.display&&(c=Math.floor(c/2),"flip"===la.transition&&la.cover===!0&&(c+=a%2===0?1:0)),c!==oa){_.isNull(ua)||ea(),G(),na=oa,oa=c,(ia.updateVisibility()===!1||-1==na)&&b.send(b.Events.WILL_MOVE_PAGE,P()),ia.updateVisibility()===!1&&t();var e={page:c+1,direction:"right"};e.prev=1===e.page?null:e.page-1,e.next=e.page===pa?null:e.page+1,e.direction=na>oa?"left":"right",ia.set(e),0==oa?ia.move(e):na-1===oa?ia.previous(e):na+1===oa?ia.next(e):ia.move(e),i(),ia.updateVisibility()===!1&&(F(),b.send(b.Events.PAGE_DID_CHANGE,P(),Q()))}}}function I(a,c){c||(c={isLogical:!1});var d=a;if(c.isLogical===!0){var e=la.firstPageNumber-1;d-=e}if(isNaN(Number(a))){var f=TT.StringUtils.format(ka.ERROR_NOT_VALID_PAGE_NUMBER,a);return void b.Dialog.showModalDialog(TT.DefaultDialogs.DIALOG_ID_ERROR,ka.ERROR,f)}(1>d||d>Q())&&(d=P()[0],TT.lazy(function(){var c=TT.StringUtils.format(ka.ERROR_NOT_VALID_PAGE_NUMBER,a);b.Dialog.showModalDialog(TT.DefaultDialogs.DIALOG_ID_ERROR,ka.ERROR,c)},5)),H(d)}function J(){return 0===oa||-1===oa}function K(){return"flip"===la.transition&&L()&&la.cover===!0?P()[0]+Q()%2===Q():L()&&Q()%2===0?P()[0]+1===Q():P()[0]===Q()}function L(){return sa}function M(){var a={prev:oa>0,next:!K()};return a}function N(a){0==arguments.length&&(a=!0),ta=a,b.Book.$getBook().turn("disabled",!a)}function O(a){var b=P()[0];return b===a?!0:"flip"===la.transition&&L()&&J()&&la.cover===!0?!1:"double"===la.display&&b+1===a?!0:!1}function P(){var a=[],b=Math.max(1,oa+1);return"double"===la.display&&(b=2*b-1,la.cover===!0&&"flip"===la.transition&&(b-=1)),b=Math.max(1,Math.min(Q(),b)),a.push(b),"double"===la.display&&Q()>=b+1&&(1!==b||la.cover!==!0||"flip"!==la.transition)&&a.push(b+1),a}function Q(){return pa}function R(){var a={current:P()[0],total:Q()},b=la.firstPageNumber-1;return a.current=P()[0]+b,a.total=Q()+b,a}function S(a){var b=la.firstPageNumber-1;return a+b}function T(){return ga}function U(a){var b={page:{width:0,height:0},fit:{width:ga.width(),height:ga.height()}},c=P();if(L()){var d;if(1===c.length)d=TT.project.viewControllers[c[0]-1];else{var e=TT.project.viewControllers[c[0]-1],f=TT.project.viewControllers[c[1]-1],g=Math.max(e.collection.width,e.collection.height),h=Math.max(f.collection.width,f.collection.height);d=h>g?f:e}b.page.width=d.collection.width,b.page.height=d.collection.height}else{var d=TT.project.viewControllers[c[0]-1];b.page.width=d.collection.width,b.page.height=d.collection.height}return ya&&W()&&(b.fit.width/=2),b}function V(a){var b=[];if("flip"===la.transition){var c=ga.turn("view"),d=ga.data().pages;return _.each(c,function(c){if(!_.isUndefined(d[c])){var e=d[c].parents(".page-wrapper");a===!0&&(e=e.clone(!0,!0),e.bookTransform("")),b.push(e)}}),b}if(a===!0){var e=ha.clone(!0,!0);e.bookTransform(""),b.push(e)}else ha&&b.push(ha);return b}function W(){return ga.parent().hasClass("cover")}function X(){return ma}function Y(){return oa}function Z(a){na=oa,"backward"===a?oa-=1:"forward"===a&&(oa+=1);var b="/"+R().current;wa=!0,window.location.hash=b,G()}function aa(){return qa}function ba(a){var c;if(c=a instanceof TT.ViewController?a:TT.project.viewControllers[a-1],!_.isUndefined(c)&&c.isLoaded===!0){var d={width:c.collection.width,height:c.collection.height},e=Math.min(c.$el.parent().width()/d.width,c.$el.parent().height()/d.height),f=parseInt(d.width*e),g=parseInt(d.height*e);f+=f%2,Math.abs(c.$el.parent().width()-f)<=2&&(f=c.$el.parent().width()),g+=g%2,Math.abs(c.$el.parent().height()-g)<=2&&(g=c.$el.parent().height()),c.$el.css({width:f+"px",height:g+"px"});var h=c.$contents;if(h.css({width:d.width+"px",height:d.height+"px"}),e=Math.max(f/d.width,g/d.height),1!==e){var i=(f-d.width)/2/e,j=(g-d.height)/2/e;h.tt_transform("scale("+e+") translate("+i+"px, "+j+"px)")}c.contentScale=e,c.trigger(b.Events.CONTENT_SCALE_DID_CHANGE,e)}}function ca(){if(ga){var a=ga.parent(),b=Math.min(a.width()/la.bookSize.width,a.height()/la.bookSize.height),c=parseInt(la.bookSize.width*b);c+=c%2,c+=c/2%2*2;var d=parseInt(la.bookSize.height*b);d+=d%2;var e=parseInt((a.width()-c)/2);e+=e%2;var f=parseInt((a.height()-d)/2);if(f+=e%2,ga.css({left:e+"px",top:f+"px",width:c+"px",height:d+"px"}),ga.attr({"data-left":e,"data-top":f,"data-width":c,"data-height":d}),la.useBackground){var g,h,i,j;g=e-za.left,h=f-za.top,i=c+za.left+za.right,j=d+za.top+za.bottom,ja.css({left:g+"px",top:h+"px",width:i+"px",height:j+"px"}),ja.children().eq(0).css({left:i-(c+za.left+10)+"px",right:i-(c+za.right+10)+"px",top:j-(d+za.top-12)+"px",bottom:j-(d+za.top-12)+"px"}),ja.children().eq(1).css({left:i-(c+za.left+8)+"px",right:i-(c+za.right+8)+"px",top:j-(d+za.top-8)+"px",bottom:j-(d+za.top-8)+"px"}),ja.children().eq(2).css({left:i-(c+za.left+5)+"px",right:i-(c+za.right+5)+"px",top:j-(d+za.top-5)+"px",bottom:j-(d+za.top-5)+"px"})}_.isUndefined(ia)||_.isNull(ia)||ia.resize(),_.each(TT.project.__loadedPages__,function(a){ba(a)})}}function da(){_.isNull(ua)&&(ua=ga.children(".book-overlay"),_.isUndefined(ua[0])&&(ua=$("<div />",{"class":"book-overlay"}),ga.append(ua),ua.on("click",fa)))}function ea(){_.isNull(ua)||(ua.off("click",fa),ua.remove(),ua=null)}function fa(){ua&&(ua.off("click",fa),ua.remove(),ua=null)}var ga,ha,ia,ja,ka=b.Strings,la={},ma=[],na=-1,oa=0,pa=0,qa=[],ra=0,sa=!1,ta=!0,ua=null,va={startX:0,startY:0,startSpan:0,startCount:0,captured:!1,threshold:40},wa=!1,xa=!1,ya=!0,za={left:0,right:0,top:0,bottom:0};b.on(b.Events.THEME_DID_LOAD,function(){ca()}),b.CommandManager.registerInternal(b.Commands.MOVE_PAGE,I),b.CommandManager.registerInternal(b.Commands.PREVIOUS_PAGE,B),b.CommandManager.registerInternal(b.Commands.NEXT_PAGE,C),b.CommandManager.registerInternal(b.Commands.FIRST_PAGE,D),b.CommandManager.registerInternal(b.Commands.LAST_PAGE,E),b.Book=a,b.Book.BookCommon=c,a.initialize=w,a.configure=z,a.reset=A,a.previous=B,a.next=C,a.moveToFirst=D,a.moveToLast=E,a.move=I,a.getCurrentPageNumber=P,a.getTotalPageNumber=Q,a.getLogicalPageNumber=R,a.toLogicalPageNumber=S,a.isFirstPage=J,a.isLastPage=K,a.isDoublePage=L,a.availablePageNavigation=M,a.availableCurrentPage=O,a.enableAction=N,a.$getBook=T,a.getCurrentPage=V,a.isCoverPage=W,a.getPages=X,a.getCurrentPageIndex=Y,a.getVisiblePages=aa,a.getBookSize=U,a.turnByUserAction=Z,a.fitPage=ba,a.layout=ca,a._addOverlay=da,a._removeOverlay=ea,a._startEmbeddedContent=F,a._stopEmbeddedContent=G,a._isFlipTransition=ya}),define("toast/core/Project",["exports","../core","./Collection","./Model","./ViewController","../utils","../events"],function(a,b,c,d,e){"use strict";function f(){return e.getDefaultAttributes()}var g,h={id:"project-213b-aa20-08344f936337",version:"5.8.342",title:"Toast Project",description:"",metadata:{},config:{defaultPageWidth:595,defaultPageHeight:845,userStylesheets:[],mobile:{},transition:"flip",doublepage:!0,firstPageNumber:1,print:!0,shadow:!0},pages:[],subpages:[]},i=c.extend();_.extend(i,{initialize:function(a){return h.id=b.dateUUID().prefix("project-"),a||(a={}),_.isNull(a.attributes)||_.isUndefined(a.attributes)?a.attributes=_.clone(h):a.attributes=_.extend(_.clone(h),a.attributes),(_.isNull(a.model)||_.isUndefined(a.model))&&(a.model=d.extend({defaults:f})),g=new i(null,a),a.editor?g.setParsedVersion():_.isUndefined(b.config.projectLoader)?g.__loadProject__(a):b.load([b.config.projectLoader],function(b){b.init(a)},function(){g.__loadProject__(a)}),g}});var j=c.prototype;return _.extend(i.prototype,{subpages:new c(null,{model:d.extend({defaults:f})}),containers:new c(null,{model:d.extend({defaults:f})}),getProjectPath:function(){return _.isUndefined(b.config.projectUrl)||_.isEmpty(b.config.projectUrl)?b.paths.projectRoot+b.paths.projectFile:b.config.projectUrl},load:function(a,e){this.reset(),"string"==typeof a&&(a=JSON.parse(a));var g;a.pages?(g=$.extend(!0,{},a.pages),a.pages&&delete a.pages):a.collection&&(g=$.extend(!0,{},a.collection),a.collection&&delete a.collection);var i=$.extend(!0,[],a.subpages);a.subpages&&delete a.subpages;var j=this.attributes;this.attributes=_.extend(j,a);for(var k in this.attributes)this.defineProperty(k);_.each(g,function(a){var b=a.subpages;a.subpages&&delete a.subpages;var g=new this.model(a);this.createChildren(g,a),g.unset("children",{silent:!0}),this.add(g,e),g.subpages=new c(null,{model:d.extend({defaults:f})}),_.each(b,function(a){var b=new this.model(a);this.createChildren(b,a),b.unset("children",{silent:!0}),g.subpages.add(b,e)},this)},this),_.each(i,function(a){var b=new this.model(a);this.createChildren(b,a),b.unset("children",{silent:!0}),this.subpages.add(b,e)},this),this.config=_.extend(_.clone(h.config),this.config),this._loadUserStylesheets(!0),this.setParsedVersion(),b.Assets.load()},reset:function(a,c){return a=j._reset.call(this,a,c),this.subpages.reset(),this.containers.reset(),b.Assets.load(),a},setParsedVersion:function(){var a=/([0-9]+)\.([0-9]+)\.([0-9]+)/.exec(this.version);a.VERSION_MAJOR=Number(a[1]),a.VERSION_MINOR=Number(a[2]),a.VERSION_PATCH=Number(a[3]),this.parsedVersion=a},updateVersion:function(){this.version=h.version,this.setParsedVersion()},finds:function(a,b){var e=[];return a instanceof d?a=_.isUndefined(a.contents)?[a]:a.contents:a instanceof c?a=a.models:_.isArray(a)||(a=[a]),_.each(a,function(a){b?a[b.name]===b.value&&e.push(a):e.push(a),_.isEmpty(a.children)?_.isEmpty(a.contents)||this._findChildren(e,a.contents,b):this._findChildren(e,a.children,b)},this),e},findAll:function(a){var b=[];return _.each(this.models,function(c){c.contents&&(b=b.concat(this.finds(c.contents,a))),c.collection&&c.collection!==this&&(b=b.concat(this.finds(c.collection,a))),_.each(c.subpages.models,function(c){c.contents&&(b=b.concat(this.finds(c.contents,a)))},this)},this),_.each(this.subpages.models,function(c){c.contents&&(b=b.concat(this.finds(c.contents,a)))},this),b},_findChildren:function(a,b,c){_.each(b,function(b){c?b[c.name]===c.value&&a.push(b):a.push(b),_.isEmpty(b.children)?_.isEmpty(b.contents)||this._findChildren(a,b.contents,c):this._findChildren(a,b.children,c)},this)},findAssets:function(a){var c=[],d=this.finds(a);return _.each(d,function(a){this.findProperty(a,function(a){if("as-"===a.substr(0,3)){var d=b.Assets.find(a);d&&c.push(d)}})},this),c},findProperty:function(a,b){var c=[];_.isUndefined(a.properties)||c.push(a.properties),_.each(a.actions,function(a){c.push(a.properties)}),_.each(c,function(a){this._findProperty(a,b)},this)},_findProperty:function(a,b){_.each(Object.keys(a),function(c){var d=a[c];if(_.isEmpty(d))return!0;if(_.isArray(d))_.each(d,function(a,e){if(_.isEmpty(a))return!0;if(_.isObject(a))this._findProperty(a,b);else{var f=b(a,c);_.isUndefined(f)||(d[e]=f)}},this);else if(_.isObject(d))this._findProperty(d,b);else{var e=b(d,c);_.isUndefined(e)||(a[c]=e)}},this)},output:function(a){var c=this.attributes;return c.pages=this.toJSON(),c.subpages=this.subpages.toJSON(),b.ImageAssets&&(c.assets.image=b.ImageAssets.output()),b.AudioAssets&&(c.assets.audio=b.AudioAssets.output()),b.MovieAssets&&(c.assets.movie=b.MovieAssets.output()),b.SVGAssets&&(c.assets.svg=b.SVGAssets.output()),b.FlashAssets&&(c.assets.flash=b.FlashAssets.output()),tt.debug?JSON.stringify(c,null,4):JSON.stringify(c)},text:function(){var a=[];return _.each(this.models,function(b){var c={id:b.id,text:""},d=this.finds(b.contents);_.each(d,function(a){void 0!==a.htmlText&&"string"==typeof a.htmlText&&(_.isEmpty(c.text)||(c.text+=" "),c.text+=a.htmlText.removeTags()),void 0!==a.text&&"string"==typeof a.text&&(_.isEmpty(c.text)||(c.text+=" "),c.text+=a.text.removeTags())},this),a.push(c)},this),a},_loadUserStylesheets:function(a){a&&$(".userStylesheet").remove();var c=$("head");_.each(this.config.userStylesheets,function(a){if(_.isEmpty(c.children("#"+a.id))){var d={id:a.id,type:"text/css",rel:"stylesheet",href:b.paths.assets+a.src},e=$('<link class="userStylesheet" />').attr(d);e.appendTo(c)}},this)},__loadProject__:function(a){if(!_.isUndefined(window.project))return this.load(window.project),void this.__build__();var b=new Backbone.Model;b.fetch({url:this.getProjectPath(),success:function(a,b){this.load(b),this.__build__()}.bind(this),error:function(a,b){TT.log("error ",b)}.bind(this)})},__build__:function(){b.params.get("doublepage")&&(this.config.doublepage="true"===b.params.get("doublepage")?!0:!1),_.isUndefined(this.config.mobile.doublepage)&&(this.config.mobile.doublepage=!1),b.isMobileDevice&&(this.config.doublepage=this.config.mobile.doublepage),b.config=_.extend(b.config,this.config),this.config.mobile||(this.config.mobile={}),this.__createPageHTMLDocument__(),b.on(b.Events.LOAD_PAGE,$.proxy(this.__onLoad__,this)),b.on(b.Events.UNLOAD_PAGE,$.proxy(this.__onUnload__,this)),b.on(b.Events.THEME_DID_LOAD,$.proxy(this.__onThemeDidLoad__,this)),b.on(b.Events.THEME_DID_UNLOAD,$.proxy(this.__onThemeDidUnLoad__,this)),b.on(b.Events.ORIENTATION_DID_CHANGE,$.proxy(this.__onOrientationChange__,this)),b.CommandManager.registerInternal(b.Commands.PLAY_BGSOUND,$.proxy(this.__excutePlayBgSoundCommand__,this)),b.CommandManager.registerInternal(b.Commands.PAUSE_BGSOUND,$.proxy(this.__excutePauseBgSoundCommand__,this)),b.CommandManager.registerInternal(b.Commands.TOGGLE_BGSOUND,$.proxy(this.__excuteToggleBgSoundCommand__,this)),b.CommandManager.registerInternal(b.Commands.TOGGLE_DOUBLEPAGE,$.proxy(this.__excuteToggleDoublePageCommand__,this)),b.CommandManager.registerInternal(b.Commands.DOUBLE_PAGE,$.proxy(this.__excuteToggleDoublePageCommand__,this)),b.dispatchReady(b.PROJECT_LOADED)},__createPageHTMLDocument__:function(){var a=$(".book");a.children().remove(),this.__loadedPages__=[],this.viewControllers=[];var c="flip"===b.config.transition;if(c)for(var d=0;d<this.models.length;d++){var f=this.models[d],g=$("<section />"),h=$("<div />",{id:f.id,"class":"toast-ctrl","data-index":d}),i=new e({el:h});i.index=d,this.viewControllers.push(i),g.append(h),a.append(g)}else for(var d=0;d<this.models.length;d++){var f=this.models[d],g=$("<section />"),h=$("<div />",{id:f.id,"class":"toast-ctrl","data-index":d}),i=new e({el:h});if(i.index=d,this.viewControllers.push(i),this.config.doublepage){var j=$("<div />",{"class":"wrapper"});j.append(h),g.append(j)}else g.append(h);if(this.config.doublepage&&d+1<this.models.length){f=this.models[d+1];var h=$("<div />",{id:f.id,"class":"toast-ctrl","data-index":d+1}),j=$("<div />",{"class":"wrapper"});j.append(h),g.append(j);var i=new e({el:h});i.index=d+1,this.viewControllers.push(i),d++}a.append(g)}},__onLoad__:function(a){this.__load__(a-1)},__load__:function(a){var c=this.viewControllers[a];if(!_.isUndefined(c)&&(c.isLoaded!==!0||0===c.$el.children().length&&!c.__hasBackgroundImage__())){var d=this.models[a];c.load(d.toJSON(),{showLoader:!0,readyonly:!0}),c.isLoaded=!0,this.__loadedPages__.push(a+1),this.__loadedPages__.sort(function(a,b){return a-b}),b.Book.fitPage(a+1),b.send(b.Events.PAGE_DID_LOAD,a+1)}},__onUnload__:function(a){this.__unload__(a-1)},__unload__:function(a){var c=this.viewControllers[a];_.isUndefined(c)||(c.reset(),c.isLoaded=!1,this.__loadedPages__=_.without(this.__loadedPages__,a+1),this.__loadedPages__.sort(function(a,b){return a-b}),b.send(b.Events.PAGE_DID_UNLOAD,a+1))},__onThemeDidLoad__:function(){if(!_.isEmpty(this.config.logo)){var a=$("<img />");if(void 0!==this.config.logo.src)a[0].src=this.config.logo.src;else if(void 0!==this.config.logo.url){var c=b.StringUtils.replaceTemplate(this.config.logo.url).encodeFilePath();a[0].src=c}var d=$(".toast").find(".navbar-brand");d.html(a)}if(!_.isEmpty(this.config.bgImage)){var c=b.StringUtils.replaceTemplate(this.config.bgImage.url).encodeFilePath();$(".toast").css({backgroundImage:'url("'+c+'")',backgroundSize:"cover",backgroundPosition:"50% 50%",backgroundRepeat:"no-repeat"})}if(!_.isEmpty(b.project.config.bgSound)&&_.isUndefined(this.$bgSound)){var c=b.StringUtils.replaceTemplate(b.project.config.bgSound.url).encodeFilePath();this.$bgSound=$("<audio>",{id:"tt-bgsound",src:c,loop:"loop"}),$(".toast").append(this.$bgSound),this.__excutePlayBgSoundCommand__()}},__onThemeDidUnLoad__:function(){},__excutePlayBgSoundCommand__:function(){this.$bgSound.attr("data-playing",!0),this.$bgSound[0].play()},__excutePauseBgSoundCommand__:function(){this.$bgSound.attr("data-playing",""),this.$bgSound[0].pause()},__excuteToggleBgSoundCommand__:function(){"true"===this.$bgSound.attr("data-playing")?this.__excutePauseBgSoundCommand__():this.__excutePlayBgSoundCommand__()},__onOrientationChange__:function(a){b.isMobileDevice&&(this.config.mobile.landscapeDoublePage&&this.config.mobile.doublepage!==!0?"landscape"===a?this.__setDoublePage__(!0):this.__setDoublePage__(!1):b.Book.layout())},__setDoublePage__:function(a){if(b.BookZoom.isActivate()){var c=this;return void b.BookZoom.deactivate({callback:function(){c.__setDoublePage__(a)}})}var d=this.config.doublepage;if(this.config.doublepage=a,b.config.doublepage=a,"flip"!==this.config.transition){var e=b.Book.getVisiblePages();_.each(e,function(a){d===!0&&(a*=2),this.__unload__(a),d===!0&&this.__unload__(a+1)},this),this.__createPageHTMLDocument__()}b.config.doublepage=this.config.doublepage=a,b.Book.reset({display:this.config.doublepage?"double":"single"}),b.send(b.Events.DOUBLEPAGE_DID_CHANGE,b.config.doublepage)},__excuteToggleDoublePageCommand__:function(){var a=!this.config.doublepage;this.__setDoublePage__(a)}}),i.__ATTRIBUTES__=h,i.getModelAttributes=f,b.Project=i}),define("toast/core/Assets",["exports","../core","./Init"],function(a,b){"use strict";function c(){return o}function d(a){var c;switch(a){case"image":c=b.ImageAssets;break;case"audio":c=b.AudioAssets;break;case"movie":c=b.MovieAssets;break;case"svg":c=b.SVGAssets;break;case"flash":c=b.FlashAssets}return c}function e(a){var b;return a=a.toLowerCase(),_.each(c(),function(c){var d;return _.each(c.fileTypes,function(b){return b.toLowerCase()===a?(d=c,!1):void 0}),d?(b=c,!1):void 0}),b}function f(a){var b;return _.each(c(),function(c){return b=c.folder(a),b?!1:void 0}),b}function g(a){var b;return _.each(c(),function(c){return b=c.get(a),b?!1:void 0}),b}function h(a){var b;return _.each(c(),function(c){var d=c.values();return _.each(d,function(c){return c.url.getBaseName()===a?(b=c,!1):void 0}),b?!1:void 0}),b}function i(){var a=[];return _.each(c(),function(b){a=a.concat(b.values())}),a}function j(a){_.each(c(),function(b){var c=b.get(a);return c?(b.unset(a),!1):void 0})}function k(){var a={image:{folders:[],assets:[]},audio:{folders:[],assets:[]},movie:{folders:[],assets:[]},svg:{folders:[],assets:[]},flash:{folders:[],assets:[]}};b.project.attributes.assets=a,b.project.defineProperty("assets")}function l(){_.isUndefined(b.project.assets)&&k(),b.ImageAssets=new n({name:"image",fileTypes:["jpg","jpeg","png","gif"]}),b.AudioAssets=new n({name:"audio",fileTypes:["mp3","ogg"]}),b.MovieAssets=new n({name:"movie",fileTypes:["mp4"]}),b.SVGAssets=new n({name:"svg",fileTypes:["svg"]}),b.FlashAssets=new n({name:"flash",fileTypes:["swf"]}),o=[],o.push(b.ImageAssets),o.push(b.AudioAssets),o.push(b.MovieAssets),o.push(b.SVGAssets),o.push(b.FlashAssets)}var m=b.Strings,n=function(a){for(var b in a)this[b]=a[b];this._folders=[],this._assets=[],this.initialize.apply(this,arguments)};_.extend(n.prototype,{initialize:function(){if(_.each(b.project.assets[this.name].folders,function(a){a._default&&(this._defaultFolder=a),this._folders[a.id]=a},this),_.each(b.project.assets[this.name].assets,function(a){this._assets[a.id]=a},this),_.isEmpty(Object.keys(this._folders)))this._setDefaults();else if(!this._defaultFolder){var a=b.project.assets[this.name].folders[0];a&&(a._default=!0,this._defaultFolder=a)}},_setDefaults:function(a){a||(a={folder:!0}),a.folder&&(this._defaultFolder={id:b.UUID6().prefix("as-"),_default:!0,readonly:!0,lock:!1,name:m.DEFAULT_FOLDER},this._folders[this._defaultFolder.id]=this._defaultFolder)},_getDefaultFolder:function(){return this._defaultFolder},values:function(a){var b=[];return a||(a={folder:!1}),a.folder===!0?_.each(Object.keys(this._folders),function(a){b.push(this._folders[a])},this):a.folderId?_.each(Object.keys(this._assets),function(c){a.folderId===this._assets[c].fid&&b.push(this._assets[c])},this):_.each(Object.keys(this._assets),function(a){b.push(this._assets[a])},this),b},set:function(a,c){c||(c={folder:!1});var d;return c.folder===!0?d=this._folders:(d=this._assets,_.isUndefined(a.ref)&&(a.ref=0),_.isEmpty(a.name)&&!_.isEmpty(a.url)&&(a.name=a.url.getBaseName().getFilenameWithoutExtension()),_.isEmpty(a.fid)&&(a.fid=this._getDefaultFolder().id)),_.isEmpty(a.id)&&(a.id=b.UUID6().prefix("as-")),"as-"!==a.id.substr(0,3)&&(a.id="as-"+a.id),a=_.extend({},d[a.id],a),d[a.id]=a,a},unset:function(a,b){if(b||(b={folder:!1}),b.folder===!0){var c=this.values({folderId:a});return _.each(c,function(a){a.fid=this._defaultFolder.id},this),delete this._folders[a],this._folders}return delete this._assets[a],this._assets},folder:function(a){return this._folders[a]},get:function(a,b){return this._assets[a]},url:function(a){var c,d=this._assets[a];return d&&d.url&&(c=b.StringUtils.replaceTemplate(d.url).encodeFilePath()),c},allKeys:function(a){return a||(a={folder:!1}),a.folder===!0?Object.keys(this._folders):Object.keys(this._assets)},reorder:function(a,b){var c=[];b||(b={folder:!1});var d;d=b.folder===!0?this._folders:this._assets;var e=[];return _.each(a,function(a){var b=d[a];b&&(e[a]=b,c.push(b),delete d[a])},this),_.each(Object.keys(e),function(a){d[a]=e[a]},this),c},ref:function(a){var b=this._assets[a];return b&&b.ref++,b},unref:function(a){var b=this._assets[a];return b&&(b.ref=Math.min(0,b.ref--)),b},gc:function(){var a=[];return _.each(Object.keys(this._assets),function(b){var c=this._assets[b];c&&!c.ref&&a.push(c)},this),a},output:function(a){a||(a={stringify:!1});var b={folders:[],assets:[]};return b.folders=this.values({folder:!0}),b.assets=this.values(),a.stringify?JSON.stringify(b,null,4):b}});var o=[];a.load=l,a.findCollection=d,a.findCollectionByFileType=e,a.collections=c,a.folder=f,a.find=g,a.findByFilename=h,a.allAssets=i,a.unset=j,b.Assets=a}),define("toast/core/StartMenu",["exports","../core","./Collection","./Model","./ViewController","../utils","../events"],function(a,b){"use strict";function c(){if(m=l.find(".start-menu"),!_.isUndefined(m[0])){0===m.children().length&&(m=m.replaceWith(k),m=l.find(".start-menu"));var a=m.find('li[command="toggleBgSound"]');if(_.isEmpty(b.project.config.bgSound)?a.remove():a.append('<a class="dropdown-toggle"><span class="glyphicon glyphicon-play" />  </a>'),m.on("show.bs.dropdown",function(){d()}),m.find("li").on("click",e),!_.isEmpty(b.config.themes)&&b.config.themes.length>1){var c="";_.each(b.config.themes,function(a){c+='<li data-theme="'+a.name+'"><a class="dropdown-toggle">'+a.label+"</a></li>"}),m.find("#theme-menu").append(c);var g=b._getTheme();m.find("#theme-menu").children('li[data-theme="'+g+'"]').children("a").addClass("checked"),m.find("#theme-menu").children("li").on("click",f)}b.config.doublepage&&m.find('[command="toggleDoublePage"]').children("a").addClass("checked"),(b.isMobileDevice||b._msieVersion&&b._msieVersion<11)&&m.find('[command="fullscreen"]').remove(),
b.isMobileDevice&&m.find('[command="print"]').remove();var h=m.find(".divider");_.each(h,function(a){var b=$(a),c=b.next();_.isUndefined(c[0])?b.remove():_.isUndefined(c.css("display"))||"none"!==c.css("display")||b.remove()}),b.send(b.Events.START_MENU_DID_LOAD)}}function d(a){b.isMobileDevice||(h()?m.find('li[command="fullscreen"]').children("a").html('<span class="glyphicon glyphicon-fullscreen" />'+n.EXIT_FULLSCREEN):m.find('li[command="fullscreen"]').children("a").html('<span class="glyphicon glyphicon-fullscreen" />'+n.START_FULLSCREEN));var c=$(".toast").find("#tt-bgsound");_.isUndefined(c[0])||("true"===c.attr("data-playing")?m.find('li[command="toggleBgSound"]').children("a").html('<span class="glyphicon glyphicon-volume-up" />  '):m.find('li[command="toggleBgSound"]').children("a").html('<span class="glyphicon glyphicon-volume-off" />  ')),b.config.doublepage?m.find('[command="toggleDoublePage"]').children("a").addClass("checked"):m.find('[command="toggleDoublePage"]').children("a").removeClass("checked"),TT.send(b.Events.BEFORE_SHOW_DROPDOWN_MENU,m)}function e(a){var c=$(a.currentTarget).attr("command");if(b.isMobileDevice&&m.find(".dropdown-submenu").removeClass("open"),_.isUndefined(c)){if(b.isMobileDevice&&$(a.currentTarget).hasClass("dropdown-submenu")&&!$(a.currentTarget).hasClass("open"))return $(a.currentTarget).addClass("open"),!1}else b.CommandManager.execute(c),m.children(".start-menu-toggle").dropdown("toggle")}function f(a){var d=$(a.currentTarget),e=d.attr("data-theme");b.ThemeLoader.load(e,"styles/themes/"+e+"/","theme").done(function(){c()}),b.LocalStorage.setItem(b.project.config.publishUniqueId+"-toast-theme",e)}function g(){h()?j():i(document.documentElement)}function h(){return"undefined"!=typeof external&&"undefined"!=typeof external.isFullscreen?external.isFullscreen():document.fullscreenElement?document.fullscreenElement:document.msFullscreenElement?document.msFullscreenElement:document.mozFullScreenElement?document.mozFullScreenElement:document.webkitFullscreenElement?document.webkitFullscreenElement:void 0}function i(a){a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()}function j(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}var k,l,m,n=b.Strings;b.on(b.Events.BOOK_READY,function(){l=$(".toast"),k=b.ThemeLoader.getHTMLTemplates().Startmenu,c(),b.CommandManager.registerInternal("fullscreen",g)})}),define("toast/core2",["./core","./core/Init","./core/Model","./core/Collection","./core/ViewController","./core/book/Book","./core/Factory","./core/Project","./core/Contents","./core/Assets","./core/StartMenu"],function(a){}),define("toast/dialogs/DefaultDialogs",["exports","../core"],function(a,b){"use strict";a.DIALOG_ID_ERROR="error-dialog",a.DIALOG_ID_INFO="error-dialog",a.DIALOG_ID_SAVE_CLOSE="save-close-dialog",a.DIALOG_ID_OK_CANCEL="ok-cancel-dailog",a.DIALOG_ID_OK="ok-dailog",b.DefaultDialogs=a}),define("text!toast/html-templates/dialog-template.html",[],function(){return'<div class="modal fade modal-dialog-center {{modalClassName}}" role="dialog" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">{{title}}</h4>\n      </div>\n      <div class="modal-body">\n        {{{content}}}\n      </div>\n      <div class="modal-footer">\n        {{#buttons}}\n        <button class="dialog-button btn {{className}}" data-button-id="{{id}}">{{text}}</button>\n        {{/buttons}}\n      </div>\n    </div>\n  </div>\n</div>\n\n'}),define("toast/dialogs/Dialog",["exports","../core","./DefaultDialogs","text!toast/html-templates/dialog-template.html"],function(a,b,c,d){"use strict";function e(a,b){a.data("buttonId",b),a.modal("hide")}function f(a,b,c){c?e(a,b):a.triggerHandler("buttonClick",b)}function g(a,b,c){if(this._$dlg=a,this._promise=b,c){var d={isMouseDown:!1,mouseOffset:{}},e=this.getElement(),f=this.getElement().find(".modal-header");f.addClass("draggable").on("mousedown",function(a){d.isMouseDown=!0;var b=e.offset();d.mouseOffset={top:a.clientY-b.top,left:a.clientX-b.left}}),this.getElement().on("mouseup mouseleave",function(a){d.isMouseDown=!1}),$(document.body).on("mousemove",{dialog:this},function(a){d.isMouseDown&&e.offset({top:a.clientY-d.mouseOffset.top,left:a.clientX-d.mouseOffset.left})})}}function h(){var a,b,c=$(".modal-inner-wrapper > .instance");c.length>0&&(a=$("body").width(),b=$("body").height(),c.css({"max-width":a,"max-height":b,overflow:"auto"}))}function i(a,b,d){var e=new $.Deferred,f=[],g=d.className;return g===c.DIALOG_ID_OK_CANCEL&&f.push({className:y,id:o,text:n.CANCEL}),f.push({className:v,id:p,text:n.OK}),k(g,b,a,f).done(function(a){a===o?e.reject():a===p?e.resolve(a):e.reject()}),e.promise()}function j(a,b,c){void 0===b&&(b=!0),$("body").append("<div class='modal-wrapper'><div class='modal-inner-wrapper'></div></div>");var d=new $.Deferred,e=d.promise(),i=$(a).addClass("instance").appendTo(".modal-inner-wrapper:last");return h(),i.data("promise",e),i.one("hidden.bs.modal",function(){var a=i.data("buttonId");a||(a=o),window.setTimeout(function(){d.resolve(a)},0),i.remove(),$(".modal-wrapper:last").remove()}).one("shown.bs.modal",function(){var a=i.find(".primary:enabled"),b=i.find(".modal-footer .dialog-button:enabled:eq(0)");a.length?a.focus():b.length?b.focus():document.activeElement.blur()}),i.on("click.bs.modal",".dialog-button",function(a){f(i,$(this).attr("data-button-id"),b)}),i.modal({backdrop:"static",show:!0,selector:".modal-inner-wrapper:last",keyboard:!1}).css("z-index",A+1).next().css("z-index",A),A+=2,new g(i,e,c)}function k(a,b,c,e,f,g){var h={modalClassName:a,title:b||"",content:c||"",buttons:e||[{className:v,id:p,text:n.OK}]},i=Mustache.render(d,h);return j(i,f,g)}function l(a,b,d){return i(a,b,{className:c.DIALOG_ID_OK_CANCEL})}function m(a,b,d){return b||(b=n.ALERT_TITLE),i(a,b,{className:c.DIALOG_ID_OK})}var n=b.Strings,o="cancel",p="ok",q="dontsave",r="close_after_save",s="save_as",t="_canceled",u="download",v="btn-primary",w="btn-success",x="btn-danger",y="",z="pull-left",A=1050;g.prototype.getElement=function(){return this._$dlg},g.prototype.getPromise=function(){return this._promise},g.prototype.close=function(){this._$dlg.is(":visible")&&e(this._$dlg,t)},g.prototype.done=function(a){this._promise.done(a)},window.addEventListener("resize",h),a.DIALOG_BTN_CANCEL=o,a.DIALOG_BTN_OK=p,a.DIALOG_BTN_DONTSAVE=q,a.DIALOG_BTN_CLOSE_AFTER_SAVE=r,a.DIALOG_BTN_SAVE_AS=s,a.DIALOG_CANCELED=t,a.DIALOG_BTN_DOWNLOAD=u,a.DIALOG_BTN_CLASS_PRIMARY=v,a.DIALOG_BTN_CLASS_SUCCESS=w,a.DIALOG_BTN_CLASS_DANGER=x,a.DIALOG_BTN_CLASS_NORMAL=y,a.DIALOG_BTN_CLASS_LEFT=z,a.showModalDialog=k,a.showModalDialogUsingTemplate=j,a.confirm=l,a.alert=m,b.Dialog=a}),define("text!toast/html-templates/spin-dialog-template.html",[],function(){return'<div class="spinner-wrap">\n	<div class="spinner-container" style="height:44px;"></div>\n	<div class="message" style="text-align:center"></div>\n	<div class="progress">\n		<div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">\n			<span class="sr-only">0% Complete</span>\n		</div>\n	</div>\n</div>\n\n'}),define("toast/dialogs/SpinDialog",["../core","./Dialog","../libs/Spinner","text!toast/html-templates/spin-dialog-template.html"],function(a,b,c,d){"use strict";var e=a.Strings,f={$dialog:null,$template:null,options:{width:400}};return _.extend(f,{show:function(f,g,h,i){i=i||{cancel:null};var j=new $.Deferred;if(void 0!=$(".spin-dialog").get(0))return setTimeout(function(){j.reject()},1),j.promise();var k=Mustache.render(d);this.$template=$(k),f&&f.length>0&&this.$template.find(".message").html(f);var l={width:2,top:f&&0!=f.length||g&&0!=g.length?"30%":"50%"},m=this.$template.find(".spinner-container"),n=new c(l).spin();m.append(n.el);var o=null;return i.cancel&&(o=[{className:b.DIALOG_BTN_CLASS_NORMAL,id:b.DIALOG_BTN_CANCEL,text:e.CANCEL}]),this.$dialog=b.showModalDialog("spin-dialog",g,this.$template[0].outerHTML,o,i.cancel?!1:!0),a._msieVersion&&a._msieVersion<10?a.lazy(function(){j.resolve()},5):this.$dialog.getElement().one("shown.bs.modal",function(){j.resolve()}),g&&0!=g.length?this.$dialog.getElement().find(".close").remove():this.$dialog.getElement().find(".modal-header").remove(),this.$progress=this.$dialog.getElement().find(".progress"),this.$progressbar=this.$progress.find(".progress-bar"),h||this.$progress.css("display","none"),i.cancel?(this.$dialog.getElement().find(".modal-footer").css("textAlign","center"),this.$dialog.getElement().on("buttonClick",$.proxy(this._onCancelClick,this,i.cancel))):this.$dialog.getElement().find(".modal-footer").remove(),this.$dialog.getElement().children(".modal-dialog").css("width",this.options.width+"px"),j.promise()},showProgress:function(){this.$progress.css("display","")},hideProgress:function(){this.$progressbar.attr("aria-valuenow",0),this.$progressbar.css("width","0%"),this.$progressbar.find(".sr-only").text(""),this.$progress.css("display","none")},updateProgress:function(a){"none"==this.$progress.css("display")&&this.showProgress(),this.$progressbar.attr("aria-valuenow",a),this.$progressbar.css("width",a+"%"),this.$progressbar.children().text(a+"% Complete")},updateMessage:function(a,b){this.$dialog.getElement().find(".modal-header .modal-title").html(b),this.$dialog.getElement().find(".modal-body .message").html(a)},enableCancelButton:function(a){a===!0?this.$dialog.getElement().find('.modal-footer [data-button-id"'+b.DIALOG_BTN_CANCEL+'"]').find("#"+b.DIALOG_BTN_CANCEL).tt_enable():this.$dialog.getElement().find('.modal-footer [data-button-id="'+b.DIALOG_BTN_CANCEL+'"]').tt_disable()},hideCancelBlock:function(){this.$dialog.getElement().find(".modal-footer").remove()},hide:function(){var a=new $.Deferred;return this.$dialog.getElement().one("hidden.bs.modal",function(){a.resolve()}),this.$dialog.close(),a.promise()},_onCancelClick:function(a,b,c){a&&a()}}),a.SpinDialog=f}),define("toast/dialogs",["./core","./dialogs/DefaultDialogs","./dialogs/Dialog","./dialogs/SpinDialog"],function(a){}),define("toast/widgets/UIWidgetPrivate",["../core","../views/UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{showLabel:!0,allowRotate:!1,style:{},getDefineProperties:function(){return[]},initialize:function(a){this.style=_.extend({},c.style,this.style),this.mergeProperties(c,this),this.label=this.model.label,this.$el.attr("data-widget-private-id",this.model.widgetPrivateID),c.initialize.call(this,a)},update:function(){return c.update.call(this)},render:function(){return c.render.call(this),this}}),a.UIWidgetPrivate=d}),define("toast/widgets/UIWidget",["../core","../views/UIView"],function(a,b){"use strict";var c=b.prototype,d=b.extend();return _.extend(d.prototype,c,{label:"Widget",showLabel:!0,widget:!0,getWidgetActions:function(){return[]},initialize:function(a){c.initialize.call(this,a)},render:function(){return c.render.call(this),this}}),a.UIWidget=d}),define("toast/widgets/UIWidgetContainer",["../core","./UIWidget","../views/UIContainer"],function(a,b,c){"use strict";var d=c.prototype,e=c.extend();return _.extend(e.prototype,d,b.prototype,{initialize:function(a){d.initialize.call(this,a)},render:function(){return d.render.call(this),this}}),a.UIWidgetContainer=e}),define("toast/widgets/UIWidgetSketchPad",["../core","./UIWidgetContainer","../libs/Sketchpad"],function(a,b,c){"use strict";var d=b.prototype,e=b.extend();return _.extend(e.prototype,d,{label:"Widget SketchPad",initialize:function(a){this.mergeProperties(d,this),this.widgetActions=_.extend({},d.getWidgetActions(),this.getWidgetActions()),d.initialize.call(this,a)},renderViewController:function(){d.renderViewController.call(this),this.update()},render:function(){return d.render.call(this),a.lazy(function(){this._lazyRender()},5,this),this},_lazyRender:function(){this._$canvasContainer=this.$el.find('[data-widget-private-id="SketchPad_Canvas_Container"]'),this._$canvasContainer.css({overflow:"hidden"});var b=TT.project.finds(this.viewController.collection.models,{name:"widgetPrivateID",value:"SketchPad_Canvas_Container"},!0),d=$("<canvas />",{"class":"SketchPad_Canvas"});this._$canvasContainer.append(d),this._sketchpad=new c({element:d,width:b[0].width,height:b[0].height}),this._sketchpad.scale=this.viewController.contentScale,this.changePenMode(this.model.properties.changePenMode),this.changeColor(this.model.properties.changeColor),this.changePenSize(this.model.properties.changePenSize),this.changeEraserSize(this.model.properties.changeEraserSize),this.viewController.on(a.Events.CONTENT_SCALE_DID_CHANGE,$.proxy(this._contentScaleDidChangeHandler,this))},present:function(){return d.present.call(this)},update:function(){var a=TT.project.finds(this.viewController.collection.models,{name:"widgetPrivateID",value:"SketchPad_Canvas_Container"},!0);0!==a.length&&(a[0].style.backgroundColor=this.model.properties.canvasColor);var a=this.containerViewController.find("widgetPrivateID","SketchPad_Canvas_Container",!0);return a&&a.view&&(a.style.backgroundColor=this.model.properties.canvasColor,a.view.update()),this},_contentScaleDidChangeHandler:function(a){this._sketchpad.scale=a,this._sketchpad.element.attr("data-scale",a)},changePenMode:function(a){var b,c;"eraser"===a?(b=this._sketchpad.penModes.eraser,c=2*this._penSize):(b=this._sketchpad.penModes.draw,c=this._penSize),b!==this._sketchpad.penMode&&(this._sketchpad.penMode=b,this._sketchpad.penSize=c,this.trigger("changeState","changePenMode",a))},changeColor:function(a){this._sketchpad.color!==a&&(this._sketchpad.color=a,this.trigger("changeState","changeColor",a))},changePenSize:function(a){this._penSize!==a&&(this._penSize=a,this._sketchpad.penSize=this._penSize,this.trigger("changeState","changePenSize",a))},changeEraserSize:function(a){this.trigger("changeState","changeEraserSize",a)},reset:function(){this.trigger("reset"),this._sketchpad.clear()},getWidgetActions:function(){return[{name:"changePenMode",label:"  ",value:"draw",control:{type:"select",valueList:[{label:" ",value:"draw"},{label:" ",value:"eraser"}]}},{name:"changeColor",label:" ",value:"#000",control:{type:"color"},tooltip:"  .      ."},{name:"changePenSize",label:"  ",value:3,control:{type:"select",valueList:[{label:"1px",value:1},{label:"3px",value:3},{label:"5px",value:5},{label:"7px",value:7},{label:"9px",value:9},{label:"11px",value:11},{label:"13px",value:13},{label:"15px",value:15},{label:"18px",value:18},{label:"21px",value:21},{label:"23px",value:23},{label:"25px",value:25}]}},{name:"reset",label:" "}]},properties:function(){return[{name:"Widget",label:"   ",properties:[{label:" ",name:"changePenMode",value:"draw",control:{type:"select",valueList:[{label:" ",value:"draw"},{label:" ",value:"eraser"}]}},{label:" ",name:"changeColor",value:"#000",control:{type:"color"}},{label:"  ",name:"changePenSize",value:3,control:{type:"select",valueList:[{label:"1px",value:1},{label:"3px",value:3},{label:"5px",value:5},{label:"7px",value:7},{label:"9px",value:9},{label:"11px",value:11},{label:"13px",value:13},{label:"15px",value:15},{label:"15px",value:18},{label:"15px",value:21},{label:"15px",value:23},{label:"15px",value:25}]}},{label:"( ) ",name:"canvasColor",control:{type:"color"}}]}]},propertyDefaultValues:function(){return[{name:"draggable",hidden:!0}]}}),a.UIWidgetSketchPad=e}),define("toast/widgets/UIWidgetTextInput",["../core","./UIWidget"],function(a,b){"use strict";var c=(a.Strings,b.prototype),d=b.extend();return _.extend(d.prototype,c,{label:"Widget TextInput",tagName:"input",className:"form-control",style:{color:"#999",fontSize:"20px",fontFamily:"Nanum Gothic",padding:"10px"},textEditable:!0,attributes:{type:"text"},useAction:!0,useAnimation:!0,properties:function(){return[{name:"WidgetTextInputProperty",label:"   ",properties:[{label:" ",name:"placeholder",value:"",control:{type:"text",placeholder:"   "}},{label:"",name:"padding",control:{type:"spinedit",placeholder:"   "}},{label:" ",name:"rightAnswer",value:"",control:{type:"text"},description:"     ..."},{label:"  ",name:"rightAnswerList",control:{type:"list",placeholder:"  ..."},description:"       ."},{label:" ",name:"condition",value:"equal",control:{type:"select",valueList:[{label:"",value:"equal"},{label:"",value:"contain"}]}},{label:" ",name:"rightAnswerColor",value:"#000",control:{type:"color"}},{label:" ",name:"rightAnswerBold",value:!1,control:{type:"checkbox"}}]}]},states:function(){return[{value:"",readonly:!0},{value:"",readonly:!0}]},getWidgetActions:function(){return[{name:"showRightAnswer",label:" ",value:"toggle",control:{type:"select",valueList:[{label:"",value:"toggle"},{label:"",value:"visible"},{label:"",value:"hidden"}]}}]},initialize:function(a){this.style=_.extend({},c.style,this.style),this.mergeProperties(c,this),this.widgetActions=_.extend({},c.getWidgetActions(),this.getWidgetActions()),_.isUndefined(this.model.properties.padding)?this.model.properties.padding=parseInt(this.style.padding):this.style.padding=this.model.properties.padding+"px",this.model.states=_.extend(this.model.states,this.states(),c.states()),c.initialize.call(this,a)},present:function(){return c.present.call(this),this.$el.attr("readonly",!0),this._update(),this},_update:function(a){this.minsize.width=2*this.model.properties.padding,this.minsize.height=2*this.model.properties.padding,this._setVal(),this.model.get("width")<Number(parseFloat(this.$el.css("width")).toFixed(1))&&this.$parent.css("width",this.$el.css("width")),this.model.get("height")<Number(parseFloat(this.$el.css("height")).toFixed(1))&&this.$parent.css("height",this.$el.css("height")),this.$el.css("pointer-events","none")},update:function(a){this.style.padding=this.model.properties.padding+"px",c.update.call(this),this._update();var b=this.model.properties.placeholder;return this.$el.val(""),TT.lazy(function(){this.$el.val(b)},0,this),this},_setVal:function(){_.isUndefined(this.model.properties.placeholder)||_.isEmpty(this.model.properties.placeholder)||this.$el.val(this.model.properties.placeholder)},render:function(){return c.render.call(this),this._action="hidden",this._setFontAttrs(),this},_setFontAttrs:function(){this.style.fontFamily||(this.style.fontFamily=""),this.style.fontWeight||(this.style.fontWeight=""),this.$el.attr("data-font-name",this.style.fontFamily),this.$el.attr("data-font-weight",this.style.fontWeight),this._color=this.$el.css("color")},viewsDidMount:function(){c.viewsDidMount.call(this),this.$el.css("cursor",""),this.__storageId=a.project.config.publishUniqueId+"-"+this.$parent.attr("id");var b=a.LocalStorage.getItem(this.__storageId);_.isNull(b)||_.isEmpty(b)?this._setVal():(this.$el.val(b),a.lazy(function(){this._check()},5,this))},_check:function(){if(!_.isEmpty(this.model.properties.rightAnswer)&&!_.isEmpty(this.$el.val())){var a=this.model.properties.rightAnswer.toLowerCase(),b=this.$el.val().toLowerCase(),c=!1;switch(this.model.properties.condition){case"equal":a===b&&(c=!0),c||_.each(this.model.properties.rightAnswerList,function(a){return a===b?(c=!0,!1):void 0});break;case"contain":-1!==a.indexOf(b)&&(c=!0),c||_.each(this.model.properties.rightAnswerList,function(a){return-1!==a.indexOf(b)?(c=!0,!1):void 0})}c?this.state(this.states()[0].value):this.state(this.states()[1].value)}},showRightAnswer:function(a){switch(a){case"toggle":var b;b="visible"===this._action?"hidden":"visible",this._doAction(b);break;case"visible":this._doAction("visible");break;case"hidden":this._doAction("hidden")}},_doAction:function(a){if(this._action!==a){switch(a){case"visible":this._userRightAnswer=this.$el.val(),this.$el.val(this.model.properties.rightAnswer),this.model.properties.rightAnswerColor&&this.$el.css("color",this.model.properties.rightAnswerColor),this.model.properties.rightAnswerBold&&"bold"!==this.$el.attr("data-font-weight")&&(this._bold=!0,this.$el.attr("data-font-weight","bold"),this.$el.css("fontWeight","bold"));break;case"hidden":this.$el.val(this._userRightAnswer),this._color?this.$el.css("color",this._color):this.$el.css("color",""),this._bold&&(this.$el.removeAttr("data-font-weight"),this.$el.css("fontWeight","")),this._bold=!1}this._action=a}},events:{focus:"_onFocus",focusout:"_onFocusOut",change:"_onChange"},_onClick:function(){this.$el.focus()},_onFocus:function(){a.BookZoom.isActivate()||a.BookZoom._off()},_onFocusOut:function(){a.BookZoom.isActivate()||a.BookZoom._on(),_.isEmpty(this.$el.val())&&this._setVal()},_onChange:function(b){this._check(),a.LocalStorage.setItem(this.__storageId,this.$el.val())}}),a.UIWidgetTextInput=d}),define("toast/widgets/UIWidgetTextInputBox",["../core","./UIWidgetTextInput"],function(a,b){"use strict";var c=(a.Strings,b.prototype),d=b.extend();return _.extend(d.prototype,c,{label:"Widget TextInputBox",tagName:"textarea",style:{color:"#999",fontSize:"28px",padding:"10px"},propertyDefaultValues:function(){return[{name:"rightAnswerList",hidden:!0},{name:"condition",hidden:!0}]},initialize:function(a){this.style=_.extend({},c.style,this.style),c.initialize.call(this,a),this.model.states=[]}}),a.UIWidgetTextInputBox=d}),define("toast/widgets",["./core","./widgets/UIWidgetPrivate","./widgets/UIWidgetSketchPad","./widgets/UIWidgetTextInput","./widgets/UIWidgetTextInputBox"],function(a){}),define("toast/toast",["require","./core","./core2","./events","./utils","./dialogs","./views","./widgets","./actions","./animations","./libs"],function(a,b){function c(){var a=new $.Deferred,c=[];return _.isUndefined(window.config)?c.push({url:"text!config.json",name:"config",json:!0}):b.config=window.config,0===c.length&&a.resolve().promise(),TT.Async.doInParallel(c,function(a){function c(b){a.json&&(b=JSON.parse(b));var c="Toast."+a.name,d=c.slice(c.lastIndexOf(".")+1),f=c.slice(0,c.lastIndexOf(".")).namespace();f[d]=b,e.resolve()}function d(){e.reject()}var e=new $.Deferred;return b.load([a.url],c,d),e.promise()},!0).done(function(){a.resolve()}).fail(function(){a.reject()}),a.promise()}function d(a){i&&clearInterval(i),i=setInterval(function(){clearInterval(i),b.send(b.Events.ORIENTATION_DID_CHANGE,b.orientation()),i=setInterval(function(){clearInterval(i),i=null,b.send(b.Events.ORIENTATION_DID_CHANGE,b.orientation())},150)},150)}var e=new b.UrlParams;b.params=e,e.parse();var f=new $.Deferred;b.ready=function(a){f.promise().done(a),f.success&&f.resolve(),f.success||c().done(function(){b.load(["text!toast/extensions.json"],function(a){if(_.isEmpty(a)||_.isUndefined(a))return void $(document).ready(function(){f.success=!0,f.resolve()});var a=JSON.parse(a);_.isEmpty(a.plugins)||_.isUndefined(a.plugins)||(b.config.plugins=a.plugins),_.isEmpty(a.project_loader)||_.isUndefined(a.project_loader)||(b.config.projectLoader=a.project_loader),_.isEmpty(a.content)||_.isUndefined(a.content)?$(document).ready(function(){f.success=!0,f.resolve()}):b.load(a.content,function(a){$(document).ready(function(){f.success=!0,f.resolve()})})},function(){$(document).ready(function(){f.success=!0,f.resolve()})})})},b.start=function(){b.debug||$(document.body).attr("oncontextmenu","return false;"),b.setPaths(),b.project=b.Project.initialize(),b.projectLoaded(function(){if((_.isEmpty(window.document.title)||-1!==window.document.title.indexOf("{title}"))&&(window.document.title=b.project.metadata.title||b.project.title),e.get("publishUniqueId")&&(b.project.config.publishUniqueId=e.get("publishUniqueId")),TT.$el=$(".toast"),TT.$el.attr("data-version",b.version),b.isMobileDevice&&(TT.$el.addClass("mobile"),$(document.body).addClass("mobile"),b.isTablet&&(TT.$el.addClass("tablet"),$(document.body).addClass("tablet"))),b.config.print||TT.$el.addClass("no-print"),"undefined"!=typeof external&&"undefined"!=typeof external.isNative&&external.isNative()){TT.$el.addClass("native");var a="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",c=!1;$(document).on(a,function(a){if(!external.isFullscreen()||c===!0){var b=a.target;b.fullscreenElement||b.msFullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement?(external.requestFullscreen(),c=!0,TT.$el.addClass("fullscreen")):(c=!1,external.exitFullscreen(),TT.$el.removeClass("fullscreen"))}}),window._exitFullscreen=function(a){TT.$el.removeClass("fullscreen")}}var d=b._getTheme();b.ThemeLoader.load(d,"styles/themes/"+d+"/","theme").done(function(){var a=["./extensions"];_.isUndefined(b.config.plugins)||_.isEmpty(b.config.plugins)||(a=a.concat(b.config.plugins)),b.load(a,function(){b.dispatchReady(b.EXTENSIONS_LOADED);var a=!1;"flip"!==b.config.transition||_.isUndefined(b.project.config.useCoverPage)||(a=b.project.config.useCoverPage);var c={width:Math.floor(b.project.models[0].width),height:Math.floor(b.project.models[0].height)};b.isMobileDevice&&b.config.mobile.landscapeDoublePage&&b.isLandscape()&&(b.config.doublepage=!0),b.Book.initialize({history:!0,autoCenter:!0,transition:b.config.transition,cover:a,display:b.config.doublepage?"double":"single",firstPageNumber:b.project.config.firstPageNumber,shadow:b.config.shadow,pageFlipSound:_.isUndefined(b.config.pageFlipSound)?!0:b.config.pageFlipSound,margin:0,minScale:0,maxScale:6,pageSize:c})}),b.on(b.Events.BOOK_READY,function(){b.dispatchReady(b.APP_READY),$(".preloader").remove(),TT.$el.css("opacity",1)})})})},b.setPaths=function(a){function c(){var a=decodeURI(window.location.pathname),b=a.substr(0,a.lastIndexOf("/"));return b=unescape(b),-1!==b.indexOf(":")&&"/"===b[0]&&(b=b.substr(1)),b}if(a||(a={}),b.paths={},b.paths.projectRoot="",b.paths.projectFile="project.json",b.paths.assetsDirectoryName="assets",b.paths.application_dir=c()+"/",b.paths.storage_dir=b.paths.application_dir+"storages/",e.get("projectRoot"))b.paths.projectRoot=e.get("projectRoot");else if("file:"===window.document.location.href.substr(0,5)){var d=window.document.location.href;d=d.substr(8,d.length-8),b.paths.projectRoot=decodeURIComponent(d.substring(0,d.lastIndexOf("/",d.length-2)+1))}if(e.get("projectFile")){var f=e.get("projectFile");b.paths.projectFile=f;var g=f,h=g.lastIndexOf(".");-1!==h&&(g=g.slice(0,h)),b.paths.assetsDirectoryName=g}b.paths=_.extend({},b.paths,a),_.isUndefined(b.config.assetsUrl)||_.isEmpty(b.config.assetsUrl)?b.paths.assets=b.paths.projectRoot+b.paths.assetsDirectoryName+"/":(b.paths.assets=b.config.assetsUrl,"/"!==b.paths.assets.substr(b.paths.assets.length-1,1)&&(b.paths.assets+="/")),b.paths.shared=b.paths.assets+"shared/",_.isUndefined(b.config.dataUrl)||_.isEmpty(b.config.dataUrl)?b.paths.data=b.paths.assets:(b.paths.data=b.config.dataUrl,"/"!==b.paths.data.substr(b.paths.data.length-1,1)&&(b.paths.data+="/")),b.StringUtils.templateStrings.APP_DIR=b.paths.application_dir,b.StringUtils.templateStrings.ASSETS_DIR=b.paths.assets,b.StringUtils.templateStrings.DATA_DIR=b.paths.data,b.StringUtils.templateStrings.SHARED_DIR=b.paths.shared,b.StringUtils.templateStrings.MOBILE_PAGE_DIR=b.StringUtils.templateStrings.ASSETS_DIR+"mobile-page-images/"},b.isLocaleDefault=function(){return!b.LocalStorage.getItem("locale")},b.getLocale=function(){return e.get("testEnvironment")?"en":b.LocalStorage.getItem("locale")||window.require.s.contexts._.config.locale},b.setLocale=function(a){a?b.LocalStorage.setItem("locale",a):b.LocalStorage.removeItem("locale")},b._getTheme=function(){if(_.isUndefined(b.config.themes))return b.project.config.theme;var a,c=b.LocalStorage.getItem(b.project.config.publishUniqueId+"-toast-theme");if(_.isUndefined(c)||_.isNull(c)){if(void 0!==b.project.config.theme&&(a=_.findWhere(b.config.themes,{name:b.project.config.theme})))return a.name}else if(a=_.findWhere(b.config.themes,{name:c}))return a.name;return a=_.findWhere(b.config.themes,{"default":!0}),a?a.name:b.config.themes[0].name};var g="onorientationchange"in window,h=g?"orientationchange":"resize";b.isAndroid&&(g=!1,h="resize"),b.orientation=function(){return b.isMobileDevice?g?0===window.orientation||180===window.orientation?"portrait":"landscape":window.innerWidth>window.innerHeight?"landscape":"portrait":""},b.isLandscape=function(){return"landscape"===b.orientation()};var i;return b.isMobileDevice&&window.addEventListener(h,d,!1),b.isInputBoxFocused=function(){return $("input:focus").get(0)||$("textarea:focus").get(0)},b.getModuleBaseUrl=function(a){var b=a.uri;return b.substring(0,b.lastIndexOf("/",b.length-2)+1)},b.lazy=function(a,b,c){c?setTimeout($.proxy(a,c),b):setTimeout(a,b)},b.lazyOnce=function(a,b,c,d){c.id&&clearTimeout(c.id),d?c.id=setTimeout($.proxy(a,d),b):c.id=setTimeout(a,b)},b.executeCommand=function(a){var c=b.CommandManager.get(a);return c?c.execute.apply(c,Array.prototype.slice.call(arguments,1)):(new $.Deferred).reject().promise()},b.executeFunctionByName=function(a,b){for(var c=[].slice.call(arguments).splice(2),d=a.split("."),e=d.pop(),f=0;f<d.length;f++)b=b[d[f]];return b[e].apply(b,c)},b.getModule=a,b.load=a,b});